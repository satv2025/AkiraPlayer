!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).AkiraPlayer={})}(this,function(e){"use strict";var t,r,s={exports:{}},n={};var i,a,o=(r||(r=1,s.exports=function(){if(t)return n;t=1;var e=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function s(t,r,s){var n=null;if(void 0!==s&&(n=""+s),void 0!==r.key&&(n=""+r.key),"key"in r)for(var i in s={},r)"key"!==i&&(s[i]=r[i]);else s=r;return r=s.ref,{$$typeof:e,type:t,key:n,ref:void 0!==r?r:null,props:s}}return n.Fragment=r,n.jsx=s,n.jsxs=s,n}()),s.exports),l={exports:{}},u={},c={exports:{}},d={};function h(){return a||(a=1,c.exports=(i||(i=1,function(e){function t(e,t){var r=e.length;e.push(t);e:for(;0<r;){var s=r-1>>>1,i=e[s];if(!(0<n(i,t)))break e;e[s]=t,e[r]=i,r=s}}function r(e){return 0===e.length?null:e[0]}function s(e){if(0===e.length)return null;var t=e[0],r=e.pop();if(r!==t){e[0]=r;e:for(var s=0,i=e.length,a=i>>>1;s<a;){var o=2*(s+1)-1,l=e[o],u=o+1,c=e[u];if(0>n(l,r))u<i&&0>n(c,l)?(e[s]=c,e[u]=r,s=u):(e[s]=l,e[o]=r,s=o);else{if(!(u<i&&0>n(c,r)))break e;e[s]=c,e[u]=r,s=u}}}return t}function n(e,t){var r=e.sortIndex-t.sortIndex;return 0!==r?r:e.id-t.id}if(e.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var i=performance;e.unstable_now=function(){return i.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],u=[],c=1,d=null,h=3,f=!1,g=!1,p=!1,m=!1,y="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,b="undefined"!=typeof setImmediate?setImmediate:null;function E(e){for(var n=r(u);null!==n;){if(null===n.callback)s(u);else{if(!(n.startTime<=e))break;s(u),n.sortIndex=n.expirationTime,t(l,n)}n=r(u)}}function S(e){if(p=!1,E(e),!g)if(null!==r(l))g=!0,w||(w=!0,T());else{var t=r(u);null!==t&&C(S,t.startTime-e)}}var T,w=!1,k=-1,_=5,A=-1;function L(){return!(!m&&e.unstable_now()-A<_)}function R(){if(m=!1,w){var t=e.unstable_now();A=t;var n=!0;try{e:{g=!1,p&&(p=!1,v(k),k=-1),f=!0;var i=h;try{t:{for(E(t),d=r(l);null!==d&&!(d.expirationTime>t&&L());){var a=d.callback;if("function"==typeof a){d.callback=null,h=d.priorityLevel;var o=a(d.expirationTime<=t);if(t=e.unstable_now(),"function"==typeof o){d.callback=o,E(t),n=!0;break t}d===r(l)&&s(l),E(t)}else s(l);d=r(l)}if(null!==d)n=!0;else{var c=r(u);null!==c&&C(S,c.startTime-t),n=!1}}break e}finally{d=null,h=i,f=!1}n=void 0}}finally{n?T():w=!1}}}if("function"==typeof b)T=function(){b(R)};else if("undefined"!=typeof MessageChannel){var I=new MessageChannel,P=I.port2;I.port1.onmessage=R,T=function(){P.postMessage(null)}}else T=function(){y(R,0)};function C(t,r){k=y(function(){t(e.unstable_now())},r)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_=0<e?Math.floor(1e3/e):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_next=function(e){switch(h){case 1:case 2:case 3:var t=3;break;default:t=h}var r=h;h=t;try{return e()}finally{h=r}},e.unstable_requestPaint=function(){m=!0},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=h;h=e;try{return t()}finally{h=r}},e.unstable_scheduleCallback=function(s,n,i){var a=e.unstable_now();switch(i="object"==typeof i&&null!==i&&"number"==typeof(i=i.delay)&&0<i?a+i:a,s){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return s={id:c++,callback:n,priorityLevel:s,startTime:i,expirationTime:o=i+o,sortIndex:-1},i>a?(s.sortIndex=i,t(u,s),null===r(l)&&s===r(u)&&(p?(v(k),k=-1):p=!0,C(S,i-a))):(s.sortIndex=o,t(l,s),g||f||(g=!0,w||(w=!0,T()))),s},e.unstable_shouldYield=L,e.unstable_wrapCallback=function(e){var t=h;return function(){var r=h;h=t;try{return e.apply(this,arguments)}finally{h=r}}}}(d)),d)),c.exports}var f,g,p={exports:{}},m={};function y(){if(f)return m;f=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),c=Symbol.for("react.lazy"),d=Symbol.for("react.activity"),h=Symbol.iterator;var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},p=Object.assign,y={};function v(e,t,r){this.props=e,this.context=t,this.refs=y,this.updater=r||g}function b(){}function E(e,t,r){this.props=e,this.context=t,this.refs=y,this.updater=r||g}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=v.prototype;var S=E.prototype=new b;S.constructor=E,p(S,v.prototype),S.isPureReactComponent=!0;var T=Array.isArray;function w(){}var k={H:null,A:null,T:null,S:null},_=Object.prototype.hasOwnProperty;function A(t,r,s){var n=s.ref;return{$$typeof:e,type:t,key:r,ref:void 0!==n?n:null,props:s}}function L(t){return"object"==typeof t&&null!==t&&t.$$typeof===e}var R=/\/+/g;function I(e,t){return"object"==typeof e&&null!==e&&null!=e.key?(r=""+e.key,s={"=":"=0",":":"=2"},"$"+r.replace(/[=:]/g,function(e){return s[e]})):t.toString(36);var r,s}function P(r,s,n,i,a){var o=typeof r;"undefined"!==o&&"boolean"!==o||(r=null);var l,u,d=!1;if(null===r)d=!0;else switch(o){case"bigint":case"string":case"number":d=!0;break;case"object":switch(r.$$typeof){case e:case t:d=!0;break;case c:return P((d=r._init)(r._payload),s,n,i,a)}}if(d)return a=a(r),d=""===i?"."+I(r,0):i,T(a)?(n="",null!=d&&(n=d.replace(R,"$&/")+"/"),P(a,s,n,"",function(e){return e})):null!=a&&(L(a)&&(l=a,u=n+(null==a.key||r&&r.key===a.key?"":(""+a.key).replace(R,"$&/")+"/")+d,a=A(l.type,u,l.props)),s.push(a)),1;d=0;var f,g=""===i?".":i+":";if(T(r))for(var p=0;p<r.length;p++)d+=P(i=r[p],s,n,o=g+I(i,p),a);else if("function"==typeof(p=null===(f=r)||"object"!=typeof f?null:"function"==typeof(f=h&&f[h]||f["@@iterator"])?f:null))for(r=p.call(r),p=0;!(i=r.next()).done;)d+=P(i=i.value,s,n,o=g+I(i,p++),a);else if("object"===o){if("function"==typeof r.then)return P(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"==typeof e.status?e.then(w,w):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(r),s,n,i,a);throw s=String(r),Error("Objects are not valid as a React child (found: "+("[object Object]"===s?"object with keys {"+Object.keys(r).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.")}return d}function C(e,t,r){if(null==e)return e;var s=[],n=0;return P(e,s,"","",function(e){return t.call(r,e,n++)}),s}function D(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var x="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)},O={map:C,forEach:function(e,t,r){C(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return C(e,function(){t++}),t},toArray:function(e){return C(e,function(e){return e})||[]},only:function(e){if(!L(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};return m.Activity=d,m.Children=O,m.Component=v,m.Fragment=r,m.Profiler=n,m.PureComponent=E,m.StrictMode=s,m.Suspense=l,m.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,m.__COMPILER_RUNTIME={__proto__:null,c:function(e){return k.H.useMemoCache(e)}},m.cache=function(e){return function(){return e.apply(null,arguments)}},m.cacheSignal=function(){return null},m.cloneElement=function(e,t,r){if(null==e)throw Error("The argument must be a React element, but you passed "+e+".");var s=p({},e.props),n=e.key;if(null!=t)for(i in void 0!==t.key&&(n=""+t.key),t)!_.call(t,i)||"key"===i||"__self"===i||"__source"===i||"ref"===i&&void 0===t.ref||(s[i]=t[i]);var i=arguments.length-2;if(1===i)s.children=r;else if(1<i){for(var a=Array(i),o=0;o<i;o++)a[o]=arguments[o+2];s.children=a}return A(e.type,n,s)},m.createContext=function(e){return(e={$$typeof:a,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:i,_context:e},e},m.createElement=function(e,t,r){var s,n={},i=null;if(null!=t)for(s in void 0!==t.key&&(i=""+t.key),t)_.call(t,s)&&"key"!==s&&"__self"!==s&&"__source"!==s&&(n[s]=t[s]);var a=arguments.length-2;if(1===a)n.children=r;else if(1<a){for(var o=Array(a),l=0;l<a;l++)o[l]=arguments[l+2];n.children=o}if(e&&e.defaultProps)for(s in a=e.defaultProps)void 0===n[s]&&(n[s]=a[s]);return A(e,i,n)},m.createRef=function(){return{current:null}},m.forwardRef=function(e){return{$$typeof:o,render:e}},m.isValidElement=L,m.lazy=function(e){return{$$typeof:c,_payload:{_status:-1,_result:e},_init:D}},m.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},m.startTransition=function(e){var t=k.T,r={};k.T=r;try{var s=e(),n=k.S;null!==n&&n(r,s),"object"==typeof s&&null!==s&&"function"==typeof s.then&&s.then(w,x)}catch(e){x(e)}finally{null!==t&&null!==r.types&&(t.types=r.types),k.T=t}},m.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},m.use=function(e){return k.H.use(e)},m.useActionState=function(e,t,r){return k.H.useActionState(e,t,r)},m.useCallback=function(e,t){return k.H.useCallback(e,t)},m.useContext=function(e){return k.H.useContext(e)},m.useDebugValue=function(){},m.useDeferredValue=function(e,t){return k.H.useDeferredValue(e,t)},m.useEffect=function(e,t){return k.H.useEffect(e,t)},m.useEffectEvent=function(e){return k.H.useEffectEvent(e)},m.useId=function(){return k.H.useId()},m.useImperativeHandle=function(e,t,r){return k.H.useImperativeHandle(e,t,r)},m.useInsertionEffect=function(e,t){return k.H.useInsertionEffect(e,t)},m.useLayoutEffect=function(e,t){return k.H.useLayoutEffect(e,t)},m.useMemo=function(e,t){return k.H.useMemo(e,t)},m.useOptimistic=function(e,t){return k.H.useOptimistic(e,t)},m.useReducer=function(e,t,r){return k.H.useReducer(e,t,r)},m.useRef=function(e){return k.H.useRef(e)},m.useState=function(e){return k.H.useState(e)},m.useSyncExternalStore=function(e,t,r){return k.H.useSyncExternalStore(e,t,r)},m.useTransition=function(){return k.H.useTransition()},m.version="19.2.4",m}function v(){return g||(g=1,p.exports=y()),p.exports}var b,E,S,T,w={exports:{}},k={};function _(){if(b)return k;b=1;var e=v();function t(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var r=2;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(){}var s={d:{f:r,r:function(){throw Error(t(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},n=Symbol.for("react.portal");var i=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function a(e,t){return"font"===e?"":"string"==typeof t?"use-credentials"===t?t:"":void 0}return k.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,k.createPortal=function(e,r){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!r||1!==r.nodeType&&9!==r.nodeType&&11!==r.nodeType)throw Error(t(299));return function(e,t,r){var s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:n,key:null==s?null:""+s,children:e,containerInfo:t,implementation:r}}(e,r,null,s)},k.flushSync=function(e){var t=i.T,r=s.p;try{if(i.T=null,s.p=2,e)return e()}finally{i.T=t,s.p=r,s.d.f()}},k.preconnect=function(e,t){"string"==typeof e&&(t?t="string"==typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,s.d.C(e,t))},k.prefetchDNS=function(e){"string"==typeof e&&s.d.D(e)},k.preinit=function(e,t){if("string"==typeof e&&t&&"string"==typeof t.as){var r=t.as,n=a(r,t.crossOrigin),i="string"==typeof t.integrity?t.integrity:void 0,o="string"==typeof t.fetchPriority?t.fetchPriority:void 0;"style"===r?s.d.S(e,"string"==typeof t.precedence?t.precedence:void 0,{crossOrigin:n,integrity:i,fetchPriority:o}):"script"===r&&s.d.X(e,{crossOrigin:n,integrity:i,fetchPriority:o,nonce:"string"==typeof t.nonce?t.nonce:void 0})}},k.preinitModule=function(e,t){if("string"==typeof e)if("object"==typeof t&&null!==t){if(null==t.as||"script"===t.as){var r=a(t.as,t.crossOrigin);s.d.M(e,{crossOrigin:r,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0})}}else null==t&&s.d.M(e)},k.preload=function(e,t){if("string"==typeof e&&"object"==typeof t&&null!==t&&"string"==typeof t.as){var r=t.as,n=a(r,t.crossOrigin);s.d.L(e,r,{crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0,type:"string"==typeof t.type?t.type:void 0,fetchPriority:"string"==typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"==typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"==typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"==typeof t.imageSizes?t.imageSizes:void 0,media:"string"==typeof t.media?t.media:void 0})}},k.preloadModule=function(e,t){if("string"==typeof e)if(t){var r=a(t.as,t.crossOrigin);s.d.m(e,{as:"string"==typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:r,integrity:"string"==typeof t.integrity?t.integrity:void 0})}else s.d.m(e)},k.requestFormReset=function(e){s.d.r(e)},k.unstable_batchedUpdates=function(e,t){return e(t)},k.useFormState=function(e,t,r){return i.H.useFormState(e,t,r)},k.useFormStatus=function(){return i.H.useHostTransitionStatus()},k.version="19.2.4",k}function A(){if(S)return u;S=1;var e=h(),t=v(),r=(E||(E=1,function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),w.exports=_()),w.exports);function s(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var r=2;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function i(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(r=t.return),e=t.return}while(e)}return 3===t.tag?r:null}function a(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function o(e){if(31===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function l(e){if(i(e)!==e)throw Error(s(188))}function c(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=c(e)))return t;e=e.sibling}return null}var d=Object.assign,f=Symbol.for("react.element"),g=Symbol.for("react.transitional.element"),p=Symbol.for("react.portal"),m=Symbol.for("react.fragment"),y=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),k=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),L=Symbol.for("react.suspense"),R=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),P=Symbol.for("react.lazy"),C=Symbol.for("react.activity"),D=Symbol.for("react.memo_cache_sentinel"),x=Symbol.iterator;function O(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=x&&e[x]||e["@@iterator"])?e:null}var N=Symbol.for("react.client.reference");function M(e){if(null==e)return null;if("function"==typeof e)return e.$$typeof===N?null:e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case m:return"Fragment";case b:return"Profiler";case y:return"StrictMode";case L:return"Suspense";case R:return"SuspenseList";case C:return"Activity"}if("object"==typeof e)switch(e.$$typeof){case p:return"Portal";case k:return e.displayName||"Context";case T:return(e._context.displayName||"Context")+".Consumer";case A:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case I:return null!==(t=e.displayName||null)?t:M(e.type)||"Memo";case P:t=e._payload,e=e._init;try{return M(e(t))}catch(e){}}return null}var F=Array.isArray,$=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,U=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,B={pending:!1,data:null,method:null,action:null},j=[],G=-1;function K(e){return{current:e}}function H(e){0>G||(e.current=j[G],j[G]=null,G--)}function V(e,t){G++,j[G]=e.current,e.current=t}var z,q,W=K(null),Y=K(null),Q=K(null),X=K(null);function J(e,t){switch(V(Q,t),V(Y,e),V(W,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?Sd(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=Td(t=Sd(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}H(W),V(W,e)}function Z(){H(W),H(Y),H(Q)}function ee(e){null!==e.memoizedState&&V(X,e);var t=W.current,r=Td(t,e.type);t!==r&&(V(Y,e),V(W,r))}function te(e){Y.current===e&&(H(W),H(Y)),X.current===e&&(H(X),gh._currentValue=B)}function re(e){if(void 0===z)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);z=t&&t[1]||"",q=-1<e.stack.indexOf("\n    at")?" (<anonymous>)":-1<e.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+z+e+q}var se=!1;function ne(e,t){if(!e||se)return"";se=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var s={DetermineComponentFrameRoot:function(){try{if(t){var r=function(){throw Error()};if(Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(r,[])}catch(e){var s=e}Reflect.construct(e,[],r)}else{try{r.call()}catch(e){s=e}e.call(r.prototype)}}else{try{throw Error()}catch(e){s=e}(r=e())&&"function"==typeof r.catch&&r.catch(function(){})}}catch(e){if(e&&s&&"string"==typeof e.stack)return[e.stack,s.stack]}return[null,null]}};s.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var n=Object.getOwnPropertyDescriptor(s.DetermineComponentFrameRoot,"name");n&&n.configurable&&Object.defineProperty(s.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var i=s.DetermineComponentFrameRoot(),a=i[0],o=i[1];if(a&&o){var l=a.split("\n"),u=o.split("\n");for(n=s=0;s<l.length&&!l[s].includes("DetermineComponentFrameRoot");)s++;for(;n<u.length&&!u[n].includes("DetermineComponentFrameRoot");)n++;if(s===l.length||n===u.length)for(s=l.length-1,n=u.length-1;1<=s&&0<=n&&l[s]!==u[n];)n--;for(;1<=s&&0<=n;s--,n--)if(l[s]!==u[n]){if(1!==s||1!==n)do{if(s--,0>--n||l[s]!==u[n]){var c="\n"+l[s].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=s&&0<=n);break}}}finally{se=!1,Error.prepareStackTrace=r}return(r=e?e.displayName||e.name:"")?re(r):""}function ie(e,t){switch(e.tag){case 26:case 27:case 5:return re(e.type);case 16:return re("Lazy");case 13:return e.child!==t&&null!==t?re("Suspense Fallback"):re("Suspense");case 19:return re("SuspenseList");case 0:case 15:return ne(e.type,!1);case 11:return ne(e.type.render,!1);case 1:return ne(e.type,!0);case 31:return re("Activity");default:return""}}function ae(e){try{var t="",r=null;do{t+=ie(e,r),r=e,e=e.return}while(e);return t}catch(e){return"\nError generating stack: "+e.message+"\n"+e.stack}}var oe=Object.prototype.hasOwnProperty,le=e.unstable_scheduleCallback,ue=e.unstable_cancelCallback,ce=e.unstable_shouldYield,de=e.unstable_requestPaint,he=e.unstable_now,fe=e.unstable_getCurrentPriorityLevel,ge=e.unstable_ImmediatePriority,pe=e.unstable_UserBlockingPriority,me=e.unstable_NormalPriority,ye=e.unstable_LowPriority,ve=e.unstable_IdlePriority,be=e.log,Ee=e.unstable_setDisableYieldValue,Se=null,Te=null;function we(e){if("function"==typeof be&&Ee(e),Te&&"function"==typeof Te.setStrictMode)try{Te.setStrictMode(Se,e)}catch(e){}}var ke=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(_e(e)/Ae|0)|0},_e=Math.log,Ae=Math.LN2;var Le=256,Re=262144,Ie=4194304;function Pe(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return 261888&e;case 262144:case 524288:case 1048576:case 2097152:return 3932160&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Ce(e,t,r){var s=e.pendingLanes;if(0===s)return 0;var n=0,i=e.suspendedLanes,a=e.pingedLanes;e=e.warmLanes;var o=134217727&s;return 0!==o?0!==(s=o&~i)?n=Pe(s):0!==(a&=o)?n=Pe(a):r||0!==(r=o&~e)&&(n=Pe(r)):0!==(o=s&~i)?n=Pe(o):0!==a?n=Pe(a):r||0!==(r=s&~e)&&(n=Pe(r)),0===n?0:0!==t&&t!==n&&0===(t&i)&&((i=n&-n)>=(r=t&-t)||32===i&&4194048&r)?t:n}function De(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function xe(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Oe(){var e=Ie;return!(62914560&(Ie<<=1))&&(Ie=4194304),e}function Ne(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function Me(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Fe(e,t,r){e.pendingLanes|=t,e.suspendedLanes&=~t;var s=31-ke(t);e.entangledLanes|=t,e.entanglements[s]=1073741824|e.entanglements[s]|261930&r}function $e(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var s=31-ke(r),n=1<<s;n&t|e[s]&t&&(e[s]|=t),r&=~n}}function Ue(e,t){var r=t&-t;return 0!==((r=42&r?1:Be(r))&(e.suspendedLanes|t))?0:r}function Be(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function je(e){return 2<(e&=-e)?8<e?134217727&e?32:268435456:8:2}function Ge(){var e=U.p;return 0!==e?e:void 0===(e=window.event)?32:Ph(e.type)}function Ke(e,t){var r=U.p;try{return U.p=e,t()}finally{U.p=r}}var He=Math.random().toString(36).slice(2),Ve="__reactFiber$"+He,ze="__reactProps$"+He,qe="__reactContainer$"+He,We="__reactEvents$"+He,Ye="__reactListeners$"+He,Qe="__reactHandles$"+He,Xe="__reactResources$"+He,Je="__reactMarker$"+He;function Ze(e){delete e[Ve],delete e[ze],delete e[We],delete e[Ye],delete e[Qe]}function et(e){var t=e[Ve];if(t)return t;for(var r=e.parentNode;r;){if(t=r[qe]||r[Ve]){if(r=t.alternate,null!==t.child||null!==r&&null!==r.child)for(e=Bd(e);null!==e;){if(r=e[Ve])return r;e=Bd(e)}return t}r=(e=r).parentNode}return null}function tt(e){if(e=e[Ve]||e[qe]){var t=e.tag;if(5===t||6===t||13===t||31===t||26===t||27===t||3===t)return e}return null}function rt(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(s(33))}function st(e){var t=e[Xe];return t||(t=e[Xe]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function nt(e){e[Je]=!0}var it=new Set,at={};function ot(e,t){lt(e,t),lt(e+"Capture",t)}function lt(e,t){for(at[e]=t,e=0;e<t.length;e++)it.add(t[e])}var ut=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ct={},dt={};function ht(e,t,r){if(n=t,oe.call(dt,n)||!oe.call(ct,n)&&(ut.test(n)?dt[n]=!0:(ct[n]=!0,0)))if(null===r)e.removeAttribute(t);else{switch(typeof r){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var s=t.toLowerCase().slice(0,5);if("data-"!==s&&"aria-"!==s)return void e.removeAttribute(t)}e.setAttribute(t,""+r)}var n}function ft(e,t,r){if(null===r)e.removeAttribute(t);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+r)}}function gt(e,t,r,s){if(null===s)e.removeAttribute(r);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(r)}e.setAttributeNS(t,r,""+s)}}function pt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function mt(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function yt(e){if(!e._valueTracker){var t=mt(e)?"checked":"value";e._valueTracker=function(e,t,r){var s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&void 0!==s&&"function"==typeof s.get&&"function"==typeof s.set){var n=s.get,i=s.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return n.call(this)},set:function(e){r=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:s.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e,t,""+e[t])}}function vt(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),s="";return e&&(s=mt(e)?e.checked?"true":"false":e.value),(e=s)!==r&&(t.setValue(e),!0)}function bt(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var Et=/[\n"\\]/g;function St(e){return e.replace(Et,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function Tt(e,t,r,s,n,i,a,o){e.name="",null!=a&&"function"!=typeof a&&"symbol"!=typeof a&&"boolean"!=typeof a?e.type=a:e.removeAttribute("type"),null!=t?"number"===a?(0===t&&""===e.value||e.value!=t)&&(e.value=""+pt(t)):e.value!==""+pt(t)&&(e.value=""+pt(t)):"submit"!==a&&"reset"!==a||e.removeAttribute("value"),null!=t?kt(e,a,pt(t)):null!=r?kt(e,a,pt(r)):null!=s&&e.removeAttribute("value"),null==n&&null!=i&&(e.defaultChecked=!!i),null!=n&&(e.checked=n&&"function"!=typeof n&&"symbol"!=typeof n),null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&"boolean"!=typeof o?e.name=""+pt(o):e.removeAttribute("name")}function wt(e,t,r,s,n,i,a,o){if(null!=i&&"function"!=typeof i&&"symbol"!=typeof i&&"boolean"!=typeof i&&(e.type=i),null!=t||null!=r){if(("submit"===i||"reset"===i)&&null==t)return void yt(e);r=null!=r?""+pt(r):"",t=null!=t?""+pt(t):r,o||t===e.value||(e.value=t),e.defaultValue=t}s="function"!=typeof(s=null!=s?s:n)&&"symbol"!=typeof s&&!!s,e.checked=o?e.checked:!!s,e.defaultChecked=!!s,null!=a&&"function"!=typeof a&&"symbol"!=typeof a&&"boolean"!=typeof a&&(e.name=a),yt(e)}function kt(e,t,r){"number"===t&&bt(e.ownerDocument)===e||e.defaultValue===""+r||(e.defaultValue=""+r)}function _t(e,t,r,s){if(e=e.options,t){t={};for(var n=0;n<r.length;n++)t["$"+r[n]]=!0;for(r=0;r<e.length;r++)n=t.hasOwnProperty("$"+e[r].value),e[r].selected!==n&&(e[r].selected=n),n&&s&&(e[r].defaultSelected=!0)}else{for(r=""+pt(r),t=null,n=0;n<e.length;n++){if(e[n].value===r)return e[n].selected=!0,void(s&&(e[n].defaultSelected=!0));null!==t||e[n].disabled||(t=e[n])}null!==t&&(t.selected=!0)}}function At(e,t,r){null==t||((t=""+pt(t))!==e.value&&(e.value=t),null!=r)?e.defaultValue=null!=r?""+pt(r):"":e.defaultValue!==t&&(e.defaultValue=t)}function Lt(e,t,r,n){if(null==t){if(null!=n){if(null!=r)throw Error(s(92));if(F(n)){if(1<n.length)throw Error(s(93));n=n[0]}r=n}null==r&&(r=""),t=r}r=pt(t),e.defaultValue=r,(n=e.textContent)===r&&""!==n&&null!==n&&(e.value=n),yt(e)}function Rt(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&3===r.nodeType)return void(r.nodeValue=t)}e.textContent=t}var It=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Pt(e,t,r){var s=0===t.indexOf("--");null==r||"boolean"==typeof r||""===r?s?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":s?e.setProperty(t,r):"number"!=typeof r||0===r||It.has(t)?"float"===t?e.cssFloat=r:e[t]=(""+r).trim():e[t]=r+"px"}function Ct(e,t,r){if(null!=t&&"object"!=typeof t)throw Error(s(62));if(e=e.style,null!=r){for(var n in r)!r.hasOwnProperty(n)||null!=t&&t.hasOwnProperty(n)||(0===n.indexOf("--")?e.setProperty(n,""):"float"===n?e.cssFloat="":e[n]="");for(var i in t)n=t[i],t.hasOwnProperty(i)&&r[i]!==n&&Pt(e,i,n)}else for(var a in t)t.hasOwnProperty(a)&&Pt(e,a,t[a])}function Dt(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ot=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Nt(e){return Ot.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Mt(){}var Ft=null;function $t(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ut=null,Bt=null;function jt(e){var t=tt(e);if(t&&(e=t.stateNode)){var r=e[ze]||null;e:switch(e=t.stateNode,t.type){case"input":if(Tt(e,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name),t=r.name,"radio"===r.type&&null!=t){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll('input[name="'+St(""+t)+'"][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var i=n[ze]||null;if(!i)throw Error(s(90));Tt(n,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name)}}for(t=0;t<r.length;t++)(n=r[t]).form===e.form&&vt(n)}break e;case"textarea":At(e,r.value,r.defaultValue);break e;case"select":null!=(t=r.value)&&_t(e,!!r.multiple,t,!1)}}}var Gt=!1;function Kt(e,t,r){if(Gt)return e(t,r);Gt=!0;try{return e(t)}finally{if(Gt=!1,(null!==Ut||null!==Bt)&&(sc(),Ut&&(t=Ut,e=Bt,Bt=Ut=null,jt(t),e)))for(t=0;t<e.length;t++)jt(e[t])}}function Ht(e,t){var r=e.stateNode;if(null===r)return null;var n=r[ze]||null;if(null===n)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}if(e)return null;if(r&&"function"!=typeof r)throw Error(s(231,t,typeof r));return r}var Vt=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),zt=!1;if(Vt)try{var qt={};Object.defineProperty(qt,"passive",{get:function(){zt=!0}}),window.addEventListener("test",qt,qt),window.removeEventListener("test",qt,qt)}catch(e){zt=!1}var Wt=null,Yt=null,Qt=null;function Xt(){if(Qt)return Qt;var e,t,r=Yt,s=r.length,n="value"in Wt?Wt.value:Wt.textContent,i=n.length;for(e=0;e<s&&r[e]===n[e];e++);var a=s-e;for(t=1;t<=a&&r[s-t]===n[i-t];t++);return Qt=n.slice(e,1<t?1-t:void 0)}function Jt(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Zt(){return!0}function er(){return!1}function tr(e){function t(t,r,s,n,i){for(var a in this._reactName=t,this._targetInst=s,this.type=r,this.nativeEvent=n,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(n):n[a]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?Zt:er,this.isPropagationStopped=er,this}return d(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Zt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Zt)},persist:function(){},isPersistent:Zt}),t}var rr,sr,nr,ir={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ar=tr(ir),or=d({},ir,{view:0,detail:0}),lr=tr(or),ur=d({},or,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Er,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==nr&&(nr&&"mousemove"===e.type?(rr=e.screenX-nr.screenX,sr=e.screenY-nr.screenY):sr=rr=0,nr=e),rr)},movementY:function(e){return"movementY"in e?e.movementY:sr}}),cr=tr(ur),dr=tr(d({},ur,{dataTransfer:0})),hr=tr(d({},or,{relatedTarget:0})),fr=tr(d({},ir,{animationName:0,elapsedTime:0,pseudoElement:0})),gr=tr(d({},ir,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),pr=tr(d({},ir,{data:0})),mr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},vr={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function br(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=vr[e])&&!!t[e]}function Er(){return br}var Sr=tr(d({},or,{key:function(e){if(e.key){var t=mr[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Jt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?yr[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Er,charCode:function(e){return"keypress"===e.type?Jt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Jt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),Tr=tr(d({},ur,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),wr=tr(d({},or,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Er})),kr=tr(d({},ir,{propertyName:0,elapsedTime:0,pseudoElement:0})),_r=tr(d({},ur,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Ar=tr(d({},ir,{newState:0,oldState:0})),Lr=[9,13,27,32],Rr=Vt&&"CompositionEvent"in window,Ir=null;Vt&&"documentMode"in document&&(Ir=document.documentMode);var Pr=Vt&&"TextEvent"in window&&!Ir,Cr=Vt&&(!Rr||Ir&&8<Ir&&11>=Ir),Dr=String.fromCharCode(32),xr=!1;function Or(e,t){switch(e){case"keyup":return-1!==Lr.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Nr(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Mr=!1;var Fr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $r(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Fr[e.type]:"textarea"===t}function Ur(e,t,r,s){Ut?Bt?Bt.push(s):Bt=[s]:Ut=s,0<(t=od(t,"onChange")).length&&(r=new ar("onChange","change",null,r,s),e.push({event:r,listeners:t}))}var Br=null,jr=null;function Gr(e){Zc(e,0)}function Kr(e){if(vt(rt(e)))return e}function Hr(e,t){if("change"===e)return t}var Vr=!1;if(Vt){var zr;if(Vt){var qr="oninput"in document;if(!qr){var Wr=document.createElement("div");Wr.setAttribute("oninput","return;"),qr="function"==typeof Wr.oninput}zr=qr}else zr=!1;Vr=zr&&(!document.documentMode||9<document.documentMode)}function Yr(){Br&&(Br.detachEvent("onpropertychange",Qr),jr=Br=null)}function Qr(e){if("value"===e.propertyName&&Kr(jr)){var t=[];Ur(t,jr,e,$t(e)),Kt(Gr,t)}}function Xr(e,t,r){"focusin"===e?(Yr(),jr=r,(Br=t).attachEvent("onpropertychange",Qr)):"focusout"===e&&Yr()}function Jr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Kr(jr)}function Zr(e,t){if("click"===e)return Kr(t)}function es(e,t){if("input"===e||"change"===e)return Kr(t)}var ts="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function rs(e,t){if(ts(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(s=0;s<r.length;s++){var n=r[s];if(!oe.call(t,n)||!ts(e[n],t[n]))return!1}return!0}function ss(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ns(e,t){var r,s=ss(e);for(e=0;s;){if(3===s.nodeType){if(r=e+s.textContent.length,e<=t&&r>=t)return{node:s,offset:t-e};e=r}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=ss(s)}}function is(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?is(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function as(e){for(var t=bt((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var r="string"==typeof t.contentWindow.location.href}catch(e){r=!1}if(!r)break;t=bt((e=t.contentWindow).document)}return t}function os(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var ls=Vt&&"documentMode"in document&&11>=document.documentMode,us=null,cs=null,ds=null,hs=!1;function fs(e,t,r){var s=r.window===r?r.document:9===r.nodeType?r:r.ownerDocument;hs||null==us||us!==bt(s)||("selectionStart"in(s=us)&&os(s)?s={start:s.selectionStart,end:s.selectionEnd}:s={anchorNode:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset},ds&&rs(ds,s)||(ds=s,0<(s=od(cs,"onSelect")).length&&(t=new ar("onSelect","select",null,t,r),e.push({event:t,listeners:s}),t.target=us)))}function gs(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var ps={animationend:gs("Animation","AnimationEnd"),animationiteration:gs("Animation","AnimationIteration"),animationstart:gs("Animation","AnimationStart"),transitionrun:gs("Transition","TransitionRun"),transitionstart:gs("Transition","TransitionStart"),transitioncancel:gs("Transition","TransitionCancel"),transitionend:gs("Transition","TransitionEnd")},ms={},ys={};function vs(e){if(ms[e])return ms[e];if(!ps[e])return e;var t,r=ps[e];for(t in r)if(r.hasOwnProperty(t)&&t in ys)return ms[e]=r[t];return e}Vt&&(ys=document.createElement("div").style,"AnimationEvent"in window||(delete ps.animationend.animation,delete ps.animationiteration.animation,delete ps.animationstart.animation),"TransitionEvent"in window||delete ps.transitionend.transition);var bs=vs("animationend"),Es=vs("animationiteration"),Ss=vs("animationstart"),Ts=vs("transitionrun"),ws=vs("transitionstart"),ks=vs("transitioncancel"),_s=vs("transitionend"),As=new Map,Ls="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Rs(e,t){As.set(e,t),ot(t,[e])}Ls.push("scrollEnd");var Is="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)},Ps=[],Cs=0,Ds=0;function xs(){for(var e=Cs,t=Ds=Cs=0;t<e;){var r=Ps[t];Ps[t++]=null;var s=Ps[t];Ps[t++]=null;var n=Ps[t];Ps[t++]=null;var i=Ps[t];if(Ps[t++]=null,null!==s&&null!==n){var a=s.pending;null===a?n.next=n:(n.next=a.next,a.next=n),s.pending=n}0!==i&&Fs(r,n,i)}}function Os(e,t,r,s){Ps[Cs++]=e,Ps[Cs++]=t,Ps[Cs++]=r,Ps[Cs++]=s,Ds|=s,e.lanes|=s,null!==(e=e.alternate)&&(e.lanes|=s)}function Ns(e,t,r,s){return Os(e,t,r,s),$s(e)}function Ms(e,t){return Os(e,null,null,t),$s(e)}function Fs(e,t,r){e.lanes|=r;var s=e.alternate;null!==s&&(s.lanes|=r);for(var n=!1,i=e.return;null!==i;)i.childLanes|=r,null!==(s=i.alternate)&&(s.childLanes|=r),22===i.tag&&(null===(e=i.stateNode)||1&e._visibility||(n=!0)),e=i,i=i.return;return 3===e.tag?(i=e.stateNode,n&&null!==t&&(n=31-ke(r),null===(s=(e=i.hiddenUpdates)[n])?e[n]=[t]:s.push(t),t.lane=536870912|r),i):null}function $s(e){if(50<Wu)throw Wu=0,Yu=null,Error(s(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Us={};function Bs(e,t,r,s){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function js(e,t,r,s){return new Bs(e,t,r,s)}function Gs(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Ks(e,t){var r=e.alternate;return null===r?((r=js(e.tag,t,e.key,e.mode)).elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=65011712&e.flags,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r.refCleanup=e.refCleanup,r}function Hs(e,t){e.flags&=65011714;var r=e.alternate;return null===r?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=r.childLanes,e.lanes=r.lanes,e.child=r.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=r.memoizedProps,e.memoizedState=r.memoizedState,e.updateQueue=r.updateQueue,e.type=r.type,t=r.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Vs(e,t,r,n,i,a){var o=0;if(n=e,"function"==typeof e)Gs(e)&&(o=1);else if("string"==typeof e)o=function(e,t,r){if(1===r||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!=typeof t.precedence||"string"!=typeof t.href||""===t.href)break;return!0;case"link":if("string"!=typeof t.rel||"string"!=typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"==typeof t.precedence&&null==e);case"script":if(t.async&&"function"!=typeof t.async&&"symbol"!=typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"==typeof t.src)return!0}return!1}(e,r,W.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case C:return(e=js(31,r,t,i)).elementType=C,e.lanes=a,e;case m:return zs(r.children,i,a,t);case y:o=8,i|=24;break;case b:return(e=js(12,r,t,2|i)).elementType=b,e.lanes=a,e;case L:return(e=js(13,r,t,i)).elementType=L,e.lanes=a,e;case R:return(e=js(19,r,t,i)).elementType=R,e.lanes=a,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case k:o=10;break e;case T:o=9;break e;case A:o=11;break e;case I:o=14;break e;case P:o=16,n=null;break e}o=29,r=Error(s(130,null===e?"null":typeof e,"")),n=null}return(t=js(o,r,t,i)).elementType=e,t.type=n,t.lanes=a,t}function zs(e,t,r,s){return(e=js(7,e,s,t)).lanes=r,e}function qs(e,t,r){return(e=js(6,e,null,t)).lanes=r,e}function Ws(e){var t=js(18,null,null,0);return t.stateNode=e,t}function Ys(e,t,r){return(t=js(4,null!==e.children?e.children:[],e.key,t)).lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Qs=new WeakMap;function Xs(e,t){if("object"==typeof e&&null!==e){var r=Qs.get(e);return void 0!==r?r:(t={value:e,source:t,stack:ae(t)},Qs.set(e,t),t)}return{value:e,source:t,stack:ae(t)}}var Js=[],Zs=0,en=null,tn=0,rn=[],sn=0,nn=null,an=1,on="";function ln(e,t){Js[Zs++]=tn,Js[Zs++]=en,en=e,tn=t}function un(e,t,r){rn[sn++]=an,rn[sn++]=on,rn[sn++]=nn,nn=e;var s=an;e=on;var n=32-ke(s)-1;s&=~(1<<n),r+=1;var i=32-ke(t)+n;if(30<i){var a=n-n%5;i=(s&(1<<a)-1).toString(32),s>>=a,n-=a,an=1<<32-ke(t)+n|r<<n|s,on=i+e}else an=1<<i|r<<n|s,on=e}function cn(e){null!==e.return&&(ln(e,1),un(e,1,0))}function dn(e){for(;e===en;)en=Js[--Zs],Js[Zs]=null,tn=Js[--Zs],Js[Zs]=null;for(;e===nn;)nn=rn[--sn],rn[sn]=null,on=rn[--sn],rn[sn]=null,an=rn[--sn],rn[sn]=null}function hn(e,t){rn[sn++]=an,rn[sn++]=on,rn[sn++]=nn,an=t.id,on=t.overflow,nn=e}var fn=null,gn=null,pn=!1,mn=null,yn=!1,vn=Error(s(519));function bn(e){throw _n(Xs(Error(s(418,1<arguments.length&&void 0!==arguments[1]&&arguments[1]?"text":"HTML","")),e)),vn}function En(e){var t=e.stateNode,r=e.type,s=e.memoizedProps;switch(t[Ve]=e,t[ze]=s,r){case"dialog":ed("cancel",t),ed("close",t);break;case"iframe":case"object":case"embed":ed("load",t);break;case"video":case"audio":for(r=0;r<Xc.length;r++)ed(Xc[r],t);break;case"source":ed("error",t);break;case"img":case"image":case"link":ed("error",t),ed("load",t);break;case"details":ed("toggle",t);break;case"input":ed("invalid",t),wt(t,s.value,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name,!0);break;case"select":ed("invalid",t);break;case"textarea":ed("invalid",t),Lt(t,s.value,s.defaultValue,s.children)}"string"!=typeof(r=s.children)&&"number"!=typeof r&&"bigint"!=typeof r||t.textContent===""+r||!0===s.suppressHydrationWarning||fd(t.textContent,r)?(null!=s.popover&&(ed("beforetoggle",t),ed("toggle",t)),null!=s.onScroll&&ed("scroll",t),null!=s.onScrollEnd&&ed("scrollend",t),null!=s.onClick&&(t.onclick=Mt),t=!0):t=!1,t||bn(e,!0)}function Sn(e){for(fn=e.return;fn;)switch(fn.tag){case 5:case 31:case 13:return void(yn=!1);case 27:case 3:return void(yn=!0);default:fn=fn.return}}function Tn(e){if(e!==fn)return!1;if(!pn)return Sn(e),pn=!0,!1;var t,r=e.tag;if((t=3!==r&&27!==r)&&((t=5===r)&&(t=!("form"!==(t=e.type)&&"button"!==t)||wd(e.type,e.memoizedProps)),t=!t),t&&gn&&bn(e),Sn(e),13===r){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));gn=Ud(e)}else if(31===r){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));gn=Ud(e)}else 27===r?(r=gn,Pd(e.type)?(e=$d,$d=null,gn=e):gn=r):gn=fn?Fd(e.stateNode.nextSibling):null;return!0}function wn(){gn=fn=null,pn=!1}function kn(){var e=mn;return null!==e&&(null===Ou?Ou=e:Ou.push.apply(Ou,e),mn=null),e}function _n(e){null===mn?mn=[e]:mn.push(e)}var An=K(null),Ln=null,Rn=null;function In(e,t,r){V(An,t._currentValue),t._currentValue=r}function Pn(e){e._currentValue=An.current,H(An)}function Cn(e,t,r){for(;null!==e;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==s&&(s.childLanes|=t)):null!==s&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===r)break;e=e.return}}function Dn(e,t,r,n){var i=e.child;for(null!==i&&(i.return=e);null!==i;){var a=i.dependencies;if(null!==a){var o=i.child;a=a.firstContext;e:for(;null!==a;){var l=a;a=i;for(var u=0;u<t.length;u++)if(l.context===t[u]){a.lanes|=r,null!==(l=a.alternate)&&(l.lanes|=r),Cn(a.return,r,e),n||(o=null);break e}a=l.next}}else if(18===i.tag){if(null===(o=i.return))throw Error(s(341));o.lanes|=r,null!==(a=o.alternate)&&(a.lanes|=r),Cn(o,r,e),o=null}else o=i.child;if(null!==o)o.return=i;else for(o=i;null!==o;){if(o===e){o=null;break}if(null!==(i=o.sibling)){i.return=o.return,o=i;break}o=o.return}i=o}}function xn(e,t,r,n){e=null;for(var i=t,a=!1;null!==i;){if(!a)if(524288&i.flags)a=!0;else if(262144&i.flags)break;if(10===i.tag){var o=i.alternate;if(null===o)throw Error(s(387));if(null!==(o=o.memoizedProps)){var l=i.type;ts(i.pendingProps.value,o.value)||(null!==e?e.push(l):e=[l])}}else if(i===X.current){if(null===(o=i.alternate))throw Error(s(387));o.memoizedState.memoizedState!==i.memoizedState.memoizedState&&(null!==e?e.push(gh):e=[gh])}i=i.return}null!==e&&Dn(t,e,r,n),t.flags|=262144}function On(e){for(e=e.firstContext;null!==e;){if(!ts(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Nn(e){Ln=e,Rn=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Mn(e){return $n(Ln,e)}function Fn(e,t){return null===Ln&&Nn(e),$n(e,t)}function $n(e,t){var r=t._currentValue;if(t={context:t,memoizedValue:r,next:null},null===Rn){if(null===e)throw Error(s(308));Rn=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Rn=Rn.next=t;return r}var Un="undefined"!=typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,r){e.push(r)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},Bn=e.unstable_scheduleCallback,jn=e.unstable_NormalPriority,Gn={$$typeof:k,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Kn(){return{controller:new Un,data:new Map,refCount:0}}function Hn(e){e.refCount--,0===e.refCount&&Bn(jn,function(){e.controller.abort()})}var Vn=null,zn=0,qn=0,Wn=null;function Yn(){if(0===--zn&&null!==Vn){null!==Wn&&(Wn.status="fulfilled");var e=Vn;Vn=null,qn=0,Wn=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Qn=$.S;$.S=function(e,t){Fu=he(),"object"==typeof t&&null!==t&&"function"==typeof t.then&&function(e,t){if(null===Vn){var r=Vn=[];zn=0,qn=zc(),Wn={status:"pending",value:void 0,then:function(e){r.push(e)}}}zn++,t.then(Yn,Yn)}(0,t),null!==Qn&&Qn(e,t)};var Xn=K(null);function Jn(){var e=Xn.current;return null!==e?e:vu.pooledCache}function Zn(e,t){V(Xn,null===t?Xn.current:t.pool)}function ei(){var e=Jn();return null===e?null:{parent:Gn._currentValue,pool:e}}var ti=Error(s(460)),ri=Error(s(474)),si=Error(s(542)),ni={then:function(){}};function ii(e){return"fulfilled"===(e=e.status)||"rejected"===e}function ai(e,t,r){switch(void 0===(r=e[r])?e.push(t):r!==t&&(t.then(Mt,Mt),t=r),t.status){case"fulfilled":return t.value;case"rejected":throw ci(e=t.reason),e;default:if("string"==typeof t.status)t.then(Mt,Mt);else{if(null!==(e=vu)&&100<e.shellSuspendCounter)throw Error(s(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var r=t;r.status="fulfilled",r.value=e}},function(e){if("pending"===t.status){var r=t;r.status="rejected",r.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw ci(e=t.reason),e}throw li=t,ti}}function oi(e){try{return(0,e._init)(e._payload)}catch(e){if(null!==e&&"object"==typeof e&&"function"==typeof e.then)throw li=e,ti;throw e}}var li=null;function ui(){if(null===li)throw Error(s(459));var e=li;return li=null,e}function ci(e){if(e===ti||e===si)throw Error(s(483))}var di=null,hi=0;function fi(e){var t=hi;return hi+=1,null===di&&(di=[]),ai(di,e,t)}function gi(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function pi(e,t){if(t.$$typeof===f)throw Error(s(525));throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function mi(e){function t(t,r){if(e){var s=t.deletions;null===s?(t.deletions=[r],t.flags|=16):s.push(r)}}function r(r,s){if(!e)return null;for(;null!==s;)t(r,s),s=s.sibling;return null}function n(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function i(e,t){return(e=Ks(e,t)).index=0,e.sibling=null,e}function a(t,r,s){return t.index=s,e?null!==(s=t.alternate)?(s=s.index)<r?(t.flags|=67108866,r):s:(t.flags|=67108866,r):(t.flags|=1048576,r)}function o(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function l(e,t,r,s){return null===t||6!==t.tag?((t=qs(r,e.mode,s)).return=e,t):((t=i(t,r)).return=e,t)}function u(e,t,r,s){var n=r.type;return n===m?d(e,t,r.props.children,s,r.key):null!==t&&(t.elementType===n||"object"==typeof n&&null!==n&&n.$$typeof===P&&oi(n)===t.type)?(gi(t=i(t,r.props),r),t.return=e,t):(gi(t=Vs(r.type,r.key,r.props,null,e.mode,s),r),t.return=e,t)}function c(e,t,r,s){return null===t||4!==t.tag||t.stateNode.containerInfo!==r.containerInfo||t.stateNode.implementation!==r.implementation?((t=Ys(r,e.mode,s)).return=e,t):((t=i(t,r.children||[])).return=e,t)}function d(e,t,r,s,n){return null===t||7!==t.tag?((t=zs(r,e.mode,s,n)).return=e,t):((t=i(t,r)).return=e,t)}function h(e,t,r){if("string"==typeof t&&""!==t||"number"==typeof t||"bigint"==typeof t)return(t=qs(""+t,e.mode,r)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case g:return gi(r=Vs(t.type,t.key,t.props,null,e.mode,r),t),r.return=e,r;case p:return(t=Ys(t,e.mode,r)).return=e,t;case P:return h(e,t=oi(t),r)}if(F(t)||O(t))return(t=zs(t,e.mode,r,null)).return=e,t;if("function"==typeof t.then)return h(e,fi(t),r);if(t.$$typeof===k)return h(e,Fn(e,t),r);pi(e,t)}return null}function f(e,t,r,s){var n=null!==t?t.key:null;if("string"==typeof r&&""!==r||"number"==typeof r||"bigint"==typeof r)return null!==n?null:l(e,t,""+r,s);if("object"==typeof r&&null!==r){switch(r.$$typeof){case g:return r.key===n?u(e,t,r,s):null;case p:return r.key===n?c(e,t,r,s):null;case P:return f(e,t,r=oi(r),s)}if(F(r)||O(r))return null!==n?null:d(e,t,r,s,null);if("function"==typeof r.then)return f(e,t,fi(r),s);if(r.$$typeof===k)return f(e,t,Fn(e,r),s);pi(e,r)}return null}function y(e,t,r,s,n){if("string"==typeof s&&""!==s||"number"==typeof s||"bigint"==typeof s)return l(t,e=e.get(r)||null,""+s,n);if("object"==typeof s&&null!==s){switch(s.$$typeof){case g:return u(t,e=e.get(null===s.key?r:s.key)||null,s,n);case p:return c(t,e=e.get(null===s.key?r:s.key)||null,s,n);case P:return y(e,t,r,s=oi(s),n)}if(F(s)||O(s))return d(t,e=e.get(r)||null,s,n,null);if("function"==typeof s.then)return y(e,t,r,fi(s),n);if(s.$$typeof===k)return y(e,t,r,Fn(t,s),n);pi(t,s)}return null}function v(l,u,c,d){if("object"==typeof c&&null!==c&&c.type===m&&null===c.key&&(c=c.props.children),"object"==typeof c&&null!==c){switch(c.$$typeof){case g:e:{for(var b=c.key;null!==u;){if(u.key===b){if((b=c.type)===m){if(7===u.tag){r(l,u.sibling),(d=i(u,c.props.children)).return=l,l=d;break e}}else if(u.elementType===b||"object"==typeof b&&null!==b&&b.$$typeof===P&&oi(b)===u.type){r(l,u.sibling),gi(d=i(u,c.props),c),d.return=l,l=d;break e}r(l,u);break}t(l,u),u=u.sibling}c.type===m?((d=zs(c.props.children,l.mode,d,c.key)).return=l,l=d):(gi(d=Vs(c.type,c.key,c.props,null,l.mode,d),c),d.return=l,l=d)}return o(l);case p:e:{for(b=c.key;null!==u;){if(u.key===b){if(4===u.tag&&u.stateNode.containerInfo===c.containerInfo&&u.stateNode.implementation===c.implementation){r(l,u.sibling),(d=i(u,c.children||[])).return=l,l=d;break e}r(l,u);break}t(l,u),u=u.sibling}(d=Ys(c,l.mode,d)).return=l,l=d}return o(l);case P:return v(l,u,c=oi(c),d)}if(F(c))return function(s,i,o,l){for(var u=null,c=null,d=i,g=i=0,p=null;null!==d&&g<o.length;g++){d.index>g?(p=d,d=null):p=d.sibling;var m=f(s,d,o[g],l);if(null===m){null===d&&(d=p);break}e&&d&&null===m.alternate&&t(s,d),i=a(m,i,g),null===c?u=m:c.sibling=m,c=m,d=p}if(g===o.length)return r(s,d),pn&&ln(s,g),u;if(null===d){for(;g<o.length;g++)null!==(d=h(s,o[g],l))&&(i=a(d,i,g),null===c?u=d:c.sibling=d,c=d);return pn&&ln(s,g),u}for(d=n(d);g<o.length;g++)null!==(p=y(d,s,g,o[g],l))&&(e&&null!==p.alternate&&d.delete(null===p.key?g:p.key),i=a(p,i,g),null===c?u=p:c.sibling=p,c=p);return e&&d.forEach(function(e){return t(s,e)}),pn&&ln(s,g),u}(l,u,c,d);if(O(c)){if("function"!=typeof(b=O(c)))throw Error(s(150));return function(i,o,l,u){if(null==l)throw Error(s(151));for(var c=null,d=null,g=o,p=o=0,m=null,v=l.next();null!==g&&!v.done;p++,v=l.next()){g.index>p?(m=g,g=null):m=g.sibling;var b=f(i,g,v.value,u);if(null===b){null===g&&(g=m);break}e&&g&&null===b.alternate&&t(i,g),o=a(b,o,p),null===d?c=b:d.sibling=b,d=b,g=m}if(v.done)return r(i,g),pn&&ln(i,p),c;if(null===g){for(;!v.done;p++,v=l.next())null!==(v=h(i,v.value,u))&&(o=a(v,o,p),null===d?c=v:d.sibling=v,d=v);return pn&&ln(i,p),c}for(g=n(g);!v.done;p++,v=l.next())null!==(v=y(g,i,p,v.value,u))&&(e&&null!==v.alternate&&g.delete(null===v.key?p:v.key),o=a(v,o,p),null===d?c=v:d.sibling=v,d=v);return e&&g.forEach(function(e){return t(i,e)}),pn&&ln(i,p),c}(l,u,c=b.call(c),d)}if("function"==typeof c.then)return v(l,u,fi(c),d);if(c.$$typeof===k)return v(l,u,Fn(l,c),d);pi(l,c)}return"string"==typeof c&&""!==c||"number"==typeof c||"bigint"==typeof c?(c=""+c,null!==u&&6===u.tag?(r(l,u.sibling),(d=i(u,c)).return=l,l=d):(r(l,u),(d=qs(c,l.mode,d)).return=l,l=d),o(l)):r(l,u)}return function(e,t,r,s){try{hi=0;var n=v(e,t,r,s);return di=null,n}catch(t){if(t===ti||t===si)throw t;var i=js(29,t,null,e.mode);return i.lanes=s,i.return=e,i}}}var yi=mi(!0),vi=mi(!1),bi=!1;function Ei(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Si(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Ti(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function wi(e,t,r){var s=e.updateQueue;if(null===s)return null;if(s=s.shared,2&yu){var n=s.pending;return null===n?t.next=t:(t.next=n.next,n.next=t),s.pending=t,t=$s(e),Fs(e,null,r),t}return Os(e,s,t,r),$s(e)}function ki(e,t,r){if(null!==(t=t.updateQueue)&&(t=t.shared,4194048&r)){var s=t.lanes;r|=s&=e.pendingLanes,t.lanes=r,$e(e,r)}}function _i(e,t){var r=e.updateQueue,s=e.alternate;if(null!==s&&r===(s=s.updateQueue)){var n=null,i=null;if(null!==(r=r.firstBaseUpdate)){do{var a={lane:r.lane,tag:r.tag,payload:r.payload,callback:null,next:null};null===i?n=i=a:i=i.next=a,r=r.next}while(null!==r);null===i?n=i=t:i=i.next=t}else n=i=t;return r={baseState:s.baseState,firstBaseUpdate:n,lastBaseUpdate:i,shared:s.shared,callbacks:s.callbacks},void(e.updateQueue=r)}null===(e=r.lastBaseUpdate)?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}var Ai=!1;function Li(){if(Ai){if(null!==Wn)throw Wn}}function Ri(e,t,r,s){Ai=!1;var n=e.updateQueue;bi=!1;var i=n.firstBaseUpdate,a=n.lastBaseUpdate,o=n.shared.pending;if(null!==o){n.shared.pending=null;var l=o,u=l.next;l.next=null,null===a?i=u:a.next=u,a=l;var c=e.alternate;null!==c&&((o=(c=c.updateQueue).lastBaseUpdate)!==a&&(null===o?c.firstBaseUpdate=u:o.next=u,c.lastBaseUpdate=l))}if(null!==i){var h=n.baseState;for(a=0,c=u=l=null,o=i;;){var f=-536870913&o.lane,g=f!==o.lane;if(g?(Eu&f)===f:(s&f)===f){0!==f&&f===qn&&(Ai=!0),null!==c&&(c=c.next={lane:0,tag:o.tag,payload:o.payload,callback:null,next:null});e:{var p=e,m=o;f=t;var y=r;switch(m.tag){case 1:if("function"==typeof(p=m.payload)){h=p.call(y,h,f);break e}h=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null==(f="function"==typeof(p=m.payload)?p.call(y,h,f):p))break e;h=d({},h,f);break e;case 2:bi=!0}}null!==(f=o.callback)&&(e.flags|=64,g&&(e.flags|=8192),null===(g=n.callbacks)?n.callbacks=[f]:g.push(f))}else g={lane:f,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===c?(u=c=g,l=h):c=c.next=g,a|=f;if(null===(o=o.next)){if(null===(o=n.shared.pending))break;o=(g=o).next,g.next=null,n.lastBaseUpdate=g,n.shared.pending=null}}null===c&&(l=h),n.baseState=l,n.firstBaseUpdate=u,n.lastBaseUpdate=c,null===i&&(n.shared.lanes=0),Ru|=a,e.lanes=a,e.memoizedState=h}}function Ii(e,t){if("function"!=typeof e)throw Error(s(191,e));e.call(t)}function Pi(e,t){var r=e.callbacks;if(null!==r)for(e.callbacks=null,e=0;e<r.length;e++)Ii(r[e],t)}var Ci=K(null),Di=K(0);function xi(e,t){V(Di,e=Au),V(Ci,t),Au=e|t.baseLanes}function Oi(){V(Di,Au),V(Ci,Ci.current)}function Ni(){Au=Di.current,H(Ci),H(Di)}var Mi=K(null),Fi=null;function $i(e){var t=e.alternate;V(Ki,1&Ki.current),V(Mi,e),null===Fi&&(null===t||null!==Ci.current||null!==t.memoizedState)&&(Fi=e)}function Ui(e){V(Ki,Ki.current),V(Mi,e),null===Fi&&(Fi=e)}function Bi(e){22===e.tag?(V(Ki,Ki.current),V(Mi,e),null===Fi&&(Fi=e)):ji()}function ji(){V(Ki,Ki.current),V(Mi,Mi.current)}function Gi(e){H(Mi),Fi===e&&(Fi=null),H(Ki)}var Ki=K(0);function Hi(e){for(var t=e;null!==t;){if(13===t.tag){var r=t.memoizedState;if(null!==r&&(null===(r=r.dehydrated)||Nd(r)||Md(r)))return t}else if(19!==t.tag||"forwards"!==t.memoizedProps.revealOrder&&"backwards"!==t.memoizedProps.revealOrder&&"unstable_legacy-backwards"!==t.memoizedProps.revealOrder&&"together"!==t.memoizedProps.revealOrder){if(null!==t.child){t.child.return=t,t=t.child;continue}}else if(128&t.flags)return t;if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Vi=0,zi=null,qi=null,Wi=null,Yi=!1,Qi=!1,Xi=!1,Ji=0,Zi=0,ea=null,ta=0;function ra(){throw Error(s(321))}function sa(e,t){if(null===t)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!ts(e[r],t[r]))return!1;return!0}function na(e,t,r,s,n,i){return Vi=i,zi=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,$.H=null===e||null===e.memoizedState?Eo:So,Xi=!1,i=r(s,n),Xi=!1,Qi&&(i=aa(t,r,s,n)),ia(e),i}function ia(e){$.H=bo;var t=null!==qi&&null!==qi.next;if(Vi=0,Wi=qi=zi=null,Yi=!1,Zi=0,ea=null,t)throw Error(s(300));null===e||Fo||null!==(e=e.dependencies)&&On(e)&&(Fo=!0)}function aa(e,t,r,n){zi=e;var i=0;do{if(Qi&&(ea=null),Zi=0,Qi=!1,25<=i)throw Error(s(301));if(i+=1,Wi=qi=null,null!=e.updateQueue){var a=e.updateQueue;a.lastEffect=null,a.events=null,a.stores=null,null!=a.memoCache&&(a.memoCache.index=0)}$.H=To,a=t(r,n)}while(Qi);return a}function oa(){var e=$.H,t=e.useState()[0];return t="function"==typeof t.then?fa(t):t,e=e.useState()[0],(null!==qi?qi.memoizedState:null)!==e&&(zi.flags|=1024),t}function la(){var e=0!==Ji;return Ji=0,e}function ua(e,t,r){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r}function ca(e){if(Yi){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}Yi=!1}Vi=0,Wi=qi=zi=null,Qi=!1,Zi=Ji=0,ea=null}function da(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Wi?zi.memoizedState=Wi=e:Wi=Wi.next=e,Wi}function ha(){if(null===qi){var e=zi.alternate;e=null!==e?e.memoizedState:null}else e=qi.next;var t=null===Wi?zi.memoizedState:Wi.next;if(null!==t)Wi=t,qi=e;else{if(null===e){if(null===zi.alternate)throw Error(s(467));throw Error(s(310))}e={memoizedState:(qi=e).memoizedState,baseState:qi.baseState,baseQueue:qi.baseQueue,queue:qi.queue,next:null},null===Wi?zi.memoizedState=Wi=e:Wi=Wi.next=e}return Wi}function fa(e){var t=Zi;return Zi+=1,null===ea&&(ea=[]),e=ai(ea,e,t),t=zi,null===(null===Wi?t.memoizedState:Wi.next)&&(t=t.alternate,$.H=null===t||null===t.memoizedState?Eo:So),e}function ga(e){if(null!==e&&"object"==typeof e){if("function"==typeof e.then)return fa(e);if(e.$$typeof===k)return Mn(e)}throw Error(s(438,String(e)))}function pa(e){var t=null,r=zi.updateQueue;if(null!==r&&(t=r.memoCache),null==t){var s=zi.alternate;null!==s&&(null!==(s=s.updateQueue)&&(null!=(s=s.memoCache)&&(t={data:s.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===r&&(r={lastEffect:null,events:null,stores:null,memoCache:null},zi.updateQueue=r),r.memoCache=t,void 0===(r=t.data[t.index]))for(r=t.data[t.index]=Array(e),s=0;s<e;s++)r[s]=D;return t.index++,r}function ma(e,t){return"function"==typeof t?t(e):t}function ya(e){return va(ha(),qi,e)}function va(e,t,r){var n=e.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=r;var i=e.baseQueue,a=n.pending;if(null!==a){if(null!==i){var o=i.next;i.next=a.next,a.next=o}t.baseQueue=i=a,n.pending=null}if(a=e.baseState,null===i)e.memoizedState=a;else{var l=o=null,u=null,c=t=i.next,d=!1;do{var h=-536870913&c.lane;if(h!==c.lane?(Eu&h)===h:(Vi&h)===h){var f=c.revertLane;if(0===f)null!==u&&(u=u.next={lane:0,revertLane:0,gesture:null,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),h===qn&&(d=!0);else{if((Vi&f)===f){c=c.next,f===qn&&(d=!0);continue}h={lane:0,revertLane:c.revertLane,gesture:null,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},null===u?(l=u=h,o=a):u=u.next=h,zi.lanes|=f,Ru|=f}h=c.action,Xi&&r(a,h),a=c.hasEagerState?c.eagerState:r(a,h)}else f={lane:h,revertLane:c.revertLane,gesture:c.gesture,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},null===u?(l=u=f,o=a):u=u.next=f,zi.lanes|=h,Ru|=h;c=c.next}while(null!==c&&c!==t);if(null===u?o=a:u.next=l,!ts(a,e.memoizedState)&&(Fo=!0,d&&null!==(r=Wn)))throw r;e.memoizedState=a,e.baseState=o,e.baseQueue=u,n.lastRenderedState=a}return null===i&&(n.lanes=0),[e.memoizedState,n.dispatch]}function ba(e){var t=ha(),r=t.queue;if(null===r)throw Error(s(311));r.lastRenderedReducer=e;var n=r.dispatch,i=r.pending,a=t.memoizedState;if(null!==i){r.pending=null;var o=i=i.next;do{a=e(a,o.action),o=o.next}while(o!==i);ts(a,t.memoizedState)||(Fo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),r.lastRenderedState=a}return[a,n]}function Ea(e,t,r){var n=zi,i=ha(),a=pn;if(a){if(void 0===r)throw Error(s(407));r=r()}else r=t();var o=!ts((qi||i).memoizedState,r);if(o&&(i.memoizedState=r,Fo=!0),i=i.queue,Va(wa.bind(null,n,i,e),[e]),i.getSnapshot!==t||o||null!==Wi&&1&Wi.memoizedState.tag){if(n.flags|=2048,Ba(9,{destroy:void 0},Ta.bind(null,n,i,r,t),null),null===vu)throw Error(s(349));a||127&Vi||Sa(n,t,r)}return r}function Sa(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},null===(t=zi.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},zi.updateQueue=t,t.stores=[e]):null===(r=t.stores)?t.stores=[e]:r.push(e)}function Ta(e,t,r,s){t.value=r,t.getSnapshot=s,ka(t)&&_a(e)}function wa(e,t,r){return r(function(){ka(t)&&_a(e)})}function ka(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!ts(e,r)}catch(e){return!0}}function _a(e){var t=Ms(e,2);null!==t&&Ju(t,e,2)}function Aa(e){var t=da();if("function"==typeof e){var r=e;if(e=r(),Xi){we(!0);try{r()}finally{we(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ma,lastRenderedState:e},t}function La(e,t,r,s){return e.baseState=r,va(e,qi,"function"==typeof s?s:ma)}function Ra(e,t,r,n,i){if(mo(e))throw Error(s(485));if(null!==(e=t.action)){var a={payload:i,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){a.listeners.push(e)}};null!==$.T?r(!0):a.isTransition=!1,n(a),null===(r=t.pending)?(a.next=t.pending=a,Ia(t,a)):(a.next=r.next,t.pending=r.next=a)}}function Ia(e,t){var r=t.action,s=t.payload,n=e.state;if(t.isTransition){var i=$.T,a={};$.T=a;try{var o=r(n,s),l=$.S;null!==l&&l(a,o),Pa(e,t,o)}catch(r){Da(e,t,r)}finally{null!==i&&null!==a.types&&(i.types=a.types),$.T=i}}else try{Pa(e,t,i=r(n,s))}catch(r){Da(e,t,r)}}function Pa(e,t,r){null!==r&&"object"==typeof r&&"function"==typeof r.then?r.then(function(r){Ca(e,t,r)},function(r){return Da(e,t,r)}):Ca(e,t,r)}function Ca(e,t,r){t.status="fulfilled",t.value=r,xa(t),e.state=r,null!==(t=e.pending)&&((r=t.next)===t?e.pending=null:(r=r.next,t.next=r,Ia(e,r)))}function Da(e,t,r){var s=e.pending;if(e.pending=null,null!==s){s=s.next;do{t.status="rejected",t.reason=r,xa(t),t=t.next}while(t!==s)}e.action=null}function xa(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Oa(e,t){return t}function Na(e,t){if(pn){var r=vu.formState;if(null!==r){e:{var s=zi;if(pn){if(gn){t:{for(var n=gn,i=yn;8!==n.nodeType;){if(!i){n=null;break t}if(null===(n=Fd(n.nextSibling))){n=null;break t}}n="F!"===(i=n.data)||"F"===i?n:null}if(n){gn=Fd(n.nextSibling),s="F!"===n.data;break e}}bn(s)}s=!1}s&&(t=r[0])}}return(r=da()).memoizedState=r.baseState=t,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Oa,lastRenderedState:t},r.queue=s,r=fo.bind(null,zi,s),s.dispatch=r,s=Aa(!1),i=po.bind(null,zi,!1,s.queue),n={state:t,dispatch:null,action:e,pending:null},(s=da()).queue=n,r=Ra.bind(null,zi,n,i,r),n.dispatch=r,s.memoizedState=e,[t,r,!1]}function Ma(e){return Fa(ha(),qi,e)}function Fa(e,t,r){if(t=va(e,t,Oa)[0],e=ya(ma)[0],"object"==typeof t&&null!==t&&"function"==typeof t.then)try{var s=fa(t)}catch(e){if(e===ti)throw si;throw e}else s=t;var n=(t=ha()).queue,i=n.dispatch;return r!==t.memoizedState&&(zi.flags|=2048,Ba(9,{destroy:void 0},$a.bind(null,n,r),null)),[s,i,e]}function $a(e,t){e.action=t}function Ua(e){var t=ha(),r=qi;if(null!==r)return Fa(t,r,e);ha(),t=t.memoizedState;var s=(r=ha()).queue.dispatch;return r.memoizedState=e,[t,s,!1]}function Ba(e,t,r,s){return e={tag:e,create:r,deps:s,inst:t,next:null},null===(t=zi.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},zi.updateQueue=t),null===(r=t.lastEffect)?t.lastEffect=e.next=e:(s=r.next,r.next=e,e.next=s,t.lastEffect=e),e}function ja(){return ha().memoizedState}function Ga(e,t,r,s){var n=da();zi.flags|=e,n.memoizedState=Ba(1|t,{destroy:void 0},r,void 0===s?null:s)}function Ka(e,t,r,s){var n=ha();s=void 0===s?null:s;var i=n.memoizedState.inst;null!==qi&&null!==s&&sa(s,qi.memoizedState.deps)?n.memoizedState=Ba(t,i,r,s):(zi.flags|=e,n.memoizedState=Ba(1|t,i,r,s))}function Ha(e,t){Ga(8390656,8,e,t)}function Va(e,t){Ka(2048,8,e,t)}function za(e){var t=ha().memoizedState;return function(e){zi.flags|=4;var t=zi.updateQueue;if(null===t)t={lastEffect:null,events:null,stores:null,memoCache:null},zi.updateQueue=t,t.events=[e];else{var r=t.events;null===r?t.events=[e]:r.push(e)}}({ref:t,nextImpl:e}),function(){if(2&yu)throw Error(s(440));return t.impl.apply(void 0,arguments)}}function qa(e,t){return Ka(4,2,e,t)}function Wa(e,t){return Ka(4,4,e,t)}function Ya(e,t){if("function"==typeof t){e=e();var r=t(e);return function(){"function"==typeof r?r():t(null)}}if(null!=t)return e=e(),t.current=e,function(){t.current=null}}function Qa(e,t,r){r=null!=r?r.concat([e]):null,Ka(4,4,Ya.bind(null,t,e),r)}function Xa(){}function Ja(e,t){var r=ha();t=void 0===t?null:t;var s=r.memoizedState;return null!==t&&sa(t,s[1])?s[0]:(r.memoizedState=[e,t],e)}function Za(e,t){var r=ha();t=void 0===t?null:t;var s=r.memoizedState;if(null!==t&&sa(t,s[1]))return s[0];if(s=e(),Xi){we(!0);try{e()}finally{we(!1)}}return r.memoizedState=[s,t],s}function eo(e,t,r){return void 0===r||1073741824&Vi&&!(261930&Eu)?e.memoizedState=t:(e.memoizedState=r,e=Xu(),zi.lanes|=e,Ru|=e,r)}function to(e,t,r,s){return ts(r,t)?r:null!==Ci.current?(e=eo(e,r,s),ts(e,t)||(Fo=!0),e):42&Vi&&(!(1073741824&Vi)||261930&Eu)?(e=Xu(),zi.lanes|=e,Ru|=e,t):(Fo=!0,e.memoizedState=r)}function ro(e,t,r,s,n){var i=U.p;U.p=0!==i&&8>i?i:8;var a,o,l,u=$.T,c={};$.T=c,po(e,!1,t,r);try{var d=n(),h=$.S;if(null!==h&&h(c,d),null!==d&&"object"==typeof d&&"function"==typeof d.then)go(e,t,(a=s,o=[],l={status:"pending",value:null,reason:null,then:function(e){o.push(e)}},d.then(function(){l.status="fulfilled",l.value=a;for(var e=0;e<o.length;e++)(0,o[e])(a)},function(e){for(l.status="rejected",l.reason=e,e=0;e<o.length;e++)(0,o[e])(void 0)}),l),Qu());else go(e,t,s,Qu())}catch(r){go(e,t,{then:function(){},status:"rejected",reason:r},Qu())}finally{U.p=i,null!==u&&null!==c.types&&(u.types=c.types),$.T=u}}function so(){}function no(e,t,r,n){if(5!==e.tag)throw Error(s(476));var i=io(e).queue;ro(e,i,t,B,null===r?so:function(){return ao(e),r(n)})}function io(e){var t=e.memoizedState;if(null!==t)return t;var r={};return(t={memoizedState:B,baseState:B,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ma,lastRenderedState:B},next:null}).next={memoizedState:r,baseState:r,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ma,lastRenderedState:r},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function ao(e){var t=io(e);null===t.next&&(t=e.alternate.memoizedState),go(e,t.next.queue,{},Qu())}function oo(){return Mn(gh)}function lo(){return ha().memoizedState}function uo(){return ha().memoizedState}function co(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var r=Qu(),s=wi(t,e=Ti(r),r);return null!==s&&(Ju(s,t,r),ki(s,t,r)),t={cache:Kn()},void(e.payload=t)}t=t.return}}function ho(e,t,r){var s=Qu();r={lane:s,revertLane:0,gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null},mo(e)?yo(t,r):null!==(r=Ns(e,t,r,s))&&(Ju(r,e,s),vo(r,t,s))}function fo(e,t,r){go(e,t,r,Qu())}function go(e,t,r,s){var n={lane:s,revertLane:0,gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null};if(mo(e))yo(t,n);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=i(a,r);if(n.hasEagerState=!0,n.eagerState=o,ts(o,a))return Os(e,t,n,0),null===vu&&xs(),!1}catch(e){}if(null!==(r=Ns(e,t,n,s)))return Ju(r,e,s),vo(r,t,s),!0}return!1}function po(e,t,r,n){if(n={lane:2,revertLane:zc(),gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},mo(e)){if(t)throw Error(s(479))}else null!==(t=Ns(e,r,n,2))&&Ju(t,e,2)}function mo(e){var t=e.alternate;return e===zi||null!==t&&t===zi}function yo(e,t){Qi=Yi=!0;var r=e.pending;null===r?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function vo(e,t,r){if(4194048&r){var s=t.lanes;r|=s&=e.pendingLanes,t.lanes=r,$e(e,r)}}var bo={readContext:Mn,use:ga,useCallback:ra,useContext:ra,useEffect:ra,useImperativeHandle:ra,useLayoutEffect:ra,useInsertionEffect:ra,useMemo:ra,useReducer:ra,useRef:ra,useState:ra,useDebugValue:ra,useDeferredValue:ra,useTransition:ra,useSyncExternalStore:ra,useId:ra,useHostTransitionStatus:ra,useFormState:ra,useActionState:ra,useOptimistic:ra,useMemoCache:ra,useCacheRefresh:ra};bo.useEffectEvent=ra;var Eo={readContext:Mn,use:ga,useCallback:function(e,t){return da().memoizedState=[e,void 0===t?null:t],e},useContext:Mn,useEffect:Ha,useImperativeHandle:function(e,t,r){r=null!=r?r.concat([e]):null,Ga(4194308,4,Ya.bind(null,t,e),r)},useLayoutEffect:function(e,t){return Ga(4194308,4,e,t)},useInsertionEffect:function(e,t){Ga(4,2,e,t)},useMemo:function(e,t){var r=da();t=void 0===t?null:t;var s=e();if(Xi){we(!0);try{e()}finally{we(!1)}}return r.memoizedState=[s,t],s},useReducer:function(e,t,r){var s=da();if(void 0!==r){var n=r(t);if(Xi){we(!0);try{r(t)}finally{we(!1)}}}else n=t;return s.memoizedState=s.baseState=n,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:n},s.queue=e,e=e.dispatch=ho.bind(null,zi,e),[s.memoizedState,e]},useRef:function(e){return e={current:e},da().memoizedState=e},useState:function(e){var t=(e=Aa(e)).queue,r=fo.bind(null,zi,t);return t.dispatch=r,[e.memoizedState,r]},useDebugValue:Xa,useDeferredValue:function(e,t){return eo(da(),e,t)},useTransition:function(){var e=Aa(!1);return e=ro.bind(null,zi,e.queue,!0,!1),da().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,r){var n=zi,i=da();if(pn){if(void 0===r)throw Error(s(407));r=r()}else{if(r=t(),null===vu)throw Error(s(349));127&Eu||Sa(n,t,r)}i.memoizedState=r;var a={value:r,getSnapshot:t};return i.queue=a,Ha(wa.bind(null,n,a,e),[e]),n.flags|=2048,Ba(9,{destroy:void 0},Ta.bind(null,n,a,r,t),null),r},useId:function(){var e=da(),t=vu.identifierPrefix;if(pn){var r=on;t="_"+t+"R_"+(r=(an&~(1<<32-ke(an)-1)).toString(32)+r),0<(r=Ji++)&&(t+="H"+r.toString(32)),t+="_"}else t="_"+t+"r_"+(r=ta++).toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:oo,useFormState:Na,useActionState:Na,useOptimistic:function(e){var t=da();t.memoizedState=t.baseState=e;var r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=r,t=po.bind(null,zi,!0,r),r.dispatch=t,[e,t]},useMemoCache:pa,useCacheRefresh:function(){return da().memoizedState=co.bind(null,zi)},useEffectEvent:function(e){var t=da(),r={impl:e};return t.memoizedState=r,function(){if(2&yu)throw Error(s(440));return r.impl.apply(void 0,arguments)}}},So={readContext:Mn,use:ga,useCallback:Ja,useContext:Mn,useEffect:Va,useImperativeHandle:Qa,useInsertionEffect:qa,useLayoutEffect:Wa,useMemo:Za,useReducer:ya,useRef:ja,useState:function(){return ya(ma)},useDebugValue:Xa,useDeferredValue:function(e,t){return to(ha(),qi.memoizedState,e,t)},useTransition:function(){var e=ya(ma)[0],t=ha().memoizedState;return["boolean"==typeof e?e:fa(e),t]},useSyncExternalStore:Ea,useId:lo,useHostTransitionStatus:oo,useFormState:Ma,useActionState:Ma,useOptimistic:function(e,t){return La(ha(),0,e,t)},useMemoCache:pa,useCacheRefresh:uo};So.useEffectEvent=za;var To={readContext:Mn,use:ga,useCallback:Ja,useContext:Mn,useEffect:Va,useImperativeHandle:Qa,useInsertionEffect:qa,useLayoutEffect:Wa,useMemo:Za,useReducer:ba,useRef:ja,useState:function(){return ba(ma)},useDebugValue:Xa,useDeferredValue:function(e,t){var r=ha();return null===qi?eo(r,e,t):to(r,qi.memoizedState,e,t)},useTransition:function(){var e=ba(ma)[0],t=ha().memoizedState;return["boolean"==typeof e?e:fa(e),t]},useSyncExternalStore:Ea,useId:lo,useHostTransitionStatus:oo,useFormState:Ua,useActionState:Ua,useOptimistic:function(e,t){var r=ha();return null!==qi?La(r,0,e,t):(r.baseState=e,[e,r.queue.dispatch])},useMemoCache:pa,useCacheRefresh:uo};function wo(e,t,r,s){r=null==(r=r(s,t=e.memoizedState))?t:d({},t,r),e.memoizedState=r,0===e.lanes&&(e.updateQueue.baseState=r)}To.useEffectEvent=za;var ko={enqueueSetState:function(e,t,r){e=e._reactInternals;var s=Qu(),n=Ti(s);n.payload=t,null!=r&&(n.callback=r),null!==(t=wi(e,n,s))&&(Ju(t,e,s),ki(t,e,s))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var s=Qu(),n=Ti(s);n.tag=1,n.payload=t,null!=r&&(n.callback=r),null!==(t=wi(e,n,s))&&(Ju(t,e,s),ki(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=Qu(),s=Ti(r);s.tag=2,null!=t&&(s.callback=t),null!==(t=wi(e,s,r))&&(Ju(t,e,r),ki(t,e,r))}};function _o(e,t,r,s,n,i,a){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(s,i,a):!t.prototype||!t.prototype.isPureReactComponent||(!rs(r,s)||!rs(n,i))}function Ao(e,t,r,s){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(r,s),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(r,s),t.state!==e&&ko.enqueueReplaceState(t,t.state,null)}function Lo(e,t){var r=t;if("ref"in t)for(var s in r={},t)"ref"!==s&&(r[s]=t[s]);if(e=e.defaultProps)for(var n in r===t&&(r=d({},r)),e)void 0===r[n]&&(r[n]=e[n]);return r}function Ro(e){Is(e)}function Io(e){console.error(e)}function Po(e){Is(e)}function Co(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(e){setTimeout(function(){throw e})}}function Do(e,t,r){try{(0,e.onCaughtError)(r.value,{componentStack:r.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(e){setTimeout(function(){throw e})}}function xo(e,t,r){return(r=Ti(r)).tag=3,r.payload={element:null},r.callback=function(){Co(e,t)},r}function Oo(e){return(e=Ti(e)).tag=3,e}function No(e,t,r,s){var n=r.type.getDerivedStateFromError;if("function"==typeof n){var i=s.value;e.payload=function(){return n(i)},e.callback=function(){Do(t,r,s)}}var a=r.stateNode;null!==a&&"function"==typeof a.componentDidCatch&&(e.callback=function(){Do(t,r,s),"function"!=typeof n&&(null===Bu?Bu=new Set([this]):Bu.add(this));var e=s.stack;this.componentDidCatch(s.value,{componentStack:null!==e?e:""})})}var Mo=Error(s(461)),Fo=!1;function $o(e,t,r,s){t.child=null===e?vi(t,null,r,s):yi(t,e.child,r,s)}function Uo(e,t,r,s,n){r=r.render;var i=t.ref;if("ref"in s){var a={};for(var o in s)"ref"!==o&&(a[o]=s[o])}else a=s;return Nn(t),s=na(e,t,r,a,i,n),o=la(),null===e||Fo?(pn&&o&&cn(t),t.flags|=1,$o(e,t,s,n),t.child):(ua(e,t,n),ll(e,t,n))}function Bo(e,t,r,s,n){if(null===e){var i=r.type;return"function"!=typeof i||Gs(i)||void 0!==i.defaultProps||null!==r.compare?((e=Vs(r.type,null,s,t,t.mode,n)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,jo(e,t,i,s,n))}if(i=e.child,!ul(e,n)){var a=i.memoizedProps;if((r=null!==(r=r.compare)?r:rs)(a,s)&&e.ref===t.ref)return ll(e,t,n)}return t.flags|=1,(e=Ks(i,s)).ref=t.ref,e.return=t,t.child=e}function jo(e,t,r,s,n){if(null!==e){var i=e.memoizedProps;if(rs(i,s)&&e.ref===t.ref){if(Fo=!1,t.pendingProps=s=i,!ul(e,n))return t.lanes=e.lanes,ll(e,t,n);131072&e.flags&&(Fo=!0)}}return Wo(e,t,r,s,n)}function Go(e,t,r,s){var n=s.children,i=null!==e?e.memoizedState:null;if(null===e&&null===t.stateNode&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),"hidden"===s.mode){if(128&t.flags){if(i=null!==i?i.baseLanes|r:r,null!==e){for(s=t.child=e.child,n=0;null!==s;)n=n|s.lanes|s.childLanes,s=s.sibling;s=n&~i}else s=0,t.child=null;return Ho(e,t,i,r,s)}if(!(536870912&r))return s=t.lanes=536870912,Ho(e,t,null!==i?i.baseLanes|r:r,r,s);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Zn(0,null!==i?i.cachePool:null),null!==i?xi(t,i):Oi(),Bi(t)}else null!==i?(Zn(0,i.cachePool),xi(t,i),ji(),t.memoizedState=null):(null!==e&&Zn(0,null),Oi(),ji());return $o(e,t,n,r),t.child}function Ko(e,t){return null!==e&&22===e.tag||null!==t.stateNode||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function Ho(e,t,r,s,n){var i=Jn();return i=null===i?null:{parent:Gn._currentValue,pool:i},t.memoizedState={baseLanes:r,cachePool:i},null!==e&&Zn(0,null),Oi(),Bi(t),null!==e&&xn(e,t,s,!0),t.childLanes=n,null}function Vo(e,t){return(t=sl({mode:t.mode,children:t.children},e.mode)).ref=e.ref,e.child=t,t.return=e,t}function zo(e,t,r){return yi(t,e.child,null,r),(e=Vo(t,t.pendingProps)).flags|=2,Gi(t),t.memoizedState=null,e}function qo(e,t){var r=t.ref;if(null===r)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!=typeof r&&"object"!=typeof r)throw Error(s(284));null!==e&&e.ref===r||(t.flags|=4194816)}}function Wo(e,t,r,s,n){return Nn(t),r=na(e,t,r,s,void 0,n),s=la(),null===e||Fo?(pn&&s&&cn(t),t.flags|=1,$o(e,t,r,n),t.child):(ua(e,t,n),ll(e,t,n))}function Yo(e,t,r,s,n,i){return Nn(t),t.updateQueue=null,r=aa(t,s,r,n),ia(e),s=la(),null===e||Fo?(pn&&s&&cn(t),t.flags|=1,$o(e,t,r,i),t.child):(ua(e,t,i),ll(e,t,i))}function Qo(e,t,r,s,n){if(Nn(t),null===t.stateNode){var i=Us,a=r.contextType;"object"==typeof a&&null!==a&&(i=Mn(a)),i=new r(s,i),t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,i.updater=ko,t.stateNode=i,i._reactInternals=t,(i=t.stateNode).props=s,i.state=t.memoizedState,i.refs={},Ei(t),a=r.contextType,i.context="object"==typeof a&&null!==a?Mn(a):Us,i.state=t.memoizedState,"function"==typeof(a=r.getDerivedStateFromProps)&&(wo(t,r,a,s),i.state=t.memoizedState),"function"==typeof r.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(a=i.state,"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),a!==i.state&&ko.enqueueReplaceState(i,i.state,null),Ri(t,s,i,n),Li(),i.state=t.memoizedState),"function"==typeof i.componentDidMount&&(t.flags|=4194308),s=!0}else if(null===e){i=t.stateNode;var o=t.memoizedProps,l=Lo(r,o);i.props=l;var u=i.context,c=r.contextType;a=Us,"object"==typeof c&&null!==c&&(a=Mn(c));var d=r.getDerivedStateFromProps;c="function"==typeof d||"function"==typeof i.getSnapshotBeforeUpdate,o=t.pendingProps!==o,c||"function"!=typeof i.UNSAFE_componentWillReceiveProps&&"function"!=typeof i.componentWillReceiveProps||(o||u!==a)&&Ao(t,i,s,a),bi=!1;var h=t.memoizedState;i.state=h,Ri(t,s,i,n),Li(),u=t.memoizedState,o||h!==u||bi?("function"==typeof d&&(wo(t,r,d,s),u=t.memoizedState),(l=bi||_o(t,r,l,s,h,u,a))?(c||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||("function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount()),"function"==typeof i.componentDidMount&&(t.flags|=4194308)):("function"==typeof i.componentDidMount&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=u),i.props=s,i.state=u,i.context=a,s=l):("function"==typeof i.componentDidMount&&(t.flags|=4194308),s=!1)}else{i=t.stateNode,Si(e,t),c=Lo(r,a=t.memoizedProps),i.props=c,d=t.pendingProps,h=i.context,u=r.contextType,l=Us,"object"==typeof u&&null!==u&&(l=Mn(u)),(u="function"==typeof(o=r.getDerivedStateFromProps)||"function"==typeof i.getSnapshotBeforeUpdate)||"function"!=typeof i.UNSAFE_componentWillReceiveProps&&"function"!=typeof i.componentWillReceiveProps||(a!==d||h!==l)&&Ao(t,i,s,l),bi=!1,h=t.memoizedState,i.state=h,Ri(t,s,i,n),Li();var f=t.memoizedState;a!==d||h!==f||bi||null!==e&&null!==e.dependencies&&On(e.dependencies)?("function"==typeof o&&(wo(t,r,o,s),f=t.memoizedState),(c=bi||_o(t,r,c,s,h,f,l)||null!==e&&null!==e.dependencies&&On(e.dependencies))?(u||"function"!=typeof i.UNSAFE_componentWillUpdate&&"function"!=typeof i.componentWillUpdate||("function"==typeof i.componentWillUpdate&&i.componentWillUpdate(s,f,l),"function"==typeof i.UNSAFE_componentWillUpdate&&i.UNSAFE_componentWillUpdate(s,f,l)),"function"==typeof i.componentDidUpdate&&(t.flags|=4),"function"==typeof i.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof i.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof i.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=f),i.props=s,i.state=f,i.context=l,s=c):("function"!=typeof i.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof i.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),s=!1)}return i=s,qo(e,t),s=!!(128&t.flags),i||s?(i=t.stateNode,r=s&&"function"!=typeof r.getDerivedStateFromError?null:i.render(),t.flags|=1,null!==e&&s?(t.child=yi(t,e.child,null,n),t.child=yi(t,null,r,n)):$o(e,t,r,n),t.memoizedState=i.state,e=t.child):e=ll(e,t,n),e}function Xo(e,t,r,s){return wn(),t.flags|=256,$o(e,t,r,s),t.child}var Jo={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Zo(e){return{baseLanes:e,cachePool:ei()}}function el(e,t,r){return e=null!==e?e.childLanes&~r:0,t&&(e|=Cu),e}function tl(e,t,r){var n,i=t.pendingProps,a=!1,o=!!(128&t.flags);if((n=o)||(n=(null===e||null!==e.memoizedState)&&!!(2&Ki.current)),n&&(a=!0,t.flags&=-129),n=!!(32&t.flags),t.flags&=-33,null===e){if(pn){if(a?$i(t):ji(),(e=gn)?null!==(e=null!==(e=Od(e,yn))&&"&"!==e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==nn?{id:an,overflow:on}:null,retryLane:536870912,hydrationErrors:null},(r=Ws(e)).return=t,t.child=r,fn=t,gn=null):e=null,null===e)throw bn(t);return Md(e)?t.lanes=32:t.lanes=536870912,null}var l=i.children;return i=i.fallback,a?(ji(),l=sl({mode:"hidden",children:l},a=t.mode),i=zs(i,a,r,null),l.return=t,i.return=t,l.sibling=i,t.child=l,(i=t.child).memoizedState=Zo(r),i.childLanes=el(e,n,r),t.memoizedState=Jo,Ko(null,i)):($i(t),rl(t,l))}var u=e.memoizedState;if(null!==u&&null!==(l=u.dehydrated)){if(o)256&t.flags?($i(t),t.flags&=-257,t=nl(e,t,r)):null!==t.memoizedState?(ji(),t.child=e.child,t.flags|=128,t=null):(ji(),l=i.fallback,a=t.mode,i=sl({mode:"visible",children:i.children},a),(l=zs(l,a,r,null)).flags|=2,i.return=t,l.return=t,i.sibling=l,t.child=i,yi(t,e.child,null,r),(i=t.child).memoizedState=Zo(r),i.childLanes=el(e,n,r),t.memoizedState=Jo,t=Ko(null,i));else if($i(t),Md(l)){if(n=l.nextSibling&&l.nextSibling.dataset)var c=n.dgst;n=c,(i=Error(s(419))).stack="",i.digest=n,_n({value:i,source:null,stack:null}),t=nl(e,t,r)}else if(Fo||xn(e,t,r,!1),n=0!==(r&e.childLanes),Fo||n){if(null!==(n=vu)&&(0!==(i=Ue(n,r))&&i!==u.retryLane))throw u.retryLane=i,Ms(e,i),Ju(n,e,i),Mo;Nd(l)||cc(),t=nl(e,t,r)}else Nd(l)?(t.flags|=192,t.child=e.child,t=null):(e=u.treeContext,gn=Fd(l.nextSibling),fn=t,pn=!0,mn=null,yn=!1,null!==e&&hn(t,e),(t=rl(t,i.children)).flags|=4096);return t}return a?(ji(),l=i.fallback,a=t.mode,c=(u=e.child).sibling,(i=Ks(u,{mode:"hidden",children:i.children})).subtreeFlags=65011712&u.subtreeFlags,null!==c?l=Ks(c,l):(l=zs(l,a,r,null)).flags|=2,l.return=t,i.return=t,i.sibling=l,t.child=i,Ko(null,i),i=t.child,null===(l=e.child.memoizedState)?l=Zo(r):(null!==(a=l.cachePool)?(u=Gn._currentValue,a=a.parent!==u?{parent:u,pool:u}:a):a=ei(),l={baseLanes:l.baseLanes|r,cachePool:a}),i.memoizedState=l,i.childLanes=el(e,n,r),t.memoizedState=Jo,Ko(e.child,i)):($i(t),e=(r=e.child).sibling,(r=Ks(r,{mode:"visible",children:i.children})).return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r)}function rl(e,t){return(t=sl({mode:"visible",children:t},e.mode)).return=e,e.child=t}function sl(e,t){return(e=js(22,e,null,t)).lanes=0,e}function nl(e,t,r){return yi(t,e.child,null,r),(e=rl(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function il(e,t,r){e.lanes|=t;var s=e.alternate;null!==s&&(s.lanes|=t),Cn(e.return,t,r)}function al(e,t,r,s,n,i){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:r,tailMode:n,treeForkCount:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=s,a.tail=r,a.tailMode=n,a.treeForkCount=i)}function ol(e,t,r){var s=t.pendingProps,n=s.revealOrder,i=s.tail;s=s.children;var a=Ki.current,o=!!(2&a);if(o?(a=1&a|2,t.flags|=128):a&=1,V(Ki,a),$o(e,t,s,r),s=pn?tn:0,!o&&null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&il(e,r,t);else if(19===e.tag)il(e,r,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(n){case"forwards":for(r=t.child,n=null;null!==r;)null!==(e=r.alternate)&&null===Hi(e)&&(n=r),r=r.sibling;null===(r=n)?(n=t.child,t.child=null):(n=r.sibling,r.sibling=null),al(t,!1,n,r,i,s);break;case"backwards":case"unstable_legacy-backwards":for(r=null,n=t.child,t.child=null;null!==n;){if(null!==(e=n.alternate)&&null===Hi(e)){t.child=n;break}e=n.sibling,n.sibling=r,r=n,n=e}al(t,!0,r,null,i,s);break;case"together":al(t,!1,null,null,void 0,s);break;default:t.memoizedState=null}return t.child}function ll(e,t,r){if(null!==e&&(t.dependencies=e.dependencies),Ru|=t.lanes,0===(r&t.childLanes)){if(null===e)return null;if(xn(e,t,r,!1),0===(r&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(r=Ks(e=t.child,e.pendingProps),t.child=r,r.return=t;null!==e.sibling;)e=e.sibling,(r=r.sibling=Ks(e,e.pendingProps)).return=t;r.sibling=null}return t.child}function ul(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!On(e))}function cl(e,t,r){if(null!==e)if(e.memoizedProps!==t.pendingProps)Fo=!0;else{if(!(ul(e,r)||128&t.flags))return Fo=!1,function(e,t,r){switch(t.tag){case 3:J(t,t.stateNode.containerInfo),In(0,Gn,e.memoizedState.cache),wn();break;case 27:case 5:ee(t);break;case 4:J(t,t.stateNode.containerInfo);break;case 10:In(0,t.type,t.memoizedProps.value);break;case 31:if(null!==t.memoizedState)return t.flags|=128,Ui(t),null;break;case 13:var s=t.memoizedState;if(null!==s)return null!==s.dehydrated?($i(t),t.flags|=128,null):0!==(r&t.child.childLanes)?tl(e,t,r):($i(t),null!==(e=ll(e,t,r))?e.sibling:null);$i(t);break;case 19:var n=!!(128&e.flags);if((s=0!==(r&t.childLanes))||(xn(e,t,r,!1),s=0!==(r&t.childLanes)),n){if(s)return ol(e,t,r);t.flags|=128}if(null!==(n=t.memoizedState)&&(n.rendering=null,n.tail=null,n.lastEffect=null),V(Ki,Ki.current),s)break;return null;case 22:return t.lanes=0,Go(e,t,r,t.pendingProps);case 24:In(0,Gn,e.memoizedState.cache)}return ll(e,t,r)}(e,t,r);Fo=!!(131072&e.flags)}else Fo=!1,pn&&1048576&t.flags&&un(t,tn,t.index);switch(t.lanes=0,t.tag){case 16:e:{var n=t.pendingProps;if(e=oi(t.elementType),t.type=e,"function"!=typeof e){if(null!=e){var i=e.$$typeof;if(i===A){t.tag=11,t=Uo(null,t,e,n,r);break e}if(i===I){t.tag=14,t=Bo(null,t,e,n,r);break e}}throw t=M(e)||e,Error(s(306,t,""))}Gs(e)?(n=Lo(e,n),t.tag=1,t=Qo(null,t,e,n,r)):(t.tag=0,t=Wo(null,t,e,n,r))}return t;case 0:return Wo(e,t,t.type,t.pendingProps,r);case 1:return Qo(e,t,n=t.type,i=Lo(n,t.pendingProps),r);case 3:e:{if(J(t,t.stateNode.containerInfo),null===e)throw Error(s(387));n=t.pendingProps;var a=t.memoizedState;i=a.element,Si(e,t),Ri(t,n,null,r);var o=t.memoizedState;if(n=o.cache,In(0,Gn,n),n!==a.cache&&Dn(t,[Gn],r,!0),Li(),n=o.element,a.isDehydrated){if(a={element:n,isDehydrated:!1,cache:o.cache},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Xo(e,t,n,r);break e}if(n!==i){_n(i=Xs(Error(s(424)),t)),t=Xo(e,t,n,r);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(gn=Fd(e.firstChild),fn=t,pn=!0,mn=null,yn=!0,r=vi(t,null,n,r),t.child=r;r;)r.flags=-3&r.flags|4096,r=r.sibling}else{if(wn(),n===i){t=ll(e,t,r);break e}$o(e,t,n,r)}t=t.child}return t;case 26:return qo(e,t),null===e?(r=Yd(t.type,null,t.pendingProps,null))?t.memoizedState=r:pn||(r=t.type,e=t.pendingProps,(n=Ed(Q.current).createElement(r))[Ve]=t,n[ze]=e,md(n,r,e),nt(n),t.stateNode=n):t.memoizedState=Yd(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return ee(t),null===e&&pn&&(n=t.stateNode=jd(t.type,t.pendingProps,Q.current),fn=t,yn=!0,i=gn,Pd(t.type)?($d=i,gn=Fd(n.firstChild)):gn=i),$o(e,t,t.pendingProps.children,r),qo(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&pn&&((i=n=gn)&&(null!==(n=function(e,t,r,s){for(;1===e.nodeType;){var n=r;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!s&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(s){if(!e[Je])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(i=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(i!==n.rel||e.getAttribute("href")!==(null==n.href||""===n.href?null:n.href)||e.getAttribute("crossorigin")!==(null==n.crossOrigin?null:n.crossOrigin)||e.getAttribute("title")!==(null==n.title?null:n.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((i=e.getAttribute("src"))!==(null==n.src?null:n.src)||e.getAttribute("type")!==(null==n.type?null:n.type)||e.getAttribute("crossorigin")!==(null==n.crossOrigin?null:n.crossOrigin))&&i&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var i=null==n.name?null:""+n.name;if("hidden"===n.type&&e.getAttribute("name")===i)return e}if(null===(e=Fd(e.nextSibling)))break}return null}(n,t.type,t.pendingProps,yn))?(t.stateNode=n,fn=t,gn=Fd(n.firstChild),yn=!1,i=!0):i=!1),i||bn(t)),ee(t),i=t.type,a=t.pendingProps,o=null!==e?e.memoizedProps:null,n=a.children,wd(i,a)?n=null:null!==o&&wd(i,o)&&(t.flags|=32),null!==t.memoizedState&&(i=na(e,t,oa,null,null,r),gh._currentValue=i),qo(e,t),$o(e,t,n,r),t.child;case 6:return null===e&&pn&&((e=r=gn)&&(null!==(r=function(e,t,r){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!r)return null;if(null===(e=Fd(e.nextSibling)))return null}return e}(r,t.pendingProps,yn))?(t.stateNode=r,fn=t,gn=null,e=!0):e=!1),e||bn(t)),null;case 13:return tl(e,t,r);case 4:return J(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=yi(t,null,n,r):$o(e,t,n,r),t.child;case 11:return Uo(e,t,t.type,t.pendingProps,r);case 7:return $o(e,t,t.pendingProps,r),t.child;case 8:case 12:return $o(e,t,t.pendingProps.children,r),t.child;case 10:return n=t.pendingProps,In(0,t.type,n.value),$o(e,t,n.children,r),t.child;case 9:return i=t.type._context,n=t.pendingProps.children,Nn(t),n=n(i=Mn(i)),t.flags|=1,$o(e,t,n,r),t.child;case 14:return Bo(e,t,t.type,t.pendingProps,r);case 15:return jo(e,t,t.type,t.pendingProps,r);case 19:return ol(e,t,r);case 31:return function(e,t,r){var n=t.pendingProps,i=!!(128&t.flags);if(t.flags&=-129,null===e){if(pn){if("hidden"===n.mode)return e=Vo(t,n),t.lanes=536870912,Ko(null,e);if(Ui(t),(e=gn)?null!==(e=null!==(e=Od(e,yn))&&"&"===e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==nn?{id:an,overflow:on}:null,retryLane:536870912,hydrationErrors:null},(r=Ws(e)).return=t,t.child=r,fn=t,gn=null):e=null,null===e)throw bn(t);return t.lanes=536870912,null}return Vo(t,n)}var a=e.memoizedState;if(null!==a){var o=a.dehydrated;if(Ui(t),i)if(256&t.flags)t.flags&=-257,t=zo(e,t,r);else{if(null===t.memoizedState)throw Error(s(558));t.child=e.child,t.flags|=128,t=null}else if(Fo||xn(e,t,r,!1),i=0!==(r&e.childLanes),Fo||i){if(null!==(n=vu)&&0!==(o=Ue(n,r))&&o!==a.retryLane)throw a.retryLane=o,Ms(e,o),Ju(n,e,o),Mo;cc(),t=zo(e,t,r)}else e=a.treeContext,gn=Fd(o.nextSibling),fn=t,pn=!0,mn=null,yn=!1,null!==e&&hn(t,e),(t=Vo(t,n)).flags|=4096;return t}return(e=Ks(e.child,{mode:n.mode,children:n.children})).ref=t.ref,t.child=e,e.return=t,e}(e,t,r);case 22:return Go(e,t,r,t.pendingProps);case 24:return Nn(t),n=Mn(Gn),null===e?(null===(i=Jn())&&(i=vu,a=Kn(),i.pooledCache=a,a.refCount++,null!==a&&(i.pooledCacheLanes|=r),i=a),t.memoizedState={parent:n,cache:i},Ei(t),In(0,Gn,i)):(0!==(e.lanes&r)&&(Si(e,t),Ri(t,null,null,r),Li()),i=e.memoizedState,a=t.memoizedState,i.parent!==n?(i={parent:n,cache:n},t.memoizedState=i,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=i),In(0,Gn,n)):(n=a.cache,In(0,Gn,n),n!==i.cache&&Dn(t,[Gn],r,!0))),$o(e,t,t.pendingProps.children,r),t.child;case 29:throw t.pendingProps}throw Error(s(156,t.tag))}function dl(e){e.flags|=4}function hl(e,t,r,s,n){if((t=!!(32&e.mode))&&(t=!1),t){if(e.flags|=16777216,(335544128&n)===n)if(e.stateNode.complete)e.flags|=8192;else{if(!oc())throw li=ni,ri;e.flags|=8192}}else e.flags&=-16777217}function fl(e,t){if("stylesheet"!==t.type||4&t.state.loading)e.flags&=-16777217;else if(e.flags|=16777216,!lh(t)){if(!oc())throw li=ni,ri;e.flags|=8192}}function gl(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?Oe():536870912,e.lanes|=t,Du|=t)}function pl(e,t){if(!pn)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;null!==t;)null!==t.alternate&&(r=t),t=t.sibling;null===r?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var s=null;null!==r;)null!==r.alternate&&(s=r),r=r.sibling;null===s?t||null===e.tail?e.tail=null:e.tail.sibling=null:s.sibling=null}}function ml(e){var t=null!==e.alternate&&e.alternate.child===e.child,r=0,s=0;if(t)for(var n=e.child;null!==n;)r|=n.lanes|n.childLanes,s|=65011712&n.subtreeFlags,s|=65011712&n.flags,n.return=e,n=n.sibling;else for(n=e.child;null!==n;)r|=n.lanes|n.childLanes,s|=n.subtreeFlags,s|=n.flags,n.return=e,n=n.sibling;return e.subtreeFlags|=s,e.childLanes=r,t}function yl(e,t,r){var n=t.pendingProps;switch(dn(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return ml(t),null;case 3:return r=t.stateNode,n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),Pn(Gn),Z(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(Tn(t)?dl(t):null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,kn())),ml(t),null;case 26:var i=t.type,a=t.memoizedState;return null===e?(dl(t),null!==a?(ml(t),fl(t,a)):(ml(t),hl(t,i,0,0,r))):a?a!==e.memoizedState?(dl(t),ml(t),fl(t,a)):(ml(t),t.flags&=-16777217):((e=e.memoizedProps)!==n&&dl(t),ml(t),hl(t,i,0,0,r)),null;case 27:if(te(t),r=Q.current,i=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==n&&dl(t);else{if(!n){if(null===t.stateNode)throw Error(s(166));return ml(t),null}e=W.current,Tn(t)?En(t):(e=jd(i,n,r),t.stateNode=e,dl(t))}return ml(t),null;case 5:if(te(t),i=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==n&&dl(t);else{if(!n){if(null===t.stateNode)throw Error(s(166));return ml(t),null}if(a=W.current,Tn(t))En(t);else{var o=Ed(Q.current);switch(a){case 1:a=o.createElementNS("http://www.w3.org/2000/svg",i);break;case 2:a=o.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;default:switch(i){case"svg":a=o.createElementNS("http://www.w3.org/2000/svg",i);break;case"math":a=o.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;case"script":(a=o.createElement("div")).innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a="string"==typeof n.is?o.createElement("select",{is:n.is}):o.createElement("select"),n.multiple?a.multiple=!0:n.size&&(a.size=n.size);break;default:a="string"==typeof n.is?o.createElement(i,{is:n.is}):o.createElement(i)}}a[Ve]=t,a[ze]=n;e:for(o=t.child;null!==o;){if(5===o.tag||6===o.tag)a.appendChild(o.stateNode);else if(4!==o.tag&&27!==o.tag&&null!==o.child){o.child.return=o,o=o.child;continue}if(o===t)break e;for(;null===o.sibling;){if(null===o.return||o.return===t)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}t.stateNode=a;e:switch(md(a,i,n),i){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&dl(t)}}return ml(t),hl(t,t.type,null===e||e.memoizedProps,t.pendingProps,r),null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==n&&dl(t);else{if("string"!=typeof n&&null===t.stateNode)throw Error(s(166));if(e=Q.current,Tn(t)){if(e=t.stateNode,r=t.memoizedProps,n=null,null!==(i=fn))switch(i.tag){case 27:case 5:n=i.memoizedProps}e[Ve]=t,(e=!!(e.nodeValue===r||null!==n&&!0===n.suppressHydrationWarning||fd(e.nodeValue,r)))||bn(t,!0)}else(e=Ed(e).createTextNode(n))[Ve]=t,t.stateNode=e}return ml(t),null;case 31:if(r=t.memoizedState,null===e||null!==e.memoizedState){if(n=Tn(t),null!==r){if(null===e){if(!n)throw Error(s(318));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(s(557));e[Ve]=t}else wn(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;ml(t),e=!1}else r=kn(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=r),e=!0;if(!e)return 256&t.flags?(Gi(t),t):(Gi(t),null);if(128&t.flags)throw Error(s(558))}return ml(t),null;case 13:if(n=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(i=Tn(t),null!==n&&null!==n.dehydrated){if(null===e){if(!i)throw Error(s(318));if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(s(317));i[Ve]=t}else wn(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;ml(t),i=!1}else i=kn(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=i),i=!0;if(!i)return 256&t.flags?(Gi(t),t):(Gi(t),null)}return Gi(t),128&t.flags?(t.lanes=r,t):(r=null!==n,e=null!==e&&null!==e.memoizedState,r&&(i=null,null!==(n=t.child).alternate&&null!==n.alternate.memoizedState&&null!==n.alternate.memoizedState.cachePool&&(i=n.alternate.memoizedState.cachePool.pool),a=null,null!==n.memoizedState&&null!==n.memoizedState.cachePool&&(a=n.memoizedState.cachePool.pool),a!==i&&(n.flags|=2048)),r!==e&&r&&(t.child.flags|=8192),gl(t,t.updateQueue),ml(t),null);case 4:return Z(),null===e&&sd(t.stateNode.containerInfo),ml(t),null;case 10:return Pn(t.type),ml(t),null;case 19:if(H(Ki),null===(n=t.memoizedState))return ml(t),null;if(i=!!(128&t.flags),null===(a=n.rendering))if(i)pl(n,!1);else{if(0!==Lu||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(a=Hi(e))){for(t.flags|=128,pl(n,!1),e=a.updateQueue,t.updateQueue=e,gl(t,e),t.subtreeFlags=0,e=r,r=t.child;null!==r;)Hs(r,e),r=r.sibling;return V(Ki,1&Ki.current|2),pn&&ln(t,n.treeForkCount),t.child}e=e.sibling}null!==n.tail&&he()>$u&&(t.flags|=128,i=!0,pl(n,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=Hi(a))){if(t.flags|=128,i=!0,e=e.updateQueue,t.updateQueue=e,gl(t,e),pl(n,!0),null===n.tail&&"hidden"===n.tailMode&&!a.alternate&&!pn)return ml(t),null}else 2*he()-n.renderingStartTime>$u&&536870912!==r&&(t.flags|=128,i=!0,pl(n,!1),t.lanes=4194304);n.isBackwards?(a.sibling=t.child,t.child=a):(null!==(e=n.last)?e.sibling=a:t.child=a,n.last=a)}return null!==n.tail?(e=n.tail,n.rendering=e,n.tail=e.sibling,n.renderingStartTime=he(),e.sibling=null,r=Ki.current,V(Ki,i?1&r|2:1&r),pn&&ln(t,n.treeForkCount),e):(ml(t),null);case 22:case 23:return Gi(t),Ni(),n=null!==t.memoizedState,null!==e?null!==e.memoizedState!==n&&(t.flags|=8192):n&&(t.flags|=8192),n?!!(536870912&r)&&!(128&t.flags)&&(ml(t),6&t.subtreeFlags&&(t.flags|=8192)):ml(t),null!==(r=t.updateQueue)&&gl(t,r.retryQueue),r=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(r=e.memoizedState.cachePool.pool),n=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(n=t.memoizedState.cachePool.pool),n!==r&&(t.flags|=2048),null!==e&&H(Xn),null;case 24:return r=null,null!==e&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),Pn(Gn),ml(t),null;case 25:case 30:return null}throw Error(s(156,t.tag))}function vl(e,t){switch(dn(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Pn(Gn),Z(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return te(t),null;case 31:if(null!==t.memoizedState){if(Gi(t),null===t.alternate)throw Error(s(340));wn()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 13:if(Gi(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));wn()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return H(Ki),null;case 4:return Z(),null;case 10:return Pn(t.type),null;case 22:case 23:return Gi(t),Ni(),null!==e&&H(Xn),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return Pn(Gn),null;default:return null}}function bl(e,t){switch(dn(t),t.tag){case 3:Pn(Gn),Z();break;case 26:case 27:case 5:te(t);break;case 4:Z();break;case 31:null!==t.memoizedState&&Gi(t);break;case 13:Gi(t);break;case 19:H(Ki);break;case 10:Pn(t.type);break;case 22:case 23:Gi(t),Ni(),null!==e&&H(Xn);break;case 24:Pn(Gn)}}function El(e,t){try{var r=t.updateQueue,s=null!==r?r.lastEffect:null;if(null!==s){var n=s.next;r=n;do{if((r.tag&e)===e){s=void 0;var i=r.create,a=r.inst;s=i(),a.destroy=s}r=r.next}while(r!==n)}}catch(e){Lc(t,t.return,e)}}function Sl(e,t,r){try{var s=t.updateQueue,n=null!==s?s.lastEffect:null;if(null!==n){var i=n.next;s=i;do{if((s.tag&e)===e){var a=s.inst,o=a.destroy;if(void 0!==o){a.destroy=void 0,n=t;var l=r,u=o;try{u()}catch(e){Lc(n,l,e)}}}s=s.next}while(s!==i)}}catch(e){Lc(t,t.return,e)}}function Tl(e){var t=e.updateQueue;if(null!==t){var r=e.stateNode;try{Pi(t,r)}catch(t){Lc(e,e.return,t)}}}function wl(e,t,r){r.props=Lo(e.type,e.memoizedProps),r.state=e.memoizedState;try{r.componentWillUnmount()}catch(r){Lc(e,t,r)}}function kl(e,t){try{var r=e.ref;if(null!==r){switch(e.tag){case 26:case 27:case 5:var s=e.stateNode;break;default:s=e.stateNode}"function"==typeof r?e.refCleanup=r(s):r.current=s}}catch(r){Lc(e,t,r)}}function _l(e,t){var r=e.ref,s=e.refCleanup;if(null!==r)if("function"==typeof s)try{s()}catch(r){Lc(e,t,r)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"==typeof r)try{r(null)}catch(r){Lc(e,t,r)}else r.current=null}function Al(e){var t=e.type,r=e.memoizedProps,s=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":r.autoFocus&&s.focus();break e;case"img":r.src?s.src=r.src:r.srcSet&&(s.srcset=r.srcSet)}}catch(t){Lc(e,e.return,t)}}function Ll(e,t,r){try{var n=e.stateNode;!function(e,t,r,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var i=null,a=null,o=null,l=null,u=null,c=null,d=null;for(g in r){var h=r[g];if(r.hasOwnProperty(g)&&null!=h)switch(g){case"checked":case"value":break;case"defaultValue":u=h;default:n.hasOwnProperty(g)||gd(e,t,g,null,n,h)}}for(var f in n){var g=n[f];if(h=r[f],n.hasOwnProperty(f)&&(null!=g||null!=h))switch(f){case"type":a=g;break;case"name":i=g;break;case"checked":c=g;break;case"defaultChecked":d=g;break;case"value":o=g;break;case"defaultValue":l=g;break;case"children":case"dangerouslySetInnerHTML":if(null!=g)throw Error(s(137,t));break;default:g!==h&&gd(e,t,f,g,n,h)}}return void Tt(e,o,l,u,c,d,a,i);case"select":for(a in g=o=l=f=null,r)if(u=r[a],r.hasOwnProperty(a)&&null!=u)switch(a){case"value":break;case"multiple":g=u;default:n.hasOwnProperty(a)||gd(e,t,a,null,n,u)}for(i in n)if(a=n[i],u=r[i],n.hasOwnProperty(i)&&(null!=a||null!=u))switch(i){case"value":f=a;break;case"defaultValue":l=a;break;case"multiple":o=a;default:a!==u&&gd(e,t,i,a,n,u)}return t=l,r=o,n=g,void(null!=f?_t(e,!!r,f,!1):!!n!=!!r&&(null!=t?_t(e,!!r,t,!0):_t(e,!!r,r?[]:"",!1)));case"textarea":for(l in g=f=null,r)if(i=r[l],r.hasOwnProperty(l)&&null!=i&&!n.hasOwnProperty(l))switch(l){case"value":case"children":break;default:gd(e,t,l,null,n,i)}for(o in n)if(i=n[o],a=r[o],n.hasOwnProperty(o)&&(null!=i||null!=a))switch(o){case"value":f=i;break;case"defaultValue":g=i;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=i)throw Error(s(91));break;default:i!==a&&gd(e,t,o,i,n,a)}return void At(e,f,g);case"option":for(var p in r)if(f=r[p],r.hasOwnProperty(p)&&null!=f&&!n.hasOwnProperty(p))if("selected"===p)e.selected=!1;else gd(e,t,p,null,n,f);for(u in n)if(f=n[u],g=r[u],n.hasOwnProperty(u)&&f!==g&&(null!=f||null!=g))if("selected"===u)e.selected=f&&"function"!=typeof f&&"symbol"!=typeof f;else gd(e,t,u,f,n,g);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var m in r)f=r[m],r.hasOwnProperty(m)&&null!=f&&!n.hasOwnProperty(m)&&gd(e,t,m,null,n,f);for(c in n)if(f=n[c],g=r[c],n.hasOwnProperty(c)&&f!==g&&(null!=f||null!=g))switch(c){case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(s(137,t));break;default:gd(e,t,c,f,n,g)}return;default:if(Dt(t)){for(var y in r)f=r[y],r.hasOwnProperty(y)&&void 0!==f&&!n.hasOwnProperty(y)&&pd(e,t,y,void 0,n,f);for(d in n)f=n[d],g=r[d],!n.hasOwnProperty(d)||f===g||void 0===f&&void 0===g||pd(e,t,d,f,n,g);return}}for(var v in r)f=r[v],r.hasOwnProperty(v)&&null!=f&&!n.hasOwnProperty(v)&&gd(e,t,v,null,n,f);for(h in n)f=n[h],g=r[h],!n.hasOwnProperty(h)||f===g||null==f&&null==g||gd(e,t,h,f,n,g)}(n,e.type,r,t),n[ze]=t}catch(t){Lc(e,e.return,t)}}function Rl(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&Pd(e.type)||4===e.tag}function Il(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||Rl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&Pd(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function Pl(e,t,r){var s=e.tag;if(5===s||6===s)e=e.stateNode,t?(9===r.nodeType?r.body:"HTML"===r.nodeName?r.ownerDocument.body:r).insertBefore(e,t):((t=9===r.nodeType?r.body:"HTML"===r.nodeName?r.ownerDocument.body:r).appendChild(e),null!=(r=r._reactRootContainer)||null!==t.onclick||(t.onclick=Mt));else if(4!==s&&(27===s&&Pd(e.type)&&(r=e.stateNode,t=null),null!==(e=e.child)))for(Pl(e,t,r),e=e.sibling;null!==e;)Pl(e,t,r),e=e.sibling}function Cl(e,t,r){var s=e.tag;if(5===s||6===s)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(4!==s&&(27===s&&Pd(e.type)&&(r=e.stateNode),null!==(e=e.child)))for(Cl(e,t,r),e=e.sibling;null!==e;)Cl(e,t,r),e=e.sibling}function Dl(e){var t=e.stateNode,r=e.memoizedProps;try{for(var s=e.type,n=t.attributes;n.length;)t.removeAttributeNode(n[0]);md(t,s,r),t[Ve]=e,t[ze]=r}catch(t){Lc(e,e.return,t)}}var xl=!1,Ol=!1,Nl=!1,Ml="function"==typeof WeakSet?WeakSet:Set,Fl=null;function $l(e,t,r){var s=r.flags;switch(r.tag){case 0:case 11:case 15:Jl(e,r),4&s&&El(5,r);break;case 1:if(Jl(e,r),4&s)if(e=r.stateNode,null===t)try{e.componentDidMount()}catch(e){Lc(r,r.return,e)}else{var n=Lo(r.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(n,t,e.__reactInternalSnapshotBeforeUpdate)}catch(e){Lc(r,r.return,e)}}64&s&&Tl(r),512&s&&kl(r,r.return);break;case 3:if(Jl(e,r),64&s&&null!==(e=r.updateQueue)){if(t=null,null!==r.child)switch(r.child.tag){case 27:case 5:case 1:t=r.child.stateNode}try{Pi(e,t)}catch(e){Lc(r,r.return,e)}}break;case 27:null===t&&4&s&&Dl(r);case 26:case 5:Jl(e,r),null===t&&4&s&&Al(r),512&s&&kl(r,r.return);break;case 12:Jl(e,r);break;case 31:Jl(e,r),4&s&&Hl(e,r);break;case 13:Jl(e,r),4&s&&Vl(e,r),64&s&&(null!==(e=r.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var r=e.ownerDocument;if("$~"===e.data)e._reactRetry=t;else if("$?"!==e.data||"loading"!==r.readyState)t();else{var s=function(){t(),r.removeEventListener("DOMContentLoaded",s)};r.addEventListener("DOMContentLoaded",s),e._reactRetry=s}}(e,r=Cc.bind(null,r))));break;case 22:if(!(s=null!==r.memoizedState||xl)){t=null!==t&&null!==t.memoizedState||Ol,n=xl;var i=Ol;xl=s,(Ol=t)&&!i?eu(e,r,!!(8772&r.subtreeFlags)):Jl(e,r),xl=n,Ol=i}break;case 30:break;default:Jl(e,r)}}function Ul(e){var t=e.alternate;null!==t&&(e.alternate=null,Ul(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&Ze(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Bl=null,jl=!1;function Gl(e,t,r){for(r=r.child;null!==r;)Kl(e,t,r),r=r.sibling}function Kl(e,t,r){if(Te&&"function"==typeof Te.onCommitFiberUnmount)try{Te.onCommitFiberUnmount(Se,r)}catch(e){}switch(r.tag){case 26:Ol||_l(r,t),Gl(e,t,r),r.memoizedState?r.memoizedState.count--:r.stateNode&&(r=r.stateNode).parentNode.removeChild(r);break;case 27:Ol||_l(r,t);var s=Bl,n=jl;Pd(r.type)&&(Bl=r.stateNode,jl=!1),Gl(e,t,r),Gd(r.stateNode),Bl=s,jl=n;break;case 5:Ol||_l(r,t);case 6:if(s=Bl,n=jl,Bl=null,Gl(e,t,r),jl=n,null!==(Bl=s))if(jl)try{(9===Bl.nodeType?Bl.body:"HTML"===Bl.nodeName?Bl.ownerDocument.body:Bl).removeChild(r.stateNode)}catch(e){Lc(r,t,e)}else try{Bl.removeChild(r.stateNode)}catch(e){Lc(r,t,e)}break;case 18:null!==Bl&&(jl?(Cd(9===(e=Bl).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,r.stateNode),Wh(e)):Cd(Bl,r.stateNode));break;case 4:s=Bl,n=jl,Bl=r.stateNode.containerInfo,jl=!0,Gl(e,t,r),Bl=s,jl=n;break;case 0:case 11:case 14:case 15:Sl(2,r,t),Ol||Sl(4,r,t),Gl(e,t,r);break;case 1:Ol||(_l(r,t),"function"==typeof(s=r.stateNode).componentWillUnmount&&wl(r,t,s)),Gl(e,t,r);break;case 21:Gl(e,t,r);break;case 22:Ol=(s=Ol)||null!==r.memoizedState,Gl(e,t,r),Ol=s;break;default:Gl(e,t,r)}}function Hl(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&null!==(e=e.memoizedState))){e=e.dehydrated;try{Wh(e)}catch(e){Lc(t,t.return,e)}}}function Vl(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{Wh(e)}catch(e){Lc(t,t.return,e)}}function zl(e,t){var r=function(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new Ml),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new Ml),t;default:throw Error(s(435,e.tag))}}(e);t.forEach(function(t){if(!r.has(t)){r.add(t);var s=Dc.bind(null,e,t);t.then(s,s)}})}function ql(e,t){var r=t.deletions;if(null!==r)for(var n=0;n<r.length;n++){var i=r[n],a=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 27:if(Pd(l.type)){Bl=l.stateNode,jl=!1;break e}break;case 5:Bl=l.stateNode,jl=!1;break e;case 3:case 4:Bl=l.stateNode.containerInfo,jl=!0;break e}l=l.return}if(null===Bl)throw Error(s(160));Kl(a,o,i),Bl=null,jl=!1,null!==(a=i.alternate)&&(a.return=null),i.return=null}if(13886&t.subtreeFlags)for(t=t.child;null!==t;)Yl(t,e),t=t.sibling}var Wl=null;function Yl(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:ql(t,e),Ql(e),4&n&&(Sl(3,e,e.return),El(3,e),Sl(5,e,e.return));break;case 1:ql(t,e),Ql(e),512&n&&(Ol||null===r||_l(r,r.return)),64&n&&xl&&(null!==(e=e.updateQueue)&&(null!==(n=e.callbacks)&&(r=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===r?n:r.concat(n))));break;case 26:var i=Wl;if(ql(t,e),Ql(e),512&n&&(Ol||null===r||_l(r,r.return)),4&n){var a=null!==r?r.memoizedState:null;if(n=e.memoizedState,null===r)if(null===n)if(null===e.stateNode){e:{n=e.type,r=e.memoizedProps,i=i.ownerDocument||i;t:switch(n){case"title":(!(a=i.getElementsByTagName("title")[0])||a[Je]||a[Ve]||"http://www.w3.org/2000/svg"===a.namespaceURI||a.hasAttribute("itemprop"))&&(a=i.createElement(n),i.head.insertBefore(a,i.querySelector("head > title"))),md(a,n,r),a[Ve]=e,nt(a),n=a;break e;case"link":var o=ah("link","href",i).get(n+(r.href||""));if(o)for(var l=0;l<o.length;l++)if((a=o[l]).getAttribute("href")===(null==r.href||""===r.href?null:r.href)&&a.getAttribute("rel")===(null==r.rel?null:r.rel)&&a.getAttribute("title")===(null==r.title?null:r.title)&&a.getAttribute("crossorigin")===(null==r.crossOrigin?null:r.crossOrigin)){o.splice(l,1);break t}md(a=i.createElement(n),n,r),i.head.appendChild(a);break;case"meta":if(o=ah("meta","content",i).get(n+(r.content||"")))for(l=0;l<o.length;l++)if((a=o[l]).getAttribute("content")===(null==r.content?null:""+r.content)&&a.getAttribute("name")===(null==r.name?null:r.name)&&a.getAttribute("property")===(null==r.property?null:r.property)&&a.getAttribute("http-equiv")===(null==r.httpEquiv?null:r.httpEquiv)&&a.getAttribute("charset")===(null==r.charSet?null:r.charSet)){o.splice(l,1);break t}md(a=i.createElement(n),n,r),i.head.appendChild(a);break;default:throw Error(s(468,n))}a[Ve]=e,nt(a),n=a}e.stateNode=n}else oh(i,e.type,e.stateNode);else e.stateNode=th(i,n,e.memoizedProps);else a!==n?(null===a?null!==r.stateNode&&(r=r.stateNode).parentNode.removeChild(r):a.count--,null===n?oh(i,e.type,e.stateNode):th(i,n,e.memoizedProps)):null===n&&null!==e.stateNode&&Ll(e,e.memoizedProps,r.memoizedProps)}break;case 27:ql(t,e),Ql(e),512&n&&(Ol||null===r||_l(r,r.return)),null!==r&&4&n&&Ll(e,e.memoizedProps,r.memoizedProps);break;case 5:if(ql(t,e),Ql(e),512&n&&(Ol||null===r||_l(r,r.return)),32&e.flags){i=e.stateNode;try{Rt(i,"")}catch(t){Lc(e,e.return,t)}}4&n&&null!=e.stateNode&&Ll(e,i=e.memoizedProps,null!==r?r.memoizedProps:i),1024&n&&(Nl=!0);break;case 6:if(ql(t,e),Ql(e),4&n){if(null===e.stateNode)throw Error(s(162));n=e.memoizedProps,r=e.stateNode;try{r.nodeValue=n}catch(t){Lc(e,e.return,t)}}break;case 3:if(ih=null,i=Wl,Wl=Vd(t.containerInfo),ql(t,e),Wl=i,Ql(e),4&n&&null!==r&&r.memoizedState.isDehydrated)try{Wh(t.containerInfo)}catch(t){Lc(e,e.return,t)}Nl&&(Nl=!1,Xl(e));break;case 4:n=Wl,Wl=Vd(e.stateNode.containerInfo),ql(t,e),Ql(e),Wl=n;break;case 12:default:ql(t,e),Ql(e);break;case 31:case 19:ql(t,e),Ql(e),4&n&&(null!==(n=e.updateQueue)&&(e.updateQueue=null,zl(e,n)));break;case 13:ql(t,e),Ql(e),8192&e.child.flags&&null!==e.memoizedState!=(null!==r&&null!==r.memoizedState)&&(Mu=he()),4&n&&(null!==(n=e.updateQueue)&&(e.updateQueue=null,zl(e,n)));break;case 22:i=null!==e.memoizedState;var u=null!==r&&null!==r.memoizedState,c=xl,d=Ol;if(xl=c||i,Ol=d||u,ql(t,e),Ol=d,xl=c,Ql(e),8192&n)e:for(t=e.stateNode,t._visibility=i?-2&t._visibility:1|t._visibility,i&&(null===r||u||xl||Ol||Zl(e)),r=null,t=e;;){if(5===t.tag||26===t.tag){if(null===r){u=r=t;try{if(a=u.stateNode,i)"function"==typeof(o=a.style).setProperty?o.setProperty("display","none","important"):o.display="none";else{l=u.stateNode;var h=u.memoizedProps.style,f=null!=h&&h.hasOwnProperty("display")?h.display:null;l.style.display=null==f||"boolean"==typeof f?"":(""+f).trim()}}catch(e){Lc(u,u.return,e)}}}else if(6===t.tag){if(null===r){u=t;try{u.stateNode.nodeValue=i?"":u.memoizedProps}catch(e){Lc(u,u.return,e)}}}else if(18===t.tag){if(null===r){u=t;try{var g=u.stateNode;i?Dd(g,!0):Dd(u.stateNode,!1)}catch(e){Lc(u,u.return,e)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;r===t&&(r=null),t=t.return}r===t&&(r=null),t.sibling.return=t.return,t=t.sibling}4&n&&(null!==(n=e.updateQueue)&&(null!==(r=n.retryQueue)&&(n.retryQueue=null,zl(e,r))));case 30:case 21:}}function Ql(e){var t=e.flags;if(2&t){try{for(var r,n=e.return;null!==n;){if(Rl(n)){r=n;break}n=n.return}if(null==r)throw Error(s(160));switch(r.tag){case 27:var i=r.stateNode;Cl(e,Il(e),i);break;case 5:var a=r.stateNode;32&r.flags&&(Rt(a,""),r.flags&=-33),Cl(e,Il(e),a);break;case 3:case 4:var o=r.stateNode.containerInfo;Pl(e,Il(e),o);break;default:throw Error(s(161))}}catch(t){Lc(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Xl(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Xl(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function Jl(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)$l(e,t.alternate,t),t=t.sibling}function Zl(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:Sl(4,t,t.return),Zl(t);break;case 1:_l(t,t.return);var r=t.stateNode;"function"==typeof r.componentWillUnmount&&wl(t,t.return,r),Zl(t);break;case 27:Gd(t.stateNode);case 26:case 5:_l(t,t.return),Zl(t);break;case 22:null===t.memoizedState&&Zl(t);break;default:Zl(t)}e=e.sibling}}function eu(e,t,r){for(r=r&&!!(8772&t.subtreeFlags),t=t.child;null!==t;){var s=t.alternate,n=e,i=t,a=i.flags;switch(i.tag){case 0:case 11:case 15:eu(n,i,r),El(4,i);break;case 1:if(eu(n,i,r),"function"==typeof(n=(s=i).stateNode).componentDidMount)try{n.componentDidMount()}catch(e){Lc(s,s.return,e)}if(null!==(n=(s=i).updateQueue)){var o=s.stateNode;try{var l=n.shared.hiddenCallbacks;if(null!==l)for(n.shared.hiddenCallbacks=null,n=0;n<l.length;n++)Ii(l[n],o)}catch(e){Lc(s,s.return,e)}}r&&64&a&&Tl(i),kl(i,i.return);break;case 27:Dl(i);case 26:case 5:eu(n,i,r),r&&null===s&&4&a&&Al(i),kl(i,i.return);break;case 12:eu(n,i,r);break;case 31:eu(n,i,r),r&&4&a&&Hl(n,i);break;case 13:eu(n,i,r),r&&4&a&&Vl(n,i);break;case 22:null===i.memoizedState&&eu(n,i,r),kl(i,i.return);break;case 30:break;default:eu(n,i,r)}t=t.sibling}}function tu(e,t){var r=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(r=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==r&&(null!=e&&e.refCount++,null!=r&&Hn(r))}function ru(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Hn(e))}function su(e,t,r,s){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)nu(e,t,r,s),t=t.sibling}function nu(e,t,r,s){var n=t.flags;switch(t.tag){case 0:case 11:case 15:su(e,t,r,s),2048&n&&El(9,t);break;case 1:case 31:case 13:default:su(e,t,r,s);break;case 3:su(e,t,r,s),2048&n&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Hn(e)));break;case 12:if(2048&n){su(e,t,r,s),e=t.stateNode;try{var i=t.memoizedProps,a=i.id,o=i.onPostCommit;"function"==typeof o&&o(a,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(e){Lc(t,t.return,e)}}else su(e,t,r,s);break;case 23:break;case 22:i=t.stateNode,a=t.alternate,null!==t.memoizedState?2&i._visibility?su(e,t,r,s):au(e,t):2&i._visibility?su(e,t,r,s):(i._visibility|=2,iu(e,t,r,s,!!(10256&t.subtreeFlags)||!1)),2048&n&&tu(a,t);break;case 24:su(e,t,r,s),2048&n&&ru(t.alternate,t)}}function iu(e,t,r,s,n){for(n=n&&(!!(10256&t.subtreeFlags)||!1),t=t.child;null!==t;){var i=e,a=t,o=r,l=s,u=a.flags;switch(a.tag){case 0:case 11:case 15:iu(i,a,o,l,n),El(8,a);break;case 23:break;case 22:var c=a.stateNode;null!==a.memoizedState?2&c._visibility?iu(i,a,o,l,n):au(i,a):(c._visibility|=2,iu(i,a,o,l,n)),n&&2048&u&&tu(a.alternate,a);break;case 24:iu(i,a,o,l,n),n&&2048&u&&ru(a.alternate,a);break;default:iu(i,a,o,l,n)}t=t.sibling}}function au(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var r=e,s=t,n=s.flags;switch(s.tag){case 22:au(r,s),2048&n&&tu(s.alternate,s);break;case 24:au(r,s),2048&n&&ru(s.alternate,s);break;default:au(r,s)}t=t.sibling}}var ou=8192;function lu(e,t,r){if(e.subtreeFlags&ou)for(e=e.child;null!==e;)uu(e,t,r),e=e.sibling}function uu(e,t,r){switch(e.tag){case 26:lu(e,t,r),e.flags&ou&&null!==e.memoizedState&&function(e,t,r,s){if(!("stylesheet"!==r.type||"string"==typeof s.media&&!1===matchMedia(s.media).matches||4&r.state.loading)){if(null===r.instance){var n=Qd(s.href),i=t.querySelector(Xd(n));if(i)return null!==(t=i._p)&&"object"==typeof t&&"function"==typeof t.then&&(e.count++,e=ch.bind(e),t.then(e,e)),r.state.loading|=4,r.instance=i,void nt(i);i=t.ownerDocument||t,s=Jd(s),(n=Kd.get(n))&&sh(s,n),nt(i=i.createElement("link"));var a=i;a._p=new Promise(function(e,t){a.onload=e,a.onerror=t}),md(i,"link",s),r.instance=i}null===e.stylesheets&&(e.stylesheets=new Map),e.stylesheets.set(r,t),(t=r.state.preload)&&!(3&r.state.loading)&&(e.count++,r=ch.bind(e),t.addEventListener("load",r),t.addEventListener("error",r))}}(r,Wl,e.memoizedState,e.memoizedProps);break;case 5:default:lu(e,t,r);break;case 3:case 4:var s=Wl;Wl=Vd(e.stateNode.containerInfo),lu(e,t,r),Wl=s;break;case 22:null===e.memoizedState&&(null!==(s=e.alternate)&&null!==s.memoizedState?(s=ou,ou=16777216,lu(e,t,r),ou=s):lu(e,t,r))}}function cu(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function du(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var r=0;r<t.length;r++){var s=t[r];Fl=s,gu(s,e)}cu(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)hu(e),e=e.sibling}function hu(e){switch(e.tag){case 0:case 11:case 15:du(e),2048&e.flags&&Sl(9,e,e.return);break;case 3:case 12:default:du(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,fu(e)):du(e)}}function fu(e){var t=e.deletions;if(16&e.flags){if(null!==t)for(var r=0;r<t.length;r++){var s=t[r];Fl=s,gu(s,e)}cu(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:Sl(8,t,t.return),fu(t);break;case 22:2&(r=t.stateNode)._visibility&&(r._visibility&=-3,fu(t));break;default:fu(t)}e=e.sibling}}function gu(e,t){for(;null!==Fl;){var r=Fl;switch(r.tag){case 0:case 11:case 15:Sl(8,r,t);break;case 23:case 22:if(null!==r.memoizedState&&null!==r.memoizedState.cachePool){var s=r.memoizedState.cachePool.pool;null!=s&&s.refCount++}break;case 24:Hn(r.memoizedState.cache)}if(null!==(s=r.child))s.return=r,Fl=s;else e:for(r=e;null!==Fl;){var n=(s=Fl).sibling,i=s.return;if(Ul(s),s===r){Fl=null;break e}if(null!==n){n.return=i,Fl=n;break e}Fl=i}}}var pu={getCacheForType:function(e){var t=Mn(Gn),r=t.data.get(e);return void 0===r&&(r=e(),t.data.set(e,r)),r},cacheSignal:function(){return Mn(Gn).controller.signal}},mu="function"==typeof WeakMap?WeakMap:Map,yu=0,vu=null,bu=null,Eu=0,Su=0,Tu=null,wu=!1,ku=!1,_u=!1,Au=0,Lu=0,Ru=0,Iu=0,Pu=0,Cu=0,Du=0,xu=null,Ou=null,Nu=!1,Mu=0,Fu=0,$u=1/0,Uu=null,Bu=null,ju=0,Gu=null,Ku=null,Hu=0,Vu=0,zu=null,qu=null,Wu=0,Yu=null;function Qu(){return 2&yu&&0!==Eu?Eu&-Eu:null!==$.T?zc():Ge()}function Xu(){if(0===Cu)if(536870912&Eu&&!pn)Cu=536870912;else{var e=Re;!(3932160&(Re<<=1))&&(Re=262144),Cu=e}return null!==(e=Mi.current)&&(e.flags|=32),Cu}function Ju(e,t,r){(e!==vu||2!==Su&&9!==Su)&&null===e.cancelPendingCommit||(ic(e,0),rc(e,Eu,Cu,!1)),Me(e,r),2&yu&&e===vu||(e===vu&&(!(2&yu)&&(Iu|=r),4===Lu&&rc(e,Eu,Cu,!1)),Uc(e))}function Zu(e,t,r){if(6&yu)throw Error(s(327));for(var n=!r&&!(127&t)&&0===(t&e.expiredLanes)||De(e,t),i=n?function(e,t){var r=yu;yu|=2;var n=lc(),i=uc();vu!==e||Eu!==t?(Uu=null,$u=he()+500,ic(e,t)):ku=De(e,t);e:for(;;)try{if(0!==Su&&null!==bu){t=bu;var a=Tu;t:switch(Su){case 1:Su=0,Tu=null,mc(e,t,a,1);break;case 2:case 9:if(ii(a)){Su=0,Tu=null,pc(t);break}t=function(){2!==Su&&9!==Su||vu!==e||(Su=7),Uc(e)},a.then(t,t);break e;case 3:Su=7;break e;case 4:Su=5;break e;case 7:ii(a)?(Su=0,Tu=null,pc(t)):(Su=0,Tu=null,mc(e,t,a,7));break;case 5:var o=null;switch(bu.tag){case 26:o=bu.memoizedState;case 5:case 27:var l=bu;if(o?lh(o):l.stateNode.complete){Su=0,Tu=null;var u=l.sibling;if(null!==u)bu=u;else{var c=l.return;null!==c?(bu=c,yc(c)):bu=null}break t}}Su=0,Tu=null,mc(e,t,a,5);break;case 6:Su=0,Tu=null,mc(e,t,a,6);break;case 8:nc(),Lu=6;break e;default:throw Error(s(462))}}fc();break}catch(t){ac(e,t)}return Rn=Ln=null,$.H=n,$.A=i,yu=r,null!==bu?0:(vu=null,Eu=0,xs(),Lu)}(e,t):dc(e,t,!0),a=n;;){if(0===i){ku&&!n&&rc(e,t,0,!1);break}if(r=e.current.alternate,!a||tc(r)){if(2===i){if(a=t,e.errorRecoveryDisabledLanes&a)var o=0;else o=0!==(o=-536870913&e.pendingLanes)?o:536870912&o?536870912:0;if(0!==o){t=o;e:{var l=e;i=xu;var u=l.current.memoizedState.isDehydrated;if(u&&(ic(l,o).flags|=256),2!==(o=dc(l,o,!1))){if(_u&&!u){l.errorRecoveryDisabledLanes|=a,Iu|=a,i=4;break e}a=Ou,Ou=i,null!==a&&(null===Ou?Ou=a:Ou.push.apply(Ou,a))}i=o}if(a=!1,2!==i)continue}}if(1===i){ic(e,0),rc(e,t,0,!0);break}e:{switch(n=e,a=i){case 0:case 1:throw Error(s(345));case 4:if((4194048&t)!==t)break;case 6:rc(n,t,Cu,!wu);break e;case 2:Ou=null;break;case 3:case 5:break;default:throw Error(s(329))}if((62914560&t)===t&&10<(i=Mu+300-he())){if(rc(n,t,Cu,!wu),0!==Ce(n,0,!0))break e;Hu=t,n.timeoutHandle=_d(ec.bind(null,n,r,Ou,Uu,Nu,t,Cu,Iu,Du,wu,a,"Throttled",-0,0),i)}else ec(n,r,Ou,Uu,Nu,t,Cu,Iu,Du,wu,a,null,-0,0)}break}i=dc(e,t,!1),a=!1}Uc(e)}function ec(e,t,r,s,n,i,a,o,l,u,c,d,h,f){if(e.timeoutHandle=-1,8192&(d=t.subtreeFlags)||!(16785408&~d)){uu(t,i,d={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Mt});var g=(62914560&i)===i?Mu-he():(4194048&i)===i?Fu-he():0;if(null!==(g=function(e,t){return e.stylesheets&&0===e.count&&hh(e,e.stylesheets),0<e.count||0<e.imgCount?function(r){var s=setTimeout(function(){if(e.stylesheets&&hh(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4+t);0<e.imgBytes&&0===uh&&(uh=62500*function(){if("function"==typeof performance.getEntriesByType){for(var e=0,t=0,r=performance.getEntriesByType("resource"),s=0;s<r.length;s++){var n=r[s],i=n.transferSize,a=n.initiatorType,o=n.duration;if(i&&o&&yd(a)){for(a=0,o=n.responseEnd,s+=1;s<r.length;s++){var l=r[s],u=l.startTime;if(u>o)break;var c=l.transferSize,d=l.initiatorType;c&&yd(d)&&(a+=c*((l=l.responseEnd)<o?1:(o-u)/(l-u)))}if(--s,t+=8*(i+a)/(n.duration/1e3),10<++e)break}}if(0<e)return t/e/1e6}return navigator.connection&&"number"==typeof(e=navigator.connection.downlink)?e:5}());var n=setTimeout(function(){if(e.waitingForImages=!1,0===e.count&&(e.stylesheets&&hh(e,e.stylesheets),e.unsuspend)){var t=e.unsuspend;e.unsuspend=null,t()}},(e.imgBytes>uh?50:800)+t);return e.unsuspend=r,function(){e.unsuspend=null,clearTimeout(s),clearTimeout(n)}}:null}(d,g)))return Hu=i,e.cancelPendingCommit=g(bc.bind(null,e,t,i,r,s,n,a,o,l,c,d,null,h,f)),void rc(e,i,a,!u)}bc(e,t,i,r,s,n,a,o,l)}function tc(e){for(var t=e;;){var r=t.tag;if((0===r||11===r||15===r)&&16384&t.flags&&(null!==(r=t.updateQueue)&&null!==(r=r.stores)))for(var s=0;s<r.length;s++){var n=r[s],i=n.getSnapshot;n=n.value;try{if(!ts(i(),n))return!1}catch(e){return!1}}if(r=t.child,16384&t.subtreeFlags&&null!==r)r.return=t,t=r;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function rc(e,t,r,s){t&=~Pu,t&=~Iu,e.suspendedLanes|=t,e.pingedLanes&=~t,s&&(e.warmLanes|=t),s=e.expirationTimes;for(var n=t;0<n;){var i=31-ke(n),a=1<<i;s[i]=-1,n&=~a}0!==r&&Fe(e,r,t)}function sc(){return!!(6&yu)||(Bc(0),!1)}function nc(){if(null!==bu){if(0===Su)var e=bu.return;else Rn=Ln=null,ca(e=bu),di=null,hi=0,e=bu;for(;null!==e;)bl(e.alternate,e),e=e.return;bu=null}}function ic(e,t){var r=e.timeoutHandle;-1!==r&&(e.timeoutHandle=-1,Ad(r)),null!==(r=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,r()),Hu=0,nc(),vu=e,bu=r=Ks(e.current,null),Eu=t,Su=0,Tu=null,wu=!1,ku=De(e,t),_u=!1,Du=Cu=Pu=Iu=Ru=Lu=0,Ou=xu=null,Nu=!1,8&t&&(t|=32&t);var s=e.entangledLanes;if(0!==s)for(e=e.entanglements,s&=t;0<s;){var n=31-ke(s),i=1<<n;t|=e[n],s&=~i}return Au=t,xs(),r}function ac(e,t){zi=null,$.H=bo,t===ti||t===si?(t=ui(),Su=3):t===ri?(t=ui(),Su=4):Su=t===Mo?8:null!==t&&"object"==typeof t&&"function"==typeof t.then?6:1,Tu=t,null===bu&&(Lu=1,Co(e,Xs(t,e.current)))}function oc(){var e=Mi.current;return null===e||((4194048&Eu)===Eu?null===Fi:!!((62914560&Eu)===Eu||536870912&Eu)&&e===Fi)}function lc(){var e=$.H;return $.H=bo,null===e?bo:e}function uc(){var e=$.A;return $.A=pu,e}function cc(){Lu=4,wu||(4194048&Eu)!==Eu&&null!==Mi.current||(ku=!0),!(134217727&Ru)&&!(134217727&Iu)||null===vu||rc(vu,Eu,Cu,!1)}function dc(e,t,r){var s=yu;yu|=2;var n=lc(),i=uc();vu===e&&Eu===t||(Uu=null,ic(e,t)),t=!1;var a=Lu;e:for(;;)try{if(0!==Su&&null!==bu){var o=bu,l=Tu;switch(Su){case 8:nc(),a=6;break e;case 3:case 2:case 9:case 6:null===Mi.current&&(t=!0);var u=Su;if(Su=0,Tu=null,mc(e,o,l,u),r&&ku){a=0;break e}break;default:u=Su,Su=0,Tu=null,mc(e,o,l,u)}}hc(),a=Lu;break}catch(t){ac(e,t)}return t&&e.shellSuspendCounter++,Rn=Ln=null,yu=s,$.H=n,$.A=i,null===bu&&(vu=null,Eu=0,xs()),a}function hc(){for(;null!==bu;)gc(bu)}function fc(){for(;null!==bu&&!ce();)gc(bu)}function gc(e){var t=cl(e.alternate,e,Au);e.memoizedProps=e.pendingProps,null===t?yc(e):bu=t}function pc(e){var t=e,r=t.alternate;switch(t.tag){case 15:case 0:t=Yo(r,t,t.pendingProps,t.type,void 0,Eu);break;case 11:t=Yo(r,t,t.pendingProps,t.type.render,t.ref,Eu);break;case 5:ca(t);default:bl(r,t),t=cl(r,t=bu=Hs(t,Au),Au)}e.memoizedProps=e.pendingProps,null===t?yc(e):bu=t}function mc(e,t,r,n){Rn=Ln=null,ca(t),di=null,hi=0;var i=t.return;try{if(function(e,t,r,n,i){if(r.flags|=32768,null!==n&&"object"==typeof n&&"function"==typeof n.then){if(null!==(t=r.alternate)&&xn(t,r,i,!0),null!==(r=Mi.current)){switch(r.tag){case 31:case 13:return null===Fi?cc():null===r.alternate&&0===Lu&&(Lu=3),r.flags&=-257,r.flags|=65536,r.lanes=i,n===ni?r.flags|=16384:(null===(t=r.updateQueue)?r.updateQueue=new Set([n]):t.add(n),Rc(e,n,i)),!1;case 22:return r.flags|=65536,n===ni?r.flags|=16384:(null===(t=r.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([n])},r.updateQueue=t):null===(r=t.retryQueue)?t.retryQueue=new Set([n]):r.add(n),Rc(e,n,i)),!1}throw Error(s(435,r.tag))}return Rc(e,n,i),cc(),!1}if(pn)return null!==(t=Mi.current)?(!(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=i,n!==vn&&_n(Xs(e=Error(s(422),{cause:n}),r))):(n!==vn&&_n(Xs(t=Error(s(423),{cause:n}),r)),(e=e.current.alternate).flags|=65536,i&=-i,e.lanes|=i,n=Xs(n,r),_i(e,i=xo(e.stateNode,n,i)),4!==Lu&&(Lu=2)),!1;var a=Error(s(520),{cause:n});if(a=Xs(a,r),null===xu?xu=[a]:xu.push(a),4!==Lu&&(Lu=2),null===t)return!0;n=Xs(n,r),r=t;do{switch(r.tag){case 3:return r.flags|=65536,e=i&-i,r.lanes|=e,_i(r,e=xo(r.stateNode,n,e)),!1;case 1:if(t=r.type,a=r.stateNode,!(128&r.flags||"function"!=typeof t.getDerivedStateFromError&&(null===a||"function"!=typeof a.componentDidCatch||null!==Bu&&Bu.has(a))))return r.flags|=65536,i&=-i,r.lanes|=i,No(i=Oo(i),e,r,n),_i(r,i),!1}r=r.return}while(null!==r);return!1}(e,i,t,r,Eu))return Lu=1,Co(e,Xs(r,e.current)),void(bu=null)}catch(t){if(null!==i)throw bu=i,t;return Lu=1,Co(e,Xs(r,e.current)),void(bu=null)}32768&t.flags?(pn||1===n?e=!0:ku||536870912&Eu?e=!1:(wu=e=!0,(2===n||9===n||3===n||6===n)&&(null!==(n=Mi.current)&&13===n.tag&&(n.flags|=16384))),vc(t,e)):yc(t)}function yc(e){var t=e;do{if(32768&t.flags)return void vc(t,wu);e=t.return;var r=yl(t.alternate,t,Au);if(null!==r)return void(bu=r);if(null!==(t=t.sibling))return void(bu=t);bu=t=e}while(null!==t);0===Lu&&(Lu=5)}function vc(e,t){do{var r=vl(e.alternate,e);if(null!==r)return r.flags&=32767,void(bu=r);if(null!==(r=e.return)&&(r.flags|=32768,r.subtreeFlags=0,r.deletions=null),!t&&null!==(e=e.sibling))return void(bu=e);bu=e=r}while(null!==e);Lu=6,bu=null}function bc(e,t,r,n,i,a,o,l,u){e.cancelPendingCommit=null;do{kc()}while(0!==ju);if(6&yu)throw Error(s(327));if(null!==t){if(t===e.current)throw Error(s(177));if(a=t.lanes|t.childLanes,function(e,t,r,s,n,i){var a=e.pendingLanes;e.pendingLanes=r,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=r,e.entangledLanes&=r,e.errorRecoveryDisabledLanes&=r,e.shellSuspendCounter=0;var o=e.entanglements,l=e.expirationTimes,u=e.hiddenUpdates;for(r=a&~r;0<r;){var c=31-ke(r),d=1<<c;o[c]=0,l[c]=-1;var h=u[c];if(null!==h)for(u[c]=null,c=0;c<h.length;c++){var f=h[c];null!==f&&(f.lane&=-536870913)}r&=~d}0!==s&&Fe(e,s,0),0!==i&&0===n&&0!==e.tag&&(e.suspendedLanes|=i&~(a&~t))}(e,r,a|=Ds,o,l,u),e===vu&&(bu=vu=null,Eu=0),Ku=t,Gu=e,Hu=r,Vu=a,zu=i,qu=n,10256&t.subtreeFlags||10256&t.flags?(e.callbackNode=null,e.callbackPriority=0,le(me,function(){return _c(),null})):(e.callbackNode=null,e.callbackPriority=0),n=!!(13878&t.flags),13878&t.subtreeFlags||n){n=$.T,$.T=null,i=U.p,U.p=2,o=yu,yu|=4;try{!function(e,t){if(e=e.containerInfo,vd=wh,os(e=as(e))){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{var n=(r=(r=e.ownerDocument)&&r.defaultView||window).getSelection&&r.getSelection();if(n&&0!==n.rangeCount){r=n.anchorNode;var i=n.anchorOffset,a=n.focusNode;n=n.focusOffset;try{r.nodeType,a.nodeType}catch(e){r=null;break e}var o=0,l=-1,u=-1,c=0,d=0,h=e,f=null;t:for(;;){for(var g;h!==r||0!==i&&3!==h.nodeType||(l=o+i),h!==a||0!==n&&3!==h.nodeType||(u=o+n),3===h.nodeType&&(o+=h.nodeValue.length),null!==(g=h.firstChild);)f=h,h=g;for(;;){if(h===e)break t;if(f===r&&++c===i&&(l=o),f===a&&++d===n&&(u=o),null!==(g=h.nextSibling))break;f=(h=f).parentNode}h=g}r=-1===l||-1===u?null:{start:l,end:u}}else r=null}r=r||{start:0,end:0}}else r=null;for(bd={focusedElem:e,selectionRange:r},wh=!1,Fl=t;null!==Fl;)if(e=(t=Fl).child,1028&t.subtreeFlags&&null!==e)e.return=t,Fl=e;else for(;null!==Fl;){switch(a=(t=Fl).alternate,e=t.flags,t.tag){case 0:if(4&e&&null!==(e=null!==(e=t.updateQueue)?e.events:null))for(r=0;r<e.length;r++)(i=e[r]).ref.impl=i.nextImpl;break;case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(1024&e&&null!==a){e=void 0,r=t,i=a.memoizedProps,a=a.memoizedState,n=r.stateNode;try{var p=Lo(r.type,i);e=n.getSnapshotBeforeUpdate(p,a),n.__reactInternalSnapshotBeforeUpdate=e}catch(e){Lc(r,r.return,e)}}break;case 3:if(1024&e)if(9===(r=(e=t.stateNode.containerInfo).nodeType))xd(e);else if(1===r)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":xd(e);break;default:e.textContent=""}break;default:if(1024&e)throw Error(s(163))}if(null!==(e=t.sibling)){e.return=t.return,Fl=e;break}Fl=t.return}}(e,t)}finally{yu=o,U.p=i,$.T=n}}ju=1,Ec(),Sc(),Tc()}}function Ec(){if(1===ju){ju=0;var e=Gu,t=Ku,r=!!(13878&t.flags);if(13878&t.subtreeFlags||r){r=$.T,$.T=null;var s=U.p;U.p=2;var n=yu;yu|=4;try{Yl(t,e);var i=bd,a=as(e.containerInfo),o=i.focusedElem,l=i.selectionRange;if(a!==o&&o&&o.ownerDocument&&is(o.ownerDocument.documentElement,o)){if(null!==l&&os(o)){var u=l.start,c=l.end;if(void 0===c&&(c=u),"selectionStart"in o)o.selectionStart=u,o.selectionEnd=Math.min(c,o.value.length);else{var d=o.ownerDocument||document,h=d&&d.defaultView||window;if(h.getSelection){var f=h.getSelection(),g=o.textContent.length,p=Math.min(l.start,g),m=void 0===l.end?p:Math.min(l.end,g);!f.extend&&p>m&&(a=m,m=p,p=a);var y=ns(o,p),v=ns(o,m);if(y&&v&&(1!==f.rangeCount||f.anchorNode!==y.node||f.anchorOffset!==y.offset||f.focusNode!==v.node||f.focusOffset!==v.offset)){var b=d.createRange();b.setStart(y.node,y.offset),f.removeAllRanges(),p>m?(f.addRange(b),f.extend(v.node,v.offset)):(b.setEnd(v.node,v.offset),f.addRange(b))}}}}for(d=[],f=o;f=f.parentNode;)1===f.nodeType&&d.push({element:f,left:f.scrollLeft,top:f.scrollTop});for("function"==typeof o.focus&&o.focus(),o=0;o<d.length;o++){var E=d[o];E.element.scrollLeft=E.left,E.element.scrollTop=E.top}}wh=!!vd,bd=vd=null}finally{yu=n,U.p=s,$.T=r}}e.current=t,ju=2}}function Sc(){if(2===ju){ju=0;var e=Gu,t=Ku,r=!!(8772&t.flags);if(8772&t.subtreeFlags||r){r=$.T,$.T=null;var s=U.p;U.p=2;var n=yu;yu|=4;try{$l(e,t.alternate,t)}finally{yu=n,U.p=s,$.T=r}}ju=3}}function Tc(){if(4===ju||3===ju){ju=0,de();var e=Gu,t=Ku,r=Hu,s=qu;10256&t.subtreeFlags||10256&t.flags?ju=5:(ju=0,Ku=Gu=null,wc(e,e.pendingLanes));var n=e.pendingLanes;if(0===n&&(Bu=null),je(r),t=t.stateNode,Te&&"function"==typeof Te.onCommitFiberRoot)try{Te.onCommitFiberRoot(Se,t,void 0,!(128&~t.current.flags))}catch(e){}if(null!==s){t=$.T,n=U.p,U.p=2,$.T=null;try{for(var i=e.onRecoverableError,a=0;a<s.length;a++){var o=s[a];i(o.value,{componentStack:o.stack})}}finally{$.T=t,U.p=n}}3&Hu&&kc(),Uc(e),n=e.pendingLanes,261930&r&&42&n?e===Yu?Wu++:(Wu=0,Yu=e):Wu=0,Bc(0)}}function wc(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Hn(t)))}function kc(){return Ec(),Sc(),Tc(),_c()}function _c(){if(5!==ju)return!1;var e=Gu,t=Vu;Vu=0;var r=je(Hu),n=$.T,i=U.p;try{U.p=32>r?32:r,$.T=null,r=zu,zu=null;var a=Gu,o=Hu;if(ju=0,Ku=Gu=null,Hu=0,6&yu)throw Error(s(331));var l=yu;if(yu|=4,hu(a.current),nu(a,a.current,o,r),yu=l,Bc(0,!1),Te&&"function"==typeof Te.onPostCommitFiberRoot)try{Te.onPostCommitFiberRoot(Se,a)}catch(e){}return!0}finally{U.p=i,$.T=n,wc(e,t)}}function Ac(e,t,r){t=Xs(r,t),null!==(e=wi(e,t=xo(e.stateNode,t,2),2))&&(Me(e,2),Uc(e))}function Lc(e,t,r){if(3===e.tag)Ac(e,e,r);else for(;null!==t;){if(3===t.tag){Ac(t,e,r);break}if(1===t.tag){var s=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof s.componentDidCatch&&(null===Bu||!Bu.has(s))){e=Xs(r,e),null!==(s=wi(t,r=Oo(2),2))&&(No(r,s,t,e),Me(s,2),Uc(s));break}}t=t.return}}function Rc(e,t,r){var s=e.pingCache;if(null===s){s=e.pingCache=new mu;var n=new Set;s.set(t,n)}else void 0===(n=s.get(t))&&(n=new Set,s.set(t,n));n.has(r)||(_u=!0,n.add(r),e=Ic.bind(null,e,t,r),t.then(e,e))}function Ic(e,t,r){var s=e.pingCache;null!==s&&s.delete(t),e.pingedLanes|=e.suspendedLanes&r,e.warmLanes&=~r,vu===e&&(Eu&r)===r&&(4===Lu||3===Lu&&(62914560&Eu)===Eu&&300>he()-Mu?!(2&yu)&&ic(e,0):Pu|=r,Du===Eu&&(Du=0)),Uc(e)}function Pc(e,t){0===t&&(t=Oe()),null!==(e=Ms(e,t))&&(Me(e,t),Uc(e))}function Cc(e){var t=e.memoizedState,r=0;null!==t&&(r=t.retryLane),Pc(e,r)}function Dc(e,t){var r=0;switch(e.tag){case 31:case 13:var n=e.stateNode,i=e.memoizedState;null!==i&&(r=i.retryLane);break;case 19:n=e.stateNode;break;case 22:n=e.stateNode._retryCache;break;default:throw Error(s(314))}null!==n&&n.delete(t),Pc(e,r)}var xc=null,Oc=null,Nc=!1,Mc=!1,Fc=!1,$c=0;function Uc(e){e!==Oc&&null===e.next&&(null===Oc?xc=Oc=e:Oc=Oc.next=e),Mc=!0,Nc||(Nc=!0,Rd(function(){6&yu?le(ge,jc):Gc()}))}function Bc(e,t){if(!Fc&&Mc){Fc=!0;do{for(var r=!1,s=xc;null!==s;){if(0!==e){var n=s.pendingLanes;if(0===n)var i=0;else{var a=s.suspendedLanes,o=s.pingedLanes;i=(1<<31-ke(42|e)+1)-1,i=201326741&(i&=n&~(a&~o))?201326741&i|1:i?2|i:0}0!==i&&(r=!0,Vc(s,i))}else i=Eu,!(3&(i=Ce(s,s===vu?i:0,null!==s.cancelPendingCommit||-1!==s.timeoutHandle)))||De(s,i)||(r=!0,Vc(s,i));s=s.next}}while(r);Fc=!1}}function jc(){Gc()}function Gc(){Mc=Nc=!1;var e=0;0!==$c&&function(){var e=window.event;if(e&&"popstate"===e.type)return e!==kd&&(kd=e,!0);return kd=null,!1}()&&(e=$c);for(var t=he(),r=null,s=xc;null!==s;){var n=s.next,i=Kc(s,t);0===i?(s.next=null,null===r?xc=n:r.next=n,null===n&&(Oc=r)):(r=s,(0!==e||3&i)&&(Mc=!0)),s=n}0!==ju&&5!==ju||Bc(e),0!==$c&&($c=0)}function Kc(e,t){for(var r=e.suspendedLanes,s=e.pingedLanes,n=e.expirationTimes,i=-62914561&e.pendingLanes;0<i;){var a=31-ke(i),o=1<<a,l=n[a];-1===l?0!==(o&r)&&0===(o&s)||(n[a]=xe(o,t)):l<=t&&(e.expiredLanes|=o),i&=~o}if(r=Eu,r=Ce(e,e===(t=vu)?r:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),s=e.callbackNode,0===r||e===t&&(2===Su||9===Su)||null!==e.cancelPendingCommit)return null!==s&&null!==s&&ue(s),e.callbackNode=null,e.callbackPriority=0;if(!(3&r)||De(e,r)){if((t=r&-r)===e.callbackPriority)return t;switch(null!==s&&ue(s),je(r)){case 2:case 8:r=pe;break;case 32:default:r=me;break;case 268435456:r=ve}return s=Hc.bind(null,e),r=le(r,s),e.callbackPriority=t,e.callbackNode=r,t}return null!==s&&null!==s&&ue(s),e.callbackPriority=2,e.callbackNode=null,2}function Hc(e,t){if(0!==ju&&5!==ju)return e.callbackNode=null,e.callbackPriority=0,null;var r=e.callbackNode;if(kc()&&e.callbackNode!==r)return null;var s=Eu;return 0===(s=Ce(e,e===vu?s:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(Zu(e,s,t),Kc(e,he()),null!=e.callbackNode&&e.callbackNode===r?Hc.bind(null,e):null)}function Vc(e,t){if(kc())return null;Zu(e,t,!0)}function zc(){if(0===$c){var e=qn;0===e&&(e=Le,!(261888&(Le<<=1))&&(Le=256)),$c=e}return $c}function qc(e){return null==e||"symbol"==typeof e||"boolean"==typeof e?null:"function"==typeof e?e:Nt(""+e)}function Wc(e,t){var r=t.ownerDocument.createElement("input");return r.name=t.name,r.value=t.value,e.id&&r.setAttribute("form",e.id),t.parentNode.insertBefore(r,t),e=new FormData(e),r.parentNode.removeChild(r),e}for(var Yc=0;Yc<Ls.length;Yc++){var Qc=Ls[Yc];Rs(Qc.toLowerCase(),"on"+(Qc[0].toUpperCase()+Qc.slice(1)))}Rs(bs,"onAnimationEnd"),Rs(Es,"onAnimationIteration"),Rs(Ss,"onAnimationStart"),Rs("dblclick","onDoubleClick"),Rs("focusin","onFocus"),Rs("focusout","onBlur"),Rs(Ts,"onTransitionRun"),Rs(ws,"onTransitionStart"),Rs(ks,"onTransitionCancel"),Rs(_s,"onTransitionEnd"),lt("onMouseEnter",["mouseout","mouseover"]),lt("onMouseLeave",["mouseout","mouseover"]),lt("onPointerEnter",["pointerout","pointerover"]),lt("onPointerLeave",["pointerout","pointerover"]),ot("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ot("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ot("onBeforeInput",["compositionend","keypress","textInput","paste"]),ot("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ot("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ot("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Jc=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Xc));function Zc(e,t){t=!!(4&t);for(var r=0;r<e.length;r++){var s=e[r],n=s.event;s=s.listeners;e:{var i=void 0;if(t)for(var a=s.length-1;0<=a;a--){var o=s[a],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==i&&n.isPropagationStopped())break e;i=o,n.currentTarget=u;try{i(n)}catch(e){Is(e)}n.currentTarget=null,i=l}else for(a=0;a<s.length;a++){if(l=(o=s[a]).instance,u=o.currentTarget,o=o.listener,l!==i&&n.isPropagationStopped())break e;i=o,n.currentTarget=u;try{i(n)}catch(e){Is(e)}n.currentTarget=null,i=l}}}}function ed(e,t){var r=t[We];void 0===r&&(r=t[We]=new Set);var s=e+"__bubble";r.has(s)||(nd(t,e,2,!1),r.add(s))}function td(e,t,r){var s=0;t&&(s|=4),nd(r,e,s,t)}var rd="_reactListening"+Math.random().toString(36).slice(2);function sd(e){if(!e[rd]){e[rd]=!0,it.forEach(function(t){"selectionchange"!==t&&(Jc.has(t)||td(t,!1,e),td(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[rd]||(t[rd]=!0,td("selectionchange",!1,t))}}function nd(e,t,r,s){switch(Ph(t)){case 2:var n=kh;break;case 8:n=_h;break;default:n=Ah}r=n.bind(null,t,r,e),n=void 0,!zt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(n=!0),s?void 0!==n?e.addEventListener(t,r,{capture:!0,passive:n}):e.addEventListener(t,r,!0):void 0!==n?e.addEventListener(t,r,{passive:n}):e.addEventListener(t,r,!1)}function id(e,t,r,s,n){var a=s;if(!(1&t||2&t||null===s))e:for(;;){if(null===s)return;var o=s.tag;if(3===o||4===o){var l=s.stateNode.containerInfo;if(l===n)break;if(4===o)for(o=s.return;null!==o;){var u=o.tag;if((3===u||4===u)&&o.stateNode.containerInfo===n)return;o=o.return}for(;null!==l;){if(null===(o=et(l)))return;if(5===(u=o.tag)||6===u||26===u||27===u){s=a=o;continue e}l=l.parentNode}}s=s.return}Kt(function(){var s=a,n=$t(r),o=[];e:{var l=As.get(e);if(void 0!==l){var u=ar,c=e;switch(e){case"keypress":if(0===Jt(r))break e;case"keydown":case"keyup":u=Sr;break;case"focusin":c="focus",u=hr;break;case"focusout":c="blur",u=hr;break;case"beforeblur":case"afterblur":u=hr;break;case"click":if(2===r.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=cr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=dr;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=wr;break;case bs:case Es:case Ss:u=fr;break;case _s:u=kr;break;case"scroll":case"scrollend":u=lr;break;case"wheel":u=_r;break;case"copy":case"cut":case"paste":u=gr;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=Tr;break;case"toggle":case"beforetoggle":u=Ar}var d=!!(4&t),h=!d&&("scroll"===e||"scrollend"===e),f=d?null!==l?l+"Capture":null:l;d=[];for(var g,p=s;null!==p;){var m=p;if(g=m.stateNode,5!==(m=m.tag)&&26!==m&&27!==m||null===g||null===f||null!=(m=Ht(p,f))&&d.push(ad(p,m,g)),h)break;p=p.return}0<d.length&&(l=new u(l,c,null,r,n),o.push({event:l,listeners:d}))}}if(!(7&t)){if(u="mouseout"===e||"pointerout"===e,(!(l="mouseover"===e||"pointerover"===e)||r===Ft||!(c=r.relatedTarget||r.fromElement)||!et(c)&&!c[qe])&&(u||l)&&(l=n.window===n?n:(l=n.ownerDocument)?l.defaultView||l.parentWindow:window,u?(u=s,null!==(c=(c=r.relatedTarget||r.toElement)?et(c):null)&&(h=i(c),d=c.tag,c!==h||5!==d&&27!==d&&6!==d)&&(c=null)):(u=null,c=s),u!==c)){if(d=cr,m="onMouseLeave",f="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(d=Tr,m="onPointerLeave",f="onPointerEnter",p="pointer"),h=null==u?l:rt(u),g=null==c?l:rt(c),(l=new d(m,p+"leave",u,r,n)).target=h,l.relatedTarget=g,m=null,et(n)===s&&((d=new d(f,p+"enter",c,r,n)).target=g,d.relatedTarget=h,m=d),h=m,u&&c)e:{for(d=ld,p=c,g=0,m=f=u;m;m=d(m))g++;m=0;for(var y=p;y;y=d(y))m++;for(;0<g-m;)f=d(f),g--;for(;0<m-g;)p=d(p),m--;for(;g--;){if(f===p||null!==p&&f===p.alternate){d=f;break e}f=d(f),p=d(p)}d=null}else d=null;null!==u&&ud(o,l,u,d,!1),null!==c&&null!==h&&ud(o,h,c,d,!0)}if("select"===(u=(l=s?rt(s):window).nodeName&&l.nodeName.toLowerCase())||"input"===u&&"file"===l.type)var v=Hr;else if($r(l))if(Vr)v=es;else{v=Jr;var b=Xr}else!(u=l.nodeName)||"input"!==u.toLowerCase()||"checkbox"!==l.type&&"radio"!==l.type?s&&Dt(s.elementType)&&(v=Hr):v=Zr;switch(v&&(v=v(e,s))?Ur(o,v,r,n):(b&&b(e,l,s),"focusout"===e&&s&&"number"===l.type&&null!=s.memoizedProps.value&&kt(l,"number",l.value)),b=s?rt(s):window,e){case"focusin":($r(b)||"true"===b.contentEditable)&&(us=b,cs=s,ds=null);break;case"focusout":ds=cs=us=null;break;case"mousedown":hs=!0;break;case"contextmenu":case"mouseup":case"dragend":hs=!1,fs(o,r,n);break;case"selectionchange":if(ls)break;case"keydown":case"keyup":fs(o,r,n)}var E;if(Rr)e:{switch(e){case"compositionstart":var S="onCompositionStart";break e;case"compositionend":S="onCompositionEnd";break e;case"compositionupdate":S="onCompositionUpdate";break e}S=void 0}else Mr?Or(e,r)&&(S="onCompositionEnd"):"keydown"===e&&229===r.keyCode&&(S="onCompositionStart");S&&(Cr&&"ko"!==r.locale&&(Mr||"onCompositionStart"!==S?"onCompositionEnd"===S&&Mr&&(E=Xt()):(Yt="value"in(Wt=n)?Wt.value:Wt.textContent,Mr=!0)),0<(b=od(s,S)).length&&(S=new pr(S,e,null,r,n),o.push({event:S,listeners:b}),E?S.data=E:null!==(E=Nr(r))&&(S.data=E))),(E=Pr?function(e,t){switch(e){case"compositionend":return Nr(t);case"keypress":return 32!==t.which?null:(xr=!0,Dr);case"textInput":return(e=t.data)===Dr&&xr?null:e;default:return null}}(e,r):function(e,t){if(Mr)return"compositionend"===e||!Rr&&Or(e,t)?(e=Xt(),Qt=Yt=Wt=null,Mr=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Cr&&"ko"!==t.locale?null:t.data}}(e,r))&&(0<(S=od(s,"onBeforeInput")).length&&(b=new pr("onBeforeInput","beforeinput",null,r,n),o.push({event:b,listeners:S}),b.data=E)),function(e,t,r,s,n){if("submit"===t&&r&&r.stateNode===n){var i=qc((n[ze]||null).action),a=s.submitter;a&&null!==(t=(t=a[ze]||null)?qc(t.formAction):a.getAttribute("formAction"))&&(i=t,a=null);var o=new ar("action","action",null,s,n);e.push({event:o,listeners:[{instance:null,listener:function(){if(s.defaultPrevented){if(0!==$c){var e=a?Wc(n,a):new FormData(n);no(r,{pending:!0,data:e,method:n.method,action:i},null,e)}}else"function"==typeof i&&(o.preventDefault(),e=a?Wc(n,a):new FormData(n),no(r,{pending:!0,data:e,method:n.method,action:i},i,e))},currentTarget:n}]})}}(o,e,s,r,n)}Zc(o,t)})}function ad(e,t,r){return{instance:e,listener:t,currentTarget:r}}function od(e,t){for(var r=t+"Capture",s=[];null!==e;){var n=e,i=n.stateNode;if(5!==(n=n.tag)&&26!==n&&27!==n||null===i||(null!=(n=Ht(e,r))&&s.unshift(ad(e,n,i)),null!=(n=Ht(e,t))&&s.push(ad(e,n,i))),3===e.tag)return s;e=e.return}return[]}function ld(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function ud(e,t,r,s,n){for(var i=t._reactName,a=[];null!==r&&r!==s;){var o=r,l=o.alternate,u=o.stateNode;if(o=o.tag,null!==l&&l===s)break;5!==o&&26!==o&&27!==o||null===u||(l=u,n?null!=(u=Ht(r,i))&&a.unshift(ad(r,u,l)):n||null!=(u=Ht(r,i))&&a.push(ad(r,u,l))),r=r.return}0!==a.length&&e.push({event:t,listeners:a})}var cd=/\r\n?/g,dd=/\u0000|\uFFFD/g;function hd(e){return("string"==typeof e?e:""+e).replace(cd,"\n").replace(dd,"")}function fd(e,t){return t=hd(t),hd(e)===t}function gd(e,t,r,n,i,a){switch(r){case"children":"string"==typeof n?"body"===t||"textarea"===t&&""===n||Rt(e,n):("number"==typeof n||"bigint"==typeof n)&&"body"!==t&&Rt(e,""+n);break;case"className":ft(e,"class",n);break;case"tabIndex":ft(e,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":ft(e,r,n);break;case"style":Ct(e,n,a);break;case"data":if("object"!==t){ft(e,"data",n);break}case"src":case"href":if(""===n&&("a"!==t||"href"!==r)){e.removeAttribute(r);break}if(null==n||"function"==typeof n||"symbol"==typeof n||"boolean"==typeof n){e.removeAttribute(r);break}n=Nt(""+n),e.setAttribute(r,n);break;case"action":case"formAction":if("function"==typeof n){e.setAttribute(r,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"==typeof a&&("formAction"===r?("input"!==t&&gd(e,t,"name",i.name,i,null),gd(e,t,"formEncType",i.formEncType,i,null),gd(e,t,"formMethod",i.formMethod,i,null),gd(e,t,"formTarget",i.formTarget,i,null)):(gd(e,t,"encType",i.encType,i,null),gd(e,t,"method",i.method,i,null),gd(e,t,"target",i.target,i,null))),null==n||"symbol"==typeof n||"boolean"==typeof n){e.removeAttribute(r);break}n=Nt(""+n),e.setAttribute(r,n);break;case"onClick":null!=n&&(e.onclick=Mt);break;case"onScroll":null!=n&&ed("scroll",e);break;case"onScrollEnd":null!=n&&ed("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=n){if("object"!=typeof n||!("__html"in n))throw Error(s(61));if(null!=(r=n.__html)){if(null!=i.children)throw Error(s(60));e.innerHTML=r}}break;case"multiple":e.multiple=n&&"function"!=typeof n&&"symbol"!=typeof n;break;case"muted":e.muted=n&&"function"!=typeof n&&"symbol"!=typeof n;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==n||"function"==typeof n||"boolean"==typeof n||"symbol"==typeof n){e.removeAttribute("xlink:href");break}r=Nt(""+n),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",r);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=n&&"function"!=typeof n&&"symbol"!=typeof n?e.setAttribute(r,""+n):e.removeAttribute(r);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&"function"!=typeof n&&"symbol"!=typeof n?e.setAttribute(r,""):e.removeAttribute(r);break;case"capture":case"download":!0===n?e.setAttribute(r,""):!1!==n&&null!=n&&"function"!=typeof n&&"symbol"!=typeof n?e.setAttribute(r,n):e.removeAttribute(r);break;case"cols":case"rows":case"size":case"span":null!=n&&"function"!=typeof n&&"symbol"!=typeof n&&!isNaN(n)&&1<=n?e.setAttribute(r,n):e.removeAttribute(r);break;case"rowSpan":case"start":null==n||"function"==typeof n||"symbol"==typeof n||isNaN(n)?e.removeAttribute(r):e.setAttribute(r,n);break;case"popover":ed("beforetoggle",e),ed("toggle",e),ht(e,"popover",n);break;case"xlinkActuate":gt(e,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":gt(e,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":gt(e,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":gt(e,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":gt(e,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":gt(e,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":gt(e,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":gt(e,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":gt(e,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":ht(e,"is",n);break;case"innerText":case"textContent":break;default:(!(2<r.length)||"o"!==r[0]&&"O"!==r[0]||"n"!==r[1]&&"N"!==r[1])&&ht(e,r=xt.get(r)||r,n)}}function pd(e,t,r,n,i,a){switch(r){case"style":Ct(e,n,a);break;case"dangerouslySetInnerHTML":if(null!=n){if("object"!=typeof n||!("__html"in n))throw Error(s(61));if(null!=(r=n.__html)){if(null!=i.children)throw Error(s(60));e.innerHTML=r}}break;case"children":"string"==typeof n?Rt(e,n):("number"==typeof n||"bigint"==typeof n)&&Rt(e,""+n);break;case"onScroll":null!=n&&ed("scroll",e);break;case"onScrollEnd":null!=n&&ed("scrollend",e);break;case"onClick":null!=n&&(e.onclick=Mt);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:at.hasOwnProperty(r)||("o"!==r[0]||"n"!==r[1]||(i=r.endsWith("Capture"),t=r.slice(2,i?r.length-7:void 0),"function"==typeof(a=null!=(a=e[ze]||null)?a[r]:null)&&e.removeEventListener(t,a,i),"function"!=typeof n)?r in e?e[r]=n:!0===n?e.setAttribute(r,""):ht(e,r,n):("function"!=typeof a&&null!==a&&(r in e?e[r]=null:e.hasAttribute(r)&&e.removeAttribute(r)),e.addEventListener(t,n,i)))}}function md(e,t,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ed("error",e),ed("load",e);var n,i=!1,a=!1;for(n in r)if(r.hasOwnProperty(n)){var o=r[n];if(null!=o)switch(n){case"src":i=!0;break;case"srcSet":a=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,t));default:gd(e,t,n,o,r,null)}}return a&&gd(e,t,"srcSet",r.srcSet,r,null),void(i&&gd(e,t,"src",r.src,r,null));case"input":ed("invalid",e);var l=n=o=a=null,u=null,c=null;for(i in r)if(r.hasOwnProperty(i)){var d=r[i];if(null!=d)switch(i){case"name":a=d;break;case"type":o=d;break;case"checked":u=d;break;case"defaultChecked":c=d;break;case"value":n=d;break;case"defaultValue":l=d;break;case"children":case"dangerouslySetInnerHTML":if(null!=d)throw Error(s(137,t));break;default:gd(e,t,i,d,r,null)}}return void wt(e,n,l,u,c,o,a,!1);case"select":for(a in ed("invalid",e),i=o=n=null,r)if(r.hasOwnProperty(a)&&null!=(l=r[a]))switch(a){case"value":n=l;break;case"defaultValue":o=l;break;case"multiple":i=l;default:gd(e,t,a,l,r,null)}return t=n,r=o,e.multiple=!!i,void(null!=t?_t(e,!!i,t,!1):null!=r&&_t(e,!!i,r,!0));case"textarea":for(o in ed("invalid",e),n=a=i=null,r)if(r.hasOwnProperty(o)&&null!=(l=r[o]))switch(o){case"value":i=l;break;case"defaultValue":a=l;break;case"children":n=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(s(91));break;default:gd(e,t,o,l,r,null)}return void Lt(e,i,a,n);case"option":for(u in r)if(r.hasOwnProperty(u)&&null!=(i=r[u]))if("selected"===u)e.selected=i&&"function"!=typeof i&&"symbol"!=typeof i;else gd(e,t,u,i,r,null);return;case"dialog":ed("beforetoggle",e),ed("toggle",e),ed("cancel",e),ed("close",e);break;case"iframe":case"object":ed("load",e);break;case"video":case"audio":for(i=0;i<Xc.length;i++)ed(Xc[i],e);break;case"image":ed("error",e),ed("load",e);break;case"details":ed("toggle",e);break;case"embed":case"source":case"link":ed("error",e),ed("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(c in r)if(r.hasOwnProperty(c)&&null!=(i=r[c]))switch(c){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,t));default:gd(e,t,c,i,r,null)}return;default:if(Dt(t)){for(d in r)r.hasOwnProperty(d)&&(void 0!==(i=r[d])&&pd(e,t,d,i,r,void 0));return}}for(l in r)r.hasOwnProperty(l)&&(null!=(i=r[l])&&gd(e,t,l,i,r,null))}function yd(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}var vd=null,bd=null;function Ed(e){return 9===e.nodeType?e:e.ownerDocument}function Sd(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Td(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function wd(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"bigint"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var kd=null;var _d="function"==typeof setTimeout?setTimeout:void 0,Ad="function"==typeof clearTimeout?clearTimeout:void 0,Ld="function"==typeof Promise?Promise:void 0,Rd="function"==typeof queueMicrotask?queueMicrotask:void 0!==Ld?function(e){return Ld.resolve(null).then(e).catch(Id)}:_d;function Id(e){setTimeout(function(){throw e})}function Pd(e){return"head"===e}function Cd(e,t){var r=t,s=0;do{var n=r.nextSibling;if(e.removeChild(r),n&&8===n.nodeType)if("/$"===(r=n.data)||"/&"===r){if(0===s)return e.removeChild(n),void Wh(t);s--}else if("$"===r||"$?"===r||"$~"===r||"$!"===r||"&"===r)s++;else if("html"===r)Gd(e.ownerDocument.documentElement);else if("head"===r){Gd(r=e.ownerDocument.head);for(var i=r.firstChild;i;){var a=i.nextSibling,o=i.nodeName;i[Je]||"SCRIPT"===o||"STYLE"===o||"LINK"===o&&"stylesheet"===i.rel.toLowerCase()||r.removeChild(i),i=a}}else"body"===r&&Gd(e.ownerDocument.body);r=n}while(r);Wh(t)}function Dd(e,t){var r=e;e=0;do{var s=r.nextSibling;if(1===r.nodeType?t?(r._stashedDisplay=r.style.display,r.style.display="none"):(r.style.display=r._stashedDisplay||"",""===r.getAttribute("style")&&r.removeAttribute("style")):3===r.nodeType&&(t?(r._stashedText=r.nodeValue,r.nodeValue=""):r.nodeValue=r._stashedText||""),s&&8===s.nodeType)if("/$"===(r=s.data)){if(0===e)break;e--}else"$"!==r&&"$?"!==r&&"$~"!==r&&"$!"!==r||e++;r=s}while(r)}function xd(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var r=t;switch(t=t.nextSibling,r.nodeName){case"HTML":case"HEAD":case"BODY":xd(r),Ze(r);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===r.rel.toLowerCase())continue}e.removeChild(r)}}function Od(e,t){for(;8!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!t)return null;if(null===(e=Fd(e.nextSibling)))return null}return e}function Nd(e){return"$?"===e.data||"$~"===e.data}function Md(e){return"$!"===e.data||"$?"===e.data&&"loading"!==e.ownerDocument.readyState}function Fd(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"$~"===t||"&"===t||"F!"===t||"F"===t)break;if("/$"===t||"/&"===t)return null}}return e}var $d=null;function Ud(e){e=e.nextSibling;for(var t=0;e;){if(8===e.nodeType){var r=e.data;if("/$"===r||"/&"===r){if(0===t)return Fd(e.nextSibling);t--}else"$"!==r&&"$!"!==r&&"$?"!==r&&"$~"!==r&&"&"!==r||t++}e=e.nextSibling}return null}function Bd(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var r=e.data;if("$"===r||"$!"===r||"$?"===r||"$~"===r||"&"===r){if(0===t)return e;t--}else"/$"!==r&&"/&"!==r||t++}e=e.previousSibling}return null}function jd(e,t,r){switch(t=Ed(r),e){case"html":if(!(e=t.documentElement))throw Error(s(452));return e;case"head":if(!(e=t.head))throw Error(s(453));return e;case"body":if(!(e=t.body))throw Error(s(454));return e;default:throw Error(s(451))}}function Gd(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Ze(e)}var Kd=new Map,Hd=new Set;function Vd(e){return"function"==typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var zd=U.d;U.d={f:function(){var e=zd.f(),t=sc();return e||t},r:function(e){var t=tt(e);null!==t&&5===t.tag&&"form"===t.type?ao(t):zd.r(e)},D:function(e){zd.D(e),Wd("dns-prefetch",e,null)},C:function(e,t){zd.C(e,t),Wd("preconnect",e,t)},L:function(e,t,r){zd.L(e,t,r);var s=qd;if(s&&e&&t){var n='link[rel="preload"][as="'+St(t)+'"]';"image"===t&&r&&r.imageSrcSet?(n+='[imagesrcset="'+St(r.imageSrcSet)+'"]',"string"==typeof r.imageSizes&&(n+='[imagesizes="'+St(r.imageSizes)+'"]')):n+='[href="'+St(e)+'"]';var i=n;switch(t){case"style":i=Qd(e);break;case"script":i=Zd(e)}Kd.has(i)||(e=d({rel:"preload",href:"image"===t&&r&&r.imageSrcSet?void 0:e,as:t},r),Kd.set(i,e),null!==s.querySelector(n)||"style"===t&&s.querySelector(Xd(i))||"script"===t&&s.querySelector(eh(i))||(md(t=s.createElement("link"),"link",e),nt(t),s.head.appendChild(t)))}},m:function(e,t){zd.m(e,t);var r=qd;if(r&&e){var s=t&&"string"==typeof t.as?t.as:"script",n='link[rel="modulepreload"][as="'+St(s)+'"][href="'+St(e)+'"]',i=n;switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":i=Zd(e)}if(!Kd.has(i)&&(e=d({rel:"modulepreload",href:e},t),Kd.set(i,e),null===r.querySelector(n))){switch(s){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(r.querySelector(eh(i)))return}md(s=r.createElement("link"),"link",e),nt(s),r.head.appendChild(s)}}},X:function(e,t){zd.X(e,t);var r=qd;if(r&&e){var s=st(r).hoistableScripts,n=Zd(e),i=s.get(n);i||((i=r.querySelector(eh(n)))||(e=d({src:e,async:!0},t),(t=Kd.get(n))&&nh(e,t),nt(i=r.createElement("script")),md(i,"link",e),r.head.appendChild(i)),i={type:"script",instance:i,count:1,state:null},s.set(n,i))}},S:function(e,t,r){zd.S(e,t,r);var s=qd;if(s&&e){var n=st(s).hoistableStyles,i=Qd(e);t=t||"default";var a=n.get(i);if(!a){var o={loading:0,preload:null};if(a=s.querySelector(Xd(i)))o.loading=5;else{e=d({rel:"stylesheet",href:e,"data-precedence":t},r),(r=Kd.get(i))&&sh(e,r);var l=a=s.createElement("link");nt(l),md(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){o.loading|=1}),l.addEventListener("error",function(){o.loading|=2}),o.loading|=4,rh(a,t,s)}a={type:"stylesheet",instance:a,count:1,state:o},n.set(i,a)}}},M:function(e,t){zd.M(e,t);var r=qd;if(r&&e){var s=st(r).hoistableScripts,n=Zd(e),i=s.get(n);i||((i=r.querySelector(eh(n)))||(e=d({src:e,async:!0,type:"module"},t),(t=Kd.get(n))&&nh(e,t),nt(i=r.createElement("script")),md(i,"link",e),r.head.appendChild(i)),i={type:"script",instance:i,count:1,state:null},s.set(n,i))}}};var qd="undefined"==typeof document?null:document;function Wd(e,t,r){var s=qd;if(s&&"string"==typeof t&&t){var n=St(t);n='link[rel="'+e+'"][href="'+n+'"]',"string"==typeof r&&(n+='[crossorigin="'+r+'"]'),Hd.has(n)||(Hd.add(n),e={rel:e,crossOrigin:r,href:t},null===s.querySelector(n)&&(md(t=s.createElement("link"),"link",e),nt(t),s.head.appendChild(t)))}}function Yd(e,t,r,n){var i,a,o,l,u=(u=Q.current)?Vd(u):null;if(!u)throw Error(s(446));switch(e){case"meta":case"title":return null;case"style":return"string"==typeof r.precedence&&"string"==typeof r.href?(t=Qd(r.href),(n=(r=st(u).hoistableStyles).get(t))||(n={type:"style",instance:null,count:0,state:null},r.set(t,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===r.rel&&"string"==typeof r.href&&"string"==typeof r.precedence){e=Qd(r.href);var c=st(u).hoistableStyles,d=c.get(e);if(d||(u=u.ownerDocument||u,d={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},c.set(e,d),(c=u.querySelector(Xd(e)))&&!c._p&&(d.instance=c,d.state.loading=5),Kd.has(e)||(r={rel:"preload",as:"style",href:r.href,crossOrigin:r.crossOrigin,integrity:r.integrity,media:r.media,hrefLang:r.hrefLang,referrerPolicy:r.referrerPolicy},Kd.set(e,r),c||(i=u,a=e,o=r,l=d.state,i.querySelector('link[rel="preload"][as="style"]['+a+"]")?l.loading=1:(a=i.createElement("link"),l.preload=a,a.addEventListener("load",function(){return l.loading|=1}),a.addEventListener("error",function(){return l.loading|=2}),md(a,"link",o),nt(a),i.head.appendChild(a))))),t&&null===n)throw Error(s(528,""));return d}if(t&&null!==n)throw Error(s(529,""));return null;case"script":return t=r.async,"string"==typeof(r=r.src)&&t&&"function"!=typeof t&&"symbol"!=typeof t?(t=Zd(r),(n=(r=st(u).hoistableScripts).get(t))||(n={type:"script",instance:null,count:0,state:null},r.set(t,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,e))}}function Qd(e){return'href="'+St(e)+'"'}function Xd(e){return'link[rel="stylesheet"]['+e+"]"}function Jd(e){return d({},e,{"data-precedence":e.precedence,precedence:null})}function Zd(e){return'[src="'+St(e)+'"]'}function eh(e){return"script[async]"+e}function th(e,t,r){if(t.count++,null===t.instance)switch(t.type){case"style":var n=e.querySelector('style[data-href~="'+St(r.href)+'"]');if(n)return t.instance=n,nt(n),n;var i=d({},r,{"data-href":r.href,"data-precedence":r.precedence,href:null,precedence:null});return nt(n=(e.ownerDocument||e).createElement("style")),md(n,"style",i),rh(n,r.precedence,e),t.instance=n;case"stylesheet":i=Qd(r.href);var a=e.querySelector(Xd(i));if(a)return t.state.loading|=4,t.instance=a,nt(a),a;n=Jd(r),(i=Kd.get(i))&&sh(n,i),nt(a=(e.ownerDocument||e).createElement("link"));var o=a;return o._p=new Promise(function(e,t){o.onload=e,o.onerror=t}),md(a,"link",n),t.state.loading|=4,rh(a,r.precedence,e),t.instance=a;case"script":return a=Zd(r.src),(i=e.querySelector(eh(a)))?(t.instance=i,nt(i),i):(n=r,(i=Kd.get(a))&&nh(n=d({},r),i),nt(i=(e=e.ownerDocument||e).createElement("script")),md(i,"link",n),e.head.appendChild(i),t.instance=i);case"void":return null;default:throw Error(s(443,t.type))}else"stylesheet"===t.type&&!(4&t.state.loading)&&(n=t.instance,t.state.loading|=4,rh(n,r.precedence,e));return t.instance}function rh(e,t,r){for(var s=r.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),n=s.length?s[s.length-1]:null,i=n,a=0;a<s.length;a++){var o=s[a];if(o.dataset.precedence===t)i=o;else if(i!==n)break}i?i.parentNode.insertBefore(e,i.nextSibling):(t=9===r.nodeType?r.head:r).insertBefore(e,t.firstChild)}function sh(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function nh(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var ih=null;function ah(e,t,r){if(null===ih){var s=new Map,n=ih=new Map;n.set(r,s)}else(s=(n=ih).get(r))||(s=new Map,n.set(r,s));if(s.has(e))return s;for(s.set(e,null),r=r.getElementsByTagName(e),n=0;n<r.length;n++){var i=r[n];if(!(i[Je]||i[Ve]||"link"===e&&"stylesheet"===i.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==i.namespaceURI){var a=i.getAttribute(t)||"";a=e+a;var o=s.get(a);o?o.push(i):s.set(a,[i])}}return s}function oh(e,t,r){(e=e.ownerDocument||e).head.insertBefore(r,"title"===t?e.querySelector("head > title"):null)}function lh(e){return!!("stylesheet"!==e.type||3&e.state.loading)}var uh=0;function ch(){if(this.count--,0===this.count&&(0===this.imgCount||!this.waitingForImages))if(this.stylesheets)hh(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var dh=null;function hh(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,dh=new Map,t.forEach(fh,e),dh=null,ch.call(e))}function fh(e,t){if(!(4&t.state.loading)){var r=dh.get(e);if(r)var s=r.get(null);else{r=new Map,dh.set(e,r);for(var n=e.querySelectorAll("link[data-precedence],style[data-precedence]"),i=0;i<n.length;i++){var a=n[i];"LINK"!==a.nodeName&&"not all"===a.getAttribute("media")||(r.set(a.dataset.precedence,a),s=a)}s&&r.set(null,s)}a=(n=t.instance).getAttribute("data-precedence"),(i=r.get(a)||s)===s&&r.set(null,n),r.set(a,n),this.count++,s=ch.bind(this),n.addEventListener("load",s),n.addEventListener("error",s),i?i.parentNode.insertBefore(n,i.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(n,e.firstChild),t.state.loading|=4}}var gh={$$typeof:k,Provider:null,Consumer:null,_currentValue:B,_currentValue2:B,_threadCount:0};function ph(e,t,r,s,n,i,a,o,l){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ne(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ne(0),this.hiddenUpdates=Ne(null),this.identifierPrefix=s,this.onUncaughtError=n,this.onCaughtError=i,this.onRecoverableError=a,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=l,this.incompleteTransitions=new Map}function mh(e,t,r,s,n,i,a,o,l,u,c,d){return e=new ph(e,t,r,a,l,u,c,d,o),t=1,!0===i&&(t|=24),i=js(3,null,null,t),e.current=i,i.stateNode=e,(t=Kn()).refCount++,e.pooledCache=t,t.refCount++,i.memoizedState={element:s,isDehydrated:r,cache:t},Ei(i),e}function yh(e){return e?e=Us:Us}function vh(e,t,r,s,n,i){n=yh(n),null===s.context?s.context=n:s.pendingContext=n,(s=Ti(t)).payload={element:r},null!==(i=void 0===i?null:i)&&(s.callback=i),null!==(r=wi(e,s,t))&&(Ju(r,0,t),ki(r,e,t))}function bh(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var r=e.retryLane;e.retryLane=0!==r&&r<t?r:t}}function Eh(e,t){bh(e,t),(e=e.alternate)&&bh(e,t)}function Sh(e){if(13===e.tag||31===e.tag){var t=Ms(e,67108864);null!==t&&Ju(t,0,67108864),Eh(e,67108864)}}function Th(e){if(13===e.tag||31===e.tag){var t=Qu(),r=Ms(e,t=Be(t));null!==r&&Ju(r,0,t),Eh(e,t)}}var wh=!0;function kh(e,t,r,s){var n=$.T;$.T=null;var i=U.p;try{U.p=2,Ah(e,t,r,s)}finally{U.p=i,$.T=n}}function _h(e,t,r,s){var n=$.T;$.T=null;var i=U.p;try{U.p=8,Ah(e,t,r,s)}finally{U.p=i,$.T=n}}function Ah(e,t,r,s){if(wh){var n=Lh(s);if(null===n)id(e,t,s,Rh,r),Uh(e,s);else if(function(e,t,r,s,n){switch(t){case"focusin":return Dh=Bh(Dh,e,t,r,s,n),!0;case"dragenter":return xh=Bh(xh,e,t,r,s,n),!0;case"mouseover":return Oh=Bh(Oh,e,t,r,s,n),!0;case"pointerover":var i=n.pointerId;return Nh.set(i,Bh(Nh.get(i)||null,e,t,r,s,n)),!0;case"gotpointercapture":return i=n.pointerId,Mh.set(i,Bh(Mh.get(i)||null,e,t,r,s,n)),!0}return!1}(n,e,t,r,s))s.stopPropagation();else if(Uh(e,s),4&t&&-1<$h.indexOf(e)){for(;null!==n;){var i=tt(n);if(null!==i)switch(i.tag){case 3:if((i=i.stateNode).current.memoizedState.isDehydrated){var a=Pe(i.pendingLanes);if(0!==a){var o=i;for(o.pendingLanes|=2,o.entangledLanes|=2;a;){var l=1<<31-ke(a);o.entanglements[1]|=l,a&=~l}Uc(i),!(6&yu)&&($u=he()+500,Bc(0))}}break;case 31:case 13:null!==(o=Ms(i,2))&&Ju(o,0,2),sc(),Eh(i,2)}if(null===(i=Lh(s))&&id(e,t,s,Rh,r),i===n)break;n=i}null!==n&&s.stopPropagation()}else id(e,t,s,null,r)}}function Lh(e){return Ih(e=$t(e))}var Rh=null;function Ih(e){if(Rh=null,null!==(e=et(e))){var t=i(e);if(null===t)e=null;else{var r=t.tag;if(13===r){if(null!==(e=a(t)))return e;e=null}else if(31===r){if(null!==(e=o(t)))return e;e=null}else if(3===r){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Rh=e,null}function Ph(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(fe()){case ge:return 2;case pe:return 8;case me:case ye:return 32;case ve:return 268435456;default:return 32}default:return 32}}var Ch=!1,Dh=null,xh=null,Oh=null,Nh=new Map,Mh=new Map,Fh=[],$h="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Uh(e,t){switch(e){case"focusin":case"focusout":Dh=null;break;case"dragenter":case"dragleave":xh=null;break;case"mouseover":case"mouseout":Oh=null;break;case"pointerover":case"pointerout":Nh.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mh.delete(t.pointerId)}}function Bh(e,t,r,s,n,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:r,eventSystemFlags:s,nativeEvent:i,targetContainers:[n]},null!==t&&(null!==(t=tt(t))&&Sh(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,null!==n&&-1===t.indexOf(n)&&t.push(n),e)}function jh(e){var t=et(e.target);if(null!==t){var r=i(t);if(null!==r)if(13===(t=r.tag)){if(null!==(t=a(r)))return e.blockedOn=t,void Ke(e.priority,function(){Th(r)})}else if(31===t){if(null!==(t=o(r)))return e.blockedOn=t,void Ke(e.priority,function(){Th(r)})}else if(3===t&&r.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===r.tag?r.stateNode.containerInfo:null)}e.blockedOn=null}function Gh(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var r=Lh(e.nativeEvent);if(null!==r)return null!==(t=tt(r))&&Sh(t),e.blockedOn=r,!1;var s=new(r=e.nativeEvent).constructor(r.type,r);Ft=s,r.target.dispatchEvent(s),Ft=null,t.shift()}return!0}function Kh(e,t,r){Gh(e)&&r.delete(t)}function Hh(){Ch=!1,null!==Dh&&Gh(Dh)&&(Dh=null),null!==xh&&Gh(xh)&&(xh=null),null!==Oh&&Gh(Oh)&&(Oh=null),Nh.forEach(Kh),Mh.forEach(Kh)}function Vh(t,r){t.blockedOn===r&&(t.blockedOn=null,Ch||(Ch=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Hh)))}var zh=null;function qh(t){zh!==t&&(zh=t,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){zh===t&&(zh=null);for(var e=0;e<t.length;e+=3){var r=t[e],s=t[e+1],n=t[e+2];if("function"!=typeof s){if(null===Ih(s||r))continue;break}var i=tt(r);null!==i&&(t.splice(e,3),e-=3,no(i,{pending:!0,data:n,method:r.method,action:s},s,n))}}))}function Wh(e){function t(t){return Vh(t,e)}null!==Dh&&Vh(Dh,e),null!==xh&&Vh(xh,e),null!==Oh&&Vh(Oh,e),Nh.forEach(t),Mh.forEach(t);for(var r=0;r<Fh.length;r++){var s=Fh[r];s.blockedOn===e&&(s.blockedOn=null)}for(;0<Fh.length&&null===(r=Fh[0]).blockedOn;)jh(r),null===r.blockedOn&&Fh.shift();if(null!=(r=(e.ownerDocument||e).$$reactFormReplay))for(s=0;s<r.length;s+=3){var n=r[s],i=r[s+1],a=n[ze]||null;if("function"==typeof i)a||qh(r);else if(a){var o=null;if(i&&i.hasAttribute("formAction")){if(n=i,a=i[ze]||null)o=a.formAction;else if(null!==Ih(n))continue}else o=a.action;"function"==typeof o?r[s+1]=o:(r.splice(s,3),s-=3),qh(r)}}}function Yh(){function e(e){e.canIntercept&&"react-transition"===e.info&&e.intercept({handler:function(){return new Promise(function(e){return n=e})},focusReset:"manual",scroll:"manual"})}function t(){null!==n&&(n(),n=null),s||setTimeout(r,20)}function r(){if(!s&&!navigation.transition){var e=navigation.currentEntry;e&&null!=e.url&&navigation.navigate(e.url,{state:e.getState(),info:"react-transition",history:"replace"})}}if("object"==typeof navigation){var s=!1,n=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(r,100),function(){s=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),null!==n&&(n(),n=null)}}}function Qh(e){this._internalRoot=e}function Xh(e){this._internalRoot=e}Xh.prototype.render=Qh.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));vh(t.current,Qu(),e,t,null,null)},Xh.prototype.unmount=Qh.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;vh(e.current,2,null,e,null,null),sc(),t[qe]=null}},Xh.prototype.unstable_scheduleHydration=function(e){if(e){var t=Ge();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Fh.length&&0!==t&&t<Fh[r].priority;r++);Fh.splice(r,0,e),0===r&&jh(e)}};var Jh=t.version;if("19.2.4"!==Jh)throw Error(s(527,Jh,"19.2.4"));U.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=i(e)))throw Error(s(188));return t!==e?null:e}for(var r=e,n=t;;){var a=r.return;if(null===a)break;var o=a.alternate;if(null===o){if(null!==(n=a.return)){r=n;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===r)return l(a),e;if(o===n)return l(a),t;o=o.sibling}throw Error(s(188))}if(r.return!==n.return)r=a,n=o;else{for(var u=!1,c=a.child;c;){if(c===r){u=!0,r=a,n=o;break}if(c===n){u=!0,n=a,r=o;break}c=c.sibling}if(!u){for(c=o.child;c;){if(c===r){u=!0,r=o,n=a;break}if(c===n){u=!0,n=o,r=a;break}c=c.sibling}if(!u)throw Error(s(189))}}if(r.alternate!==n)throw Error(s(190))}if(3!==r.tag)throw Error(s(188));return r.stateNode.current===r?e:t}(t),e=null===(e=null!==e?c(e):null)?null:e.stateNode};var Zh={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:$,reconcilerVersion:"19.2.4"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ef=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ef.isDisabled&&ef.supportsFiber)try{Se=ef.inject(Zh),Te=ef}catch(e){}}return u.createRoot=function(e,t){if(!n(e))throw Error(s(299));var r=!1,i="",a=Ro,o=Io,l=Po;return null!=t&&(!0===t.unstable_strictMode&&(r=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onUncaughtError&&(a=t.onUncaughtError),void 0!==t.onCaughtError&&(o=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError)),t=mh(e,1,!1,null,0,r,i,null,a,o,l,Yh),e[qe]=t.current,sd(e),new Qh(t)},u.hydrateRoot=function(e,t,r){if(!n(e))throw Error(s(299));var i=!1,a="",o=Ro,l=Io,u=Po,c=null;return null!=r&&(!0===r.unstable_strictMode&&(i=!0),void 0!==r.identifierPrefix&&(a=r.identifierPrefix),void 0!==r.onUncaughtError&&(o=r.onUncaughtError),void 0!==r.onCaughtError&&(l=r.onCaughtError),void 0!==r.onRecoverableError&&(u=r.onRecoverableError),void 0!==r.formState&&(c=r.formState)),(t=mh(e,1,!0,t,0,i,a,c,o,l,u,Yh)).context=yh(null),r=t.current,(a=Ti(i=Be(i=Qu()))).callback=null,wi(r,a,i),r=i,t.current.lanes=r,Me(t,r),Uc(t),e[qe]=t.current,sd(e),new Xh(t)},u.version="19.2.4",u}var L=(T||(T=1,function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),l.exports=A()),l.exports);const R=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},I=Number.isSafeInteger||function(e){return"number"==typeof e&&Math.abs(e)<=P},P=Number.MAX_SAFE_INTEGER||9007199254740991;let C=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),D=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",e.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",e.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.ASSET_LIST_LOAD_ERROR="assetListLoadError",e.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",e.ASSET_LIST_PARSING_ERROR="assetListParsingError",e.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.ATTACH_MEDIA_ERROR="attachMediaError",e.UNKNOWN="unknown",e}({}),x=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.MEDIA_ENDED="hlsMediaEnded",e.STALL_RESOLVED="hlsStallResolved",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFERED_TO_END="hlsBufferedToEnd",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",e.ASSET_LIST_LOADING="hlsAssetListLoading",e.ASSET_LIST_LOADED="hlsAssetListLoaded",e.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",e.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",e.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",e.INTERSTITIAL_STARTED="hlsInterstitialStarted",e.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",e.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",e.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",e.INTERSTITIAL_ENDED="hlsInterstitialEnded",e.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",e.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",e.EVENT_CUE_ENTER="hlsEventCueEnter",e}({});var O="manifest",N="level",M="audioTrack",F="subtitleTrack",$="main",U="audio",B="subtitle";class j{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class G{constructor(e,t,r,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new j(e),this.fast_=new j(t),this.defaultTTFB_=s,this.ttfb_=new j(e)}update(e,t){const{slow_:r,fast_:s,ttfb_:n}=this;r.halfLife!==e&&(this.slow_=new j(e,r.getEstimate(),r.getTotalWeight())),s.halfLife!==t&&(this.fast_=new j(t,s.getEstimate(),s.getTotalWeight())),n.halfLife!==e&&(this.ttfb_=new j(e,n.getEstimate(),n.getTotalWeight()))}sample(e,t){const r=(e=Math.max(e,this.minDelayMs_))/1e3,s=8*t/r;this.fast_.sample(r,s),this.slow_.sample(r,s)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function K(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t);if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function H(){return H=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},H.apply(null,arguments)}function V(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?V(Object(r),!0).forEach(function(t){K(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class q{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const r=`[${e}]:`;this.trace=W,this.debug=t.debug.bind(null,r),this.log=t.log.bind(null,r),this.warn=t.warn.bind(null,r),this.info=t.info.bind(null,r),this.error=t.error.bind(null,r)}}const W=function(){},Y={trace:W,debug:W,log:W,warn:W,info:W,error:W};function Q(){return H({},Y)}function X(e,t,r){return t[e]?t[e].bind(t):function(e,t){const r=self.console[e];return r?r.bind(self.console,`${t?"["+t+"] ":""}[${e}] >`):W}(e,r)}const J=Q();const Z=J;function ee(e=!0){if("undefined"==typeof self)return;return(e||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function te(e,t){const r=Object.keys(e),s=Object.keys(t),n=r.length,i=s.length;return!n||!i||n===i&&!r.some(e=>-1===s.indexOf(e))}function re(e,t=!1){if("undefined"!=typeof TextDecoder){const r=new TextDecoder("utf-8").decode(e);if(t){const e=r.indexOf("\0");return-1!==e?r.substring(0,e):r}return r.replace(/\0/g,"")}const r=e.length;let s,n,i,a="",o=0;for(;o<r;){if(s=e[o++],0===s&&t)return a;if(0!==s&&3!==s)switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(s);break;case 12:case 13:n=e[o++],a+=String.fromCharCode((31&s)<<6|63&n);break;case 14:n=e[o++],i=e[o++],a+=String.fromCharCode((15&s)<<12|(63&n)<<6|63&i)}}return a}function se(e){let t="";for(let r=0;r<e.length;r++){let s=e[r].toString(16);s.length<2&&(s="0"+s),t+=s}return t}function ne(e){return Uint8Array.from(e.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function ie(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ae,oe={exports:{}};var le=(ae||(ae=1,function(e){var t,r,s,n,i;t=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,n=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,i={buildAbsoluteURL:function(e,t,s){if(s=s||{},e=e.trim(),!(t=t.trim())){if(!s.alwaysNormalize)return e;var n=i.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=i.normalizePath(n.path),i.buildURLFromParts(n)}var a=i.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return s.alwaysNormalize?(a.path=i.normalizePath(a.path),i.buildURLFromParts(a)):t;var o=i.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=r.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var u={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(u.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var c=o.path,d=c.substring(0,c.lastIndexOf("/")+1)+a.path;u.path=i.normalizePath(d)}else u.path=o.path,a.params||(u.params=o.params,a.query||(u.query=o.query));return null===u.path&&(u.path=s.alwaysNormalize?i.normalizePath(a.path):a.path),i.buildURLFromParts(u)},parseURL:function(e){var r=t.exec(e);return r?{scheme:r[1]||"",netLoc:r[2]||"",path:r[3]||"",params:r[4]||"",query:r[5]||"",fragment:r[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(s,"");e.length!==(e=e.replace(n,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=i}(oe)),oe.exports);class ue{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ce="audio",de="video",he="audiovideo";class fe{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,"string"==typeof e&&(e={url:e}),this.base=e,function(e,t){const r=ye(e,t);r&&(r.enumerable=!0,Object.defineProperty(e,t,r))}(this,"stats")}setByteRange(e,t){const r=e.split("@",2);let s;s=1===r.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(r[1]),this._byteRange=[s,parseInt(r[0])+s]}get baseurl(){return this.base.url}get byteRange(){return null===this._byteRange?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return null===this._streams&&(this._streams={[ce]:null,[de]:null,[he]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return null!==this._stats}get hasStreams(){return null!==this._streams}get stats(){return null===this._stats&&(this._stats=new ue),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=le.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[ce]=null,e[de]=null,e[he]=null}}function ge(e){return"initSegment"!==e.sn}class pe extends fe{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(R(e)&&R(t))return t-e}return null}get bitrate(){return this.byteLength?8*this.byteLength/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(null==(e=this._decryptdata)||!e.keyId){const e=Object.keys(t);if(1===e.length){const r=this._decryptdata=t[e[0]]||null;r&&(this._decryptdata=r.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;const e=R(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){var t;const e=Object.keys(this.levelkeys),r=e.length;if(r>1||1===r&&null!=(t=this.levelkeys[e[0]])&&t.encrypted)return!0}return!1}get programDateTime(){return null===this._programDateTime&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){R(e)?this._programDateTime=e:this._programDateTime=this.rawProgramDateTime=null}get ref(){return ge(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var r;const s=t[e];!s||null!=(r=this._decryptdata)&&r.keyId||(this._decryptdata=s.getDecryptData(this.sn,t))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,r,s,n,i=!1){const{elementaryStreams:a}=this,o=a[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,r),o.startDTS=Math.min(o.startDTS,s),o.endDTS=Math.max(o.endDTS,n)):a[e]={startPTS:t,endPTS:r,startDTS:s,endDTS:n,partial:i}}}class me extends fe{constructor(e,t,r,s,n){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const i=e.enumeratedString("BYTERANGE");i&&this.setByteRange(i,n),n&&(this.fragOffset=n.fragOffset+n.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function ye(e,t){const r=Object.getPrototypeOf(e);if(r){const e=Object.getOwnPropertyDescriptor(r,t);return e||ye(r,t)}}const ve=Math.pow(2,32)-1,be=[].push,Ee={video:1,audio:2,id3:3,text:4};function Se(e){return String.fromCharCode.apply(null,e)}function Te(e,t){const r=e[t]<<8|e[t+1];return r<0?65536+r:r}function we(e,t){const r=_e(e,t);return r<0?4294967296+r:r}function ke(e,t){let r=we(e,t);return r*=Math.pow(2,32),r+=we(e,t+4),r}function _e(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function Ae(e,t){const r=[];if(!t.length)return r;const s=e.byteLength;for(let n=0;n<s;){const i=we(e,n),a=i>1?n+i:s;if(Se(e.subarray(n+4,n+8))===t[0])if(1===t.length)r.push(e.subarray(n+8,a));else{const s=Ae(e.subarray(n+8,a),t.slice(1));s.length&&be.apply(r,s)}n=a}return r}function Le(e){const t=[],r=e[0];let s=8;const n=we(e,s);s+=4;let i=0,a=0;0===r?(i=we(e,s),a=we(e,s+4),s+=8):(i=ke(e,s),a=ke(e,s+8),s+=16),s+=2;let o=e.length+a;const l=Te(e,s);s+=2;for(let r=0;r<l;r++){let r=s;const i=we(e,r);r+=4;const a=2147483647&i;if(1===(2147483648&i)>>>31)return Z.warn("SIDX has hierarchical references (not supported)"),null;const l=we(e,r);r+=4,t.push({referenceSize:a,subsegmentDuration:l,info:{duration:l/n,start:o,end:o+a-1}}),o+=a,r+=4,s=r}return{earliestPresentationTime:i,timescale:n,version:r,referencesCount:l,references:t}}function Re(e){const t=[],r=Ae(e,["moov","trak"]);for(let e=0;e<r.length;e++){const s=r[e],n=Ae(s,["tkhd"])[0];if(n){let e=n[0];const r=we(n,0===e?12:20),i=Ae(s,["mdia","mdhd"])[0];if(i){e=i[0];const n=we(i,0===e?12:20),a=Ae(s,["mdia","hdlr"])[0];if(a){const e=Se(a.subarray(8,12)),i={soun:ce,vide:de}[e],o=Ie(Ae(s,["mdia","minf","stbl","stsd"])[0]);i?(t[r]={timescale:n,type:i,stsd:o},t[i]=z({timescale:n,id:r},o)):t[r]={timescale:n,type:e,stsd:o}}}}}return Ae(e,["moov","mvex","trex"]).forEach(e=>{const r=we(e,4),s=t[r];s&&(s.default={duration:we(e,12),flags:we(e,20)})}),t}function Ie(e){const t=e.subarray(8),r=t.subarray(86),s=Se(t.subarray(4,8));let n,i=s;const a="enca"===s||"encv"===s;if(a){const e=Ae(t,[s])[0];Ae(e.subarray("enca"===s?28:78),["sinf"]).forEach(e=>{const t=Ae(e,["schm"])[0];if(t){const r=Se(t.subarray(4,8));if("cbcs"===r||"cenc"===r){const t=Ae(e,["frma"])[0];t&&(i=Se(t))}}})}const o=i;switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const e=Ae(r,["avcC"])[0];e&&e.length>3&&(i+="."+De(e[1])+De(e[2])+De(e[3]),n=Pe("avc1"===o?"dva1":"dvav",r));break}case"mp4a":{const e=Ae(t,[s])[0],r=Ae(e.subarray(28),["esds"])[0];if(r&&r.length>7){let e=4;if(3!==r[e++])break;e=Ce(r,e),e+=2;const t=r[e++];if(128&t&&(e+=2),64&t&&(e+=r[e++]),4!==r[e++])break;e=Ce(r,e);const s=r[e++];if(64!==s)break;if(i+="."+De(s),e+=12,5!==r[e++])break;e=Ce(r,e);const n=r[e++];let a=(248&n)>>3;31===a&&(a+=1+((7&n)<<3)+((224&r[e])>>5)),i+="."+a}break}case"hvc1":case"hev1":{const e=Ae(r,["hvcC"])[0];if(e&&e.length>12){const t=e[1],r=["","A","B","C"][t>>6],s=31&t,n=we(e,2),a=(32&t)>>5?"H":"L",o=e[12],l=e.subarray(6,12);i+="."+r+s,i+="."+function(e){let t=0;for(let r=0;r<32;r++)t|=(e>>r&1)<<31-r;return t>>>0}(n).toString(16).toUpperCase(),i+="."+a+o;let u="";for(let e=l.length;e--;){const t=l[e];if(t||u){u="."+t.toString(16).toUpperCase()+u}}i+=u}n=Pe("hev1"==o?"dvhe":"dvh1",r);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":i=Pe(i,r)||i;break;case"vp09":{const e=Ae(r,["vpcC"])[0];if(e&&e.length>6){const t=e[4],r=e[5],s=e[6]>>4&15;i+="."+xe(t)+"."+xe(r)+"."+xe(s)}break}case"av01":{const e=Ae(r,["av1C"])[0];if(e&&e.length>2){const t=e[1]>>>5,s=31&e[1],a=e[2]>>>7?"H":"M",o=(64&e[2])>>6,l=(32&e[2])>>5,u=2===t&&o?l?12:10:o?10:8,c=(16&e[2])>>4,d=(8&e[2])>>3,h=(4&e[2])>>2,f=3&e[2],g=1,p=1,m=1,y=0;i+="."+t+"."+xe(s)+a+"."+xe(u)+"."+c+"."+d+h+f+"."+xe(g)+"."+xe(p)+"."+xe(m)+"."+y,n=Pe("dav1",r)}break}}return{codec:i,encrypted:a,supplemental:n}}function Pe(e,t){const r=Ae(t,["dvvC"]),s=r.length?r[0]:Ae(t,["dvcC"])[0];if(s){const t=s[2]>>1&127,r=s[2]<<5&32|s[3]>>3&31;return e+"."+xe(t)+"."+xe(r)}}function Ce(e,t){const r=t+5;for(;128&e[t++]&&t<r;);return t}function De(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function xe(e){return(e<10?"0":"")+e}function Oe(e,t){Ae(e,["moov","trak"]).forEach(e=>{const r=Ae(e,["mdia","minf","stbl","stsd"])[0];if(!r)return;const s=r.subarray(8);let n=Ae(s,["enca"]);const i=n.length>0;i||(n=Ae(s,["encv"])),n.forEach(e=>{Ae(i?e.subarray(28):e.subarray(78),["sinf"]).forEach(e=>{const r=Ne(e);r&&t(r,i)})})})}function Ne(e){const t=Ae(e,["schm"])[0];if(t){const r=Se(t.subarray(4,8));if("cbcs"===r||"cenc"===r){const t=Ae(e,["schi","tenc"])[0];if(t)return t}}}function Me(e,t){const r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function Fe(e,t){const r=[],s=t.samples,n=t.timescale,i=t.id;let a=!1;return Ae(s,["moof"]).map(o=>{const l=o.byteOffset-8;Ae(o,["traf"]).map(o=>{const u=Ae(o,["tfdt"]).map(e=>{const t=e[0];let r=we(e,4);return 1===t&&(r*=Math.pow(2,32),r+=we(e,8)),r/n})[0];return void 0!==u&&(e=u),Ae(o,["tfhd"]).map(u=>{const c=we(u,4),d=16777215&we(u,0);let h=0;const f=!!(16&d);let g=0;const p=!!(32&d);let m=8;c===i&&(!!(1&d)&&(m+=8),!!(2&d)&&(m+=4),!!(8&d)&&(h=we(u,m),m+=4),f&&(g=we(u,m),m+=4),p&&(m+=4),"video"===t.type&&(a=$e(t.codec)),Ae(o,["trun"]).map(i=>{const o=i[0],u=16777215&we(i,0),c=!!(1&u);let d=0;const f=!!(4&u),p=!!(256&u);let m=0;const y=!!(512&u);let v=0;const b=!!(1024&u),E=!!(2048&u);let S=0;const T=we(i,4);let w=8;c&&(d=we(i,w),w+=4),f&&(w+=4);let k=d+l;for(let l=0;l<T;l++){if(p?(m=we(i,w),w+=4):m=h,y?(v=we(i,w),w+=4):v=g,b&&(w+=4),E&&(S=0===o?we(i,w):_e(i,w),w+=4),t.type===de){let t=0;for(;t<v;){const i=we(s,k);if(k+=4,Ue(a,s[k])){Be(s.subarray(k,k+i),a?2:1,e+S/n,r)}k+=i,t+=i+4}}e+=m/n}}))})})}),r}function $e(e){if(!e)return!1;const t=e.substring(0,4);return"hvc1"===t||"hev1"===t||"dvh1"===t||"dvhe"===t}function Ue(e,t){if(e){const e=t>>1&63;return 39===e||40===e}return 6===(31&t)}function Be(e,t,r,s){const n=je(e);let i=0;i+=t;let a=0,o=0,l=0;for(;i<n.length;){a=0;do{if(i>=n.length)break;l=n[i++],a+=l}while(255===l);o=0;do{if(i>=n.length)break;l=n[i++],o+=l}while(255===l);const e=n.length-i;let t=i;if(o<e)i+=o;else if(o>e){Z.error(`Malformed SEI payload. ${o} is too small, only ${e} bytes left to parse.`);break}if(4===a){if(181===n[t++]){const e=Te(n,t);if(t+=2,49===e){const e=we(n,t);if(t+=4,1195456820===e){const e=n[t++];if(3===e){const i=n[t++],o=64&i,l=o?2+3*(31&i):0,u=new Uint8Array(l);if(o){u[0]=i;for(let e=1;e<l;e++)u[e]=n[t++]}s.push({type:e,payloadType:a,pts:r,bytes:u})}}}}}else if(5===a&&o>16){const e=[];for(let r=0;r<16;r++){const s=n[t++].toString(16);e.push(1==s.length?"0"+s:s),3!==r&&5!==r&&7!==r&&9!==r||e.push("-")}const i=o-16,l=new Uint8Array(i);for(let e=0;e<i;e++)l[e]=n[t++];s.push({payloadType:a,pts:r,uuid:e.join(""),userData:re(l),userDataBytes:l})}}}function je(e){const t=e.byteLength,r=[];let s=1;for(;s<t-2;)0===e[s]&&0===e[s+1]&&3===e[s+2]?(r.push(s+2),s+=2):s++;if(0===r.length)return e;const n=t-r.length,i=new Uint8Array(n);let a=0;for(s=0;s<n;a++,s++)a===r[0]&&(a++,r.shift()),i[s]=e[a];return i}function Ge(e,t,r){if(16!==e.byteLength)throw new RangeError("Invalid system id");let s,n,i;s=0,n=new Uint8Array,i=new Uint8Array;const a=new Uint8Array(4);return r.byteLength>0&&new DataView(a.buffer).setUint32(0,r.byteLength,!1),function(e,...t){const r=t.length;let s=8,n=r;for(;n--;)s+=t[n].byteLength;const i=new Uint8Array(s);for(i[0]=s>>24&255,i[1]=s>>16&255,i[2]=s>>8&255,i[3]=255&s,i.set(e,4),n=0,s=8;n<r;n++)i.set(t[n],s),s+=t[n].byteLength;return i}([112,115,115,104],new Uint8Array([0,0,0,0]),e,i,n,a,r)}function Ke(e){const t=e.getUint32(0),r=e.byteOffset,s=e.byteLength;if(s<t)return{offset:r,size:s};if(1886614376!==e.getUint32(4))return{offset:r,size:t};const n=e.getUint32(8)>>>24;if(0!==n&&1!==n)return{offset:r,size:t};const i=e.buffer,a=se(new Uint8Array(i,r+12,16));let o=null,l=null,u=0;if(0===n)u=28;else{const n=e.getUint32(28);if(!n||s<32+16*n)return{offset:r,size:t};o=[];for(let e=0;e<n;e++)o.push(new Uint8Array(i,r+32+16*e,16));u=32+16*n}if(!u)return{offset:r,size:t};const c=e.getUint32(u);return t-32<c?{offset:r,size:t}:(l=new Uint8Array(i,r+u+4,c),{version:n,systemId:a,kids:o,data:l,offset:r,size:t})}const He=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Ve={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function ze(e,t){const r=Ve[t];return!!r&&!!r[e.slice(0,4)]}function qe(e,t,r=!0){return!e.split(",").some(e=>!We(e,t,r))}function We(e,t,r=!0){var s;const n=ee(r);return null!=(s=null==n?void 0:n.isTypeSupported(Ye(e,t)))&&s}function Ye(e,t){return`${t}/mp4;codecs=${e}`}function Qe(e){if(e){const t=e.substring(0,4);return Ve.video[t]}return 2}function Xe(e){const t=He();return e.split(",").reduce((e,r)=>{const s=t&&$e(r)?9:Ve.video[r];return s?(2*s+e)/(e?3:2):(Ve.audio[r]+e)/(e?2:1)},0)}const Je={};const Ze=/flac|opus|mp4a\.40\.34/i;function et(e,t=!0){return e.replace(Ze,e=>function(e,t=!0){if(Je[e])return Je[e];const r={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[e];for(let n=0;n<r.length;n++){var s;if(We(r[n],"audio",t))return Je[e]=r[n],r[n];if("mp3"===r[n]&&null!=(s=ee(t))&&s.isTypeSupported("audio/mpeg"))return""}return e}(e.toLowerCase(),t))}function tt(e,t){if(e&&(e.length>4||-1!==["ac-3","ec-3","alac","fLaC","Opus"].indexOf(e))&&(rt(e,"audio")||rt(e,"video")))return e;if(t){const r=t.split(",");if(r.length>1){if(e)for(let t=r.length;t--;)if(r[t].substring(0,4)===e.substring(0,4))return r[t];return r[0]}}return t||e}function rt(e,t){return ze(e,t)&&We(e,t)}function st(e){if(e.startsWith("av01.")){const t=e.split("."),r=["0","111","01","01","01","0"];for(let e=t.length;e>4&&e<10;e++)t[e]=r[e-4];return t.join(".")}return e}function nt(e){const t=ee(e)||{isTypeSupported:()=>!1};return{mpeg:t.isTypeSupported("audio/mpeg"),mp3:t.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:t.isTypeSupported('audio/mp4; codecs="ac-3"')}}function it(e){return e.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const at={supported:!1,smooth:!1,powerEfficient:!1},ot={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function lt(e,t){return{supported:!1,configurations:t,decodingInfoResults:[at],error:e}}function ut(e,t,r,s,n,i){const a=e.videoCodec,o=e.audioCodec?e.audioGroups:null,l=null==i?void 0:i.audioCodec,u=null==i?void 0:i.channels,c=u?parseInt(u):l?1/0:2;let d=null;if(null!=o&&o.length)try{d=1===o.length&&o[0]?t.groups[o[0]].channels:o.reduce((e,r)=>{if(r){const s=t.groups[r];if(!s)throw new Error(`Audio track group ${r} not found`);Object.keys(s.channels).forEach(t=>{e[t]=(e[t]||0)+s.channels[t]})}return e},{2:0})}catch(e){return!0}return void 0!==a&&(a.split(",").some(e=>$e(e))||e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(s,30)||"SDR"!==e.videoRange&&e.videoRange!==r||e.bitrate>Math.max(n,8e6))||!!d&&R(c)&&Object.keys(d).some(e=>parseInt(e)>c)}function ct(e,t,r,s={}){const n=e.videoCodec;if(!n&&!e.audioCodec||!r)return Promise.resolve(ot);const i=[],a=function(e){var t;const r=null==(t=e.videoCodec)?void 0:t.split(","),s=ht(e),n=e.width||640,i=e.height||480,a=e.frameRate||30,o=e.videoRange.toLowerCase();return r?r.map(e=>{const t={contentType:Ye(st(e),"video"),width:n,height:i,bitrate:s,framerate:a};return"sdr"!==o&&(t.transferFunction=o),t}):[]}(e),o=a.length,l=function(e,t,r){var s;const n=null==(s=e.audioCodec)?void 0:s.split(","),i=ht(e);if(n&&e.audioGroups)return e.audioGroups.reduce((e,s)=>{var a;const o=s?null==(a=t.groups[s])?void 0:a.tracks:null;return o?o.reduce((e,t)=>{if(t.groupId===s){const s=parseFloat(t.channels||"");n.forEach(t=>{const n={contentType:Ye(t,"audio"),bitrate:r?dt(t,i):i};s&&(n.channels=""+s),e.push(n)})}return e},e):e},[]);return[]}(e,t,o>0),u=l.length;for(let e=o||1*u||1;e--;){const t={type:"media-source"};if(o&&(t.video=a[e%o]),u){t.audio=l[e%u];const r=t.audio.bitrate;t.video&&r&&(t.video.bitrate-=r)}i.push(t)}if(n){const e=navigator.userAgent;if(n.split(",").some(e=>$e(e))&&He())return Promise.resolve(lt(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${e})`),i))}return Promise.all(i.map(e=>{const t=function(e){let t="";const{audio:r,video:s}=e;if(s){t+=`${it(s.contentType)}_r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${Math.ceil(s.bitrate/1e5)}`}if(r){t+=`${s?"_":""}${it(r.contentType)}_c${r.channels}`}return t}(e);return s[t]||(s[t]=r.decodingInfo(e))})).then(e=>({supported:!e.some(e=>!e.supported),configurations:i,decodingInfoResults:e})).catch(e=>({supported:!1,configurations:i,decodingInfoResults:[],error:e}))}function dt(e,t){if(t<=1)return 1;let r=128e3;return"ec-3"===e?r=768e3:"ac-3"===e&&(r=64e4),Math.min(t/2,r)}function ht(e){return 1e3*Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)/1e3)||1}const ft=["NONE","TYPE-0","TYPE-1",null];const gt=["SDR","PQ","HLG"];var pt="",mt="YES",yt="v2";function vt(e){const{canSkipUntil:t,canSkipDateRanges:r,age:s}=e;return t&&s<t/2?r?yt:mt:pt}class bt{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Et{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(e=>!!e).map(e=>e.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const r=null==(t=e.supplemental)?void 0:t.videoCodec;r&&r!==e.videoCodec&&(this.codecSet+=`,${r.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return St(this._audioGroups,e)}hasSubtitleGroup(e){return St(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t)if("audio"===e){let e=this._audioGroups;e||(e=this._audioGroups=[]),-1===e.indexOf(t)&&e.push(t)}else if("text"===e){let e=this._subtitleGroups;e||(e=this._subtitleGroups=[]),-1===e.indexOf(t)&&e.push(t)}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return null==(e=this.audioGroups)?void 0:e[0]}get textGroupId(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}addFallback(){}}function St(e,t){return!(!t||!e)&&-1!==e.indexOf(t)}function Tt(e,t){let r=!1,s=[];if(e&&(r="SDR"!==e,s=[e]),t){s=t.allowedVideoRanges||gt.slice(0);const e="SDR"!==s.join("")&&!t.videoCodec;r=void 0!==t.preferHDR?t.preferHDR:e&&function(){if("function"==typeof matchMedia){const e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}(),r||(s=["SDR"])}return{preferHDR:r,allowedVideoRanges:s}}const wt=(e,t)=>JSON.stringify(e,(e=>{const t=new WeakSet;return(r,s)=>{if(e&&(s=e(r,s)),"object"==typeof s&&null!==s){if(t.has(s))return;t.add(s)}return s}})(t));function kt(e,t){Z.log(`[abr] start candidates with "${e}" ignored because ${t}`)}function _t(e){return e.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const s=t.channels||"2";return r.channels[s]=(r.channels[s]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function At(e){if(!e)return e;const{lang:t,assocLang:r,characteristics:s,channels:n,audioCodec:i}=e;return{lang:t,assocLang:r,characteristics:s,channels:n,audioCodec:i}}function Lt(e,t,r){if("attrs"in e){const r=t.indexOf(e);if(-1!==r)return r}for(let s=0;s<t.length;s++){if(Rt(e,t[s],r))return s}return-1}function Rt(e,t,r){const{groupId:s,name:n,lang:i,assocLang:a,default:o}=e,l=e.forced;return(void 0===s||t.groupId===s)&&(void 0===n||t.name===n)&&(void 0===i||function(e,t="--"){if(e.length===t.length)return e===t;return e.startsWith(t)||t.startsWith(e)}(i,t.lang))&&(void 0===i||t.assocLang===a)&&(void 0===o||t.default===o)&&(void 0===l||t.forced===l)&&(!("characteristics"in e)||function(e,t=""){const r=e.split(","),s=t.split(",");return r.length===s.length&&!r.some(e=>-1===s.indexOf(e))}(e.characteristics||"",t.characteristics))&&(void 0===r||r(e,t))}function It(e,t){const{audioCodec:r,channels:s}=e;return!(void 0!==r&&(t.audioCodec||"").substring(0,4)!==r.substring(0,4)||void 0!==s&&s!==(t.channels||"2"))}function Pt(e,t,r){for(let s=t;s>-1;s--)if(r(e[s]))return s;for(let s=t+1;s<e.length;s++)if(r(e[s]))return s;return-1}function Ct(e,t){var r;return!!e&&e!==(null==(r=t.loadLevelObj)?void 0:r.uri)}const Dt=function(e,t){let r=0,s=e.length-1,n=null,i=null;for(;r<=s;){n=(r+s)/2|0,i=e[n];const a=t(i);if(a>0)r=n+1;else{if(!(a<0))return i;s=n-1}}return null};function xt(e,t,r=0,s=0,n=.005){let i=null;if(e){i=t[1+e.sn-t[0].sn]||null;const s=e.endDTS-r;s>0&&s<15e-7&&(r+=15e-7),i&&e.level!==i.level&&i.end<=e.end&&(i=t[2+e.sn-t[0].sn]||null)}else 0===r&&0===t[0].start&&(i=t[0]);if(i&&((!e||e.level===i.level)&&0===Ot(r,s,i)||function(e,t,r){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){const s=t.tagList.reduce((e,t)=>("INF"===t[0]&&(e+=parseFloat(t[1])),e),r);return e.start<=s}return!1}(i,e,Math.min(n,s))))return i;const a=Dt(t,Ot.bind(null,r,s));return!a||a===e&&i?i:a}function Ot(e=0,t=0,r){if(r.start<=e&&r.start+r.duration>e)return 0;const s=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-s<=e?1:r.start-s>e&&r.start?-1:0}function Nt(e,t,r){const s=1e3*Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return(r.endProgramDateTime||0)-s>e}function Mt(e,t,r){if(e&&e.startCC<=t&&e.endCC>=t){let s=e.fragments;const{fragmentHint:n}=e;let i;return n&&(s=s.concat(n)),Dt(s,e=>e.cc<t?1:e.cc>t?-1:(i=e,e.end<=r?1:e.start>r?-1:0)),i||null}return null}function Ft(e){switch(e.details){case D.FRAG_LOAD_TIMEOUT:case D.KEY_LOAD_TIMEOUT:case D.LEVEL_LOAD_TIMEOUT:case D.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function $t(e){return e.details.startsWith("key")}function Ut(e){return $t(e)&&!!e.frag&&!e.frag.decryptdata}function Bt(e,t){const r=Ft(t);return e.default[(r?"timeout":"error")+"Retry"]}function jt(e,t){const r="linear"===e.backoff?1:Math.pow(2,t);return Math.min(r*e.retryDelayMs,e.maxRetryDelayMs)}function Gt(e){return z(z({},e),{errorRetry:null,timeoutRetry:null})}function Kt(e,t,r,s){if(!e)return!1;const n=null==s?void 0:s.code,i=t<e.maxNumRetry&&(function(e){return Ht(e)||!!e&&(e<400||e>499)}(n)||!!r);return e.shouldRetry?e.shouldRetry(e,t,r,s,i):i}function Ht(e){return 0===e&&!1===navigator.onLine}var Vt=0,zt=2,qt=3,Wt=5,Yt=0,Qt=1,Xt=2,Jt=4;function Zt(e){const t={action:Vt,flags:Yt};return e&&(t.resolved=!0),t}var er="NOT_LOADED",tr="APPENDING",rr="PARTIAL",sr="OK";class nr{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.BUFFER_APPENDED,this.onBufferAppended,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this),e.on(x.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.BUFFER_APPENDED,this.onBufferAppended,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this),e.off(x.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let t=r.length;t--;){const s=r[t];if(!s)break;if(s.start<=e&&e<=s.end&&s.loaded)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,r){const{fragments:s}=this,n=Object.keys(s);for(let i=n.length;i--;){const a=s[n[i]];if((null==a?void 0:a.body.type)===t&&(!r||a.buffered)){const t=a.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,r,s,n){this.timeRanges&&(this.timeRanges[e]=t);const i=(null==s?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(s=>{const a=this.fragments[s];if(!a)return;if(i>=a.body.sn)return;if(!a.buffered&&(!a.loaded||n))return void(a.body.type===r&&this.removeFragment(a.body));const o=a.range[e];o&&(0!==o.time.length?o.time.some(e=>{const r=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return r&&this.removeFragment(a.body),r}):this.removeFragment(a.body))})}detectPartialFragments(e){const t=this.timeRanges;if(!t||"initSegment"===e.frag.sn)return;const r=e.frag,s=ar(r),n=this.fragments[s];if(!n||n.buffered&&r.gap)return;const i=!r.relurl;Object.keys(t).forEach(s=>{const a=r.elementaryStreams[s];if(!a)return;const o=t[s],l=i||!0===a.partial;n.range[s]=this.getBufferedTimes(r,e.part,l,o)}),n.loaded=null,Object.keys(n.range).length?(this.bufferedEnd(n,r),ir(n)||this.removeParts(r.sn-1,r.type)):this.removeFragment(n.body)}bufferedEnd(e,t){e.buffered=!0;(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=or(r,t=>t.fragment.sn>=e))}fragBuffered(e,t){const r=ar(e);let s=this.fragments[r];!s&&t&&(s=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,this.bufferedEnd(s,e))}getBufferedTimes(e,t,r,s){const n={time:[],partial:r},i=e.start,a=e.end,o=e.minEndPTS||a,l=e.maxStartPTS||i;for(let e=0;e<s.length;e++){const t=s.start(e)-this.bufferPadding,r=s.end(e)+this.bufferPadding;if(l>=t&&o<=r){n.time.push({startPTS:Math.max(i,s.start(e)),endPTS:Math.min(a,s.end(e))});break}if(i<r&&a>t){const t=Math.max(i,s.start(e)),r=Math.min(a,s.end(e));r>t&&(n.partial=!0,n.time.push({startPTS:t,endPTS:r}))}else if(a<=t)break}return n}getPartialFragment(e){let t,r,s,n=null,i=0;const{bufferPadding:a,fragments:o}=this;return Object.keys(o).forEach(l=>{const u=o[l];u&&ir(u)&&(r=u.body.start-a,s=u.body.end+a,e>=r&&e<=s&&(t=Math.min(e-r,s-e),i<=t&&(n=u.body,i=t)))}),n}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||ir(t))}getState(e){const t=ar(e),r=this.fragments[t];return r?r.buffered?ir(r)?rr:sr:tr:er}isTimeBuffered(e,t,r){let s,n;for(let i=0;i<r.length;i++){if(s=r.start(i)-this.bufferPadding,n=r.end(i)+this.bufferPadding,e>=s&&t<=n)return!0;if(t<=s)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if("initSegment"===t.frag.sn||t.frag.bitrateTest)return;const r=t.frag,s=t.part?null:t,n=ar(r);this.fragments[n]={body:r,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:s,timeRanges:n,type:i}=t;if("initSegment"===r.sn)return;const a=r.type;if(s){let e=this.activePartLists[a];e||(this.activePartLists[a]=e=[]),e.push(s)}this.timeRanges=n;const o=n[i];this.detectEvictedFragments(i,o,a,s)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=ar(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,r=Object.keys(t);if(!e)return r.length>0;for(let s=r.length;s--;){const n=t[r[s]];if((null==n?void 0:n.body.type)===e)return!0}return!1}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,r,s,n){s&&!this.hasGaps||Object.keys(this.fragments).forEach(i=>{const a=this.fragments[i];if(!a)return;const o=a.body;o.type!==r||s&&!o.gap||o.start<t&&o.end>e&&(a.buffered||n)&&this.removeFragment(o)})}removeFragment(e){const t=ar(e);e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const t=e.sn;this.activePartLists[e.type]=or(r,e=>e.fragment.sn!==t)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=null==(e=this.hls)||null==(e=e.latestLevelDetails)?void 0:e.partList;t&&t.forEach(e=>e.clearElementaryStreamInfo())}}function ir(e){var t,r,s;return e.buffered&&!!(e.body.gap||null!=(t=e.range.video)&&t.partial||null!=(r=e.range.audio)&&r.partial||null!=(s=e.range.audiovideo)&&s.partial)}function ar(e){return`${e.type}_${e.level}_${e.sn}`}function or(e,t){return e.filter(e=>{const r=t(e);return r||e.clearElementaryStreamInfo(),r})}var lr=0,ur=1;class cr{constructor(e,t,r){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=r}decrypt(e,t){switch(this.aesMode){case lr:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case ur:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}class dr{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let e=0;e<4;e++)r[e]=t.getUint32(4*e);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,s=r[0],n=r[1],i=r[2],a=r[3],o=this.invSubMix,l=o[0],u=o[1],c=o[2],d=o[3],h=new Uint32Array(256);let f=0,g=0,p=0;for(p=0;p<256;p++)h[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){let r=g^g<<1^g<<2^g<<3^g<<4;r=r>>>8^255&r^99,e[f]=r,t[r]=f;const o=h[f],p=h[o],m=h[p];let y=257*h[r]^16843008*r;s[f]=y<<24|y>>>8,n[f]=y<<16|y>>>16,i[f]=y<<8|y>>>24,a[f]=y,y=16843009*m^65537*p^257*o^16843008*f,l[r]=y<<24|y>>>8,u[r]=y<<16|y>>>16,c[r]=y<<8|y>>>24,d[r]=y,f?(f=o^h[h[h[m^o]]],g^=h[h[g]]):f=g=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,s=0;for(;s<t.length&&r;)r=t[s]===this.key[s],s++;if(r)return;this.key=t;const n=this.keySize=t.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);const i=this.ksRows=4*(n+6+1);let a,o;const l=this.keySchedule=new Uint32Array(i),u=this.invKeySchedule=new Uint32Array(i),c=this.sBox,d=this.rcon,h=this.invSubMix,f=h[0],g=h[1],p=h[2],m=h[3];let y,v;for(a=0;a<i;a++)a<n?y=l[a]=t[a]:(v=y,a%n===0?(v=v<<8|v>>>24,v=c[v>>>24]<<24|c[v>>>16&255]<<16|c[v>>>8&255]<<8|c[255&v],v^=d[a/n|0]<<24):n>6&&a%n===4&&(v=c[v>>>24]<<24|c[v>>>16&255]<<16|c[v>>>8&255]<<8|c[255&v]),l[a]=y=(l[a-n]^v)>>>0);for(o=0;o<i;o++)a=i-o,v=3&o?l[a]:l[a-4],u[o]=o<4||a<=4?v:f[c[v>>>24]]^g[c[v>>>16&255]]^p[c[v>>>8&255]]^m[c[255&v]],u[o]=u[o]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,r){const s=this.keySize+6,n=this.invKeySchedule,i=this.invSBox,a=this.invSubMix,o=a[0],l=a[1],u=a[2],c=a[3],d=this.uint8ArrayToUint32Array_(r);let h=d[0],f=d[1],g=d[2],p=d[3];const m=new Int32Array(e),y=new Int32Array(m.length);let v,b,E,S,T,w,k,_,A,L,R,I,P,C;const D=this.networkToHostOrderSwap;for(;t<m.length;){for(A=D(m[t]),L=D(m[t+1]),R=D(m[t+2]),I=D(m[t+3]),T=A^n[0],w=I^n[1],k=R^n[2],_=L^n[3],P=4,C=1;C<s;C++)v=o[T>>>24]^l[w>>16&255]^u[k>>8&255]^c[255&_]^n[P],b=o[w>>>24]^l[k>>16&255]^u[_>>8&255]^c[255&T]^n[P+1],E=o[k>>>24]^l[_>>16&255]^u[T>>8&255]^c[255&w]^n[P+2],S=o[_>>>24]^l[T>>16&255]^u[w>>8&255]^c[255&k]^n[P+3],T=v,w=b,k=E,_=S,P+=4;v=i[T>>>24]<<24^i[w>>16&255]<<16^i[k>>8&255]<<8^i[255&_]^n[P],b=i[w>>>24]<<24^i[k>>16&255]<<16^i[_>>8&255]<<8^i[255&T]^n[P+1],E=i[k>>>24]<<24^i[_>>16&255]<<16^i[T>>8&255]<<8^i[255&w]^n[P+2],S=i[_>>>24]<<24^i[T>>16&255]<<16^i[w>>8&255]<<8^i[255&k]^n[P+3],y[t]=D(v^h),y[t+1]=D(S^f),y[t+2]=D(E^g),y[t+3]=D(b^p),h=A,f=L,g=R,p=I,t+=4}return y.buffer}}class hr{constructor(e,t,r){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=r}expandKey(){const e=function(e){switch(e){case lr:return"AES-CBC";case ur:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${e}`)}}(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}class fr{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(e){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function(e){const t=e.byteLength,r=t&&new DataView(e.buffer).getUint8(t-1);return r?e.slice(0,t-r):e}(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r,s){return this.useSoftware?new Promise((n,i)=>{const a=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(a,t,r,s);const o=this.flush();o?n(o.buffer):i(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r,s)}softwareDecrypt(e,t,r,s){const{currentIV:n,currentResult:i,remainderData:a}=this;if(s!==lr||16!==t.byteLength)return Z.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),a&&(e=Me(a,e),this.remainderData=null);const o=this.getValidChunk(e);if(!o.length)return null;n&&(r=n);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new dr),l.expandKey(t);const u=i;return this.currentResult=l.decrypt(o.buffer,0,r),this.currentIV=o.slice(-16).buffer,u||null}webCryptoDecrypt(e,t,r,s){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r,s));this.key=t,this.fastAesKey=new hr(this.subtle,t,s)}return this.fastAesKey.expandKey().then(t=>{if(!this.subtle)return Promise.reject(new Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");return new cr(this.subtle,new Uint8Array(r),s).decrypt(e.buffer,t)}).catch(n=>(Z.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${n.name}: ${n.message}`),this.onWebCryptoError(e,t,r,s)))}onWebCryptoError(e,t,r,s){const n=this.enableSoftwareAES;if(n){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r,s);const n=this.flush();if(n)return n.buffer}throw new Error("WebCrypto"+(n?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%16;return r!==e.length&&(t=e.slice(0,r),this.remainderData=e.slice(r)),t}logOnce(e){this.logEnabled&&(Z.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const gr=Math.pow(2,17);class pr{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new vr({type:C.NETWORK_ERROR,details:D.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(r?"part list":"url")),networkDetails:null}));this.abort();const s=this.config,n=s.fLoader,i=s.loader;return new Promise((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some(e=>"GAP"===e[0]))return void o(yr(e));e.gap=!1}const l=this.loader=n?new n(s):new i(s),u=mr(e);e.loader=l;const c=Gt(s.fragLoadPolicy.default),d={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:gr};e.stats=l.stats;const h={onSuccess:(t,r,s,n)=>{this.resetLoader(e,l);let i=t.data;s.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(i.slice(0,16)),i=i.slice(16)),a({frag:e,part:null,payload:i,networkDetails:n})},onError:(t,s,n,i)=>{this.resetLoader(e,l),o(new vr({type:C.NETWORK_ERROR,details:D.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:z({url:r,data:void 0},t),error:new Error(`HTTP Error ${t.code} ${t.text}`),networkDetails:n,stats:i}))},onAbort:(t,r,s)=>{this.resetLoader(e,l),o(new vr({type:C.NETWORK_ERROR,details:D.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:s,stats:t}))},onTimeout:(t,r,s)=>{this.resetLoader(e,l),o(new vr({type:C.NETWORK_ERROR,details:D.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${d.timeout}ms`),networkDetails:s,stats:t}))}};t&&(h.onProgress=(r,s,n,i)=>t({frag:e,part:null,payload:n,networkDetails:i})),l.load(u,d,h)})}loadPart(e,t,r){this.abort();const s=this.config,n=s.fLoader,i=s.loader;return new Promise((a,o)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void o(yr(e,t));const l=this.loader=n?new n(s):new i(s),u=mr(e,t);e.loader=l;const c=Gt(s.fragLoadPolicy.default),d={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:gr};t.stats=l.stats,l.load(u,d,{onSuccess:(s,n,i,o)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const u={frag:e,part:t,payload:s.data,networkDetails:o};r(u),a(u)},onError:(r,s,n,i)=>{this.resetLoader(e,l),o(new vr({type:C.NETWORK_ERROR,details:D.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:z({url:u.url,data:void 0},r),error:new Error(`HTTP Error ${r.code} ${r.text}`),networkDetails:n,stats:i}))},onAbort:(r,s,n)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),o(new vr({type:C.NETWORK_ERROR,details:D.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:n,stats:r}))},onTimeout:(r,s,n)=>{this.resetLoader(e,l),o(new vr({type:C.NETWORK_ERROR,details:D.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${d.timeout}ms`),networkDetails:n,stats:r}))}})})}updateStatsFromPart(e,t){const r=e.stats,s=t.stats,n=s.total;if(r.loaded+=s.loaded,n){const s=Math.round(e.duration/t.duration),i=Math.min(Math.round(r.loaded/n),s),a=(s-i)*Math.round(r.loaded/i);r.total=r.loaded+a}else r.total=Math.max(r.loaded,r.total);const i=r.loading,a=s.loading;i.start?i.first+=a.first-a.start:(i.start=a.start,i.first=a.first),i.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function mr(e,t=null){const r=t||e,s={frag:e,part:t,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},n=r.byteRangeStartOffset,i=r.byteRangeEndOffset;if(R(n)&&R(i)){var a;let t=n,r=i;if("initSegment"===e.sn&&("AES-128"===(o=null==(a=e.decryptdata)?void 0:a.method)||"AES-256"===o)){const e=i-n;e%16&&(r=i+(16-e%16)),0!==n&&(s.resetIV=!0,t=n-16)}s.rangeStart=t,s.rangeEnd=r}var o;return s}function yr(e,t){const r=new Error(`GAP ${e.gap?"tag":"attribute"} found`),s={type:C.MEDIA_ERROR,details:D.FRAG_GAP,fatal:!1,frag:e,error:r,networkDetails:null};return t&&(s.part=t),(t||e).stats.aborted=!0,new vr(s)}class vr extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class br extends q{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Er{constructor(e,t,r,s=0,n=-1,i=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=r,this.size=s,this.part=n,this.partial=i}}const Sr={length:0,start:()=>0,end:()=>0};class Tr{static isBuffered(e,t){if(e){const r=Tr.getBuffered(e);for(let e=r.length;e--;)if(t>=r.start(e)&&t<=r.end(e))return!0}return!1}static bufferedRanges(e){if(e){const t=Tr.getBuffered(e);return Tr.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}static bufferInfo(e,t,r){if(e){const s=Tr.bufferedRanges(e);if(s.length)return Tr.bufferedInfo(s,t,r)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.length>1&&e.sort((e,t)=>e.start-t.start||t.end-e.end);let s=-1,n=[];if(r)for(let i=0;i<e.length;i++){t>=e[i].start&&t<=e[i].end&&(s=i);const a=n.length;if(a){const t=n[a-1].end;e[i].start-t<r?e[i].end>t&&(n[a-1].end=e[i].end):n.push(e[i])}else n.push(e[i])}else n=e;let i,a=0,o=t,l=t;for(let e=0;e<n.length;e++){const u=n[e].start,c=n[e].end;if(-1===s&&t>=u&&t<=c&&(s=e),t+r>=u&&t<c)o=u,l=c,a=l-t;else if(t+r<u){i=u;break}}return{len:a,start:o||0,end:l||0,nextStart:i,buffered:e,bufferedIndex:s}}static getBuffered(e){try{return e.buffered||Sr}catch(e){return Z.log("failed to get media.buffered",e),Sr}}}const wr=/\{\$([a-zA-Z0-9-_]+)\}/g;function kr(e){return wr.test(e)}function _r(e,t){if(null!==e.variableList||e.hasVariableRefs){const r=e.variableList;return t.replace(wr,t=>{const s=t.substring(2,t.length-1),n=null==r?void 0:r[s];return void 0===n?(e.playlistParsingError||(e.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),t):n})}return t}function Ar(e,t,r){let s,n,i=e.variableList;if(i||(e.variableList=i={}),"QUERYPARAM"in t){s=t.QUERYPARAM;try{const e=new self.URL(r).searchParams;if(!e.has(s))throw new Error(`"${s}" does not match any query parameter in URI: "${r}"`);n=e.get(s)}catch(t){e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${t.message}`))}}else s=t.NAME,n=t.VALUE;s in i?e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):i[s]=n||""}function Lr(e,t,r){const s=t.IMPORT;if(r&&s in r){let t=e.variableList;t||(e.variableList=t={}),t[s]=r[s]}else e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${s}"`))}const Rr=/^(\d+)x(\d+)$/,Ir=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Pr{constructor(e,t){"string"==typeof e&&(e=Pr.parseAttrList(e,t)),H(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>"X-"===e.substring(0,2))}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const r=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)r[e]=parseInt(t.slice(2*e,2*e+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const r=this[e];return(r?r.split(/[ ,]+/):[]).reduce((e,t)=>(e[t.toLowerCase()]=!0,e),t)}bool(e){return"YES"===this[e]}decimalResolution(e){const t=Rr.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let r;const s={};for(Ir.lastIndex=0;null!==(r=Ir.exec(e));){const n=r[1].trim();let i=r[2];const a=0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1;let o=!1;if(a)i=i.slice(1,-1);else switch(n){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":o=!0}if(t&&(a||o))i=_r(t,i);else if(!o&&!a)switch(n){case"CLOSED-CAPTIONS":if("NONE"===i)break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Z.warn(`${e}: attribute ${n} is missing quotes`)}s[n]=i}return s}}function Cr(e){return"ID"!==e&&"CLASS"!==e&&"CUE"!==e&&"START-DATE"!==e&&"DURATION"!==e&&"END-DATE"!==e&&"END-ON-NEXT"!==e}function Dr(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e||"SCTE35-CMD"===e}class xr{constructor(e,t,r=0){var s;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(null==t?void 0:t.tagAnchor)||null,this.tagOrder=null!=(s=null==t?void 0:t.tagOrder)?s:r,t){const r=t.attr;for(const t in r)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==r[t]){Z.warn(`DATERANGE tag attribute: "${t}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=t;break}e=H(new Pr({}),r,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const e=(null==t?void 0:t.endDate)||new Date(this.attr["END-DATE"]);R(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return void 0===e?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return null===e||null===e.programDateTime?(Z.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return null!==t?this._dateAtEnd=new Date(this._startDate.getTime()+1e3*t):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(R(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return"com.apple.hls.interstitial"===this.class}get isValid(){return!!this.id&&!this._badValueForSameId&&R(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}class Or{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&r>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let r=t.decryptdata;return r||(t.setKeyFormat(e.keyFormat),r=t.decryptdata),!!r&&e.matches(r)})}get hasProgramDateTime(){return!!this.fragments.length&&R(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const e=this.driftEndTime-this.driftStartTime;if(e>0){return 1e3*(this.driftEnd-this.driftStart)/e}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(-1!==t){for(let r=e.length;r--;)if(e[r].index>t)return e[r].index;return t}}return 0}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Nr(e,t){return e.length===t.length&&!e.some((e,r)=>e!==t[r])}function Mr(e,t){return!e&&!t||!(!e||!t)&&Nr(e,t)}function Fr(e){return"AES-128"===e||"AES-256"===e||"AES-256-CTR"===e}function $r(e){switch(e){case"AES-128":case"AES-256":return lr;case"AES-256-CTR":return ur;default:throw new Error(`invalid full segment method ${e}`)}}function Ur(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0))}function Br(e){return Uint8Array.from(unescape(encodeURIComponent(e)),e=>e.charCodeAt(0))}function jr(e){const t=function(e,t,r){const s=e[t];e[t]=e[r],e[r]=s};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}function Gr(e){const t=e.split(":");let r=null;if("data"===t[0]&&2===t.length){const e=t[1].split(";"),s=e[e.length-1].split(",");if(2===s.length){const t="base64"===s[0],n=s[1];t?(e.splice(-1,1),r=Ur(n)):r=function(e){const t=Br(e).subarray(0,16),r=new Uint8Array(16);return r.set(t,16-t.length),r}(n)}}return r}const Kr="undefined"!=typeof self?self:void 0;var Hr={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Vr="org.w3.clearkey",zr="com.apple.streamingkeydelivery",qr="com.microsoft.playready",Wr="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function Yr(e){switch(e){case zr:return Hr.FAIRPLAY;case qr:return Hr.PLAYREADY;case Wr:return Hr.WIDEVINE;case Vr:return Hr.CLEARKEY}}function Qr(e){switch(e){case Hr.FAIRPLAY:return zr;case Hr.PLAYREADY:return qr;case Hr.WIDEVINE:return Wr;case Hr.CLEARKEY:return Vr}}function Xr(e){const{drmSystems:t,widevineLicenseUrl:r}=e,s=t?[Hr.FAIRPLAY,Hr.WIDEVINE,Hr.PLAYREADY,Hr.CLEARKEY].filter(e=>!!t[e]):[];return!s[Hr.WIDEVINE]&&r&&s.push(Hr.WIDEVINE),s}const Jr=null!=Kr&&null!=(Zr=Kr.navigator)&&Zr.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;var Zr;function es(e){const t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),r=String.fromCharCode.apply(null,Array.from(t)),s=r.substring(r.indexOf("<"),r.length),n=(new DOMParser).parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(n){const e=n.childNodes[0]?n.childNodes[0].nodeValue:n.getAttribute("VALUE");if(e){const t=Ur(e).subarray(0,16);return jr(t),t}}return null}let ts={};class rs{static clearKeyUriToKeyIdMap(){ts={}}static setKeyIdForUri(e,t){ts[e]=t}static addKeyIdForUri(e){const t=Object.keys(ts).length%Number.MAX_SAFE_INTEGER,r=new Uint8Array(16);return new DataView(r.buffer,12,4).setUint32(0,t),ts[e]=r,r}constructor(e,t,r,s=[1],n=null,i){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=s,this.iv=n,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&!Fr(e),null!=i&&i.startsWith("0x")&&(this.keyId=new Uint8Array(ne(i)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Nr(e.keyFormatVersions,this.keyFormatVersions)&&Mr(e.iv,this.iv)&&Mr(e.keyId,this.keyId)}isSupported(){if(this.method){if(Fr(this.method)||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case zr:case Wr:case qr:case Vr:return-1!==["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Fr(this.method)){let t=this.iv;t||("number"!=typeof e&&(Z.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),t=function(e){const t=new Uint8Array(16);for(let r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t}(e));return new rs(this.method,this.uri,"identity",this.keyFormatVersions,t)}if(this.keyId){const e=ts[this.uri];if(e&&!Nr(this.keyId,e)&&rs.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const r=Gr(this.uri);if(r)switch(this.keyFormat){case Wr:if(this.pssh=r,!this.keyId){const e=function(e){const t=[];if(e instanceof ArrayBuffer){const r=e.byteLength;let s=0;for(;s+32<r;){const r=Ke(new DataView(e,s));t.push(r),s+=r.size}}return t}(r.buffer);if(e.length){var s;const t=e[0];this.keyId=null!=(s=t.kids)&&s.length?t.kids[0]:null}}this.keyId||(this.keyId=ss(t));break;case qr:{const e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Ge(e,0,r),this.keyId=es(r);break}default:{let e=r.subarray(0,16);if(16!==e.length){const t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e;e=function(e){const t=null==e?void 0:e[Wr];if(t)return t.keyId;return null}(t),e||(e=ss(t),e||(e=ts[this.uri])),e&&(this.keyId=e,rs.setKeyIdForUri(this.uri,e))}return this}}function ss(e){const t=null==e?void 0:e[qr];if(t){const e=Gr(t.uri);if(e)return es(e)}return null}const ns=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,is=/#EXT-X-MEDIA:(.*)/g,as=/^#EXT(?:INF|-X-TARGETDURATION):/m,os=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),ls=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class us{static findGroup(e,t){for(let r=0;r<e.length;r++){const s=e[r];if(s.id===t)return s}}static resolve(e,t){return le.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return as.test(e)}static parseMasterPlaylist(e,t){const r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:kr(e)},s=[];if(ns.lastIndex=0,!e.startsWith("#EXTM3U"))return r.playlistParsingError=new Error("no EXTM3U delimiter"),r;let n;for(;null!=(n=ns.exec(e));)if(n[1]){var i;const e=new Pr(n[1],r),a=_r(r,n[2]),o={attrs:e,bitrate:e.decimalInteger("BANDWIDTH")||e.decimalInteger("AVERAGE-BANDWIDTH"),name:e.NAME,url:us.resolve(a,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),gs(e.CODECS,o);const u=e["SUPPLEMENTAL-CODECS"];u&&(o.supplemental={},gs(u,o.supplemental)),null!=(i=o.unknownCodecs)&&i.length||s.push(o),r.levels.push(o)}else if(n[3]){const e=n[3],s=n[4];switch(e){case"SESSION-DATA":{const e=new Pr(s,r),t=e["DATA-ID"];t&&(null===r.sessionData&&(r.sessionData={}),r.sessionData[t]=e);break}case"SESSION-KEY":{const e=hs(s,t,r);e.encrypted&&e.isSupported()?(null===r.sessionKeys&&(r.sessionKeys=[]),r.sessionKeys.push(e)):Z.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${s}"`);break}case"DEFINE":Ar(r,new Pr(s,r),t);break;case"CONTENT-STEERING":{const e=new Pr(s,r);r.contentSteering={uri:us.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":r.startTimeOffset=fs(s)}}const a=s.length>0&&s.length<r.levels.length;return r.levels=a?s:r.levels,0===r.levels.length&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,r){let s;const n={},i=r.levels,a={AUDIO:i.map(e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec})),SUBTITLES:i.map(e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec})),"CLOSED-CAPTIONS":[]};let o=0;for(is.lastIndex=0;null!==(s=is.exec(e));){const e=new Pr(s[1],r),i=e.TYPE;if(i){const r=a[i],s=n[i]||[];n[i]=s;const l=e.LANGUAGE,u=e["ASSOC-LANGUAGE"],c=e.CHANNELS,d=e.CHARACTERISTICS,h=e["INSTREAM-ID"],f={attrs:e,bitrate:0,id:o++,groupId:e["GROUP-ID"]||"",name:e.NAME||l||"",type:i,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:l,url:e.URI?us.resolve(e.URI,t):""};if(u&&(f.assocLang=u),c&&(f.channels=c),d&&(f.characteristics=d),h&&(f.instreamId=h),null!=r&&r.length){const e=us.findGroup(r,f.groupId)||r[0];ps(f,e,"audioCodec"),ps(f,e,"textCodec")}s.push(f)}}return n}static parseLevelPlaylist(e,t,r,s,n,i){var a;const o={url:t},l=new Or(t),u=l.fragments,c=[];let d,h,f,g,p=null,m=0,y=0,v=0,b=0,E=0,S=null,T=new pe(s,o),w=-1,k=!1,_=null;if(os.lastIndex=0,l.m3u8=e,l.hasVariableRefs=kr(e),"#EXTM3U"!==(null==(a=os.exec(e))?void 0:a[0]))return l.playlistParsingError=new Error("Missing format identifier #EXTM3U"),l;for(;null!==(d=os.exec(e));){k&&(k=!1,T=new pe(s,o),T.playlistOffset=v,T.setStart(v),T.sn=m,T.cc=b,E&&(T.bitrate=E),T.level=r,p&&(T.initSegment=p,p.rawProgramDateTime&&(T.rawProgramDateTime=p.rawProgramDateTime,p.rawProgramDateTime=null),_&&(T.setByteRange(_),_=null)));const e=d[1];if(e){T.duration=parseFloat(e);const t=(" "+d[2]).slice(1);T.title=t||null,T.tagList.push(t?["INF",e,t]:["INF",e])}else if(d[3]){if(R(T.duration)){T.playlistOffset=v,T.setStart(v),f&&vs(T,f,l),T.sn=m,T.level=r,T.cc=b,u.push(T);const e=(" "+d[3]).slice(1);T.relurl=_r(l,e),ms(T,S,c),S=T,v+=T.duration,m++,y=0,k=!0}}else{if(d=d[0].match(ls),!d){Z.warn("No matches on slow regex match for level playlist!");continue}for(h=1;h<d.length&&void 0===d[h];h++);const e=(" "+d[h]).slice(1),n=(" "+d[h+1]).slice(1),a=d[h+2]?(" "+d[h+2]).slice(1):null;switch(e){case"BYTERANGE":S?T.setByteRange(n,S):T.setByteRange(n);break;case"PROGRAM-DATE-TIME":T.rawProgramDateTime=n,T.tagList.push(["PROGRAM-DATE-TIME",n]),-1===w&&(w=u.length);break;case"PLAYLIST-TYPE":l.type&&bs(l,e,d),l.type=n.toUpperCase();break;case"MEDIA-SEQUENCE":0!==l.startSN?bs(l,e,d):u.length>0&&Es(l,e,d),m=l.startSN=parseInt(n);break;case"SKIP":{l.skippedSegments&&bs(l,e,d);const t=new Pr(n,l),r=t.decimalInteger("SKIPPED-SEGMENTS");if(R(r)){l.skippedSegments+=r;for(let e=r;e--;)u.push(null);m+=r}const s=t.enumeratedString("RECENTLY-REMOVED-DATERANGES");s&&(l.recentlyRemovedDateranges=(l.recentlyRemovedDateranges||[]).concat(s.split("\t")));break}case"TARGETDURATION":0!==l.targetduration&&bs(l,e,d),l.targetduration=Math.max(parseInt(n),1);break;case"VERSION":null!==l.version&&bs(l,e,d),l.version=parseInt(n);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":l.live||bs(l,e,d),l.live=!1;break;case"#":(n||a)&&T.tagList.push(a?[n,a]:[n]);break;case"DISCONTINUITY":b++,T.tagList.push(["DIS"]);break;case"GAP":T.gap=!0,T.tagList.push([e]);break;case"BITRATE":T.tagList.push([e,n]),E=1e3*parseInt(n),R(E)?T.bitrate=E:E=0;break;case"DATERANGE":{const e=new Pr(n,l),t=new xr(e,l.dateRanges[e.ID],l.dateRangeTagCount);l.dateRangeTagCount++,t.isValid||l.skippedSegments?l.dateRanges[t.id]=t:Z.warn(`Ignoring invalid DATERANGE tag: "${n}"`),T.tagList.push(["EXT-X-DATERANGE",n]);break}case"DEFINE":{const e=new Pr(n,l);"IMPORT"in e?Lr(l,e,i):Ar(l,e,t)}break;case"DISCONTINUITY-SEQUENCE":0!==l.startCC?bs(l,e,d):u.length>0&&Es(l,e,d),l.startCC=b=parseInt(n);break;case"KEY":{const e=hs(n,t,l);if(e.isSupported()){if("NONE"===e.method){f=void 0;break}f||(f={});const t=f[e.keyFormat];null!=t&&t.matches(e)||(t&&(f=H({},f)),f[e.keyFormat]=e)}else Z.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${n}"`);break}case"START":l.startTimeOffset=fs(n);break;case"MAP":{const e=new Pr(n,l);if(T.duration){const t=new pe(s,o);ys(t,e,r,f),p=t,T.initSegment=p,p.rawProgramDateTime&&!T.rawProgramDateTime&&(T.rawProgramDateTime=p.rawProgramDateTime)}else{const t=T.byteRangeEndOffset;if(t){const e=T.byteRangeStartOffset;_=`${t-e}@${e}`}else _=null;ys(T,e,r,f),p=T,k=!0}p.cc=b;break}case"SERVER-CONTROL":g&&bs(l,e,d),g=new Pr(n),l.canBlockReload=g.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=g.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=l.canSkipUntil>0&&g.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=g.optionalFloat("PART-HOLD-BACK",0),l.holdBack=g.optionalFloat("HOLD-BACK",0);break;case"PART-INF":{l.partTarget&&bs(l,e,d);const t=new Pr(n);l.partTarget=t.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=l.partList;e||(e=l.partList=[]);const t=y>0?e[e.length-1]:void 0,r=y++,s=new Pr(n,l),i=new me(s,T,o,r,t);e.push(i),T.duration+=i.duration;break}case"PRELOAD-HINT":{const e=new Pr(n,l);l.preloadHint=e;break}case"RENDITION-REPORT":{const e=new Pr(n,l);l.renditionReports=l.renditionReports||[],l.renditionReports.push(e);break}default:Z.warn(`line parsed but not handled: ${d}`)}}}S&&!S.relurl?(u.pop(),v-=S.duration,l.partList&&(l.fragmentHint=S)):l.partList&&(ms(T,S,c),T.cc=b,l.fragmentHint=T,f&&vs(T,f,l)),l.targetduration||(l.playlistParsingError=new Error("Missing Target Duration"));const A=u.length,L=u[0],I=u[A-1];if(v+=l.skippedSegments*l.targetduration,v>0&&A&&I){l.averagetargetduration=v/A;const e=I.sn;l.endSN="initSegment"!==e?e:0,l.live||(I.endList=!0),w>0&&(!function(e,t){let r=e[t];for(let s=t;s--;){const t=e[s];if(!t)return;t.programDateTime=r.programDateTime-1e3*t.duration,r=t}}(u,w),L&&c.unshift(L))}return l.fragmentHint&&(v+=l.fragmentHint.duration),l.totalduration=v,c.length&&l.dateRangeTagCount&&L&&cs(c,l),l.endCC=b,l}}function cs(e,t){let r=e.length;if(!r){if(!t.hasProgramDateTime)return;{const s=t.fragments[t.fragments.length-1];e.push(s),r++}}const s=e[r-1],n=t.live?1/0:t.totalduration,i=Object.keys(t.dateRanges);for(let o=i.length;o--;){const l=t.dateRanges[i[o]],u=l.startDate.getTime();l.tagAnchor=s.ref;for(let s=r;s--;){var a;if((null==(a=e[s])?void 0:a.sn)<t.startSN)break;const r=ds(t,u,e,s,n);if(-1!==r){l.tagAnchor=t.fragments[r].ref;break}}}}function ds(e,t,r,s,n){const i=r[s];if(i){const o=i.programDateTime;if(t>=o||0===s){var a;if(t<=o+1e3*(((null==(a=r[s+1])?void 0:a.start)||n)-i.start)){const n=r[s].sn-e.startSN;if(n<0)return-1;const i=e.fragments;if(i.length>r.length){for(let a=(r[s+1]||i[i.length-1]).sn-e.startSN;a>n;a--){const e=i[a].programDateTime;if(t>=e&&t<e+1e3*i[a].duration)return a}}return n}}}return-1}function hs(e,t,r){var s,n;const i=new Pr(e,r),a=null!=(s=i.METHOD)?s:"",o=i.URI,l=i.hexadecimalInteger("IV"),u=i.KEYFORMATVERSIONS,c=null!=(n=i.KEYFORMAT)?n:"identity";o&&i.IV&&!l&&Z.error(`Invalid IV: ${i.IV}`);const d=o?us.resolve(o,t):"",h=(u||"1").split("/").map(Number).filter(Number.isFinite);return new rs(a,d,c,h,l,i.KEYID)}function fs(e){const t=new Pr(e).decimalFloatingPoint("TIME-OFFSET");return R(t)?t:null}function gs(e,t){let r=(e||"").split(/[ ,]+/).filter(e=>e);["video","audio","text"].forEach(e=>{const s=r.filter(t=>ze(t,e));s.length&&(t[`${e}Codec`]=s.map(e=>e.split("/")[0]).join(","),r=r.filter(e=>-1===s.indexOf(e)))}),t.unknownCodecs=r}function ps(e,t,r){const s=t[r];s&&(e[r]=s)}function ms(e,t,r){e.rawProgramDateTime?r.push(e):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime)}function ys(e,t,r,s){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=r,e.sn="initSegment",s&&(e.levelkeys=s),e.initSegment=null}function vs(e,t,r){e.levelkeys=t;const{encryptedFragments:s}=r;s.length&&s[s.length-1].levelkeys===t||!Object.keys(t).some(e=>t[e].isCommonEncryption)||s.push(e)}function bs(e,t,r){e.playlistParsingError=new Error(`#EXT-X-${t} must not appear more than once (${r[0]})`)}function Es(e,t,r){e.playlistParsingError=new Error(`#EXT-X-${t} must appear before the first Media Segment (${r[0]})`)}function Ss(e,t){const r=t.startPTS;if(R(r)){let s,n=0;t.sn>e.sn?(n=r-e.start,s=e):(n=e.start-r,s=t),s.duration!==n&&s.setDuration(n)}else if(t.sn>e.sn){e.cc===t.cc&&e.minEndPTS?t.setStart(e.start+(e.minEndPTS-e.start)):t.setStart(e.start+e.duration)}else t.setStart(Math.max(e.start-t.duration,0))}function Ts(e,t,r,s,n,i,a){s-r<=0&&(a.warn("Fragment should have a positive duration",t),s=r+t.duration,i=n+t.duration);let o=r,l=s;const u=t.startPTS,c=t.endPTS;if(R(u)){const d=Math.abs(u-r);e&&d>e.totalduration?a.warn(`media timestamps and playlist times differ by ${d}s for level ${t.level} ${e.url}`):R(t.deltaPTS)?t.deltaPTS=Math.max(d,t.deltaPTS):t.deltaPTS=d,o=Math.max(r,u),r=Math.min(r,u),n=void 0!==t.startDTS?Math.min(n,t.startDTS):n,l=Math.min(s,c),s=Math.max(s,c),i=void 0!==t.endDTS?Math.max(i,t.endDTS):i}const d=r-t.start;0!==t.start&&t.setStart(r),t.setDuration(s-t.start),t.startPTS=r,t.maxStartPTS=o,t.startDTS=n,t.endPTS=s,t.minEndPTS=l,t.endDTS=i;const h=t.sn;if(!e||h<e.startSN||h>e.endSN)return 0;let f;const g=h-e.startSN,p=e.fragments;for(p[g]=t,f=g;f>0;f--)Ss(p[f],p[f-1]);for(f=g;f<p.length-1;f++)Ss(p[f],p[f+1]);return e.fragmentHint&&Ss(p[p.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,d}function ws(e,t,r){if(e===t)return;let s=null;const n=e.fragments;for(let e=n.length-1;e>=0;e--){const t=n[e].initSegment;if(t){s=t;break}}let i;e.fragmentHint&&delete e.fragmentHint.endPTS,function(e,t,r){const s=t.skippedSegments,n=Math.max(e.startSN,t.startSN)-t.startSN,i=(e.fragmentHint?1:0)+(s?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,a=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let u=n;u<=i;u++){const n=l[a+u];let i=o[u];if(s&&!i&&n&&(i=t.fragments[u]=n),n&&i){r(n,i,u,o);const s=n.relurl,a=i.relurl;if(s&&Ds(s,a))return void(t.playlistParsingError=ks(`media sequence mismatch ${i.sn}:`,e,t,n,i));if(n.cc!==i.cc)return void(t.playlistParsingError=ks(`discontinuity sequence mismatch (${n.cc}!=${i.cc})`,e,t,n,i))}}}(e,t,(e,r,n,a)=>{if((!t.startCC||t.skippedSegments)&&r.cc!==e.cc){const s=e.cc-r.cc;for(let e=n;e<a.length;e++)a[e].cc+=s;t.endCC=a[a.length-1].cc}R(e.startPTS)&&R(e.endPTS)&&(r.setStart(r.startPTS=e.startPTS),r.startDTS=e.startDTS,r.maxStartPTS=e.maxStartPTS,r.endPTS=e.endPTS,r.endDTS=e.endDTS,r.minEndPTS=e.minEndPTS,r.setDuration(e.endPTS-e.startPTS),r.duration&&(i=r),t.PTSKnown=t.alignedSliding=!0),e.hasStreams&&(r.elementaryStreams=e.elementaryStreams),r.loader=e.loader,e.hasStats&&(r.stats=e.stats),e.initSegment&&(r.initSegment=e.initSegment,s=e.initSegment)});const a=t.fragments,o=t.fragmentHint?a.concat(t.fragmentHint):a;if(s&&o.forEach(e=>{var t;!e||e.initSegment&&e.initSegment.relurl!==(null==(t=s)?void 0:t.relurl)||(e.initSegment=s)}),t.skippedSegments){if(t.deltaUpdateFailed=a.some(e=>!e),t.deltaUpdateFailed){r.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)a.shift();t.startSN=a[0].sn}else{t.canSkipDateRanges&&(t.dateRanges=function(e,t,r){const{dateRanges:s,recentlyRemovedDateranges:n}=t,i=H({},e);n&&n.forEach(e=>{delete i[e]});const a=Object.keys(i).length;if(!a)return s;return Object.keys(s).forEach(e=>{const t=i[e],n=new xr(s[e].attr,t);n.isValid?(i[e]=n,t||(n.tagOrder+=a)):r.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${wt(s[e].attr)}"`)}),i}(e.dateRanges,t,r));const s=e.fragments.filter(e=>e.rawProgramDateTime);if(e.hasProgramDateTime&&!t.hasProgramDateTime)for(let e=1;e<o.length;e++)null===o[e].programDateTime&&ms(o[e],o[e-1],s);cs(s,t)}t.endCC=a[a.length-1].cc}if(!t.startCC){var l;const r=Rs(e,t.startSN-1);t.startCC=null!=(l=null==r?void 0:r.cc)?l:a[0].cc}!function(e,t,r){if(e&&t){let s=0;for(let n=0,i=e.length;n<=i;n++){const i=e[n],a=t[n+s];i&&a&&i.index===a.index&&i.fragment.sn===a.fragment.sn?r(i,a):s--}}}(e.partList,t.partList,(e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats}),i?Ts(t,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS,r):_s(e,t),a.length&&(t.totalduration=t.edge-a[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;const u=t.advancedDateTime;if(t.advanced&&u){const e=t.edge;t.driftStart||(t.driftStartTime=u,t.driftStart=e),t.driftEndTime=u,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime;-1===t.requestScheduled&&(t.requestScheduled=e.requestScheduled)}function ks(e,t,r,s,n){return new Error(`${e} ${n.url}\nPlaylist starting @${t.startSN}\n${t.m3u8}\n\nPlaylist starting @${r.startSN}\n${r.m3u8}`)}function _s(e,t,r=!0){const s=t.startSN+t.skippedSegments-e.startSN,n=e.fragments,i=s>=0;let a=0;if(i&&s<n.length)a=n[s].start;else if(i&&t.startSN===e.endSN+1)a=e.fragmentEnd;else if(i&&r)a=e.fragmentStart+s*t.levelTargetDuration;else{if(t.skippedSegments||0!==t.fragmentStart)return;a=e.fragmentStart}As(t,a)}function As(e,t){if(t){const r=e.fragments;for(let s=e.skippedSegments;s<r.length;s++)r[s].addStart(t);e.fragmentHint&&e.fragmentHint.addStart(t)}}function Ls(e,t=1/0){let r=1e3*e.targetduration;if(e.updated){const s=e.fragments,n=4;if(s.length&&r*n>t){const e=1e3*s[s.length-1].duration;e<r&&(r=e)}}else r/=2;return Math.round(r)}function Rs(e,t,r){if(!e)return null;let s=e.fragments[t-e.startSN];return s||(s=e.fragmentHint,s&&s.sn===t?s:t<e.startSN&&r&&r.sn===t?r:null)}function Is(e,t,r){return e?Ps(e.partList,t,r):null}function Ps(e,t,r){if(e)for(let s=e.length;s--;){const n=e[s];if(n.index===r&&n.fragment.sn===t)return n}return null}function Cs(e){e.forEach((e,t)=>{var r;null==(r=e.details)||r.fragments.forEach(e=>{e.level=t,e.initSegment&&(e.initSegment.level=t)})})}function Ds(e,t){return!(e===t||!t)&&xs(e)!==xs(t)}function xs(e){return e.replace(/\?[^?]*$/,"")}function Os(e,t){for(let s=0,n=e.length;s<n;s++){var r;if((null==(r=e[s])?void 0:r.cc)===t)return e[s]}return null}function Ns(e,t){const r=e.start+t;e.startPTS=r,e.setStart(r),e.endPTS=r+e.duration}function Ms(e,t){const r=t.fragments;for(let t=0,s=r.length;t<s;t++)Ns(r[t],e);t.fragmentHint&&Ns(t.fragmentHint,e),t.alignedSliding=!0}function Fs(e,t){if(!function(e,t){return!!(e&&t.startCC<e.endCC&&t.endCC>e.startCC)}(t,e))return;const r=Math.min(t.endCC,e.endCC),s=Os(t.fragments,r),n=Os(e.fragments,r);if(!s||!n)return;Z.log(`Aligning playlist at start of dicontinuity sequence ${r}`);Ms(s.start-n.start,e)}function $s(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;const r=e.fragments,s=t.fragments;if(!r.length||!s.length)return;let n,i;const a=Math.min(t.endCC,e.endCC);t.startCC<a&&e.startCC<a&&(n=Os(s,a),i=Os(r,a)),n&&i||(n=s[Math.floor(s.length/2)],i=Os(r,n.cc)||r[Math.floor(r.length/2)]);const o=n.programDateTime,l=i.programDateTime;if(!o||!l)return;Ms((l-o)/1e3-(i.start-n.start),e)}function Us(e,t,r){Bs(e,t,r),e.addEventListener(t,r)}function Bs(e,t,r){e.removeEventListener(t,r)}const js=function(e){let t="";const r=e.length;for(let s=0;s<r;s++)t+=`[${e.start(s).toFixed(3)}-${e.end(s).toFixed(3)}]`;return t},Gs="STOPPED",Ks="IDLE",Hs="KEY_LOADING",Vs="FRAG_LOADING",zs="FRAG_LOADING_WAITING_RETRY",qs="WAITING_TRACK",Ws="PARSING",Ys="PARSED",Qs="ENDED",Xs="ERROR",Js="WAITING_INIT_PTS",Zs="WAITING_LEVEL";class en extends br{constructor(e,t,r,s,n){super(s,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=Gs,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:e,fragCurrent:t,media:r,mediaBuffer:s,state:n}=this,i=r?r.currentTime:0,a=Tr.bufferInfo(s||r,i,e.maxBufferHole),o=!a.len;if(this.log(`Media seeking to ${R(i)?i.toFixed(3):i}, state: ${n}, ${o?"out of":"in"} buffer`),this.state===Qs)this.resetLoadingState();else if(t){const r=e.maxFragLookUpTolerance,s=t.start-r,n=t.start+t.duration+r;if(o||n<a.start||s>a.end){const e=i>n;(i<s||e)&&(e&&t.loader&&(this.log(`Cancelling fragment load for seek (sn: ${t.sn})`),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(r){this.fragmentTracker.removeFragmentsInRange(i,1/0,this.playlistType,!0);if(i>this.lastCurrentTime&&(this.lastCurrentTime=i),!this.loadingParts){const e=Math.max(a.end,i),t=this.shouldLoadParts(this.getLevelDetails(),e);t&&(this.log(`LL-Part loading ON after seeking to ${i.toFixed(2)} with buffer @${e.toFixed(2)}`),this.loadingParts=t)}}this.hls.hasEnoughToStart||(this.log(`Setting ${o?"startPosition":"nextLoadPosition"} to ${i} for seek without enough to start`),this.nextLoadPosition=i,o&&(this.startPosition=i)),o&&this.state===Ks&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=n,this.hls=e,this.fragmentLoader=new pr(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new fr(e.config)}registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===Gs)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Gs}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return-1===t&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const r=e.end||0,s=this.config.timelineOffset||0;if(r<=s)return!1;const n=e.buffered;this.config.maxBufferHole&&n&&n.length>1&&(e=Tr.bufferedInfo(n,e.start,0));const i=e.nextStart;if(i&&i>s&&i<t.edge)return!1;if(this.media.currentTime<e.start)return!1;const a=t.partList;if(null!=a&&a.length){const e=a[a.length-1];return Tr.isBuffered(this.media,e.start+e.duration/2)}const o=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(o)}getLevelDetails(){if(this.levels&&null!==this.levelLastLoaded)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;var t;return e?(null==(t=this.getLevelDetails())?void 0:t.appliedTimelineOffset)||e:0}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;Us(r,"seeking",this.onMediaSeeking),Us(r,"ended",this.onMediaEnded);const s=this.config;this.levels&&s.autoStartLoad&&this.state===Gs&&this.startLoad(s.startPosition)}onMediaDetaching(e,t){const r=!!t.transferMedia,s=this.media;if(null!==s){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Bs(s,"seeking",this.onMediaSeeking),Bs(s,"ended",this.onMediaEnded),this.keyLoader&&!r&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,r)return this.resetLoadingState(),void this.resetTransmuxer();this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=Gs,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this.startFragRequested=!0,this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){this._doFragLoad(e,t,r,e=>{const t=e.frag;if(this.fragContextChanged(t))return this.warn(`${t.type} sn: ${t.sn}${e.part?" part: "+e.part.index:""} of ${this.fragInfo(t,!1,e.part)}) was dropped during download.`),void this.fragmentTracker.removeFragment(t);t.stats.chunkCount++,this._handleFragmentLoadProgress(e)}).then(e=>{if(!e)return;const t=this.state,r=e.frag;this.fragContextChanged(r)?(t===Vs||!this.fragCurrent&&t===Ws)&&(this.fragmentTracker.removeFragment(r),this.state=Ks):("payload"in e&&(this.log(`Loaded ${r.type} sn: ${r.sn} of ${this.playlistLabel()} ${r.level}`),this.hls.trigger(x.FRAG_LOADED,e)),this._handleFragmentLoadComplete(e))}).catch(t=>{this.state!==Gs&&this.state!==Xs&&(this.warn(`Frag error: ${(null==t?void 0:t.message)||t}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===tr){const t=e.type,s=this.getFwdBufferInfo(this.mediaBuffer,t),n=Math.max(e.duration,s?s.len:this.config.maxBufferLength),i=this.backtrackFragment;(1===(i?e.sn-i.sn:0)||this.reduceMaxBufferLength(n,e.duration))&&r.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===rr&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(null==t?void 0:t.live)&&"EVENT"!==t.type&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:r};this.hls.trigger(x.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(e=>{const t=null==e?void 0:e.frag;if(!t||this.fragContextChanged(t)||!this.levels)throw new Error("init load aborted");return e}).then(e=>{const{hls:t}=this,{frag:r,payload:s}=e,n=r.decryptdata;if(s&&s.byteLength>0&&null!=n&&n.key&&n.iv&&Fr(n.method)){const i=self.performance.now();return this.decrypter.decrypt(new Uint8Array(s),n.key.buffer,n.iv.buffer,$r(n.method)).catch(e=>{throw t.trigger(x.ERROR,{type:C.MEDIA_ERROR,details:D.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:r}),e}).then(s=>{const n=self.performance.now();return t.trigger(x.FRAG_DECRYPTED,{frag:r,payload:s,stats:{tstart:i,tdecrypt:n}}),e.payload=s,this.completeInitSegmentLoad(e)})}return this.completeInitSegmentLoad(e)}).catch(t=>{this.state!==Gs&&this.state!==Xs&&(this.warn(t),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state!==Gs&&(this.state=Ks),e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var r,s;const n=e.tracks;if(n&&!t.encrypted&&(null!=(r=n.audio)&&r.encrypted||null!=(s=n.video)&&s.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const e=this.media,r=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${e?"attached mediaKeys: "+e.mediaKeys:"detached"})`);return this.warn(r.message),!e||e.mediaKeys?!1:(this.hls.trigger(x.ERROR,{type:C.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_NO_KEYS,fatal:!1,error:r,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const r=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${r?js(Tr.getBuffered(r)):"(detached)"})`),ge(e)){var s;if(e.type!==B){const t=e.elementaryStreams;if(!Object.keys(t).some(e=>!!t[e]))return void(this.state=Ks)}const t=null==(s=this.levels)?void 0:s[e.level];null!=t&&t.fragmentError&&(this.log(`Resetting level fragment error count of ${t.fragmentError} on frag buffered`),t.fragmentError=0)}this.state=Ks}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:s,partsLoaded:n}=e,i=!n||0===n.length||n.some(e=>!e),a=new Er(r.level,r.sn,r.stats.chunkCount+1,0,s?s.index:-1,!i);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,s){var n;this.fragCurrent=e;const i=t.details;if(!this.levels||!i)throw new Error(`frag load aborted, missing level${i?"":" detail"}s`);let a=null;if(!e.encrypted||null!=(n=e.decryptdata)&&n.key)e.encrypted||(a=this.keyLoader.loadClear(e,i.encryptedFragments,this.startFragRequested),a&&this.log("[eme] blocking frag load until media-keys acquired"));else if(this.log(`Loading key for ${e.sn} of [${i.startSN}-${i.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=Hs,this.fragCurrent=e,a=this.keyLoader.load(e).then(e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(x.KEY_LOADED,e),this.state===Hs&&(this.state=Ks),e}),this.hls.trigger(x.KEY_LOADING,{frag:e}),null===this.fragCurrent)return this.log("context changed in KEY_LOADING"),Promise.resolve(null);const o=this.fragPrevious;if(ge(e)&&(!o||e.sn!==o.sn)){const r=this.shouldLoadParts(t.details,e.end);r!==this.loadingParts&&(this.log(`LL-Part loading ${r?"ON":"OFF"} loading sn ${null==o?void 0:o.sn}->${e.sn}`),this.loadingParts=r)}if(r=Math.max(e.start,r||0),this.loadingParts&&ge(e)){const n=i.partList;if(n&&s){r>i.fragmentEnd&&i.fragmentHint&&(e=i.fragmentHint);const o=this.getNextPart(n,e,r);if(o>-1){const l=n[o];let u;return e=this.fragCurrent=l.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${l.index} (${o}/${n.length-1}) of ${this.fragInfo(e,!1,l)}) cc: ${e.cc} [${i.startSN}-${i.endSN}], target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=l.start+l.duration,this.state=Vs,u=a?a.then(r=>!r||this.fragContextChanged(r.frag)?null:this.doFragPartsLoad(e,l,t,s)).catch(e=>this.handleFragLoadError(e)):this.doFragPartsLoad(e,l,t,s).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(x.FRAG_LOADING,{frag:e,part:l,targetBufferTime:r}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):u}if(!e.url||this.loadedEndOfParts(n,r))return Promise.resolve(null)}}var l;if(ge(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${r.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${null==(l=i.partList)?void 0:l.filter(e=>e.loaded).map(e=>`[${e.start}-${e.end}]`)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+i.startSN+"-"+i.endSN+"]"}, target: ${parseFloat(r.toFixed(3))}`),R(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Vs;const u=this.config.progressive&&e.type!==B;let c;return c=u&&a?a.then(t=>!t||this.fragContextChanged(t.frag)?null:this.fragmentLoader.load(e,s)).catch(e=>this.handleFragLoadError(e)):Promise.all([this.fragmentLoader.load(e,u?s:void 0),a]).then(([e])=>(!u&&s&&s(e),e)).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(x.FRAG_LOADING,{frag:e,targetBufferTime:r}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):c}doFragPartsLoad(e,t,r,s){return new Promise((n,i)=>{var a;const o=[],l=null==(a=r.details)?void 0:a.partList,u=t=>{this.fragmentLoader.loadPart(e,t,s).then(s=>{o[t.index]=s;const i=s.part;this.hls.trigger(x.FRAG_LOADED,s);const a=Is(r.details,e.sn,t.index+1)||Ps(l,e.sn,t.index+1);if(!a)return n({frag:e,part:i,partsLoaded:o});u(a)}).catch(i)};u(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===D.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===C.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(x.ERROR,t)}else this.hls.trigger(x.ERROR,{type:C.OTHER_ERROR,details:D.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==Ws)return void(this.fragCurrent||this.state===Gs||this.state===Xs||(this.state=Ks));const{frag:r,part:s,level:n}=t,i=self.performance.now();r.stats.parsing.end=i,s&&(s.stats.parsing.end=i);const a=this.getLevelDetails(),o=a&&r.sn>a.endSN||this.shouldLoadParts(a,r.end);o!==this.loadingParts&&(this.log(`LL-Part loading ${o?"ON":"OFF"} after parsing segment ending @${r.end.toFixed(2)}`),this.loadingParts=o),this.updateLevelTiming(r,s,n,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var r;const n=e.partList[0];if(n.fragment.type===B)return!1;if(t>=n.end+((null==(r=e.fragmentHint)?void 0:r.duration)||0)){var s;if((this.hls.hasEnoughToStart?(null==(s=this.media)?void 0:s.currentTime)||this.lastCurrentTime:this.getLoadPosition())>n.start-n.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:s,sn:n,part:i}=e;if(null==t||!t[s])return this.warn(`Levels object was unset while buffering fragment ${n} of ${this.playlistLabel()} ${s}. The current chunk will not be buffered.`),null;const a=t[s],o=a.details,l=i>-1?Is(o,n,i):null,u=l?l.fragment:Rs(o,n,r);return u?(r&&r!==u&&(u.stats=r.stats),{frag:u,part:l,level:a}):null}bufferFragmentData(e,t,r,s,n){if(this.state!==Ws)return;const{data1:i,data2:a}=e;let o=i;if(a&&(o=Me(i,a)),!o.length)return;const l=this.initPTS[t.cc],u=l?-l.baseTime/l.timescale:void 0,c={type:e.type,frag:t,part:r,chunkMeta:s,offset:u,parent:t.type,data:o};if(this.hls.trigger(x.BUFFER_APPENDING,c),e.dropped&&e.independent&&!r){if(n)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Tr.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const r=t.currentTime,s=Tr.bufferInfo(t,r,0),n=e.duration,i=Math.min(2*this.config.maxFragLookUpTolerance,.25*n),a=Math.max(Math.min(e.start-i,s.end-i),r+i);e.start-a>i&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){var r;const s=this.getLoadPosition();if(!R(s))return null;const n=this.lastCurrentTime>s||null!=(r=this.media)&&r.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,t,n)}getFwdBufferInfoAtPos(e,t,r,s){const n=Tr.bufferInfo(e,t,s);if(0===n.len&&void 0!==n.nextStart){const i=this.fragmentTracker.getBufferedFrag(t,r);if(i&&(n.nextStart<=i.end||i.gap)){const r=Math.max(Math.min(n.nextStart,i.end)-t,s);return Tr.bufferInfo(e,t,r)}}return n}getMaxBufferLength(e){const{config:t}=this;let r;return r=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const r=this.config,s=Math.max(Math.min(e-t,r.maxBufferLength),t),n=Math.max(e-3*t,r.maxMaxBufferLength/2,s);return n>=s&&(r.maxMaxBufferLength=n,this.warn(`Reduce max buffer length to ${n}s`),!0)}getAppendedFrag(e,t=$){const r=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,s=r.length;if(!s)return null;const{config:n}=this,i=r[0].start,a=n.lowLatencyMode&&!!t.partList;let o=null;if(t.live){const r=n.initialLiveManifestSize;if(s<r)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${r})`),null;if(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<i){var l;a&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),o=this.getInitialLiveFragment(t);const r=this.hls.startPosition,s=this.hls.liveSyncPosition,n=o?(-1!==r&&r>=i?r:s)||o.start:e;this.log(`Setting startPosition to ${n} to match start frag at live edge. mainStart: ${r} liveSyncPosition: ${s} frag.start: ${null==(l=o)?void 0:l.start}`),this.startPosition=this.nextLoadPosition=n}}else e<=i&&(o=r[0]);if(!o){const r=this.loadingParts?t.partEnd:t.fragmentEnd;o=this.getFragmentAtPosition(e,r,t)}let u=this.filterReplacedPrimary(o,t);if(!u&&o){const e=o.sn-t.startSN;u=this.filterReplacedPrimary(r[e+1]||null,t)}return this.mapToInitFragWhenRequired(u)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===sr||r===rr&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,s,n){let i=null;if(e.gap&&(i=this.getNextFragment(this.nextLoadPosition,t),i&&!i.gap&&r.nextStart)){const e=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,s,0);if(null!==e&&r.len+e.len>=n){const e=i.sn;return this.loopSn!==e&&(this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${e}`),this.loopSn=e),null}}return this.loopSn=void 0,i}get primaryPrefetch(){if(tn(this.config)){var e;if(null==(e=this.hls.interstitialsManager)||null==(e=e.playingItem)?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(tn(this.config)&&e.type!==B){const r=this.hls.interstitialsManager,s=null==r?void 0:r.bufferingItem;if(s){const r=s.event;if(r){if(r.appendInPlace||Math.abs(e.start-s.start)>1||0===s.start)return null}else{if(e.end<=s.start&&!1===(null==t?void 0:t.live))return null;if(e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}}const n=null==r?void 0:r.playerQueue;if(n)for(let t=n.length;t--;){const r=n[t].interstitial;if(r.appendInPlace&&e.start>=r.startTime&&e.end<=r.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,r){let s=-1,n=!1,i=!0;for(let a=0,o=e.length;a<o;a++){const o=e[a];if(i=i&&!o.independent,s>-1&&r<o.start)break;const l=o.loaded;l?s=-1:(n||(o.independent||i)&&o.fragment===t)&&(o.fragment!==t&&this.warn(`Need buffer at ${r} but next unloaded part starts at ${o.start}`),s=a),n=l}return s}loadedEndOfParts(e,t){let r;for(let s=e.length;s--;){if(r=e[s],!r.loaded)return!1;if(t>r.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,r=this.fragPrevious;let s=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),s=function(e,t,r){if(null===t||!Array.isArray(e)||!e.length||!R(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;for(let s=0;s<e.length;++s){const n=e[s];if(Nt(t,r,n))return n}return null}(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const n=r.sn+1;if(n>=e.startSN&&n<=e.endSN){const i=t[n-e.startSN];r.cc===i.cc&&(s=i,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=Mt(e,r.cc,r.end),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const t=this.hls.liveSyncPosition;null!==t&&(s=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,r){const{config:s}=this;let{fragPrevious:n}=this,{fragments:i,endSN:a}=r;const{fragmentHint:o}=r,{maxFragLookUpTolerance:l}=s,u=r.partList,c=!!(this.loadingParts&&null!=u&&u.length&&o);let d;if(c&&!this.bitrateTest&&u[u.length-1].fragment.sn===o.sn&&(i=i.concat(o),a=o.sn),e<t){var h;d=xt(n,i,e,e<this.lastCurrentTime||e>t-l||null!=(h=this.media)&&h.paused||!this.startFragRequested?0:l)}else d=i[i.length-1];if(d){const e=d.sn-r.startSN,t=this.fragmentTracker.getState(d);if((t===sr||t===rr&&d.gap)&&(n=d),n&&d.sn===n.sn&&(!c||u[0].fragment.sn>d.sn||!r.live)){if(d.level===n.level){const t=i[e+1];d=d.sn<a&&this.fragmentTracker.getState(t)!==sr?t:null}}}return d}alignPlaylists(e,t,r){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const n=e.fragmentStart,i=!t,a=e.alignedSliding&&R(n);if(i||!a&&!n){!function(e,t){e&&(Fs(t,e),t.alignedSliding||$s(t,e),t.alignedSliding||t.skippedSegments||_s(e,t,!1))}(r,e);const n=e.fragmentStart;return this.log(`Live playlist sliding: ${n.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${s}`),n}return n}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let r=this.startPosition;r<t&&(r=-1);const s=this.timelineOffset;if(-1===r){const n=null!==this.startTimeOffset,i=n?this.startTimeOffset:e.startTimeOffset;null!==i&&R(i)?(r=t+i,i<0&&(r+=e.edge),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Setting startPosition to ${r} for start time offset ${i} found in ${n?"multivariant":"media"} playlist`),this.startPosition=r):e.live?(r=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${r}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=r=0),this.lastCurrentTime=r+s}this.nextLoadPosition=r+s}getLoadPosition(){var e;const{media:t}=this;let r=0;return null!=(e=this.hls)&&e.hasEnoughToStart&&t?r=t.currentTime:this.nextLoadPosition>=0&&(r=this.nextLoadPosition),r}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&ge(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===zs)||(this.state=Ks)}onFragmentOrKeyLoadError(e,t){var r;if(t.chunkMeta&&!t.frag){const e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;var n;if(this.fragContextChanged(s))return void this.warn(`Frag load error must match current frag to retry ${s.url} > ${null==(n=this.fragCurrent)?void 0:n.url}`);const i=t.details===D.FRAG_GAP;i&&this.fragmentTracker.fragBuffered(s,!0);const a=t.errorAction;if(!a)return void(this.state=Xs);const{action:o,flags:l,retryCount:u=0,retryConfig:c}=a,d=!!c,h=d&&o===Wt,f=d&&!a.resolved&&l===Qt,g=null==(r=this.hls.latestLevelDetails)?void 0:r.live;if(!h&&f&&ge(s)&&!s.endList&&g&&!Ut(t))this.resetFragmentErrors(e),this.treatAsGap(s),a.resolved=!0;else if((h||f)&&u<c.maxNumRetry){var p;const r=Ht(null==(p=t.response)?void 0:p.code),n=jt(c,u);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+n,this.state=zs,a.resolved=!0,r)return this.log("Waiting for connection (offline)"),this.retryDate=1/0,void(t.reason="offline");this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${u+1}/${c.maxNumRetry} in ${n}ms`)}else if(c){if(this.resetFragmentErrors(e),!(u<c.maxNumRetry))return void this.warn(`${t.details} reached or exceeded max retry (${u})`);i||o===qt||(a.resolved=!0)}else this.state=o===zt?Zs:Xs;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,r=t===1/0;(!t||e>=t||r&&!Ht(0))&&(r&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=Ks)}reduceLengthAndFlushBuffer(e){if(this.state===Ws||this.state===Ys){const t=e.frag,r=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,r),n=s&&s.len>.5;n&&this.reduceMaxBufferLength(s.len,(null==t?void 0:t.duration)||10);const i=!n;return i&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),i}return!1}resetFragmentErrors(e){e===U&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==Gs&&(this.state=Ks)}afterBufferFlushed(e,t,r){if(!e)return;const s=Tr.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,r),this.state===Qs&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==Gs&&(this.state=Ks)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;null!=t&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${-1===e.level?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,s){const n=r.details;if(!n)return void this.warn("level.details undefined");if(!Object.keys(e.elementaryStreams).reduce((t,i)=>{const a=e.elementaryStreams[i];if(a){const o=a.endPTS-a.startPTS;if(o<=0)return this.warn(`Could not parse fragment ${e.sn} ${i} duration reliably (${o})`),t||!1;const l=s?0:Ts(n,e,a.startPTS,a.endPTS,a.startDTS,a.endDTS,this);return this.hls.trigger(x.LEVEL_PTS_UPDATED,{details:n,level:r,drift:l,type:i,frag:e,start:a.startPTS,end:a.endPTS}),!0}return t},!1)){var i;const t=null===(null==(i=this.transmuxer)?void 0:i.error);if((0===r.fragmentError||t&&(r.fragmentError<2||e.endList))&&this.treatAsGap(e,r),t){const t=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(t.message),this.hls.trigger(x.ERROR,{type:C.MEDIA_ERROR,details:D.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=Ys,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(x.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===$?"level":"track"}fragInfo(e,t=!0,r){var s,n;return`${this.playlistLabel()} ${e.level} (${r?"part":"frag"}:[${(null!=(s=t&&!r?e.startPTS:(r||e).start)?s:NaN).toFixed(3)}-${(null!=(n=t&&!r?e.endPTS:(r||e).end)?n:NaN).toFixed(3)}]${r&&"main"===e.type?"INDEPENDENT="+(r.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;null==(e=this.transmuxer)||e.reset()}recoverWorkerError(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function tn(e){return!!e.interstitialsController&&!1!==e.enableInterstitialPlayback}class rn{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;return e.length?(r=1===e.length?e[0]:function(e,t){const r=new Uint8Array(t);let s=0;for(let t=0;t<e.length;t++){const n=e[t];r.set(n,s),s+=n.length}return r}(e,t),this.reset(),r):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}var sn,nn={exports:{}};var an=(sn||(sn=1,function(e){var t=Object.prototype.hasOwnProperty,r="~";function s(){}function n(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function i(e,t,s,i,a){if("function"!=typeof s)throw new TypeError("The listener must be a function");var o=new n(s,i||e,a),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function a(e,t){0===--e._eventsCount?e._events=new s:delete e._events[t]}function o(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(r=!1)),o.prototype.eventNames=function(){var e,s,n=[];if(0===this._eventsCount)return n;for(s in e=this._events)t.call(e,s)&&n.push(r?s.slice(1):s);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},o.prototype.listeners=function(e){var t=r?r+e:e,s=this._events[t];if(!s)return[];if(s.fn)return[s.fn];for(var n=0,i=s.length,a=new Array(i);n<i;n++)a[n]=s[n].fn;return a},o.prototype.listenerCount=function(e){var t=r?r+e:e,s=this._events[t];return s?s.fn?1:s.length:0},o.prototype.emit=function(e,t,s,n,i,a){var o=r?r+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,s),!0;case 4:return c.fn.call(c.context,t,s,n),!0;case 5:return c.fn.call(c.context,t,s,n,i),!0;case 6:return c.fn.call(c.context,t,s,n,i,a),!0}for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,s);break;case 4:c[u].fn.call(c[u].context,t,s,n);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},o.prototype.on=function(e,t,r){return i(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return i(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,s,n){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return a(this,i),this;var o=this._events[i];if(o.fn)o.fn!==t||n&&!o.once||s&&o.context!==s||a(this,i);else{for(var l=0,u=[],c=o.length;l<c;l++)(o[l].fn!==t||n&&!o[l].once||s&&o[l].context!==s)&&u.push(o[l]);u.length?this._events[i]=1===u.length?u[0]:u:a(this,i)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new s,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o}(nn)),nn.exports),on=ie(an);const ln="1.6.15",un={};function cn(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function dn(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function hn(e,t){let r=0;return r=(127&e[t])<<21,r|=(127&e[t+1])<<14,r|=(127&e[t+2])<<7,r|=127&e[t+3],r}function fn(e,t){const r=t;let s=0;for(;dn(e,t);){s+=10;s+=hn(e,t+6),cn(e,t+10)&&(s+=10),t+=s}if(s>0)return e.subarray(r,r+s)}function gn(e,t){return 255===e[t]&&240==(246&e[t+1])}function pn(e,t){return 1&e[t+1]?7:9}function mn(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function yn(e,t){return t+1<e.length&&gn(e,t)}function vn(e,t){if(yn(e,t)){const r=pn(e,t);if(t+r>=e.length)return!1;const s=mn(e,t);if(s<=r)return!1;const n=t+s;return n===e.length||yn(e,n)}return!1}function bn(e,t,r,s,n){if(!e.samplerate){const i=function(e,t,r,s){const n=t[r+2],i=n>>2&15;if(i>12){const t=new Error(`invalid ADTS sampling index:${i}`);return void e.emit(x.ERROR,x.ERROR,{type:C.MEDIA_ERROR,details:D.FRAG_PARSING_ERROR,fatal:!0,error:t,reason:t.message})}const a=1+(n>>6&3),o=t[r+3]>>6&3|(1&n)<<2,l="mp4a.40."+a,u=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][i];let c=i;5!==a&&29!==a||(c-=3);const d=[a<<3|(14&c)>>1,(1&c)<<7|o<<3];return Z.log(`manifest codec:${s}, parsed codec:${l}, channels:${o}, rate:${u} (ADTS object type:${a} sampling index:${i})`),{config:d,samplerate:u,channelCount:o,codec:l,parsedCodec:l,manifestCodec:s}}(t,r,s,n);if(!i)return;H(e,i)}}function En(e){return 9216e4/e}function Sn(e,t,r,s,n){const i=s+n*En(e.samplerate),a=function(e,t){const r=pn(e,t);if(t+r<=e.length){const s=mn(e,t)-r;if(s>0)return{headerLength:r,frameLength:s}}}(t,r);let o;if(a){const{frameLength:s,headerLength:n}=a,l=n+s,u=Math.max(0,r+l-t.length);u?(o=new Uint8Array(l-n),o.set(t.subarray(r+n,t.length),0)):o=t.subarray(r+n,r+l);const c={unit:o,pts:i};return u||e.samples.push(c),{sample:c,length:l,missing:u}}const l=t.length-r;o=new Uint8Array(l),o.set(t.subarray(r,t.length),0);return{sample:{unit:o,pts:i},length:l,missing:-1}}function Tn(e,t){return dn(e,t)&&hn(e,t+6)+10<=e.length-t}function wn(e,t=0,r=1/0){return function(e,t,r,s){const n=function(e){return e instanceof ArrayBuffer?e:e.buffer}(e);let i=1;"BYTES_PER_ELEMENT"in s&&(i=s.BYTES_PER_ELEMENT);const a=(d=e,d&&d.buffer instanceof ArrayBuffer&&void 0!==d.byteLength&&void 0!==d.byteOffset?e.byteOffset:0),o=(a+e.byteLength)/i,l=(a+t)/i,u=Math.floor(Math.max(0,Math.min(l,o))),c=Math.floor(Math.min(u+Math.max(r,0),o));var d;return new s(n,u,c-u)}(e,t,r,Uint8Array)}function kn(e){const t={key:e.type,description:"",data:"",mimeType:null,pictureType:null};if(e.size<2)return;if(3!==e.data[0])return void console.log("Ignore frame with unrecognized character encoding");const r=e.data.subarray(1).indexOf(0);if(-1===r)return;const s=re(wn(e.data,1,r)),n=e.data[2+r],i=e.data.subarray(3+r).indexOf(0);if(-1===i)return;const a=re(wn(e.data,3+r,i));let o;return o="--\x3e"===s?re(wn(e.data,4+r+i)):function(e){return e instanceof ArrayBuffer?e:0==e.byteOffset&&e.byteLength==e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer}(e.data.subarray(4+r+i)),t.mimeType=s,t.pictureType=n,t.description=a,t.data=o,t}function _n(e){return"PRIV"===e.type?function(e){if(e.size<2)return;const t=re(e.data,!0),r=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:r.buffer}}(e):"W"===e.type[0]?function(e){if("WXXX"===e.type){if(e.size<2)return;let t=1;const r=re(e.data.subarray(t),!0);t+=r.length+1;const s=re(e.data.subarray(t));return{key:e.type,info:r,data:s}}const t=re(e.data);return{key:e.type,info:"",data:t}}(e):"APIC"===e.type?kn(e):function(e){if(e.size<2)return;if("TXXX"===e.type){let t=1;const r=re(e.data.subarray(t),!0);t+=r.length+1;const s=re(e.data.subarray(t));return{key:e.type,info:r,data:s}}const t=re(e.data.subarray(1));return{key:e.type,info:"",data:t}}(e)}function An(e){const t=String.fromCharCode(e[0],e[1],e[2],e[3]),r=hn(e,4);return{type:t,size:r,data:e.subarray(10,10+r)}}function Ln(e){let t=0;const r=[];for(;dn(e,t);){const s=hn(e,t+6);e[t+5]>>6&1&&(t+=10),t+=10;const n=t+s;for(;t+10<n;){const s=An(e.subarray(t)),n=_n(s);n&&r.push(n),t+=s.size+10}cn(e,t)&&(t+=10)}return r}function Rn(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info}function In(e){if(8===e.data.byteLength){const t=new Uint8Array(e.data),r=1&t[3];let s=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return s/=45,r&&(s+=47721858.84),Math.round(s)}}function Pn(e){const t=Ln(e);for(let e=0;e<t.length;e++){const r=t[e];if(Rn(r))return In(r)}}let Cn=function(e){return e.audioId3="org.id3",e.dateRange="com.apple.quicktime.HLS",e.emsg="https://aomedia.org/emsg/ID3",e.misbklv="urn:misb:KLV:bin:1910.1",e}({});function Dn(e="",t=9e4){return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class xn{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=Me(this.cachedData,e),this.cachedData=null);let r,s=fn(e,0),n=s?s.length:0;const i=this._audioTrack,a=this._id3Track,o=s?Pn(s):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&R(o))&&(this.basePTS=On(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),s&&s.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:Cn.audioId3,duration:Number.POSITIVE_INFINITY});n<l;){if(this.canParse(e,n)){const t=this.appendFrame(i,e,n);t?(this.frameIndex++,this.lastPTS=t.sample.pts,n+=t.length,r=n):n=l}else Tn(e,n)?(s=fn(e,n),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:Cn.audioId3,duration:Number.POSITIVE_INFINITY}),n+=s.length,r=n):n++;if(n===l&&r!==l){const t=e.slice(r);this.cachedData?this.cachedData=Me(this.cachedData,t):this.cachedData=t}}return{audioTrack:i,videoTrack:Dn(),id3Track:a,textTrack:Dn()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Dn(),id3Track:this._id3Track,textTrack:Dn()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const On=(e,t,r)=>{if(R(e))return 90*e;return 9e4*t+(r?9e4*r.baseTime/r.timescale:0)};let Nn=null;const Mn=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Fn=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],$n=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Un=[0,1,1,4];function Bn(e,t,r,s,n){if(r+24>t.length)return;const i=jn(t,r);if(i&&r+i.frameLength<=t.length){const a=s+n*(9e4*i.samplesPerFrame/i.sampleRate),o={unit:t.subarray(r,r+i.frameLength),pts:a,dts:a};return e.config=[],e.channelCount=i.channelCount,e.samplerate=i.sampleRate,e.samples.push(o),{sample:o,length:i.frameLength,missing:0}}}function jn(e,t){const r=e[t+1]>>3&3,s=e[t+1]>>1&3,n=e[t+2]>>4&15,i=e[t+2]>>2&3;if(1!==r&&0!==n&&15!==n&&3!==i){const a=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*Mn[14*(3===r?3-s:3===s?3:4)+n-1],u=Fn[3*(3===r?0:2===r?1:2)+i],c=3===o?1:2,d=$n[r][s],h=Un[s],f=8*d*h,g=Math.floor(d*l/u+a)*h;if(null===Nn){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Nn=e?parseInt(e[1]):0}return!!Nn&&Nn<=87&&2===s&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:u,channelCount:c,frameLength:g,samplesPerFrame:f}}}function Gn(e,t){return!(255!==e[t]||224&~e[t+1]||!(6&e[t+1]))}function Kn(e,t){return t+1<e.length&&Gn(e,t)}function Hn(e,t){if(t+1<e.length&&Gn(e,t)){const r=4,s=jn(e,t);let n=r;null!=s&&s.frameLength&&(n=s.frameLength);const i=t+n;return i===e.length||Kn(e,i)}return!1}const Vn=(e,t)=>{let r=0,s=5;t+=s;const n=new Uint32Array(1),i=new Uint32Array(1),a=new Uint8Array(1);for(;s>0;){a[0]=e[t];const o=Math.min(s,8),l=8-o;i[0]=4278190080>>>24+l<<l,n[0]=(a[0]&i[0])>>l,r=r?r<<o|n[0]:n[0],t+=1,s-=o}return r};class zn extends xn{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const s=qn(e,t,r,this.basePTS,this.frameIndex);if(-1!==s){return{sample:e.samples[e.samples.length-1],length:s,missing:0}}}static probe(e){if(!e)return!1;const t=fn(e,0);if(!t)return!1;const r=t.length;return 11===e[r]&&119===e[r+1]&&void 0!==Pn(t)&&Vn(e,r)<16}}function qn(e,t,r,s,n){if(r+8>t.length)return-1;if(11!==t[r]||119!==t[r+1])return-1;const i=t[r+4]>>6;if(i>=3)return-1;const a=[48e3,44100,32e3][i],o=63&t[r+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+i];if(r+l>t.length)return-1;const u=t[r+6]>>5;let c=0;2===u?c+=2:(1&u&&1!==u&&(c+=2),4&u&&(c+=2));const d=(t[r+6]<<8|t[r+7])>>12-c&1,h=[2,1,2,3,3,4,4,5][u]+d,f=t[r+5]>>3,g=7&t[r+5],p=new Uint8Array([i<<6|f<<1|g>>2,(3&g)<<6|u<<3|d<<2|o>>4,o<<4&224]),m=s+n*(1536/a*9e4),y=t.subarray(r,r+l);return e.config=p,e.channelCount=h,e.samplerate=a,e.samples.push({unit:y,pts:m}),l}const Wn=/\/emsg[-/]ID3/i;function Yn(e,t){return R(e.presentationTime)?e.presentationTime/e.timeScale:t+e.presentationTimeDelta/e.timeScale}class Qn{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new fr(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,lr)}decryptAacSample(e,t,r){const s=e[t].unit;if(s.length<=16)return;const n=s.subarray(16,s.length-s.length%16),i=n.buffer.slice(n.byteOffset,n.byteOffset+n.length);this.decryptBuffer(i).then(n=>{const i=new Uint8Array(n);s.set(i,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)}).catch(r)}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t);let s=0;for(let t=32;t<e.length-16;t+=160,s+=16)r.set(e.subarray(t,t+16),s);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let s=0;for(let t=32;t<e.length-16;t+=160,s+=16)e.set(r.subarray(s,s+16),t);return e}decryptAvcSample(e,t,r,s,n){const i=je(n.data),a=this.getAvcEncryptedData(i);this.decryptBuffer(a.buffer).then(a=>{n.data=this.getAvcDecryptedUnit(i,a),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,s)}).catch(s)}decryptAvcSamples(e,t,r,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length)return void s();const n=e[t].units;for(;!(r>=n.length);r++){const i=n[r];if(!(i.data.length<=48||1!==i.type&&5!==i.type||(this.decryptAvcSample(e,t,r,s,i),this.decrypter.isSync())))return}}}}class Xn{constructor(){this.VideoSample=null}createVideoSample(e,t,r){return{key:e,frame:!1,pts:t,dts:r,units:[],length:0}}getLastNalUnit(e){var t;let r,s=this.VideoSample;if(s&&0!==s.units.length||(s=e[e.length-1]),null!=(t=s)&&t.units){const e=s.units;r=e[e.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){const r=t.samples,s=r.length;if(!s)return void t.dropped++;{const t=r[s-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}}parseNALu(e,t,r){const s=t.byteLength;let n=e.naluState||0;const i=n,a=[];let o,l,u,c=0,d=-1,h=0;for(-1===n&&(d=0,h=this.getNALuType(t,0),n=0,c=1);c<s;)if(o=t[c++],n)if(1!==n)if(o)if(1===o){if(l=c-n-1,d>=0){const e={data:t.subarray(d,l),type:h};a.push(e)}else{const r=this.getLastNalUnit(e.samples);r&&(i&&c<=4-i&&r.state&&(r.data=r.data.subarray(0,r.data.byteLength-i)),l>0&&(r.data=Me(r.data,t.subarray(0,l)),r.state=0))}c<s?(u=this.getNALuType(t,c),d=c,h=u,n=0):n=-1}else n=0;else n=3;else n=o?0:2;else n=o?0:1;if(d>=0&&n>=0){const e={data:t.subarray(d,s),type:h,state:n};a.push(e)}if(0===a.length){const r=this.getLastNalUnit(e.samples);r&&(r.data=Me(r.data,t))}return e.naluState=n,a}}class Jn{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,s=new Uint8Array(4),n=Math.min(4,t);if(0===n)throw new Error("no bytes available");s.set(e.subarray(r,r+n)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&Z.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class Zn extends Xn{parsePES(e,t,r,s){const n=this.parseNALu(e,r.data,s);let i,a=this.VideoSample,o=!1;r.data=null,a&&n.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),n.forEach(s=>{var n,l;switch(s.type){case 1:{let t=!1;i=!0;const n=s.data;if(o&&n.length>4){const e=this.readSliceType(n);2!==e&&4!==e&&7!==e&&9!==e||(t=!0)}var u;if(t)null!=(u=a)&&u.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null);a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.frame=!0,a.key=t;break}case 5:i=!0,null!=(n=a)&&n.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 6:i=!0,Be(s.data,1,r.pts,t.samples);break;case 7:{var c,d;i=!0,o=!0;const t=s.data,r=this.readSPS(t);if(!e.sps||e.width!==r.width||e.height!==r.height||(null==(c=e.pixelRatio)?void 0:c[0])!==r.pixelRatio[0]||(null==(d=e.pixelRatio)?void 0:d[1])!==r.pixelRatio[1]){e.width=r.width,e.height=r.height,e.pixelRatio=r.pixelRatio,e.sps=[t];const s=t.subarray(1,4);let n="avc1.";for(let e=0;e<3;e++){let t=s[e].toString(16);t.length<2&&(t="0"+t),n+=t}e.codec=n}break}case 8:i=!0,e.pps=[s.data];break;case 9:i=!0,e.audFound=!0,null!=(l=a)&&l.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;case 12:i=!0;break;default:i=!1}if(a&&i){a.units.push(s)}}),s&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return 31&e[t]}readSliceType(e){const t=new Jn(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let r,s=8,n=8;for(let i=0;i<e;i++)0!==n&&(r=t.readEG(),n=(s+r+256)%256),s=0===n?s:n}readSPS(e){const t=new Jn(e);let r,s,n,i=0,a=0,o=0,l=0;const u=t.readUByte.bind(t),c=t.readBits.bind(t),d=t.readUEG.bind(t),h=t.readBoolean.bind(t),f=t.skipBits.bind(t),g=t.skipEG.bind(t),p=t.skipUEG.bind(t),m=this.skipScalingList.bind(this);u();const y=u();if(c(5),f(3),u(),p(),100===y||110===y||122===y||244===y||44===y||83===y||86===y||118===y||128===y){const e=d();if(3===e&&f(1),p(),p(),f(1),h())for(s=3!==e?8:12,n=0;n<s;n++)h()&&m(n<6?16:64,t)}p();const v=d();if(0===v)d();else if(1===v)for(f(1),g(),g(),r=d(),n=0;n<r;n++)g();p(),f(1);const b=d(),E=d(),S=c(1);0===S&&f(1),f(1),h()&&(i=d(),a=d(),o=d(),l=d());let T=[1,1];if(h()&&h()){switch(u()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[u()<<8|u(),u()<<8|u()]}}return{width:Math.ceil(16*(b+1)-2*i-2*a),height:(2-S)*(E+1)*16-(S?2:4)*(o+l),pixelRatio:T}}}class ei extends Xn{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,r,s){const n=this.parseNALu(e,r.data,s);let i,a=this.VideoSample,o=!1;r.data=null,a&&n.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),n.forEach(s=>{var n,l;switch(s.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),a.frame=!0,i=!0;break;case 16:case 17:case 18:case 21:var u;if(i=!0,o)null!=(u=a)&&u.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null);a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:i=!0,null!=(n=a)&&n.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0,a.frame=!0;break;case 39:i=!0,Be(s.data,2,r.pts,t.samples);break;case 32:i=!0,e.vps||("object"!=typeof e.params&&(e.params={}),e.params=H(e.params,this.readVPS(s.data)),this.initVPS=s.data),e.vps=[s.data];break;case 33:if(i=!0,o=!0,void 0===e.vps||e.vps[0]===this.initVPS||void 0===e.sps||this.matchSPS(e.sps[0],s.data)||(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const t=this.readSPS(s.data);e.width=t.width,e.height=t.height,e.pixelRatio=t.pixelRatio,e.codec=t.codecString,e.sps=[],"object"!=typeof e.params&&(e.params={});for(const r in t.params)e.params[r]=t.params[r]}this.pushParameterSet(e.sps,s.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),a.key=!0;break;case 34:if(i=!0,"object"==typeof e.params){if(!e.pps){e.pps=[];const t=this.readPPS(s.data);for(const r in t)e.params[r]=t[r]}this.pushParameterSet(e.pps,s.data,e.vps)}break;case 35:i=!0,e.audFound=!0,null!=(l=a)&&l.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;default:i=!1}if(a&&i){a.units.push(s)}}),s&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,r){(r&&r[0]===this.initVPS||!r&&!e.length)&&e.push(t)}getNALuType(e,t){return(126&e[t])>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let r=0;for(let s=0;s<e.byteLength;s++)s>=2&&3===e[s]&&0===e[s-1]&&0===e[s-2]||(t[r]=e[s],r++);return new Uint8Array(t.buffer,0,r)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Jn(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);return{numTemporalLayers:t.readBits(3)+1,temporalIdNested:t.readBoolean()}}readSPS(e){const t=new Jn(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const r=t.readBits(3);t.readBoolean();const s=t.readBits(2),n=t.readBoolean(),i=t.readBits(5),a=t.readUByte(),o=t.readUByte(),l=t.readUByte(),u=t.readUByte(),c=t.readUByte(),d=t.readUByte(),h=t.readUByte(),f=t.readUByte(),g=t.readUByte(),p=t.readUByte(),m=t.readUByte(),y=[],v=[];for(let e=0;e<r;e++)y.push(t.readBoolean()),v.push(t.readBoolean());if(r>0)for(let e=r;e<8;e++)t.readBits(2);for(let e=0;e<r;e++)y[e]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),v[e]&&t.readUByte();t.readUEG();const b=t.readUEG();3==b&&t.skipBits(1);const E=t.readUEG(),S=t.readUEG(),T=t.readBoolean();let w=0,k=0,_=0,A=0;T&&(w+=t.readUEG(),k+=t.readUEG(),_+=t.readUEG(),A+=t.readUEG());const L=t.readUEG(),R=t.readUEG(),I=t.readUEG();for(let e=t.readBoolean()?0:r;e<=r;e++)t.skipUEG(),t.skipUEG(),t.skipUEG();t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.readBoolean()){if(t.readBoolean())for(let e=0;e<4;e++)for(let r=0;r<(3===e?2:6);r++){if(t.readBoolean()){const r=Math.min(64,1<<4+(e<<1));e>1&&t.readEG();for(let e=0;e<r;e++)t.readEG()}else t.readUEG()}}t.readBoolean(),t.readBoolean();t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const P=t.readUEG();let C=0;for(let e=0;e<P;e++){let r=!1;if(0!==e&&(r=t.readBoolean()),r){e===P&&t.readUEG(),t.readBoolean(),t.readUEG();let r=0;for(let e=0;e<=C;e++){const e=t.readBoolean();let s=!1;e||(s=t.readBoolean()),(e||s)&&r++}C=r}else{const e=t.readUEG(),r=t.readUEG();C=e+r;for(let r=0;r<e;r++)t.readUEG(),t.readBoolean();for(let e=0;e<r;e++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const e=t.readUEG();for(let r=0;r<e;r++){for(let e=0;e<I+4;e++)t.readBits(1);t.readBits(1)}}let D=0,x=1,O=1,N=!0,M=1,F=0;t.readBoolean(),t.readBoolean();let $=!1;if(t.readBoolean()){if(t.readBoolean()){const e=t.readUByte();e>0&&e<16?(x=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][e-1],O=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][e-1]):255===e&&(x=t.readBits(16),O=t.readBits(16))}t.readBoolean()&&t.readBoolean();if(t.readBoolean()){t.readBits(3),t.readBoolean();t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())}t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),$=t.readBoolean(),$&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG());if(t.readBoolean()){M=t.readBits(32),F=t.readBits(32);t.readBoolean()&&t.readUEG();if(t.readBoolean()){const e=t.readBoolean(),s=t.readBoolean();let n=!1;(e||s)&&(n=t.readBoolean(),n&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),n&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let i=0;i<=r;i++){N=t.readBoolean();let r=!1;N||t.readBoolean()?t.readEG():r=t.readBoolean();const i=r?1:t.readUEG()+1;if(e)for(let e=0;e<i;e++)t.readUEG(),t.readUEG(),n&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(s)for(let e=0;e<i;e++)t.readUEG(),t.readUEG(),n&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),D=t.readUEG())}let U=E,B=S;if(T){let e=1,t=1;1===b?e=t=2:2==b&&(e=2),U=E-e*k-e*w,B=S-t*A-t*_}const j=s?["A","B","C"][s]:"",G=a<<24|o<<16|l<<8|u;let K=0;for(let e=0;e<32;e++)K=(K|(G>>e&1)<<31-e)>>>0;let H=K.toString(16);1===i&&"2"===H&&(H="6");return{codecString:`hvc1.${j}${i}.${H}.${n?"H":"L"}${m}.B0`,params:{general_tier_flag:n,general_profile_idc:i,general_profile_space:s,general_profile_compatibility_flags:[a,o,l,u],general_constraint_indicator_flags:[c,d,h,f,g,p],general_level_idc:m,bit_depth:L+8,bit_depth_luma_minus8:L,bit_depth_chroma_minus8:R,min_spatial_segmentation_idc:D,chroma_format_idc:b,frame_rate:{fixed:N,fps:F/M}},width:U,height:B,pixelRatio:[x,O]}}readPPS(e){const t=new Jn(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2);t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const r=t.readBoolean(),s=t.readBoolean();let n=1;return s&&r?n=0:s?n=3:r&&(n=2),{parallelismType:n}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const ti=188;class ri{constructor(e,t,r,s){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=s,this.videoParser=null}static probe(e,t){const r=ri.syncOffset(e);return r>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${r}`),-1!==r}static syncOffset(e){const t=e.length;let r=Math.min(940,t-ti)+1,s=0;for(;s<r;){let n=!1,i=-1,a=0;for(let o=s;o<t;o+=ti){if(71!==e[o]||t-o!==ti&&71!==e[o+ti]){if(a)return-1;break}if(a++,-1===i&&(i=o,0!==i&&(r=Math.min(i+18612,e.length-ti)+1)),n||(n=0===si(e,o)),n&&a>1&&(0===i&&a>2||o+ti>r))return i}s++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:Ee[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,r,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=ri.createTrack("video"),this._videoTrack.duration=s,this._audioTrack=ri.createTrack("audio",s),this._id3Track=ri.createTrack("id3"),this._txtTrack=ri.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,s=!1){let n;r||(this.sampleAes=null);const i=this._videoTrack,a=this._audioTrack,o=this._id3Track,l=this._txtTrack;let u=i.pid,c=i.pesData,d=a.pid,h=o.pid,f=a.pesData,g=o.pesData,p=null,m=this.pmtParsed,y=this._pmtId,v=e.length;if(this.remainderData&&(v=(e=Me(this.remainderData,e)).length,this.remainderData=null),v<ti&&!s)return this.remainderData=e,{audioTrack:a,videoTrack:i,id3Track:o,textTrack:l};const b=Math.max(0,ri.syncOffset(e));v-=(v-b)%ti,v<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,v,e.buffer.byteLength-v));let E=0;for(let t=b;t<v;t+=ti)if(71===e[t]){const s=!!(64&e[t+1]),v=si(e,t);let E;if((48&e[t+3])>>4>1){if(E=t+5+e[t+4],E===t+ti)continue}else E=t+4;switch(v){case u:s&&(c&&(n=li(c,this.logger))&&(this.readyVideoParser(i.segmentCodec),null!==this.videoParser&&this.videoParser.parsePES(i,l,n,!1)),c={data:[],size:0}),c&&(c.data.push(e.subarray(E,t+ti)),c.size+=t+ti-E);break;case d:if(s){if(f&&(n=li(f,this.logger)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,n);break;case"mp3":this.parseMPEGPES(a,n);break;case"ac3":this.parseAC3PES(a,n)}f={data:[],size:0}}f&&(f.data.push(e.subarray(E,t+ti)),f.size+=t+ti-E);break;case h:s&&(g&&(n=li(g,this.logger))&&this.parseID3PES(o,n),g={data:[],size:0}),g&&(g.data.push(e.subarray(E,t+ti)),g.size+=t+ti-E);break;case 0:s&&(E+=e[E]+1),y=this._pmtId=ni(e,E);break;case y:{s&&(E+=e[E]+1);const n=ii(e,E,this.typeSupported,r,this.observer,this.logger);u=n.videoPid,u>0&&(i.pid=u,i.segmentCodec=n.segmentVideoCodec),d=n.audioPid,d>0&&(a.pid=d,a.segmentCodec=n.segmentAudioCodec),h=n.id3Pid,h>0&&(o.pid=h),null===p||m||(this.logger.warn(`MPEG-TS PMT found at ${t} after unknown PID '${p}'. Backtracking to sync byte @${b} to parse all TS packets.`),p=null,t=b-188),m=this.pmtParsed=!0;break}case 17:case 8191:break;default:p=v}}else E++;E>0&&ai(this.observer,new Error(`Found ${E} TS packet/s that do not start with 0x47`),void 0,this.logger),i.pesData=c,a.pesData=f,o.pesData=g;const S={audioTrack:a,videoTrack:i,id3Track:o,textTrack:l};return s&&this.extractRemainingSamples(S),S}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:s,textTrack:n}=e,i=r.pesData,a=t.pesData,o=s.pesData;let l;if(i&&(l=li(i,this.logger))?(this.readyVideoParser(r.segmentCodec),null!==this.videoParser&&(this.videoParser.parsePES(r,n,l,!0),r.pesData=null)):r.pesData=i,a&&(l=li(a,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l)}t.pesData=null}else null!=a&&a.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;o&&(l=li(o,this.logger))?(this.parseID3PES(s,l),s.pesData=null):s.pesData=o}demuxSampleAes(e,t,r){const s=this.demux(e,r,!0,!this.config.progressive),n=this.sampleAes=new Qn(this.observer,this.config,t);return this.decrypt(s,n)}readyVideoParser(e){null===this.videoParser&&("avc"===e?this.videoParser=new Zn:"hevc"===e&&(this.videoParser=new ei))}decrypt(e,t){return new Promise(r=>{const{audioTrack:s,videoTrack:n}=e;s.samples&&"aac"===s.segmentCodec?t.decryptAacSamples(s.samples,0,()=>{n.samples?t.decryptAvcSamples(n.samples,0,0,()=>{r(e)}):r(e)}):n.samples&&t.decryptAvcSamples(n.samples,0,0,()=>{r(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let r=0;const s=this.aacOverFlow;let n,i,a,o=t.data;if(s){this.aacOverFlow=null;const t=s.missing,n=s.sample.unit.byteLength;if(-1===t)o=Me(s.sample.unit,o);else{const i=n-t;s.sample.unit.set(o.subarray(0,t),i),e.samples.push(s.sample),r=s.missing}}for(n=r,i=o.length;n<i-1&&!yn(o,n);n++);if(n!==r){let e;const t=n<i-1;if(e=t?`AAC PES did not start with ADTS header,offset:${n}`:"No ADTS header found in AAC PES",ai(this.observer,new Error(e),t,this.logger),!t)return}if(bn(e,this.observer,o,n,this.audioCodec),void 0!==t.pts)a=t.pts;else{if(!s)return void this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=En(e.samplerate);a=s.sample.pts+t}}let l,u=0;for(;n<i;){if(l=Sn(e,o,n,a,u),n+=l.length,l.missing){this.aacOverFlow=l;break}for(u++;n<i-1&&!yn(o,n);n++);}}parseMPEGPES(e,t){const r=t.data,s=r.length;let n=0,i=0;const a=t.pts;if(void 0!==a)for(;i<s;)if(Kn(r,i)){const t=Bn(e,r,i,a,n);if(!t)break;i+=t.length,n++}else i++;else this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(e,t){{const r=t.data,s=t.pts;if(void 0===s)return void this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");const n=r.length;let i,a=0,o=0;for(;o<n&&(i=qn(e,r,o,s,a++))>0;)o+=i}}parseID3PES(e,t){if(void 0===t.pts)return void this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");const r=H({},t,{type:this._videoTrack?Cn.emsg:Cn.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function si(e,t){return((31&e[t+1])<<8)+e[t+2]}function ni(e,t){return(31&e[t+10])<<8|e[t+11]}function ii(e,t,r,s,n,i){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<o;){const o=si(e,t),l=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!s){oi("ADTS AAC",i);break}case 15:-1===a.audioPid&&(a.audioPid=o);break;case 21:-1===a.id3Pid&&(a.id3Pid=o);break;case 219:if(!s){oi("H.264",i);break}case 27:-1===a.videoPid&&(a.videoPid=o);break;case 3:case 4:r.mpeg||r.mp3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="mp3"):i.log("MPEG audio found, not supported in this browser");break;case 193:if(!s){oi("AC-3",i);break}case 129:r.ac3?-1===a.audioPid&&(a.audioPid=o,a.segmentAudioCodec="ac3"):i.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===a.audioPid&&l>0){let s=t+5,n=l;for(;n>2;){if(106===e[s])!0!==r.ac3?i.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=o,a.segmentAudioCodec="ac3");const t=e[s+1]+2;s+=t,n-=t}}break;case 194:case 135:return ai(n,new Error("Unsupported EC-3 in M2TS found"),void 0,i),a;case 36:-1===a.videoPid&&(a.videoPid=o,a.segmentVideoCodec="hevc",i.log("HEVC in M2TS found"))}t+=l+5}return a}function ai(e,t,r,s){s.warn(`parsing error: ${t.message}`),e.emit(x.ERROR,x.ERROR,{type:C.MEDIA_ERROR,details:D.FRAG_PARSING_ERROR,fatal:!1,levelRetry:r,error:t,reason:t.message})}function oi(e,t){t.log(`${e} with AES-128-CBC encryption found in unencrypted stream`)}function li(e,t){let r,s,n,i,a,o=0;const l=e.data;if(!e||0===e.size)return null;for(;l[0].length<19&&l.length>1;)l[0]=Me(l[0],l[1]),l.splice(1,1);r=l[0];if(1===(r[0]<<16)+(r[1]<<8)+r[2]){if(s=(r[4]<<8)+r[5],s&&s>e.size-6)return null;const u=r[7];192&u&&(i=536870912*(14&r[9])+4194304*(255&r[10])+16384*(254&r[11])+128*(255&r[12])+(254&r[13])/2,64&u?(a=536870912*(14&r[14])+4194304*(255&r[15])+16384*(254&r[16])+128*(255&r[17])+(254&r[18])/2,i-a>54e5&&(t.warn(`${Math.round((i-a)/9e4)}s delta between PTS and DTS, align them`),i=a)):a=i),n=r[8];let c=n+9;if(e.size<=c)return null;e.size-=c;const d=new Uint8Array(e.size);for(let e=0,t=l.length;e<t;e++){r=l[e];let t=r.byteLength;if(c){if(c>t){c-=t;continue}r=r.subarray(c),t-=c,c=0}d.set(r,o),o+=t}return s&&(s-=n+3),{data:d,pts:i,dts:a,len:s}}return null}class ui{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const ci=Math.pow(2,32)-1;class di{static init(){let e;for(e in di.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},di.types)di.types.hasOwnProperty(e)&&(di.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);di.HDLR_TYPES={video:t,audio:r};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);di.STTS=di.STSC=di.STCO=n,di.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),di.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),di.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),di.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const i=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);di.FTYP=di.box(di.types.ftyp,i,o,i,a),di.DINF=di.box(di.types.dinf,di.box(di.types.dref,s))}static box(e,...t){let r=8,s=t.length;const n=s;for(;s--;)r+=t[s].byteLength;const i=new Uint8Array(r);for(i[0]=r>>24&255,i[1]=r>>16&255,i[2]=r>>8&255,i[3]=255&r,i.set(e,4),s=0,r=8;s<n;s++)i.set(t[s],r),r+=t[s].byteLength;return i}static hdlr(e){return di.box(di.types.hdlr,di.HDLR_TYPES[e])}static mdat(e){return di.box(di.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(ci+1)),s=Math.floor(t%(ci+1));return di.box(di.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,s>>24,s>>16&255,s>>8&255,255&s,85,196,0,0]))}static mdia(e){return di.box(di.types.mdia,di.mdhd(e.timescale||0,e.duration||0),di.hdlr(e.type),di.minf(e))}static mfhd(e){return di.box(di.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?di.box(di.types.minf,di.box(di.types.smhd,di.SMHD),di.DINF,di.stbl(e)):di.box(di.types.minf,di.box(di.types.vmhd,di.VMHD),di.DINF,di.stbl(e))}static moof(e,t,r){return di.box(di.types.moof,di.mfhd(e),di.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=di.trak(e[t]);return di.box.apply(null,[di.types.moov,di.mvhd(e[0].timescale||0,e[0].duration||0)].concat(r).concat(di.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=di.trex(e[t]);return di.box.apply(null,[di.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(ci+1)),s=Math.floor(t%(ci+1)),n=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,s>>24,s>>16&255,s>>8&255,255&s,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return di.box(di.types.mvhd,n)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let s,n;for(s=0;s<t.length;s++)n=t[s].flags,r[s+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return di.box(di.types.sdtp,r)}static stbl(e){return di.box(di.types.stbl,di.stsd(e),di.box(di.types.stts,di.STTS),di.box(di.types.stsc,di.STSC),di.box(di.types.stsz,di.STSZ),di.box(di.types.stco,di.STCO))}static avc1(e){let t,r,s,n=[],i=[];for(t=0;t<e.sps.length;t++)r=e.sps[t],s=r.byteLength,n.push(s>>>8&255),n.push(255&s),n=n.concat(Array.prototype.slice.call(r));for(t=0;t<e.pps.length;t++)r=e.pps[t],s=r.byteLength,i.push(s>>>8&255),i.push(255&s),i=i.concat(Array.prototype.slice.call(r));const a=di.box(di.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|e.sps.length].concat(n).concat([e.pps.length]).concat(i))),o=e.width,l=e.height,u=e.pixelRatio[0],c=e.pixelRatio[1];return di.box(di.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,di.box(di.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),di.box(di.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,c>>24,c>>16&255,c>>8&255,255&c])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static mp4a(e){return di.box(di.types.mp4a,di.audioStsd(e),di.box(di.types.esds,di.esds(e)))}static mp3(e){return di.box(di.types[".mp3"],di.audioStsd(e))}static ac3(e){return di.box(di.types["ac-3"],di.audioStsd(e),di.box(di.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if("audio"===e.type){if("aac"===t)return di.box(di.types.stsd,di.STSD,di.mp4a(e));if("ac3"===t&&e.config)return di.box(di.types.stsd,di.STSD,di.ac3(e));if("mp3"===t&&"mp3"===e.codec)return di.box(di.types.stsd,di.STSD,di.mp3(e))}else{if(!e.pps||!e.sps)throw new Error("video track missing pps or sps");if("avc"===t)return di.box(di.types.stsd,di.STSD,di.avc1(e));if("hevc"===t&&e.vps)return di.box(di.types.stsd,di.STSD,di.hvc1(e))}throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,r=(e.duration||0)*(e.timescale||0),s=e.width||0,n=e.height||0,i=Math.floor(r/(ci+1)),a=Math.floor(r%(ci+1));return di.box(di.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,255&s,0,0,n>>8&255,255&n,0,0]))}static traf(e,t){const r=di.sdtp(e),s=e.id,n=Math.floor(t/(ci+1)),i=Math.floor(t%(ci+1));return di.box(di.types.traf,di.box(di.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s])),di.box(di.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,i>>24,i>>16&255,i>>8&255,255&i])),di.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,di.box(di.types.trak,di.tkhd(e),di.mdia(e))}static trex(e){const t=e.id;return di.box(di.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],s=r.length,n=12+16*s,i=new Uint8Array(n);let a,o,l,u,c,d;for(t+=8+n,i.set(["video"===e.type?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,255&s,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),a=0;a<s;a++)o=r[a],l=o.duration,u=o.size,c=o.flags,d=o.cts,i.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,u>>>24&255,u>>>16&255,u>>>8&255,255&u,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.paddingValue<<1|c.isNonSync,61440&c.degradPrio,15&c.degradPrio,d>>>24&255,d>>>16&255,d>>>8&255,255&d],12+16*a);return di.box(di.types.trun,i)}static initSegment(e){di.types||di.init();const t=di.moov(e);return Me(di.FTYP,t)}static hvc1(e){const t=e.params,r=[e.vps,e.sps,e.pps],s=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),3|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),r.length]);let n=s.length;for(let e=0;e<r.length;e+=1){n+=3;for(let t=0;t<r[e].length;t+=1)n+=2+r[e][t].length}const i=new Uint8Array(n);i.set(s,0),n=s.length;const a=r.length-1;for(let e=0;e<r.length;e+=1){i.set(new Uint8Array([32+e|(e===a?128:0),0,r[e].length]),n),n+=3;for(let t=0;t<r[e].length;t+=1)i.set(new Uint8Array([r[e][t].length>>8,255&r[e][t].length]),n),n+=2,i.set(r[e][t],n),n+=r[e][t].length}const o=di.box(di.types.hvcC,i),l=e.width,u=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return di.box(di.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,di.box(di.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),di.box(di.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d])))}}di.types=void 0,di.HDLR_TYPES=void 0,di.STTS=void 0,di.STSC=void 0,di.STCO=void 0,di.STSZ=void 0,di.VMHD=void 0,di.SMHD=void 0,di.STSD=void 0,di.FTYP=void 0,di.DINF=void 0;function hi(e,t,r=1,s=!1){const n=e*t*r;return s?Math.round(n):n}function fi(e,t=!1){return hi(e,1e3,1/9e4,t)}function gi(e){const{baseTime:t,timescale:r,trackId:s}=e;return`${t/r} (${t}/${r}) trackId: ${s}`}let pi,mi=null,yi=null;function vi(e,t,r,s){return{duration:t,size:r,cts:s,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class bi extends q{constructor(e,t,r,s){if(super("mp4-remuxer",s),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,null===mi){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);mi=e?parseInt(e[1]):0}if(null===yi){const e=navigator.userAgent.match(/Safari\/(\d+)/i);yi=e?parseInt(e[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;t&&e&&e.trackId===t.trackId&&e.baseTime===t.baseTime&&e.timescale===t.timescale||this.log(`Reset initPTS: ${t?gi(t):t} > ${e?gi(e):e}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e[0].pts,s=e.reduce((e,s)=>{let n=s.pts,i=n-e;return i<-4294967296&&(t=!0,n=Ei(n,r),i=n-e),i>0?e:n},r);return t&&this.debug("PTS rollover detected"),s}remux(e,t,r,s,n,i,a,o){let l,u,c,d,h,f,g=n,p=n;const m=e.pid>-1,y=t.pid>-1,v=t.samples.length,b=e.samples.length>0,E=a&&v>0||v>1;if((!m||b)&&(!y||E)||this.ISGenerated||a){if(this.ISGenerated){var S,T,w,k;const e=this.videoTrackConfig;(e&&(t.width!==e.width||t.height!==e.height||(null==(S=t.pixelRatio)?void 0:S[0])!==(null==(T=e.pixelRatio)?void 0:T[0])||(null==(w=t.pixelRatio)?void 0:w[1])!==(null==(k=e.pixelRatio)?void 0:k[1]))||!e&&E||null===this.nextAudioTs&&b)&&this.resetInitSegment()}this.ISGenerated||(c=this.generateIS(e,t,n,i));const r=this.isVideoContiguous;let s,a=-1;if(E&&(a=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!r&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,a>0){this.warn(`Dropped ${a} out of ${v} video samples due to a missing keyframe`);const e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(a),t.dropped+=a,p+=(t.samples[0].pts-e)/t.inputTimeScale,s=p}else-1===a&&(this.warn(`No keyframe found out of ${v} video samples`),f=!1);if(this.ISGenerated){if(b&&E){const r=this.getVideoStartPts(t.samples),s=(Ei(e.samples[0].pts,r)-r)/t.inputTimeScale;g+=Math.max(0,s),p+=Math.max(0,-s)}if(b){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),c=this.generateIS(e,t,n,i)),u=this.remuxAudio(e,g,this.isAudioContiguous,i,y||E||o===U?p:void 0),E){const s=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),c=this.generateIS(e,t,n,i)),l=this.remuxVideo(t,p,r,s)}}else E&&(l=this.remuxVideo(t,p,r,0));l&&(l.firstKeyFrame=a,l.independent=-1!==a,l.firstKeyFramePTS=s)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(h=Si(r,n,this._initPTS,this._initDTS)),s.samples.length&&(d=Ti(s,n,this._initPTS))),{audio:u,video:l,initSegment:c,independent:f,text:d,id3:h}}computeInitPts(e,t,r,s){const n=Math.round(r*t);let i=Ei(e,n);if(i<n+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(n-i)/t} ${s}`);i<n+t;)i+=8589934592;return i-n}generateIS(e,t,r,s){const n=e.samples,i=t.samples,a=this.typeSupported,o={},l=this._initPTS;let u,c,d,h=!l||s,f="audio/mp4",g=-1;if(h&&(u=c=1/0),e.config&&n.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(f="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3"}o.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&a.mpeg?new Uint8Array(0):di.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(g=e.id,d=e.inputTimeScale,l&&d===l.timescale?h=!1:u=c=this.computeInitPts(n[0].pts,d,r,"audio"))}if(t.sps&&t.pps&&i.length){if(t.timescale=t.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:di.initSegment([t]),metadata:{width:t.width,height:t.height}},h)if(g=t.id,d=t.inputTimeScale,l&&d===l.timescale)h=!1;else{const e=this.getVideoStartPts(i),t=Ei(i[0].dts,e),s=this.computeInitPts(t,d,r,"video"),n=this.computeInitPts(e,d,r,"video");c=Math.min(c,s),u=Math.min(u,n)}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(o).length)return this.ISGenerated=!0,h?(l&&this.warn(`Timestamps at playlist time: ${s?"":"~"}${r} ${u/d} != initPTS: ${l.baseTime/l.timescale} (${l.baseTime}/${l.timescale}) trackId: ${l.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${u/d} (${u}/${d}) trackId: ${g}`),this._initPTS={baseTime:u,timescale:d,trackId:g},this._initDTS={baseTime:c,timescale:d,trackId:g}):u=d=void 0,{tracks:o,initPTS:u,timescale:d,trackId:g}}remuxVideo(e,t,r,s){const n=e.inputTimeScale,i=e.samples,a=[],o=i.length,l=this._initPTS,u=l.baseTime*n/l.timescale;let c,d,h=this.nextVideoTs,f=8,g=this.videoSampleDuration,p=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,y=!1;if(!r||null===h){const e=u+t*n,s=i[0].pts-Ei(i[0].dts,i[0].pts);mi&&null!==h&&Math.abs(e-s-(h+u))<15e3?r=!0:h=e-s-u}const v=h+u;for(let e=0;e<o;e++){const t=i[e];t.pts=Ei(t.pts,v),t.dts=Ei(t.dts,v),t.dts<i[e>0?e-1:e].dts&&(y=!0)}y&&i.sort(function(e,t){const r=e.dts-t.dts,s=e.pts-t.pts;return r||s}),c=i[0].dts,d=i[i.length-1].dts;const b=d-c,E=b?Math.round(b/(o-1)):g||e.inputTimeScale/30;if(r){const r=c-v,s=r>E,n=r<-1;if((s||n)&&(s?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${fi(r,!0)} ms (${r}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${fi(-r,!0)} ms (${r}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!n||v>=i[0].pts||mi)){c=v;const e=i[0].pts-r;if(s)i[0].dts=c,i[0].pts=e;else{let t=!0;for(let s=0;s<i.length&&!(i[s].dts>e&&t);s++){const e=i[s].pts;if(i[s].dts-=r,i[s].pts-=r,s<i.length-1){const r=i[s+1].pts;t=r<=i[s].pts==r<=e}}}this.log(`Video: Initial PTS/DTS adjusted: ${fi(e,!0)}/${fi(c,!0)}, delta: ${fi(r,!0)} ms`)}}c=Math.max(0,c);let S=0,T=0,w=c;for(let e=0;e<o;e++){const t=i[e],r=t.units,s=r.length;let n=0;for(let e=0;e<s;e++)n+=r[e].data.length;T+=n,S+=s,t.length=n,t.dts<w?(t.dts=w,w+=E/4|0||1):w=t.dts,p=Math.min(t.pts,p),m=Math.max(t.pts,m)}d=i[o-1].dts;const k=T+4*S+8;let _;try{_=new Uint8Array(k)}catch(e){return void this.observer.emit(x.ERROR,x.ERROR,{type:C.MUX_ERROR,details:D.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:k,reason:`fail allocating video mdat ${k}`})}const A=new DataView(_.buffer);A.setUint32(0,k),_.set(di.types.mdat,4);let L=!1,R=Number.POSITIVE_INFINITY,I=Number.POSITIVE_INFINITY,P=Number.NEGATIVE_INFINITY,O=Number.NEGATIVE_INFINITY;for(let e=0;e<o;e++){const t=i[e],r=t.units;let l,c=0;for(let e=0,t=r.length;e<t;e++){const t=r[e],s=t.data,n=t.data.byteLength;A.setUint32(f,n),f+=4,_.set(s,f),f+=n,c+=4+n}if(e<o-1)g=i[e+1].dts-t.dts,l=i[e+1].pts-t.pts;else{const r=this.config,a=e>0?t.dts-i[e-1].dts:E;if(l=e>0?t.pts-i[e-1].pts:E,r.stretchShortVideoTrack&&null!==this.nextAudioTs){const e=Math.floor(r.maxBufferHole*n),i=(s?p+s*n:this.nextAudioTs+u)-t.pts;i>e?(g=i-a,g<0?g=a:L=!0,this.log(`It is approximately ${i/90} ms to the next segment; using duration ${g/90} ms for the last video frame.`)):g=a}else g=a}const d=Math.round(t.pts-t.dts);R=Math.min(R,g),P=Math.max(P,g),I=Math.min(I,l),O=Math.max(O,l),a.push(vi(t.key,g,c,d))}if(a.length)if(mi){if(mi<70){const e=a[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(yi&&O-I<P-R&&E/P<.025&&0===a[0].cts){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=c;for(let t=0,r=a.length;t<r;t++){const s=e+a[t].duration,n=e+a[t].cts;if(t<r-1){const e=s+a[t+1].cts;a[t].duration=e-n}else a[t].duration=t?a[t-1].duration:E;a[t].cts=0,e=s}}g=L||!g?E:g;const N=d+g;this.nextVideoTs=h=N-u,this.videoSampleDuration=g,this.isVideoContiguous=!0;const M={data1:di.moof(e.sequenceNumber++,c,H(e,{samples:a})),data2:_,startPTS:(p-u)/n,endPTS:(m+g-u)/n,startDTS:(c-u)/n,endDTS:h/n,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,M}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(e,t,r,s,n){const i=e.inputTimeScale,a=i/(e.samplerate?e.samplerate:i),o=this.getSamplesPerFrame(e),l=o*a,u=this._initPTS,c="mp3"===e.segmentCodec&&this.typeSupported.mpeg,d=[],h=void 0!==n;let f=e.samples,g=c?0:8,p=this.nextAudioTs||-1;const m=u.baseTime*i/u.timescale,y=m+t*i;if(this.isAudioContiguous=r=r||f.length&&p>0&&(s&&Math.abs(y-(p+m))<9e3||Math.abs(Ei(f[0].pts,y)-(p+m))<20*l),f.forEach(function(e){e.pts=Ei(e.pts,y)}),!r||p<0){const e=f.length;if(f=f.filter(e=>e.pts>=0),e!==f.length&&this.warn(`Removed ${f.length-e} of ${e} samples (initPTS ${m} / ${i})`),!f.length)return;p=0===n?0:s&&!h?Math.max(0,y-m):f[0].pts-m}if("aac"===e.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let r=0,s=p+m;r<f.length;r++){const n=f[r],a=n.pts,o=a-s,u=Math.abs(1e3*o/i);if(o<=-t*l&&h)0===r&&(this.warn(`Audio frame @ ${(a/i).toFixed(3)}s overlaps marker by ${Math.round(1e3*o/i)} ms.`),this.nextAudioTs=p=a-m,s=a);else if(o>=t*l&&u<1e4&&h){let t=Math.round(o/l);for(s=a-t*l;s<0&&t&&l;)t--,s+=l;0===r&&(this.nextAudioTs=p=s-m),this.warn(`Injecting ${t} audio frames @ ${((s-m)/i).toFixed(3)}s due to ${Math.round(1e3*o/i)} ms gap.`);for(let i=0;i<t;i++){let t=ui.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);t||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),t=n.unit.subarray()),f.splice(r,0,{unit:t,pts:s}),s+=l,r++}}n.pts=s,s+=l}}let v,b=null,E=null,S=0,T=f.length;for(;T--;)S+=f[T].unit.byteLength;for(let t=0,s=f.length;t<s;t++){const s=f[t],n=s.unit;let i=s.pts;if(null!==E){d[t-1].duration=Math.round((i-E)/a)}else{if(r&&"aac"===e.segmentCodec&&(i=p+m),b=i,!(S>0))return;S+=g;try{v=new Uint8Array(S)}catch(e){return void this.observer.emit(x.ERROR,x.ERROR,{type:C.MUX_ERROR,details:D.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:S,reason:`fail allocating audio mdat ${S}`})}if(!c){new DataView(v.buffer).setUint32(0,S),v.set(di.types.mdat,4)}}v.set(n,g);const l=n.byteLength;g+=l,d.push(vi(!0,o,l,0)),E=i}const w=d.length;if(!w)return;const k=d[d.length-1];p=E-m,this.nextAudioTs=p+a*k.duration;const _=c?new Uint8Array(0):di.moof(e.sequenceNumber++,b/a,H({},e,{samples:d}));e.samples=[];const A=(b-m)/i,L=this.nextAudioTs/i,R={data1:_,data2:v,startPTS:A,endPTS:L,startDTS:A,endDTS:L,type:"audio",hasAudio:!0,hasVideo:!1,nb:w};return this.isAudioContiguous=!0,R}}function Ei(e,t){let r;if(null===t)return e;for(r=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=r;return e}function Si(e,t,r,s){const n=e.samples.length;if(!n)return;const i=e.inputTimeScale;for(let a=0;a<n;a++){const n=e.samples[a];n.pts=Ei(n.pts-r.baseTime*i/r.timescale,t*i)/i,n.dts=Ei(n.dts-s.baseTime*i/s.timescale,t*i)/i}const a=e.samples;return e.samples=[],{samples:a}}function Ti(e,t,r){const s=e.samples.length;if(!s)return;const n=e.inputTimeScale;for(let i=0;i<s;i++){const s=e.samples[i];s.pts=Ei(s.pts-r.baseTime*n/r.timescale,t*n)/n}e.samples.sort((e,t)=>e.pts-t.pts);const i=e.samples;return e.samples=[],{samples:i}}function wi(e,t,r=!1){return void 0!==(null==e?void 0:e.start)?(e.start+(r?e.duration:0))/e.timescale:t}function ki(e,t,r){const s=e.codec;if(s&&s.length>4)return s;if(t===ce){if("ec-3"===s||"ac-3"===s||"alac"===s)return s;if("fLaC"===s||"Opus"===s){return et(s,!1)}return r.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"}return r.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1"}try{pi=self.performance.now.bind(self.performance)}catch(e){pi=Date.now}const _i=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,s){const n=this.videoTrack=Dn("video",1),i=this.audioTrack=Dn("audio",1),a=this.txtTrack=Dn("text",1);if(this.id3Track=Dn("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const o=Re(e);if(o.video){const{id:e,timescale:t,codec:r,supplemental:s}=o.video;n.id=e,n.timescale=a.timescale=t,n.codec=r,n.supplemental=s}if(o.audio){const{id:e,timescale:t,codec:r}=o.audio;i.id=e,i.timescale=t,i.codec=r}a.id=Ee.text,n.sampleDuration=0,n.duration=i.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return function(e){const t=e.byteLength;for(let r=0;r<t;){const s=we(e,r);if(s>8&&109===e[r+4]&&111===e[r+5]&&111===e[r+6]&&102===e[r+7])return!0;r=s>1?r+s:t}return!1}(e)}demux(e,t){this.timeOffset=t;let r=e;const s=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Me(this.remainderData,e));const t=function(e){const t={valid:null,remainder:null},r=Ae(e,["moof"]);if(r.length<2)return t.remainder=e,t;const s=r[r.length-1];return t.valid=e.slice(0,s.byteOffset-8),t.remainder=e.slice(s.byteOffset-8),t}(r);this.remainderData=t.remainder,s.samples=t.valid||new Uint8Array}else s.samples=r;const i=this.extractID3Track(s,t);return n.samples=Fe(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:i,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return r.samples=Fe(e,t),{videoTrack:t,audioTrack:Dn(),id3Track:s,textTrack:Dn()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const s=Ae(e.samples,["emsg"]);s&&s.forEach(e=>{const s=function(e){const t=e[0];let r="",s="",n=0,i=0,a=0,o=0,l=0,u=0;if(0===t){for(;"\0"!==Se(e.subarray(u,u+1));)r+=Se(e.subarray(u,u+1)),u+=1;for(r+=Se(e.subarray(u,u+1)),u+=1;"\0"!==Se(e.subarray(u,u+1));)s+=Se(e.subarray(u,u+1)),u+=1;s+=Se(e.subarray(u,u+1)),u+=1,n=we(e,12),i=we(e,16),o=we(e,20),l=we(e,24),u=28}else if(1===t){u+=4,n=we(e,u),u+=4;const t=we(e,u);u+=4;const i=we(e,u);for(u+=4,a=2**32*t+i,I(a)||(a=Number.MAX_SAFE_INTEGER,Z.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=we(e,u),u+=4,l=we(e,u),u+=4;"\0"!==Se(e.subarray(u,u+1));)r+=Se(e.subarray(u,u+1)),u+=1;for(r+=Se(e.subarray(u,u+1)),u+=1;"\0"!==Se(e.subarray(u,u+1));)s+=Se(e.subarray(u,u+1)),u+=1;s+=Se(e.subarray(u,u+1)),u+=1}return{schemeIdUri:r,value:s,timeScale:n,presentationTime:a,presentationTimeDelta:i,eventDuration:o,id:l,payload:e.subarray(u,e.byteLength)}}(e);if(Wn.test(s.schemeIdUri)){const e=Yn(s,t);let n=4294967295===s.eventDuration?Number.POSITIVE_INFINITY:s.eventDuration/s.timeScale;n<=.001&&(n=Number.POSITIVE_INFINITY);const i=s.payload;r.samples.push({data:i,len:i.byteLength,dts:e,pts:e,type:Cn.emsg,duration:n})}else if(this.config.enableEmsgKLVMetadata&&s.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const e=Yn(s,t);r.samples.push({data:s.payload,len:s.payload.byteLength,dts:e,pts:e,type:Cn.misbklv,duration:Number.POSITIVE_INFINITY})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}},remux:class extends q{constructor(e,t,r,s){super("passthrough-remuxer",s),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,r,s){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(e,s),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:r,videoCodec:s}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const{audio:n,video:i}=this.initData=Re(e);if(t)!function(e,t){if(!e||!t)return;const r=t.keyId;r&&t.isCommonEncryption&&Oe(e,(e,t)=>{const s=e.subarray(8,24);s.some(e=>0!==e)||(Z.log(`[eme] Patching keyId in 'enc${t?"a":"v"}>sinf>>tenc' box: ${se(s)} -> ${se(r)}`),e.set(r,8))})}(e,t);else{const e=n||i;null!=e&&e.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${e.codec}")!`)}n&&(r=ki(n,ce,this)),i&&(s=ki(i,de,this));const a={};n&&i?a.audiovideo={container:"video/mp4",codec:r+","+s,supplemental:i.supplemental,encrypted:i.encrypted,initSegment:e,id:"main"}:n?a.audio={container:"audio/mp4",codec:r,encrypted:n.encrypted,initSegment:e,id:"audio"}:i?a.video={container:"video/mp4",codec:s,supplemental:i.supplemental,encrypted:i.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(e,t,r,s,n,i){var a,o;let{initPTS:l,lastEndTime:u}=this;const c={audio:void 0,video:void 0,text:s,id3:r,initSegment:void 0};R(u)||(u=this.lastEndTime=n||0);const d=t.samples;if(!d.length)return c;const h={initPTS:void 0,timescale:void 0,trackId:void 0};let f=this.initData;if(null!=(a=f)&&a.length||(this.generateInitSegment(d),f=this.initData),null==(o=f)||!o.length)return this.warn("Failed to generate initSegment."),c;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);const g=function(e,t,r){const s={},n=Ae(e,["moof","traf"]);for(let e=0;e<n.length;e++){const i=n[e],a=Ae(i,["tfhd"])[0],o=we(a,4),l=t[o];if(!l)continue;s[o]||(s[o]={start:NaN,duration:0,sampleCount:0,timescale:l.timescale,type:l.type});const u=s[o],c=Ae(i,["tfdt"])[0];if(c){const e=c[0];let t=we(c,4);1===e&&(t===ve?r.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(t*=ve+1,t+=we(c,8))),R(t)&&(!R(u.start)||t<u.start)&&(u.start=t)}const d=l.default,h=we(a,0)|(null==d?void 0:d.flags);let f=(null==d?void 0:d.duration)||0;8&h&&(f=we(a,2&h?12:8));const g=Ae(i,["trun"]);let p=u.start||0,m=0,y=f;for(let e=0;e<g.length;e++){const t=g[e],r=we(t,4),s=u.sampleCount;u.sampleCount+=r;const n=1&t[3],i=4&t[3],a=1&t[2],o=2&t[2],l=4&t[2],c=8&t[2];let d=8,h=r;for(n&&(d+=4),i&&r&&(1&t[d+1]||void 0!==u.keyFrameIndex||(u.keyFrameIndex=s),d+=4,a?(y=we(t,d),d+=4):y=f,o&&(d+=4),c&&(d+=4),p+=y,m+=y,h--);h--;)a?(y=we(t,d),d+=4):y=f,o&&(d+=4),l&&(1&t[d+1]||void 0===u.keyFrameIndex&&(u.keyFrameIndex=u.sampleCount-(h+1),u.keyFrameStart=p),d+=4),c&&(d+=4),p+=y,m+=y;!m&&f&&(m+=f*r)}u.duration+=m}if(!Object.keys(s).some(e=>s[e].duration)){let t=1/0,r=0;const n=Ae(e,["sidx"]);for(let e=0;e<n.length;e++){const s=Le(n[e]);if(null!=s&&s.references){t=Math.min(t,s.earliestPresentationTime/s.timescale);const e=s.references.reduce((e,t)=>e+t.info.duration||0,0);r=Math.max(r,e+s.earliestPresentationTime/s.timescale)}}r&&R(r)&&Object.keys(s).forEach(e=>{s[e].duration||(s[e].duration=r*s[e].timescale-s[e].start)})}return s}(d,f,this),p=f.audio?g[f.audio.id]:null,m=f.video?g[f.video.id]:null,y=wi(m,1/0),v=wi(p,1/0),b=wi(m,0,!0),E=wi(p,0,!0);let S=n,T=0;const w=p&&(!m||!l&&v<y||l&&l.trackId===f.audio.id),k=w?p:m;if(k){const e=k.timescale,t=k.start-n*e,r=w?f.audio.id:f.video.id;S=k.start/e,T=w?E-v:b-y,!i&&l||!function(e,t,r,s){if(null===e)return!0;const n=Math.max(s,1),i=t-e.baseTime/e.timescale;return Math.abs(i-r)>n}(l,S,n,T)&&e===l.timescale||(l&&this.warn(`Timestamps at playlist time: ${i?"":"~"}${n} ${t/e} != initPTS: ${l.baseTime/l.timescale} (${l.baseTime}/${l.timescale}) trackId: ${l.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${S-n} (${t}/${e}) trackId: ${r}`),l=null,h.initPTS=t,h.timescale=e,h.trackId=r)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${n}`);l?(h.initPTS=l.baseTime,h.timescale=l.timescale,h.trackId=l.trackId):(h.timescale&&void 0!==h.trackId&&void 0!==h.initPTS||(this.warn("Could not set initPTS"),h.initPTS=S,h.timescale=1,h.trackId=-1),this.initPTS=l={baseTime:h.initPTS,timescale:h.timescale,trackId:h.trackId});const _=S-l.baseTime/l.timescale,A=_+T;T>0?this.lastEndTime=A:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const L=!!f.audio,I=!!f.video;let P="";L&&(P+="audio"),I&&(P+="video");const C={data1:d,startPTS:_,startDTS:_,endPTS:A,endDTS:A,type:P,hasAudio:L,hasVideo:I,nb:1,dropped:0,encrypted:!!f.audio&&f.audio.encrypted||!!f.video&&f.video.encrypted};c.audio=L&&!I?C:void 0,c.video=I?C:void 0;const D=null==m?void 0:m.sampleCount;if(D){const e=m.keyFrameIndex,t=-1!==e;C.nb=D,C.dropped=0===e||this.isVideoContiguous?0:t?e:D,C.independent=t,C.firstKeyFrame=e,t&&m.keyFrameStart&&(C.firstKeyFramePTS=(m.keyFrameStart-l.baseTime)/l.timescale),this.isVideoContiguous||(c.independent=t),this.isVideoContiguous||(this.isVideoContiguous=t),C.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${e}/${D} dropped: ${C.dropped} start: ${C.firstKeyFramePTS||"NA"}`)}return c.initSegment=h,c.id3=Si(r,n,l,l),s.samples.length&&(c.text=Ti(s,n,l)),c}}},{demux:ri,remux:bi},{demux:class extends xn{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const r=fn(e,0);let s=(null==r?void 0:r.length)||0;if(Hn(e,s))return!1;for(let r=e.length;s<r;s++)if(vn(e,s))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&gn(e,t)&&mn(e,t)<=e.length-t}(e,t)}appendFrame(e,t,r){bn(e,this.observer,t,r,e.manifestCodec);const s=Sn(e,t,r,this.basePTS,this.frameIndex);if(s&&0===s.missing)return s}},remux:bi},{demux:class extends xn{resetInitSegment(e,t,r,s){super.resetInitSegment(e,t,r,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=fn(e,0);let r=(null==t?void 0:t.length)||0;if(t&&11===e[r]&&119===e[r+1]&&void 0!==Pn(t)&&Vn(e,r)<=16)return!1;for(let t=e.length;r<t;r++)if(Hn(e,r))return Z.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return Gn(e,t)&&4<=e.length-t}(e,t)}appendFrame(e,t,r){if(null!==this.basePTS)return Bn(e,t,r,this.basePTS,this.frameIndex)}},remux:bi}];_i.splice(2,0,{demux:zn,remux:bi});class Ai{constructor(e,t,r,s,n,i){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.id=n,this.logger=i}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,s){const n=r.transmuxing;n.executeStart=pi();let i=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:o}=this;s&&(this.currentTransmuxState=s);const{contiguous:l,discontinuity:u,trackSwitch:c,accurateTimeOffset:d,timeOffset:h,initSegmentChange:f}=s||a,{audioCodec:g,videoCodec:p,defaultInitPts:m,duration:y,initSegmentData:v}=o,b=function(e,t){let r=null;e.byteLength>0&&null!=(null==t?void 0:t.key)&&null!==t.iv&&null!=t.method&&(r=t);return r}(i,t);if(b&&Fr(b.method)){const e=this.getDecrypter(),t=$r(b.method);if(!e.isSync())return this.asyncResult=!0,this.decryptionPromise=e.webCryptoDecrypt(i,b.key.buffer,b.iv.buffer,t).then(e=>{const t=this.push(e,null,r);return this.decryptionPromise=null,t}),this.decryptionPromise;{let s=e.softwareDecrypt(i,b.key.buffer,b.iv.buffer,t);if(r.part>-1){const t=e.flush();s=t?t.buffer:t}if(!s)return n.executeEnd=pi(),Li(r);i=new Uint8Array(s)}}const E=this.needsProbing(u,c);if(E){const e=this.configureTransmuxer(i);if(e)return this.logger.warn(`[transmuxer] ${e.message}`),this.observer.emit(x.ERROR,x.ERROR,{type:C.MEDIA_ERROR,details:D.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),n.executeEnd=pi(),Li(r)}(u||c||f||E)&&this.resetInitSegment(v,g,p,y,t),(u||f||E)&&this.resetInitialTimestamp(m),l||this.resetContiguity();const S=this.transmux(i,b,h,d,r);this.asyncResult=Ri(S);const T=this.currentTransmuxState;return T.contiguous=!0,T.discontinuity=!1,T.trackSwitch=!1,n.executeEnd=pi(),S}flush(e){const t=e.transmuxing;t.executeStart=pi();const{decrypter:r,currentTransmuxState:s,decryptionPromise:n}=this;if(n)return this.asyncResult=!0,n.then(()=>this.flush(e));const i=[],{timeOffset:a}=s;if(r){const t=r.flush();t&&i.push(this.push(t.buffer,null,e))}const{demuxer:o,remuxer:l}=this;if(!o||!l){t.executeEnd=pi();const r=[Li(e)];return this.asyncResult?Promise.resolve(r):r}const u=o.flush(a);return Ri(u)?(this.asyncResult=!0,u.then(t=>(this.flushRemux(i,t,e),i))):(this.flushRemux(i,u,e),this.asyncResult?Promise.resolve(i):i)}flushRemux(e,t,r){const{audioTrack:s,videoTrack:n,id3Track:i,textTrack:a}=t,{accurateTimeOffset:o,timeOffset:l}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${r.sn}${r.part>-1?" part: "+r.part:""} of ${this.id===$?"level":"track"} ${r.level}`);const u=this.remuxer.remux(s,n,i,a,l,o,!0,this.id);e.push({remuxResult:u,chunkMeta:r}),r.transmuxing.executeEnd=pi()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;t&&r&&(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,s,n){const{demuxer:i,remuxer:a}=this;i&&a&&(i.resetInitSegment(e,t,r,s),a.resetInitSegment(e,t,r,n))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,s,n){let i;return i=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,r,s,n):this.transmuxUnencrypted(e,r,s,n),i}transmuxUnencrypted(e,t,r,s){const{audioTrack:n,videoTrack:i,id3Track:a,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(n,i,a,o,t,r,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,r,s,n){return this.demuxer.demuxSampleAes(e,t,r).then(e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,r,s,!1,this.id),chunkMeta:n}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:s}=this;let n;for(let t=0,r=_i.length;t<r;t++){var i;if(null!=(i=_i[t].demux)&&i.probe(e,this.logger)){n=_i[t];break}}if(!n)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,o=this.remuxer,l=n.remux,u=n.demux;o&&o instanceof l||(this.remuxer=new l(r,t,s,this.logger)),a&&a instanceof u||(this.demuxer=new u(r,t,s,this.logger),this.probe=u.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new fr(this.config)),e}}const Li=e=>({remuxResult:{},chunkMeta:e});function Ri(e){return"then"in e&&e.then instanceof Function}class Ii{constructor(e,t,r,s,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=s,this.defaultInitPts=n||null}}class Pi{constructor(e,t,r,s,n,i){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=s,this.timeOffset=n,this.initSegmentChange=i}}let Ci=0;class Di{constructor(e,t,r,s){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Ci++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=e=>{const t=e.data,r=this.hls;if(r&&null!=t&&t.event&&t.instanceNo===this.instanceNo)switch(t.event){case"init":{var s;const e=null==(s=this.workerContext)?void 0:s.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":r.logger[t.data.logType]&&r.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.part=this.part,t.data.id=this.id,r.trigger(t.event,t.data)}},this.onWorkerError=e=>{if(!this.hls)return;const t=new Error(`${e.message}  (${e.filename}:${e.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(x.ERROR,{type:C.OTHER_ERROR,details:D.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:t})};const n=e.config;this.hls=e,this.id=t,this.useWorker=!!n.enableWorker,this.onTransmuxComplete=r,this.onFlush=s;const i=(e,t)=>{(t=t||{}).frag=this.frag||void 0,e===x.ERROR&&(t.parent=this.id,t.part=this.part,this.error=t.error),this.hls.trigger(e,t)};this.observer=new on,this.observer.on(x.FRAG_DECRYPTED,i),this.observer.on(x.ERROR,i);const a=nt(n.preferManagedMediaSource);if(this.useWorker&&"undefined"!=typeof Worker){const r=this.hls.logger;if(n.workerPath||"function"==typeof __HLS_WORKER_BUNDLE__){try{n.workerPath?(r.log(`loading Web Worker ${n.workerPath} for "${t}"`),this.workerContext=function(e){const t=un[e];if(t)return t.clientCount++,t;const r=new self.URL(e,self.location.href).href,s={worker:new self.Worker(r),scriptURL:r,clientCount:1};return un[e]=s,s}(n.workerPath)):(r.log(`injecting Web Worker for "${t}"`),this.workerContext=function(){const e=un[ln];if(e)return e.clientCount++,e;const t=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),r=self.URL.createObjectURL(t),s={worker:new self.Worker(r),objectURL:r,clientCount:1};return un[ln]=s,s}());const{worker:e}=this.workerContext;e.addEventListener("message",this.onWorkerMessage),e.addEventListener("error",this.onWorkerError),e.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:a,id:t,config:wt(n)})}catch(s){r.warn(`Error setting up "${t}" Web Worker, fallback to inline`,s),this.terminateWorker(),this.error=null,this.transmuxer=new Ai(this.observer,a,n,"",t,e.logger)}return}}this.transmuxer=new Ai(this.observer,a,n,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Ci++;const t=this.hls.config,r=nt(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:r,id:this.id,config:wt(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),function(e){const t=un[e||ln];if(t&&1===t.clientCount--){const{worker:r,objectURL:s}=t;delete un[e||ln],s&&self.URL.revokeObjectURL(s),r.terminate()}}(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,r,s,n,i,a,o,l,u){var c,d;l.transmuxing.start=self.performance.now();const{instanceNo:h,transmuxer:f}=this,g=i?i.start:n.start,p=n.decryptdata,m=this.frag,y=!(m&&n.cc===m.cc),v=!(m&&l.level===m.level),b=m?l.sn-m.sn:-1,E=this.part?l.part-this.part.index:-1,S=0===b&&l.id>1&&l.id===(null==m?void 0:m.stats.chunkCount),T=!v&&(1===b||0===b&&(1===E||S&&E<=0)),w=self.performance.now();(v||b||0===n.stats.parsing.start)&&(n.stats.parsing.start=w),!i||!E&&T||(i.stats.parsing.start=w);const k=!(m&&(null==(c=n.initSegment)?void 0:c.url)===(null==(d=m.initSegment)?void 0:d.url)),_=new Pi(y,T,o,v,g,k);if(!T||y||k){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${n.type} sn: ${l.sn}${l.part>-1?" part: "+l.part:""} ${this.id===$?"level":"track"}: ${l.level} id: ${l.id}\n        discontinuity: ${y}\n        trackSwitch: ${v}\n        contiguous: ${T}\n        accurateTimeOffset: ${o}\n        timeOffset: ${g}\n        initSegmentChange: ${k}`);const e=new Ii(r,s,t,a,u);this.configureTransmuxer(e)}if(this.frag=n,this.part=i,this.workerContext)this.workerContext.worker.postMessage({instanceNo:h,cmd:"demux",data:e,decryptdata:p,chunkMeta:l,state:_},e instanceof ArrayBuffer?[e]:[]);else if(f){const t=f.push(e,p,l,_);Ri(t)?t.then(e=>{this.handleTransmuxComplete(e)}).catch(e=>{this.transmuxerError(e,l,"transmuxer-interface push error")}):this.handleTransmuxComplete(t)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:r}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(r){const t=r.flush(e);Ri(t)?t.then(t=>{this.handleFlushResult(t,e)}).catch(t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")}):this.handleFlushResult(t,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(x.ERROR,{type:C.MEDIA_ERROR,details:D.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(e=>{this.handleTransmuxComplete(e)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:r}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):r&&r.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class xi extends q{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const s=null==t?void 0:t.renditionReports;if(s){let n=-1;for(let r=0;r<s.length;r++){const i=s[r];let a;try{a=new self.URL(i.URI,t.url).href}catch(e){this.warn(`Could not construct new URL for Rendition Report: ${e}`),a=i.URI||""}if(a===e){n=r;break}a===e.substring(0,a.length)&&(n=r)}if(-1!==n){const e=s[n],i=parseInt(e["LAST-MSN"])||t.lastPartSn;let a=parseInt(e["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const e=Math.min(t.age-t.partTarget,t.targetduration);a>=0&&e>t.partTarget&&(a+=1)}const o=r&&vt(r);return new bt(i,a>=0?a:void 0,o)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}return e}playlistLoaded(e,t,r){const{details:s,stats:n}=t,i=self.performance.now(),a=n.loading.first?Math.max(0,i-n.loading.first):0;s.advancedDateTime=Date.now()-a;const o=this.hls.config.timelineOffset;if(o!==s.appliedTimelineOffset){const e=Math.max(o||0,0);s.appliedTimelineOffset=e,s.fragments.forEach(t=>{t.setStart(t.playlistOffset+e)})}if(s.live||null!=r&&r.live){const o="levelInfo"in t?t.levelInfo:t.track;if(s.reloaded(r),r&&s.fragments.length>0){ws(r,s,this);const e=s.playlistParsingError;if(e){this.warn(e);const r=this.hls;if(!r.config.ignorePlaylistParsingErrors){var l;const{networkDetails:i}=t;return void r.trigger(x.ERROR,{type:C.NETWORK_ERROR,details:D.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:e,reason:e.message,level:t.level||void 0,parent:null==(l=s.fragments[0])?void 0:l.type,networkDetails:i,stats:n})}s.playlistParsingError=null}}-1===s.requestScheduled&&(s.requestScheduled=n.loading.start);const u=this.hls.mainForwardBufferInfo,c=u?u.end-u.len:0,d=Ls(s,1e3*(s.edge-c));if(s.requestScheduled+d<i?s.requestScheduled=i:s.requestScheduled+=d,this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),!this.canLoad||!s.live)return;let h,f,g;if(s.canBlockReload&&s.endSN&&s.advanced){const e=this.hls.config.lowLatencyMode,n=s.lastPartSn,a=s.endSN,l=s.lastPartIndex,u=n===a;-1!==l?u?(f=a+1,g=e?0:l):(f=n,g=e?l+1:s.maxPartIndex):f=a+1;const c=s.age,d=c+s.ageHeader;let p=Math.min(d-s.partTarget,1.5*s.targetduration);if(p>0){if(d>3*s.targetduration)this.log(`Playlist last advanced ${c.toFixed(2)}s ago. Omitting segment and part directives.`),f=void 0,g=void 0;else if(null!=r&&r.tuneInGoal&&d-s.partTarget>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${p} with playlist age: ${s.age}`),p=0;else{const e=Math.floor(p/s.targetduration);if(f+=e,void 0!==g){g+=Math.round(p%s.targetduration/s.partTarget)}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${c.toFixed(2)}s goal: ${p} skip sn ${e} to part ${g}`)}s.tuneInGoal=p}if(h=this.getDeliveryDirectives(s,t.deliveryDirectives,f,g),e||!u)return s.requestScheduled=i,void this.loadingPlaylist(o,h)}else(s.canBlockReload||s.canSkipUntil)&&(h=this.getDeliveryDirectives(s,t.deliveryDirectives,f,g));h&&void 0!==f&&s.canBlockReload&&(s.requestScheduled=n.loading.first+Math.max(d-2*a,d/2)),this.scheduleLoading(o,h,s)}else this.clearTimer()}scheduleLoading(e,t,r){const s=r||e.details;if(!s)return void this.loadingPlaylist(e,t);const n=self.performance.now(),i=s.requestScheduled;if(n>=i)return void this.loadingPlaylist(e,t);const a=i-n;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(a)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),a)}getDeliveryDirectives(e,t,r,s){let n=vt(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,s=t.part,n=pt),new bt(r,s,n)}checkRetry(e){const t=e.details,r=Ft(e),s=e.errorAction,{action:n,retryCount:i=0,retryConfig:a}=s||{},o=!!s&&!!a&&(n===Wt||!s.resolved&&n===zt);if(o){var l;if(i>=a.maxNumRetry)return!1;if(r&&null!=(l=e.context)&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${i+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const e=jt(a,i);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),e),this.warn(`Retrying playlist loading ${i+1}/${a.maxNumRetry} after "${t}" in ${e}ms`)}e.levelRetry=!0,s.resolved=!0}return o}}function Oi(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!Ni(e[r].attrs,t[r].attrs))return!1;return!0}function Ni(e,t,r){const s=e["STABLE-RENDITION-ID"];return s&&!r?s===t["STABLE-RENDITION-ID"]:!(r||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>e[r]!==t[r])}function Mi(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}class Fi{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,r){if(null===this.queues||null===this.tracks)return;const s=this.queues[t];s.push(e),1!==s.length||r||this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const r={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(r,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const r={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(r)}})}removeBlockers(){null!==this.queues&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const r=null==(t=e[0])?void 0:t.label;"async-blocker"!==r&&"async-blocker-prepend"!==r||(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(null===this.queues)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(null===this.queues||null===this.tracks)return;const t=this.queues[e];if(t.length){const s=t[0];try{s.execute()}catch(t){var r;if(s.onError(t),null===this.queues||null===this.tracks)return;const n=null==(r=this.tracks[e])?void 0:r.buffer;null!=n&&n.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){null!==this.queues&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return(null==(t=this.queues)?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return null===e||null===t?"<destroyed>":`\n${this.list("video")}\n${this.list("audio")}\n${this.list("audiovideo")}}`}list(e){var t,r;return null!=(t=this.queues)&&t[e]||null!=(r=this.tracks)&&r[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const r=null==(t=this.tracks)?void 0:t[e],s=null==r?void 0:r.buffer;return s?`SourceBuffer${s.updating?" updating":""}${r.ended?" ended":""}${r.ending?" ending":""}`:"none"}listOps(e){var t;return(null==(t=this.queues)?void 0:t[e].map(e=>e.label).join(", "))||""}}const $i=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Ui="HlsJsTrackRemovedError";class Bi extends Error{constructor(e){super(e),this.name=Ui}}function ji(e){const t=e.querySelectorAll("source");[].slice.call(t).forEach(t=>{e.removeChild(t)})}function Gi(e){return"audio"===e?1:0}class Ki{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(x.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.BUFFER_CODECS,this.onBufferCodecs,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(x.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.BUFFER_CODECS,this.onBufferCodecs,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&R(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((t,r)=>this.isLevelAllowed(t)&&r<=e);return this.clientRect=null,Ki.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,t.width||t.height||(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(e){}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height)}static getMaxLevelByMediaSize(e,t,r){if(null==e||!e.length)return-1;const s=(e,t)=>!t||(e.width!==t.width||e.height!==t.height);let n=e.length-1;const i=Math.max(t,r);for(let t=0;t<e.length;t+=1){const r=e[t];if((r.width>=i||r.height>=i)&&s(r,e[t+1])){n=t;break}}return n}}const Hi={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Vi={HLS:"h"};class zi{constructor(e,t){Array.isArray(e)&&(e=e.map(e=>e instanceof zi?e:new zi(e))),this.value=e,this.params=t}}function qi(e,t,r,s){return new Error(`failed to ${e} "${n=t,Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":"object"==typeof n?JSON.stringify(n):String(n)}" as ${r}`,{cause:s});var n}function Wi(e,t,r){return qi("serialize",e,t,r)}class Yi{constructor(e){this.description=e}}const Qi="Bare Item";function Xi(e){if(!1===ArrayBuffer.isView(e))throw Wi(e,"Byte Sequence");return`:${t=e,btoa(String.fromCharCode(...t))}:`;var t}function Ji(e){if(function(e){return e<-999999999999999||999999999999999<e}(e))throw Wi(e,"Integer");return e.toString()}function Zi(e,t){if(e<0)return-Zi(-e,t);const r=Math.pow(10,t);if(Math.abs(e*r%1-.5)<Number.EPSILON){const t=Math.floor(e*r);return(t%2==0?t:t+1)/r}return Math.round(e*r)/r}function ea(e){const t=Zi(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw Wi(e,"Decimal");const r=t.toString();return r.includes(".")?r:`${r}.0`}const ta=/[\x00-\x1f\x7f]+/;function ra(e){const t=(r=e).description||r.toString().slice(7,-1);var r;if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw Wi(t,"Token");return t}function sa(e){switch(typeof e){case"number":if(!R(e))throw Wi(e,Qi);return Number.isInteger(e)?Ji(e):ea(e);case"string":return function(e){if(ta.test(e))throw Wi(e,"String");return`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}(e);case"symbol":return ra(e);case"boolean":return function(e){if("boolean"!=typeof e)throw Wi(e,"Boolean");return e?"?1":"?0"}(e);case"object":if(e instanceof Date)return function(e){return`@${Ji(e.getTime()/1e3)}`}(e);if(e instanceof Uint8Array)return Xi(e);if(e instanceof Yi)return ra(e);default:throw Wi(e,Qi)}}function na(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw Wi(e,"Key");return e}function ia(e){return null==e?"":Object.entries(e).map(([e,t])=>!0===t?`;${na(e)}`:`;${na(e)}=${sa(t)}`).join("")}function aa(e){return e instanceof zi?`${sa(e.value)}${ia(e.params)}`:sa(e)}function oa(e,t={whitespace:!0}){if("object"!=typeof e||null==e)throw Wi(e,"Dict");const r=e instanceof Map?e.entries():Object.entries(e),s=(null==t?void 0:t.whitespace)?" ":"";return Array.from(r).map(([e,t])=>{t instanceof zi==!1&&(t=new zi(t));let r=na(e);var s;return!0===t.value?r+=ia(t.params):(r+="=",Array.isArray(t.value)?r+=`(${(s=t).value.map(aa).join(" ")})${ia(s.params)}`:r+=aa(t)),r}).join(`,${s}`)}function la(e,t){return oa(e,t)}const ua="CMCD-Object",ca="CMCD-Request",da="CMCD-Session",ha="CMCD-Status",fa={br:ua,ab:ua,d:ua,ot:ua,tb:ua,tpb:ua,lb:ua,tab:ua,lab:ua,url:ua,pb:ca,bl:ca,tbl:ca,dl:ca,ltc:ca,mtp:ca,nor:ca,nrr:ca,rc:ca,sn:ca,sta:ca,su:ca,ttfb:ca,ttfbb:ca,ttlb:ca,cmsdd:ca,cmsds:ca,smrt:ca,df:ca,cs:ca,ts:ca,cid:da,pr:da,sf:da,sid:da,st:da,v:da,msd:da,bs:ha,bsd:ha,cdn:ha,rtp:ha,bg:ha,pt:ha,ec:ha,e:ha},ga=ca;function pa(e,t){const r={};if(!e)return r;const s=Object.keys(e),n=t?(i=t,Object.keys(i).reduce((e,t)=>{var r;return null===(r=i[t])||void 0===r||r.forEach(r=>e[r]=t),e},{})):{};var i;return s.reduce((t,r)=>{var s;const i=fa[r]||n[r]||ga;return(null!==(s=t[i])&&void 0!==s?s:t[i]={})[r]=e[r],t},r)}const ma="event";const ya=e=>Math.round(e),va=(e,t)=>Array.isArray(e)?e.map(e=>va(e,t)):e instanceof zi&&"string"==typeof e.value?new zi(va(e.value,t),e.params):(t.baseUrl&&(e=function(e,t){const r=new URL(e),s=new URL(t);if(r.origin!==s.origin)return e;const n=r.pathname.split("/").slice(1),i=s.pathname.split("/").slice(1,-1);for(;n[0]===i[0];)n.shift(),i.shift();for(;i.length;)i.shift(),n.unshift("..");return n.join("/")+r.search+r.hash}(e,t.baseUrl)),1===t.version?encodeURIComponent(e):e),ba=e=>100*ya(e/100),Ea={br:ya,d:ya,bl:ba,dl:ba,mtp:ba,nor:(e,t)=>{let r=e;return t.version>=2&&(e instanceof zi&&"string"==typeof e.value?r=new zi([e]):"string"==typeof e&&(r=[e])),va(r,t)},rtp:ba,tb:ya},Sa="request",Ta="response",wa=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],ka=["e"],_a=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Aa(e){return _a.test(e)}const La=["d","dl","nor","ot","rtp","su"];const Ra=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];const Ia=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function Pa(e){return Ia.includes(e)||Aa(e)}const Ca={[Ta]:function(e){return wa.includes(e)||La.includes(e)||Ra.includes(e)||Aa(e)},[ma]:function(e){return wa.includes(e)||ka.includes(e)||Aa(e)},[Sa]:function(e){return wa.includes(e)||La.includes(e)||Aa(e)}};function Da(e,t={}){const r={};if(null==e||"object"!=typeof e)return r;const s=t.version||e.v||1,n=t.reportingMode||Sa,i=1===s?Pa:Ca[n];let a=Object.keys(e).filter(i);const o=t.filter;"function"==typeof o&&(a=a.filter(o));const l=n===Ta||n===ma;l&&!a.includes("ts")&&a.push("ts"),s>1&&!a.includes("v")&&a.push("v");const u=H({},Ea,t.formatters),c={version:s,reportingMode:n,baseUrl:t.baseUrl};return a.sort().forEach(t=>{let n=e[t];const i=u[t];if("function"==typeof i&&(n=i(n,c)),"v"===t){if(1===s)return;n=s}"pr"==t&&1===n||(l&&"ts"===t&&!R(n)&&(n=Date.now()),function(e){return"number"==typeof e?R(e):null!=e&&""!==e&&!1!==e}(n)&&(function(e){return["ot","sf","st","e","sta"].includes(e)}(t)&&"string"==typeof n&&(n=new Yi(n)),r[t]=n))}),r}function xa(e,t,r){return H(e,function(e,t={}){const r={};if(!e)return r;const s=pa(Da(e,t),null==t?void 0:t.customHeaderMap);return Object.entries(s).reduce((e,[t,r])=>{const s=la(r,{whitespace:!1});return s&&(e[t]=s),e},r)}(t,r))}function Oa(e,t={}){if(!e)return"";const r=function(e,t={}){return e?la(Da(e,t),{whitespace:!1}):""}(e,t);return encodeURIComponent(r)}const Na=/CMCD=[^&#]+/;function Ma(e,t,r){const s=function(e,t={}){return e?`CMCD=${Oa(e,t)}`:""}(t,r);if(!s)return e;if(Na.test(e))return e.replace(Na,s);const n=e.includes("?")?"&":"?";return`${e}${n}${s}`}function Fa(e,t,r,s){e&&Object.keys(t).forEach(n=>{const i=e.filter(e=>e.groupId===n).map(e=>{const i=H({},e);return i.details=void 0,i.attrs=new Pr(i.attrs),i.url=i.attrs.URI=$a(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",r),i.groupId=i.attrs["GROUP-ID"]=t[n],i.attrs["PATHWAY-ID"]=s,i});e.push(...i)})}function $a(e,t,r,s){const{HOST:n,PARAMS:i,[r]:a}=s;let o;t&&(o=null==a?void 0:a[t],o&&(e=o));const l=new self.URL(e);return n&&!o&&(l.host=n),i&&Object.keys(i).sort().forEach(e=>{e&&l.searchParams.set(e,i[e])}),l.href}class Ua extends q{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Ua.CDMCleanupPromise?[Ua.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=e=>{const{initDataType:t,initData:r}=e,s=`"${e.type}" event: init data type: "${t}"`;if(this.debug(s),null!==r){if(!this.keyFormatPromise){let e=Object.keys(this.keySystemAccessPromises);e.length||(e=Xr(this.config));const t=e.map(Qr).filter(e=>!!e);this.keyFormatPromise=this.getKeyFormatPromise(t)}this.keyFormatPromise.then(n=>{const i=Yr(n);if("sinf"!==t||i!==Hr.FAIRPLAY)return void this.log(`Ignoring "${e.type}" event with init data type: "${t}" for selected key-system ${i}`);let a;try{const e=Se(new Uint8Array(r)),t=Ne(Ur(JSON.parse(e).sinf));if(!t)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");a=new Uint8Array(t.subarray(8,24))}catch(e){return void this.warn(`${s} Failed to parse sinf: ${e}`)}const o=se(a),{keyIdToKeySessionPromise:l,mediaKeySessions:u}=this;let c=l[o];for(let e=0;e<u.length;e++){const s=u[e],n=s.decryptdata;if(!n.keyId)continue;const i=se(n.keyId);if(Nr(a,n.keyId)||-1!==n.uri.replace(/-/g,"").indexOf(o)){if(c=l[i],!c)continue;if(n.pssh)break;delete l[i],n.pssh=new Uint8Array(r),n.keyId=a,c=l[o]=c.then(()=>this.generateRequestWithPreferredKeySession(s,t,r,"encrypted-event-key-match")),c.catch(e=>this.handleError(e));break}}c||this.handleError(new Error(`Key ID ${o} not encountered in playlist. Key-system sessions ${u.length}.`))}).catch(e=>this.handleError(e))}},this.onWaitingForKey=e=>{this.log(`"${e.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(x.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(x.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(x.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(x.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(x.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(x.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,s=null==t?void 0:t[e];return s?s.licenseUrl:e===Hr.WIDEVINE&&r?r:void 0}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(void 0===t)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=null==t?void 0:t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(e,t,r)=>!!e&&r.indexOf(e)===t,s=t.map(e=>e.audioCodec).filter(r),n=t.map(e=>e.videoCodec).filter(r);return s.length+n.length===0&&n.push("avc1.42e01e"),new Promise((t,r)=>{const i=e=>{const a=e.shift();this.getMediaKeysPromise(a,s,n).then(e=>t({keySystem:a,mediaKeys:e})).catch(t=>{e.length?i(e):r(t instanceof Ga?t:new Ga({type:C.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))})};i(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if("function"!=typeof r){let e=`Configured requestMediaKeySystemAccess is not a function ${r}`;return null===Jr&&"http:"===self.location.protocol&&(e=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(e))}return r(e,t)}getMediaKeysPromise(e,t,r){var s;const n=function(e,t,r,s){let n;switch(e){case Hr.FAIRPLAY:n=["cenc","sinf"];break;case Hr.WIDEVINE:case Hr.PLAYREADY:n=["cenc"];break;case Hr.CLEARKEY:n=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${e}`)}return function(e,t,r,s){return[{initDataTypes:e,persistentState:s.persistentState||"optional",distinctiveIdentifier:s.distinctiveIdentifier||"optional",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:t.map(e=>({contentType:`audio/mp4; codecs=${e}`,robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null})),videoCapabilities:r.map(e=>({contentType:`video/mp4; codecs=${e}`,robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null}))}]}(n,t,r,s)}(e,t,r,this.config.drmSystemOptions||{});let i=this.keySystemAccessPromises[e],a=null==(s=i)?void 0:s.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${wt(n)}`),a=this.requestMediaKeySystemAccess(e,n);const t=i=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(t=>{this.log(`Failed to obtain access to key-system "${e}": ${t}`)}),a.then(r=>{this.log(`Access for key-system "${r.keySystem}" obtained`);const s=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const n=t.mediaKeys=r.createMediaKeys().then(r=>(this.log(`Media-keys created for "${e}"`),t.hasMediaKeys=!0,s.then(t=>t?this.setMediaKeysServerCertificate(r,e,t):r)));return n.catch(t=>{this.error(`Failed to create media-keys for "${e}"}: ${t}`)}),n})}return a.then(()=>i.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${se(e.keyId||[])} keyUri: ${e.uri}`);const s=r.createSession(),n={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(n),n}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),s=Ba(t),n="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(r,n,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyId ${se(e.decryptdata.keyId||[])}\n      } (data length: ${t.byteLength})`),r.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Qr(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:e,mediaKeys:t})=>this.attemptSetMediaKeys(e,t))}selectKeySystem(e){return new Promise((t,r)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:e})=>{const s=Qr(e);s?t(s):r(new Error(`Unable to find format for key-system "${e}"`))}).catch(r)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Xr(this.config),r=e.map(Yr).filter(e=>!!e&&-1!==t.indexOf(e));return this.selectKeySystem(r)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let r=0;r<t.length;r++){const s=ja(e,t[r]);if(s)return s}}loadKey(e){const t=e.keyInfo.decryptdata,r=Ba(t),s=this.bannedKeyIds[r];if(s||"internal-error"===this.getKeyStatus(t)){const r=Ka(s||"internal-error",t);return this.handleError(r,e.frag),Promise.reject(r)}const n=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${n}`);const i=this.keyIdToKeySessionPromise[r];if(!i){const s=this.getKeySystemForKeyPromise(t).then(({keySystem:r,mediaKeys:s})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${n}`),this.attemptSetMediaKeys(r,s).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:r,mediaKeys:s,decryptdata:t}))))).then(e=>{const r=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(e,"cenc",r,"playlist-key")});return s.catch(t=>this.handleError(t,e.frag)),this.keyIdToKeySessionPromise[r]=s,s}return i.catch(r=>{if(r instanceof Ga){const s=z({},r.data);"internal-error"===this.getKeyStatus(t)&&(s.decryptdata=t);const n=new Ga(s,r.message);this.handleError(n,e.frag)}}),i}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Ga){t&&(e.data.frag=t);const r=e.data.decryptdata;this.error(`${e.message}${r?` (${se(r.keyId||[])})`:""}`),this.hls.trigger(x.ERROR,e.data)}else this.error(e.message),this.hls.trigger(x.ERROR,{type:C.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Ba(e),r=this.keyIdToKeySessionPromise[t];if(!r){const t=Yr(e.keyFormat),r=t?[t]:Xr(this.config);return this.attemptKeySystemAccess(r)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=Xr(this.config)),0===e.length)throw new Ga({type:C.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${wt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(r).then(()=>this.media?this.media.setMediaKeys(t):new Promise((e,r)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return r(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(e).catch(r)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(e=>-1===r.indexOf(e))})}generateRequestWithPreferredKeySession(e,t,r,s){var n;const i=null==(n=this.config.drmSystems)||null==(n=n[e.keySystem])?void 0:n.generateRequest;if(i)try{const s=i.call(this.hls,t,r,e);if(!s)throw new Error("Invalid response from configured generateRequest filter");t=s.initDataType,r=s.initData?s.initData:null,e.decryptdata.pssh=r?new Uint8Array(r):null}catch(e){if(this.warn(e.message),this.hls&&this.hls.config.debug)throw e}if(null===r)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const a=Ba(e.decryptdata),o=e.decryptdata.uri;this.log(`Generating key-session request for "${s}" keyId: ${a} URI: ${o} (init data type: ${t} length: ${r.byteLength})`);const l=new on,u=e._onmessage=t=>{const r=e.mediaKeysSession;if(!r)return void l.emit("error",new Error("invalid state"));const{messageType:s,message:n}=t;this.log(`"${s}" message event for session "${r.sessionId}" message size: ${n.byteLength}`),"license-request"===s||"license-renewal"===s?this.renewLicense(e,n).catch(e=>{l.eventNames().length?l.emit("error",e):this.handleError(e)}):"license-release"===s?e.keySystem===Hr.FAIRPLAY&&this.updateKeySession(e,Br("acknowledged")).then(()=>this.removeSession(e)).catch(e=>this.handleError(e)):this.warn(`unhandled media key message type "${s}"`)},c=(e,t)=>{let r;t.keyStatus=e,e.startsWith("usable")?l.emit("resolved"):"internal-error"===e||"output-restricted"===e||"output-downscaled"===e?r=Ka(e,t.decryptdata):"expired"===e?r=new Error(`key expired (keyId: ${a})`):"released"===e?r=new Error("key released"):"status-pending"===e||this.warn(`unhandled key status change "${e}" (keyId: ${a})`),r&&(l.eventNames().length?l.emit("error",r):this.handleError(r))},d=e._onkeystatuseschange=t=>{if(!e.mediaKeysSession)return void l.emit("error",new Error("invalid state"));const r=this.getKeyStatuses(e);if(!Object.keys(r).some(e=>"status-pending"!==r[e]))return;if("expired"===r[a])return this.log(`Expired key ${wt(r)} in key-session "${e.mediaKeysSession.sessionId}"`),void this.renewKeySession(e);let s=r[a];if(s)c(s,e);else{var n;const t=1e3;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(n=e.keyStatusTimeouts)[a]||(n[a]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const r=this.getKeyStatus(e.decryptdata);if(r&&"status-pending"!==r)return this.log(`No status for keyId ${a} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${r} from other session.`),c(r,e);this.log(`key status for ${a} in key-session "${e.mediaKeysSession.sessionId}" timed out after ${t}ms`),s="internal-error",c(s,e)},t)),this.log(`No status for keyId ${a} (${wt(r)}).`)}};Us(e.mediaKeysSession,"message",u),Us(e.mediaKeysSession,"keystatuseschange",d);const h=new Promise((e,t)=>{l.on("error",t),l.on("resolved",e)});return e.mediaKeysSession.generateRequest(t,r).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${a} URI: ${o}`)}).catch(t=>{throw new Ga({type:C.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_NO_SESSION,error:t,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${t}`)}).then(()=>h).catch(t=>(l.removeAllListeners(),this.removeSession(e).then(()=>{throw t}))).then(()=>(l.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((r,s)=>{if("string"==typeof s&&"object"==typeof r){const e=s;s=r,r=e}const n="buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s);if(e.keySystem===Hr.PLAYREADY&&16===n.length){const e=se(n);t[e]=r,jr(n)}const i=se(n);"internal-error"===r&&(this.bannedKeyIds[i]=r),this.log(`key status change "${r}" for keyStatuses keyId: ${i} key-session "${e.mediaKeysSession.sessionId}"`),t[i]=r}),t}fetchServerCertificate(e){const t=this.config,r=new(0,t.loader)(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((n,i)=>{const a={responseType:"arraybuffer",url:s},o=t.certLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(e,t,r,s)=>{n(e.data)},onError:(t,r,n,o)=>{i(new Ga({type:C.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:n,response:z({url:a.url,data:void 0},t)},`"${e}" certificate request failed (${s}). Status: ${t.code} (${t.text})`))},onTimeout:(t,r,n)=>{i(new Ga({type:C.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:n,response:{url:a.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(e,t,r)=>{i(new Error("aborted"))}};r.load(a,l,u)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((s,n)=>{e.setServerCertificate(r).then(n=>{this.log(`setServerCertificate ${n?"success":"not supported by CDM"} (${r.byteLength}) on "${t}"`),s(e)}).catch(e=>{n(new Ga({type:C.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(t=>this.updateKeySession(e,new Uint8Array(t)).catch(t=>{throw new Ga({type:C.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:t,fatal:!1},t.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=(new DOMParser).parseFromString(r,"application/xml"),n=s.querySelectorAll("HttpHeader");if(n.length>0){let t;for(let r=0,s=n.length;r<s;r++){var i,a;t=n[r];const s=null==(i=t.querySelector("name"))?void 0:i.textContent,o=null==(a=t.querySelector("value"))?void 0:a.textContent;s&&o&&e.setRequestHeader(s,o)}}const o=s.querySelector("Challenge"),l=null==o?void 0:o.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return Br(atob(l))}setupLicenseXHR(e,t,r,s){const n=this.config.licenseXhrSetup;return n?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return n.call(this.hls,e,t,r,s)}).catch(i=>{if(!r.decryptdata)throw i;return e.open("POST",t,!0),n.call(this.hls,e,t,r,s)}).then(r=>{e.readyState||e.open("POST",t,!0);return{xhr:e,licenseChallenge:r||s}}):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((s,n)=>{const i=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${i}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return n(new Error("invalid state"));if(4===a.readyState)if(200===a.status){this._requestLicenseFailureCount=0;let t=a.response;this.log(`License received ${t instanceof ArrayBuffer?t.byteLength:t}`);const r=this.config.licenseResponseCallback;if(r)try{t=r.call(this.hls,a,i,e)}catch(e){this.error(e)}s(t)}else{const o=r.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||a.status>=400&&a.status<500)n(new Ga({type:C.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:a,response:{url:i,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${i}). Status: ${a.status} (${a.statusText})`));else{const r=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${r} attempts left`),this.requestLicense(e,t).then(s,n)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,i,e,t).then(({xhr:t,licenseChallenge:r})=>{e.keySystem==Hr.PLAYREADY&&(r=this.unpackPlayReadyKeyMessage(t,r)),t.send(r)}).catch(n)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,Us(r,"encrypted",this.onMediaEncrypted),Us(r,"waitingforkey",this.onWaitingForKey);const s=this.mediaResolved;s?s():this.mediaKeys=r.mediaKeys}onMediaDetached(){const e=this.media;e&&(Bs(e,"encrypted",this.onMediaEncrypted),Bs(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const r=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,rs.clearKeyUriToKeyIdMap();const n=s.length;Ua.CDMCleanupPromise=Promise.all(s.map(e=>this.removeSession(e)).concat((null==r||null==(e=r.setMediaKeys(null))?void 0:e.catch(e=>{this.log(`Could not clear media keys: ${e}`),this.hls&&this.hls.trigger(x.ERROR,{type:C.OTHER_ERROR,details:D.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${e}`)})}))||Promise.resolve())).catch(e=>{this.log(`Could not close sessions and clear media keys: ${e}`),this.hls&&this.hls.trigger(x.ERROR,{type:C.OTHER_ERROR,details:D.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${e}`)})}).then(()=>{n&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(t&&this.config.emeEnabled&&!this.keyFormatPromise){const e=t.reduce((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e),[]);this.log(`Selecting key-system from session-keys ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r,decryptdata:s}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${se((null==s?void 0:s.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const n=this.mediaKeySessions.indexOf(e);n>-1&&this.mediaKeySessions.splice(n,1);const{keyStatusTimeouts:i}=e;i&&Object.keys(i).forEach(e=>self.clearTimeout(i[e]));const{drmSystemOptions:a}=this.config,o=function(e){var t;return!(!e||"persistent-license"!==e.sessionType&&(null==(t=e.sessionTypes)||!t.some(e=>"persistent-license"===e)))}(a)?new Promise((e,r)=>{self.setTimeout(()=>r(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(e).catch(r)}):Promise.resolve();return o.catch(e=>{this.log(`Could not remove session: ${e}`),this.hls&&this.hls.trigger(x.ERROR,{type:C.OTHER_ERROR,details:D.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${e}`)})}).then(()=>t.close()).catch(e=>{this.log(`Could not close session: ${e}`),this.hls&&this.hls.trigger(x.ERROR,{type:C.OTHER_ERROR,details:D.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${e}`)})})}return Promise.resolve()}}function Ba(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return se(e.keyId)}function ja(e,t){return e.keyId&&t.mediaKeysSession.keyStatuses.has(e.keyId)?t.mediaKeysSession.keyStatuses.get(e.keyId):e.matches(t.decryptdata)?t.keyStatus:void 0}Ua.CDMCleanupPromise=void 0;class Ga extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function Ka(e,t){const r="output-restricted"===e,s=r?D.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:D.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Ga({type:C.KEY_SYSTEM_ERROR,details:s,fatal:!1,decryptdata:t},r?"HDCP level output restricted":`key status changed to "${e}"`)}function Ha(e,t){let r;try{r=new Event("addtrack")}catch(e){r=document.createEvent("Event"),r.initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)}function Va(e,t){const r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(r){Z.debug(`[texttrack-utils]: ${r}`);try{const r=new self.TextTrackCue(t.startTime,t.endTime,t.text);r.id=t.id,e.addCue(r)}catch(e){Z.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${e}`)}}"disabled"===r&&(e.mode=r)}function za(e,t){const r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues)for(let r=e.cues.length;r--;)t&&e.cues[r].removeEventListener("enter",t),e.removeCue(e.cues[r]);"disabled"===r&&(e.mode=r)}function qa(e,t,r,s){const n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues&&e.cues.length>0){const n=function(e,t,r){const s=[],n=function(e,t){if(t<=e[0].startTime)return 0;const r=e.length-1;if(t>e[r].endTime)return-1;let s,n=0,i=r;for(;n<=i;)if(s=Math.floor((i+n)/2),t<e[s].startTime)i=s-1;else{if(!(t>e[s].startTime&&n<r))return s;n=s+1}return e[n].startTime-t<t-e[i].startTime?n:i}(e,t);if(n>-1)for(let i=n,a=e.length;i<a;i++){const n=e[i];if(n.startTime>=t&&n.endTime<=r)s.push(n);else if(n.startTime>r)return s}return s}(e.cues,t,r);for(let t=0;t<n.length;t++)s&&!s(n[t])||e.removeCue(n[t])}"disabled"===n&&(e.mode=n)}function Wa(e){const t=[];for(let r=0;r<e.length;r++){const s=e[r];"subtitles"!==s.kind&&"captions"!==s.kind||!s.label||t.push(e[r])}return t}function Ya(e){let t=5381,r=e.length;for(;r;)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()}const Qa=.025;let Xa=function(e){return e[e.Point=0]="Point",e[e.Range=1]="Range",e}({});function Ja(e,t,r){return`${e.identifier}-${r+1}-${Ya(t)}`}class Za{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,null==(e=this.assetListLoader)||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const r=this.playoutLimit;if(e<=0||isNaN(r))return!1;if(0===r)return!0;return((null==(t=this.assetList[e])?void 0:t.startOffset)||0)>r}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return eo(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(0===this.startTime||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime;return t-eo(t,e)<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=R(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return eo(e,t)}return e}get appendInPlace(){return!!this.appendInPlaceStarted||!this.appendInPlaceDisabled&&!(this.cue.once||this.cue.pre||!this.startIsAligned||!(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Qa))}set appendInPlace(e){this.appendInPlaceStarted?this.resetOnResume=!e:this.appendInPlaceDisabled=!e}get timelineStart(){return null!==this._timelineStart?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return t=null!==this._duration?this._duration:this.dateRange.duration?this.dateRange.duration:this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return"RANGE"===this.dateRange.attr["X-TIMELINE-OCCUPIES"]?Xa.Range:Xa.Point}get supplementsPrimary(){return"PRIMARY"===this.dateRange.attr["X-TIMELINE-STYLE"]}get contentMayVary(){return"NO"!==this.dateRange.attr["X-CONTENT-MAY-VARY"]}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||null!==this.assetListResponse}toString(){return`["${(e=this).identifier}" ${e.cue.pre?"<pre>":e.cue.post?"<post>":""}${e.timelineStart.toFixed(2)}-${e.resumeTime.toFixed(2)}]`;var e}}function eo(e,t){return e-t.start<t.duration/2&&!(Math.abs(e-(t.start+t.duration))<Qa)?t.start:t.start+t.duration}function to(e,t,r){const s=new self.URL(e,r);return"data:"!==s.protocol&&s.searchParams.set("_HLS_primary_id",t),s}function ro(e,t){for(;null!=(r=e.assetList[++t])&&r.error;)var r;return t}function so(e){const t=e.timelineStart,r=e.duration||0;return`["${e.identifier}" ${t.toFixed(2)}-${(t+r).toFixed(2)}]`}class no{constructor(e,t,r,s){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(x.PLAYOUT_LIMIT_REACHED,{})};const n=this.hls=new e(t);this.interstitial=r,this.assetItem=s;const i=()=>{this.hasDetails=!0};n.once(x.LEVEL_LOADED,i),n.once(x.AUDIO_TRACK_LOADED,i),n.once(x.SUBTITLE_TRACK_LOADED,i),n.on(x.MEDIA_ATTACHING,(e,{media:t})=>{this.removeMediaListeners(),this.mediaAttached=t;this.interstitial.playoutLimit&&(t.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&n.on(x.BUFFER_APPENDED,()=>{const e=this.bufferedEnd;this.reachedPlayout(e)&&(this._bufferedEosTime=e,n.trigger(x.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=to(t,e.config.primarySessionId||"").href}catch(e){}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if(null!=(t=this.hls)&&t.bufferedToEnd)return!0;if(!e)return!1;const r=Math.min(this._bufferedEosTime||1/0,this.duration),s=this.timelineOffset,n=Tr.bufferInfo(e,s,0);return this.getAssetTime(n.end)>=r-.02}reachedPlayout(e){const t=this.interstitial.playoutLimit;return this.startOffset+e>=t}get destroyed(){var e;return!(null!=(e=this.hls)&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return(null==(e=this.hls)?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Tr.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const r=t-this.startOffset;if(r>0&&r<e)return r}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return(null==(e=this.hls)?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const r=e-t;if(Math.abs(r)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,r=this.duration;return Math.min(Math.max(0,e-t),r)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){var e;this.mediaAttached&&(null!=(e=this.hls)&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd))}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),null==(t=this.hls)||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,null==(e=this.hls)||e.detachMedia()}resumeBuffering(){var e;null==(e=this.hls)||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.hls)||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),(null==(e=this.hls)?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=e=>delete e.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,r){var s;null==(s=this.hls)||s.on(e,t)}once(e,t,r){var s;null==(s=this.hls)||s.once(e,t)}off(e,t,r){var s;null==(s=this.hls)||s.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${so(this.assetItem)} ${null==(e=this.hls)?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}class io extends q{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((r,s)=>e<=s.startOffset&&t>s.startOffset?(delete s.error,r+1):r,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let r=-1;e.nextEvent?r=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(r=this.findEventIndex(e.previousEvent.identifier)+1);const s=this.items;if(s)for(s[r]||(void 0===t&&(t=e.start),r=this.findItemIndexAtTime(t));r>=0&&null!=(n=s[r])&&n.event;){var n;r--}return r}findItemIndexAtTime(e,t){const r=this.items;if(r)for(let s=0;s<r.length;s++){let n=r[s];if(t&&"primary"!==t&&(n=n[t]),e===n.start||e>n.start&&e<n.end)return s}return-1}findJumpRestrictedIndex(e,t){const r=this.items;if(r)for(let s=e;s<=t&&r[s];s++){const e=r[s].event;if(null!=e&&e.restrictions.jump&&!e.appendInPlace)return s}return-1}findEventIndex(e){const t=this.items;if(t)for(let s=t.length;s--;){var r;if((null==(r=t[s].event)?void 0:r.identifier)===e)return s}return-1}findAssetIndex(e,t){const r=e.assetList,s=r.length;if(s>1)for(let e=0;e<s;e++){const n=r[e];if(!n.error){const r=n.timelineStart;if(t===r||t>r&&(t<r+(n.duration||0)||e===s-1))return e}}return 0}get assetIdAtEnd(){var e;const t=null==(e=this.items)||null==(e=e[this.length-1])?void 0:e.event;if(t){const e=t.assetList,r=e[e.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(e,t){const r=e.main.details,{dateRanges:s}=r,n=this.events,i=this.parseDateRanges(s,{url:r.url},t),a=Object.keys(s),o=n?n.filter(e=>!a.includes(e.identifier)):[];i.length&&i.sort((e,t)=>{const r=e.cue.pre,s=e.cue.post,n=t.cue.pre,i=t.cue.post;if(r&&!n)return-1;if(n&&!r)return 1;if(s&&!i)return 1;if(i&&!s)return-1;if(!(r||n||s||i)){const r=e.startTime,s=t.startTime;if(r!==s)return r-s}return e.dateRange.tagOrder-t.dateRange.tagOrder}),this.events=i,o.forEach(e=>{this.removeEvent(e)}),this.updateSchedule(e,o)}updateSchedule(e,t=[],r=!1){const s=this.events||[];if(s.length||t.length||this.length<2){const n=this.items,i=this.parseSchedule(s,e);(r||t.length||(null==n?void 0:n.length)!==i.length||i.some((e,t)=>Math.abs(e.playout.start-n[t].playout.start)>.005||Math.abs(e.playout.end-n[t].playout.end)>.005))&&(this.items=i,this.onScheduleUpdate(t,n))}}parseDateRanges(e,t,r){const s=[],n=Object.keys(e);for(let i=0;i<n.length;i++){const a=n[i],o=e[a];if(o.isInterstitial){let e=this.eventMap[a];e?e.setDateRange(o):(e=new Za(o,t),this.eventMap[a]=e,!1===r&&(e.appendInPlace=r)),s.push(e)}}return s}parseSchedule(e,t){const r=[],s=t.main.details,n=s.live?1/0:s.edge;let i=0;if((e=e.filter(e=>!(e.error||e.cue.once&&e.hasPlayed))).length){this.resolveOffsets(e,t);let s=0,o=0;if(e.forEach((t,a)=>{const l=t.cue.pre,u=t.cue.post,c=e[a-1]||null,d=t.appendInPlace,h=u?n:t.startOffset,f=t.duration,g=t.timelineOccupancy===Xa.Range?f:0,p=t.resumptionOffset,m=(null==c?void 0:c.startTime)===h,y=h+t.cumulativeDuration;let v=d?y+f:h+p;if(l||!u&&h<=0){const e=o;o+=g,t.timelineStart=y;const s=i;i+=f,r.push({event:t,start:y,end:v,playout:{start:s,end:i},integrated:{start:e,end:o}})}else{if(!(h<=n))return;{if(!m){const n=h-s;if(n>.033){const l=s,u=o;o+=n;const c=i;i+=n;const d={previousEvent:e[a-1]||null,nextEvent:t,start:l,end:l+n,playout:{start:c,end:i},integrated:{start:u,end:o}};r.push(d)}else n>0&&c&&(c.cumulativeDuration+=n,r[r.length-1].end=h)}u&&(v=y),t.timelineStart=y;const n=o;o+=g;const l=i;i+=f,r.push({event:t,start:y,end:v,playout:{start:l,end:i},integrated:{start:n,end:o}})}}const b=t.resumeTime;s=u||b>n?n:b}),s<n){var a;const e=s,t=o,l=n-s;o+=l;const u=i;i+=l,r.push({previousEvent:(null==(a=r[r.length-1])?void 0:a.event)||null,nextEvent:null,start:s,end:e+l,playout:{start:u,end:i},integrated:{start:t,end:o}})}this.setDurations(n,i,o)}else{const e=0;r.push({previousEvent:null,nextEvent:null,start:e,end:n,playout:{start:e,end:n},integrated:{start:e,end:n}}),this.setDurations(n,n,n)}return r}setDurations(e,t,r){this.durations={primary:e,playout:t,integrated:r}}resolveOffsets(e,t){const r=t.main.details,s=r.live?1/0:r.edge;let n=0,i=-1;e.forEach((a,o)=>{const l=a.cue.pre,u=a.cue.post,c=l?0:u?s:a.startTime;this.updateAssetDurations(a);if(i===c?a.cumulativeDuration=n:(n=0,i=c),!u&&a.snapOptions.in&&(a.resumeAnchor=xt(null,r.fragments,a.startOffset+a.resumptionOffset,0,0)||void 0),a.appendInPlace&&!a.appendInPlaceStarted){this.primaryCanResumeInPlaceAt(a,t)||(a.appendInPlace=!1)}if(!a.appendInPlace&&o+1<e.length){e[o+1].startTime-e[o].resumeTime<.033&&(e[o+1].appendInPlace=!1,e[o+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${a}`))}const d=R(a.resumeOffset)?a.resumeOffset:a.duration;n+=d})}primaryCanResumeInPlaceAt(e,t){const r=e.resumeTime,s=e.startTime+e.resumptionOffset;if(Math.abs(r-s)>Qa)return this.log(`"${e.identifier}" resumption ${r} not aligned with estimated timeline end ${s}`),!1;return!Object.keys(t).some(s=>{const n=t[s].details,i=n.edge;if(r>=i)return this.log(`"${e.identifier}" resumption ${r} past ${s} playlist end ${i}`),!1;const a=xt(null,n.fragments,r);if(!a)return this.log(`"${e.identifier}" resumption ${r} does not align with any fragments in ${s} playlist (${n.fragStart}-${n.fragmentEnd})`),!0;const o="audio"===s?.175:0;return!(Math.abs(a.start-r)<Qa+o||Math.abs(a.end-r)<Qa+o)&&(this.log(`"${e.identifier}" resumption ${r} not aligned with ${s} fragment bounds (${a.start}-${a.end} sn: ${a.sn} cc: ${a.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let r=0,s=!1,n=!1;for(let i=0;i<e.assetList.length;i++){const a=e.assetList[i],o=t+r;a.startOffset=r,a.timelineStart=o,s||(s=null===a.duration),n||(n=!!a.error);r+=a.error?0:a.duration||0}e.duration=s&&!n?Math.max(r,e.duration):r}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function ao(e){return`[${e.event?'"'+e.event.identifier+'"':"primary"}: ${e.start.toFixed(2)}-${e.end.toFixed(2)}]`}class oo{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const r=e.assetListUrl;let s;try{s=to(r,this.hls.sessionId,e.baseUrl)}catch(t){const s=this.assignAssetListError(e,D.ASSET_LIST_LOAD_ERROR,t,r);return void this.hls.trigger(x.ERROR,s)}t&&"data:"!==s.protocol&&s.searchParams.set("_HLS_start_offset",""+t);const n=this.hls.config,i=new(0,n.loader)(n),a={responseType:"json",url:s.href},o=n.interstitialAssetListLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(t,r,s,n)=>{const i=t.data,a=null==i?void 0:i.ASSETS;if(!Array.isArray(a)){const t=this.assignAssetListError(e,D.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),s.url,r,n);return void this.hls.trigger(x.ERROR,t)}e.assetListResponse=i,this.hls.trigger(x.ASSET_LIST_LOADED,{event:e,assetListResponse:i,networkDetails:n})},onError:(t,r,s,n)=>{const i=this.assignAssetListError(e,D.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${t.code} ${t.text} (${r.url})`),r.url,n,s);this.hls.trigger(x.ERROR,i)},onTimeout:(t,r,s)=>{const n=this.assignAssetListError(e,D.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${r.url})`),r.url,t,s);this.hls.trigger(x.ERROR,n)}};return i.load(a,l,u),this.hls.trigger(x.ASSET_LIST_LOADING,{event:e}),i}assignAssetListError(e,t,r,s,n,i){return e.error=r,{type:C.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:s,error:r,networkDetails:i,stats:n}}}function lo(e){var t;null==e||null==(t=e.play())||t.catch(()=>{})}function uo(e,t){return`[${e}] Advancing timeline position to ${t}`}class co{constructor(e){this.buffered=void 0;const t=(t,r,s)=>{if((r>>>=0)>s-1)throw new DOMException(`Failed to execute '${t}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${s})`);return e[r][t]};this.buffered={get length(){return e.length},end:r=>t("end",r,e.length),start:r=>t("start",r,e.length)}}}const ho={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},fo=e=>String.fromCharCode(ho[e]||e),go=15,po=100,mo={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},yo={17:2,18:4,21:6,22:8,23:10,19:13,20:15},vo={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},bo={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Eo=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class So{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r="function"==typeof t?t():t;Z.log(`${this.time} [${e}] ${r}`)}}}const To=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class wo{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const s=t[r];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class ko{constructor(){this.uchar=" ",this.penState=new wo}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class _o{constructor(e){this.chars=[],this.pos=0,this.currPenState=new wo,this.cueStartTime=null,this.logger=void 0;for(let e=0;e<po;e++)this.chars.push(new ko);this.logger=e}equals(e){for(let t=0;t<po;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<po;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<po;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>po&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=po)}moveCursor(e){const t=this.pos+e;if(e>1)for(let e=this.pos+1;e<t+1;e++)this.chars[e].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=fo(e);this.pos>=po?this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<po;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<po;r++){const s=this.chars[r].uchar;" "!==s&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e);this.chars[this.pos].setPenState(this.currPenState)}}class Ao{constructor(e){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<go;t++)this.rows.push(new _o(e));this.logger=e}reset(){for(let e=0;e<go;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let r=0;r<go;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<go;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<go;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e);this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+wt(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let e=0;e<go;e++)this.rows[e].clear();const e=this.currRow+1-this.nrRollUpRows,r=this.lastOutputScreen;if(r){const s=r.rows[e].cueStartTime,n=this.logger.time;if(null!==s&&null!==n&&s<n)for(let s=0;s<this.nrRollUpRows;s++)this.rows[t-this.nrRollUpRows+s+1].copy(r.rows[e+s])}}this.currRow=t;const r=this.rows[this.currRow];if(null!==e.indent){const t=e.indent,s=Math.max(t-1,0);r.setCursor(e.indent),e.color=r.chars[s].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+wt(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",s=-1;for(let r=0;r<go;r++){const n=this.rows[r].getTextString();n&&(s=r+1,e?t.push("Row "+s+": '"+n+"'"):t.push(n.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r}getTextAndFormat(){return this.rows}}class Lo{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Ao(r),this.nonDisplayedMemory=new Ao(r),this.lastOutputScreen=new Ao(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[r]}this.logger.log(2,"MIDROW: "+wt(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Ro{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;const s=this.logger=new So;this.channels=[null,new Lo(e,t,s),new Lo(e+1,r,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let e=0;e<t.length;e+=2){const r=127&t[e],s=127&t[e+1];let n=!1,i=null;if(0===r&&0===s)continue;this.logger.log(3,()=>"["+To([t[e],t[e+1]])+"] -> ("+To([r,s])+")");const a=this.cmdHistory;if(r>=16&&r<=31){if(Po(r,s,a)){Io(null,null,a),this.logger.log(3,()=>"Repeated command ("+To([r,s])+") is dropped");continue}Io(r,s,this.cmdHistory),n=this.parseCmd(r,s),n||(n=this.parseMidrow(r,s)),n||(n=this.parsePAC(r,s)),n||(n=this.parseBackgroundAttributes(r,s))}else Io(null,null,a);if(!n&&(i=this.parseChars(r,s),i)){const e=this.currentChannel;if(e&&e>0){this.channels[e].insertChars(i)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}n||i||this.logger.log(2,()=>"Couldn't parse cleaned data "+To([r,s])+" orig: "+To([t[e],t[e+1]]))}}parseCmd(e,t){if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;const r=20===e||21===e||23===e?1:2,s=this.channels[r];return 20===e||21===e||28===e||29===e?32===t?s.ccRCL():33===t?s.ccBS():34===t?s.ccAOF():35===t?s.ccAON():36===t?s.ccDER():37===t?s.ccRU(2):38===t?s.ccRU(3):39===t?s.ccRU(4):40===t?s.ccFON():41===t?s.ccRDC():42===t?s.ccTR():43===t?s.ccRTD():44===t?s.ccEDM():45===t?s.ccCR():46===t?s.ccENM():47===t&&s.ccEOC():s.ccTO(t-32),this.currentChannel=r,!0}parseMidrow(e,t){let r=0;if((17===e||25===e)&&t>=32&&t<=47){if(r=17===e?1:2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[r];return!!s&&(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+To([e,t])+")"),!0)}return!1}parsePAC(e,t){let r;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;const s=e<=23?1:2;r=t>=64&&t<=95?1===s?mo[e]:vo[e]:1===s?yo[e]:bo[e];const n=this.channels[s];return!!n&&(n.setPAC(this.interpretPAC(r,t)),this.currentChannel=s,!0)}interpretPAC(e,t){let r;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,s.underline=!(1&~r),r<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(s.italics=!0,s.color="white"):s.indent=4*Math.floor((r-16)/2),s}parseChars(e,t){let r,s=null,n=null;if(e>=25?(r=2,n=e-8):(r=1,n=e),n>=17&&n<=19){let e;e=17===n?t+80:18===n?t+112:t+144,this.logger.log(2,()=>"Special char '"+fo(e)+"' in channel "+r),s=[e]}else e>=32&&e<=127&&(s=0===t?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+To(s).join(",")),s}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;let r;const s={};16===e||24===e?(r=Math.floor((t-32)/2),s.background=Eo[r],t%2==1&&(s.background=s.background+"_semi")):45===t?s.background="transparent":(s.foreground="black",47===t&&(s.underline=!0));const n=e<=23?1:2;return this.channels[n].setBkgData(s),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Io(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function Io(e,t,r){r.a=e,r.b=t}function Po(e,t,r){return r.a===e&&r.b===t}var Co=function(){if(null!=Kr&&Kr.VTTCue)return self.VTTCue;const e=["","lr","rl"],t=["start","middle","end","left","right"];function r(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;const r=t.toLowerCase();return!!~e.indexOf(r)&&r}function s(e){return r(t,e)}function n(e,...t){let r=1;for(;r<arguments.length;r++){const t=arguments[r];for(const r in t)e[r]=t[r]}return e}function i(t,i,a){const o=this,l={enumerable:!0};o.hasBeenReset=!1;let u="",c=!1,d=t,h=i,f=a,g=null,p="",m=!0,y="auto",v="start",b=50,E="middle",S=50,T="middle";Object.defineProperty(o,"id",n({},l,{get:function(){return u},set:function(e){u=""+e}})),Object.defineProperty(o,"pauseOnExit",n({},l,{get:function(){return c},set:function(e){c=!!e}})),Object.defineProperty(o,"startTime",n({},l,{get:function(){return d},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",n({},l,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",n({},l,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",n({},l,{get:function(){return g},set:function(e){g=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",n({},l,{get:function(){return p},set:function(t){const s=function(t){return r(e,t)}(t);if(!1===s)throw new SyntaxError("An invalid or illegal string was specified.");p=s,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",n({},l,{get:function(){return m},set:function(e){m=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",n({},l,{get:function(){return y},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",n({},l,{get:function(){return v},set:function(e){const t=s(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",n({},l,{get:function(){return b},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",n({},l,{get:function(){return E},set:function(e){const t=s(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",n({},l,{get:function(){return S},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");S=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",n({},l,{get:function(){return T},set:function(e){const t=s(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");T=t,this.hasBeenReset=!0}})),o.displayState=void 0}return i.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},i}();class Do{decode(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function xo(e){function t(e,t,r,s){return 3600*(0|e)+60*(0|t)+(0|r)+parseFloat(s||0)}const r=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return r?parseFloat(r[2])>59?t(r[2],r[3],0,r[4]):t(r[1],r[2],r[3],r[4]):null}class Oo{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let s=0;s<r.length;++s)if(t===r[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function No(e,t,r,s){const n=s?e.split(s):[e];for(const e in n){if("string"!=typeof n[e])continue;const s=n[e].split(r);if(2!==s.length)continue;t(s[0],s[1])}}const Mo=new Co(0,0,""),Fo="middle"===Mo.align?"middle":"center";function $o(e,t,r){const s=e;function n(){const t=xo(e);if(null===t)throw new Error("Malformed timestamp: "+s);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function i(){e=e.replace(/^\s+/,"")}if(i(),t.startTime=n(),i(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+s);e=e.slice(3),i(),t.endTime=n(),i(),function(e,t){const s=new Oo;No(e,function(e,t){let n;switch(e){case"region":for(let n=r.length-1;n>=0;n--)if(r[n].id===t){s.set(e,r[n].region);break}break;case"vertical":s.alt(e,t,["rl","lr"]);break;case"line":n=t.split(","),s.integer(e,n[0]),s.percent(e,n[0])&&s.set("snapToLines",!1),s.alt(e,n[0],["auto"]),2===n.length&&s.alt("lineAlign",n[1],["start",Fo,"end"]);break;case"position":n=t.split(","),s.percent(e,n[0]),2===n.length&&s.alt("positionAlign",n[1],["start",Fo,"end","line-left","line-right","auto"]);break;case"size":s.percent(e,t);break;case"align":s.alt(e,t,["start",Fo,"end","left","right"])}},/:/,/\s/),t.region=s.get("region",null),t.vertical=s.get("vertical","");let n=s.get("line","auto");"auto"===n&&-1===Mo.line&&(n=-1),t.line=n,t.lineAlign=s.get("lineAlign","start"),t.snapToLines=s.get("snapToLines",!0),t.size=s.get("size",100),t.align=s.get("align",Fo);let i=s.get("position","auto");"auto"===i&&50===Mo.position&&(i="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=i}(e,t)}function Uo(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class Bo{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Do,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function r(){let e=t.buffer,r=0;for(e=Uo(e);r<e.length&&"\r"!==e[r]&&"\n"!==e[r];)++r;const s=e.slice(0,r);return"\r"===e[r]&&++r,"\n"===e[r]&&++r,t.buffer=e.slice(r),s}function s(e){No(e,function(e,t){},/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=r();const s=e.match(/^()?WEBVTT([ \t].*)?$/);if(null==s||!s[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let n=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(n?n=!1:e=r(),t.state){case"HEADER":/:/.test(e)?s(e):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new Co(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{$o(e,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const r=-1!==e.indexOf("--\x3e");if(!e||r&&(n=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const jo=/\r\n|\n\r|\n|\r/g,Go=function(e,t,r=0){return e.slice(r,r+t.length)===t};function Ko(e,t,r){return Ya(e.toString())+Ya(t.toString())+Ya(r)}function Ho(e,t,r,s,n,i,a){const o=new Bo,l=re(new Uint8Array(e)).trim().replace(jo,"\n").split("\n"),u=[],c=t?function(e,t=1){return hi(e,9e4,1/t)}(t.baseTime,t.timescale):0;let d,h="00:00.000",f=0,g=0,p=!0;o.oncue=function(e){const i=r[s];let a=r.ccOffset;const o=(f-c)/9e4;if(null!=i&&i.new&&(void 0!==g?a=r.ccOffset=i.start:function(e,t,r){let s=e[t],n=e[s.prevCC];if(!n||!n.new&&s.new)return e.ccOffset=e.presentationOffset=s.start,void(s.new=!1);for(;null!=(i=n)&&i.new;){var i;e.ccOffset+=s.start-n.start,s.new=!1,s=n,n=e[s.prevCC]}e.presentationOffset=r}(r,s,o)),o){if(!t)return void(d=new Error("Missing initPTS for VTT MPEGTS"));a=o-r.presentationOffset}const l=e.endTime-e.startTime,h=Ei(9e4*(e.startTime+a-g),9e4*n)/9e4;e.startTime=Math.max(h,0),e.endTime=Math.max(h+l,0);const p=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(p)),e.id||(e.id=Ko(e.startTime,e.endTime,p)),e.endTime>0&&u.push(e)},o.onparsingerror=function(e){d=e},o.onflush=function(){d?a(d):i(u)},l.forEach(e=>{if(p){if(Go(e,"X-TIMESTAMP-MAP=")){p=!1,e.slice(16).split(",").forEach(e=>{Go(e,"LOCAL:")?h=e.slice(6):Go(e,"MPEGTS:")&&(f=parseInt(e.slice(7)))});try{g=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),n=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!(R(t)&&R(r)&&R(s)&&R(n)))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=6e4*s,t+=36e5*n,t}(h)/1e3}catch(e){d=e}return}""===e&&(p=!1)}o.parse(e+"\n")}),o.flush()}const Vo="stpp.ttml.im1t",zo=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,qo=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Wo={left:"start",center:"center",right:"end",start:"start",end:"end"};function Yo(e,t,r,s){const n=Ae(new Uint8Array(e),["mdat"]);if(0===n.length)return void s(new Error("Could not parse IMSC1 mdat"));const i=n.map(e=>re(e)),a=function(e,t,r=1,s=!1){return hi(e,t,1/r,s)}(t.baseTime,1,t.timescale);try{i.forEach(e=>r(function(e,t){const r=(new DOMParser).parseFromString(e,"text/xml"),s=r.getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const n={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},i=Object.keys(n).reduce((e,t)=>(e[t]=s.getAttribute(`ttp:${t}`)||n[t],e),{}),a="preserve"!==s.getAttribute("xml:space"),o=Xo(Qo(s,"styling","style")),l=Xo(Qo(s,"layout","region")),u=Qo(s,"body","[begin]");return[].map.call(u,e=>{const r=Jo(e,a);if(!r||!e.hasAttribute("begin"))return null;const s=tl(e.getAttribute("begin"),i),n=tl(e.getAttribute("dur"),i);let u=tl(e.getAttribute("end"),i);if(null===s)throw el(e);if(null===u){if(null===n)throw el(e);u=s+n}const c=new Co(s-t,u-t,r);c.id=Ko(c.startTime,c.endTime,c.text);const d=function(e,t,r){const s="http://www.w3.org/ns/ttml#styling";let n=null;const i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;a&&r.hasOwnProperty(a)&&(n=r[a]);return i.reduce((r,i)=>{const a=Zo(t,s,i)||Zo(e,s,i)||Zo(n,s,i);return a&&(r[i]=a),r},{})}(l[e.getAttribute("region")],o[e.getAttribute("style")],o),{textAlign:h}=d;if(h){const e=Wo[h];e&&(c.lineAlign=e),c.align=h}return H(c,d),c}).filter(e=>null!==e)}(e,a)))}catch(e){s(e)}}function Qo(e,t,r){const s=e.getElementsByTagName(t)[0];return s?[].slice.call(s.querySelectorAll(r)):[]}function Xo(e){return e.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function Jo(e,t){return[].slice.call(e.childNodes).reduce((e,r,s)=>{var n;return"br"===r.nodeName&&s?e+"\n":null!=(n=r.childNodes)&&n.length?Jo(r,t):t?e+r.textContent.trim().replace(/\s+/g," "):e+r.textContent},"")}function Zo(e,t,r){return e&&e.hasAttributeNS(t,r)?e.getAttributeNS(t,r):null}function el(e){return new Error(`Could not parse ttml timestamp ${e}`)}function tl(e,t){if(!e)return null;let r=xo(e);return null===r&&(zo.test(e)?r=function(e,t){const r=zo.exec(e),s=(0|r[4])+(0|r[5])/t.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+s/t.frameRate}(e,t):qo.test(e)&&(r=function(e,t){const r=qo.exec(e),s=Number(r[1]);switch(r[2]){case"h":return 3600*s;case"m":return 60*s;case"ms":return 1e3*s;case"f":return s/t.frameRate;case"t":return s/t.tickRate}return s}(e,t))),r}class rl{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}function sl(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function nl(e,t){return!!e&&e.kind===sl(t)&&Mi(t,e)}function il(e,t,r,s){return Math.min(t,s)-Math.max(e,r)}const al=/\s/,ol={newCue(e,t,r,s){const n=[];let i,a,o,l,u;const c=self.VTTCue||self.TextTrackCue;for(let h=0;h<s.rows.length;h++)if(i=s.rows[h],o=!0,l=0,u="",!i.isEmpty()){var d;for(let e=0;e<i.chars.length;e++)al.test(i.chars[e].uchar)&&o?l++:(u+=i.chars[e].uchar,o=!1);i.cueStartTime=t,t===r&&(r+=1e-4),l>=16?l--:l++;const s=Uo(u.trim()),f=Ko(t,r,s);null!=e&&null!=(d=e.cues)&&d.getCueById(f)||(a=new c(t,r,s),a.id=f,a.line=h+1,a.align="left",a.position=10+Math.min(80,10*Math.floor(8*l/32)),n.push(a))}return e&&n.length&&(n.sort((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line),n.forEach(t=>Va(e,t))),n}};const ll=/(\d+)-(\d+)\/(\d+)/;class ul{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||cl,this.controller=new self.AbortController,this.stats=new ue}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const n=function(e,t){const r={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(H({},e.headers))};e.rangeEnd&&r.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1));return r}(e,this.controller.signal),i="arraybuffer"===e.responseType,a=i?"byteLength":"length",{maxTimeToFirstByteMs:o,maxLoadTimeMs:l}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,n),self.clearTimeout(this.requestTimeout),t.timeout=o&&R(o)?o:l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},t.timeout);(Ri(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(r=>{var n;this.response=this.loader=r;const a=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},l-(a-s.loading.start)),!r.ok){const{status:e,statusText:t}=r;throw new dl(t||"fetch, bad network response",e,r)}s.loading.first=a,s.total=function(e){const t=e.get("Content-Range");if(t){const e=function(e){const t=ll.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(R(e))return e}const r=e.get("Content-Length");if(r)return parseInt(r)}(r.headers)||s.total;const o=null==(n=this.callbacks)?void 0:n.onProgress;return o&&R(t.highWaterMark)?this.loadProgressively(r,s,e,t.highWaterMark,o):i?r.arrayBuffer():"json"===e.responseType?r.json():r.text()}).then(r=>{var n,i;const o=this.response;if(!o)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const l=r[a];l&&(s.loaded=s.total=l);const u={url:o.url,data:r,code:o.status},c=null==(n=this.callbacks)?void 0:n.onProgress;c&&!R(t.highWaterMark)&&c(s,e,r,o),null==(i=this.callbacks)||i.onSuccess(u,s,e,o)}).catch(t=>{var r;if(self.clearTimeout(this.requestTimeout),s.aborted)return;const n=t&&t.code||0,i=t?t.message:null;null==(r=this.callbacks)||r.onError({code:n,text:i},e,t?t.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,s=0,n){const i=new rn,a=e.body.getReader(),o=()=>a.read().then(a=>{if(a.done)return i.dataLength&&n(t,r,i.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const l=a.value,u=l.length;return t.loaded+=u,u<s||i.dataLength?(i.push(l),i.dataLength>=s&&n(t,r,i.flush().buffer,e)):n(t,r,l.buffer,e),o()}).catch(()=>Promise.reject());return o()}}function cl(e,t){return new self.Request(e.url,t)}class dl extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const hl=/^age:\s*[\d.]+\s*$/im;class fl{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new ue,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const n=this.xhrSetup;n?Promise.resolve().then(()=>{if(this.loader===r&&!this.stats.aborted)return n(r,t.url)}).catch(e=>{if(this.loader===r&&!this.stats.aborted)return r.open("GET",t.url,!0),n(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(e=>{var n;null==(n=this.callbacks)||n.onError({code:r.status,text:e.message},t,r,s)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:n,maxLoadTimeMs:i}=r.loadPolicy;if(s)for(const t in s)e.setRequestHeader(t,s[t]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=n&&R(n)?n:i,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const s=t.readyState,n=this.config;if(!r.aborted&&s>=2&&(0===r.loading.first&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),n.timeout!==n.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),n.timeout=n.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),4===s)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const s=t.status,l="text"===t.responseType?t.responseText:null;if(s>=200&&s<300){const n=null!=l?l:t.response;if(null!=n){var i,a;r.loading.end=Math.max(self.performance.now(),r.loading.first);const o="arraybuffer"===t.responseType?n.byteLength:n.length;r.loaded=r.total=o,r.bwEstimate=8e3*r.total/(r.loading.end-r.loading.first);const l=null==(i=this.callbacks)?void 0:i.onProgress;l&&l(r,e,n,t);const u={url:t.responseURL,data:n,code:s};return void(null==(a=this.callbacks)||a.onSuccess(u,r,e,t))}}const u=n.loadPolicy.errorRetry;var o;if(Kt(u,r.retry,!1,{url:e.url,data:void 0,code:s}))this.retry(u);else Z.error(`${s} while loading ${e.url}`),null==(o=this.callbacks)||o.onError({code:s,text:t.statusText},e,t,r)}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry;if(Kt(e,this.stats.retry,!0))this.retry(e);else{var t;Z.warn(`timeout while loading ${null==(t=this.context)?void 0:t.url}`);const e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=jt(e,r.retry),r.retry++,Z.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${null==t?void 0:t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&hl.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const gl=z(z({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:6e7,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:fl,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class extends q{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=e=>{var t;const{fragCurrent:r,partCurrent:s,hls:n}=this,{autoLevelEnabled:i,media:a}=n;if(!r||!a)return;const o=performance.now(),l=s?s.stats:r.stats,u=s?s.duration:r.duration,c=o-l.loading.start,d=n.minAutoLevel,h=r.level,f=this._nextAutoLevel;if(l.aborted||l.loaded&&l.loaded===l.total||h<=d)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!i)return;const g=f>-1&&f!==h,p=!!e||g;if(!p&&(a.paused||!a.playbackRate||!a.readyState))return;const m=n.mainForwardBufferInfo;if(!p&&null===m)return;const y=this.bwEstimator.getEstimateTTFB(),v=Math.abs(a.playbackRate);if(c<=Math.max(y,u/(2*v)*1e3))return;const b=m?m.len/v:0,E=l.loading.first?l.loading.first-l.loading.start:-1,S=l.loaded&&E>-1,T=this.getBwEstimate(),w=n.levels,k=w[h],_=Math.max(l.loaded,Math.round(u*(r.bitrate||k.averageBitrate)/8));let A=S?c-E:c;A<1&&S&&(A=Math.min(c,8*l.loaded/T));const L=S?1e3*l.loaded/A:0,I=y/1e3,P=L?(_-l.loaded)/L:8*_/T+I;if(P<=b)return;const C=L?8*L:T,D=!0===(null==(t=(null==e?void 0:e.details)||this.hls.latestLevelDetails)?void 0:t.live),O=this.hls.config.abrBandWidthUpFactor;let N,M=Number.POSITIVE_INFINITY;for(N=h-1;N>d;N--){const e=w[N].maxBitrate,t=!w[N].details||D;if(M=this.getTimeToLoadFrag(I,C,u*e,t),M<Math.min(b,u+I))break}if(M>=P)return;if(M>10*u)return;S?this.bwEstimator.sample(c-Math.min(y,E),l.loaded):this.bwEstimator.sampleTTFB(c);const F=w[N].maxBitrate;this.getBwEstimate()*O>F&&this.resetEstimator(F);const $=this.findBestLevel(F,d,N,0,b,1,1);$>-1&&(N=$),this.warn(`Fragment ${r.sn}${s?" part "+s.index:""} of level ${h} is loading too slowly;\n      Fragment duration: ${r.duration.toFixed(3)}\n      Time to underbuffer: ${b.toFixed(3)} s\n      Estimated load time for current fragment: ${P.toFixed(3)} s\n      Estimated load time for down switch fragment: ${M.toFixed(3)} s\n      TTFB estimate: ${0|E} ms\n      Current BW estimate: ${R(T)?0|T:"Unknown"} bps\n      New BW estimate: ${0|this.getBwEstimate()} bps\n      Switching to level ${N} @ ${0|F} bps`),n.nextLoadLevel=n.nextAutoLevel=N,this.clearTimer();const U=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===N&&N>0){const e=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${N>0?"and switching down":""}\n      Fragment duration: ${r.duration.toFixed(3)} s\n      Time to underbuffer: ${e.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,N>d){let t=this.findBestLevel(this.hls.levels[d].bitrate,d,N,0,e,1,1);-1===t&&(t=d),this.hls.nextLoadLevel=this.hls.nextAutoLevel=t,this.resetEstimator(this.hls.levels[t].bitrate)}}};g||P>2*M?U():this.timer=self.setInterval(U,1e3*M),n.trigger(x.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:s,stats:l})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new G(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.FRAG_LOADING,this.onFragLoading,this),e.on(x.FRAG_LOADED,this.onFragLoaded,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this),e.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.FRAG_LOADING,this.onFragLoading,this),e.off(x.FRAG_LOADED,this.onFragLoaded,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this),e.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(x.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){var s;if(!r.bitrateTest)this.fragCurrent=r,this.partCurrent=null!=(s=t.part)?s:null;this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case D.BUFFER_ADD_CODEC_ERROR:case D.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case D.FRAG_LOAD_TIMEOUT:{const e=t.frag,{fragCurrent:r,partCurrent:s}=this;if(e&&r&&e.sn===r.sn&&e.level===r.level){const t=performance.now(),r=s?s.stats:e.stats,n=t-r.loading.start,i=r.loading.first?r.loading.first-r.loading.start:-1;if(r.loaded&&i>-1){const e=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(n-Math.min(e,i),r.loaded)}else this.bwEstimator.sampleTTFB(n)}break}}}getTimeToLoadFrag(e,t,r,s){return e+r/t+(s?e+this.lastLevelLoadSec:0)}onLevelLoaded(e,t){const r=this.hls.config,{loading:s}=t.stats,n=s.end-s.first;R(n)&&(this.lastLevelLoadSec=n/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:r}){const s=r?r.stats:t.stats;if(t.type===$&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const e=r?r.duration:t.duration,n=this.hls.levels[t.level],i=(n.loaded?n.loaded.bytes:0)+s.loaded,a=(n.loaded?n.loaded.duration:0)+e;n.loaded={bytes:i,duration:a},n.realBitrate=Math.round(8*i/a)}if(t.bitrateTest){const e={stats:s,frag:t,part:r,id:t.type};this.onFragBuffered(x.FRAG_BUFFERED,e),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:s}=t,n=null!=s&&s.stats.loaded?s.stats:r.stats;if(n.aborted)return;if(this.ignoreFragment(r))return;const i=n.parsing.end-n.loading.start-Math.min(n.loading.first-n.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(i,n.loaded),n.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==$||"initSegment"===e.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,n=this.findBestLevel(r,t,e,0,s,1,1);if(n>-1)return n;const i=this.hls.firstLevel,a=Math.min(Math.max(i,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${i} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,t=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(!(-1===e||t&&r&&this.nextAutoLevelKey!==this.getAutoLevelKey()))return e;const s=t&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){const t=this.hls.levels;if(t.length>Math.max(e,s)&&t[e].loadError<=t[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this;if(r.levels.length<=1)return r.loadLevel;const{maxAutoLevel:s,config:n,minAutoLevel:i}=r,a=t?t.duration:e?e.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay();let u=n.abrBandWidthFactor,c=n.abrBandWidthUpFactor;if(l){const e=this.findBestLevel(o,i,s,l,0,u,c);if(e>=0)return this.rebufferNotice=-1,e}let d=a?Math.min(a,n.maxStarvationDelay):n.maxStarvationDelay;if(!l){const e=this.bitrateTestDelay;if(e){d=(a?Math.min(a,n.maxLoadingDelay):n.maxLoadingDelay)-e,this.info(`bitrate test took ${Math.round(1e3*e)}ms, set first fragment max fetchDuration to ${Math.round(1e3*d)} ms`),u=c=1}}const h=this.findBestLevel(o,i,s,l,d,u,c);if(this.rebufferNotice!==h&&(this.rebufferNotice=h,this.info(`${l?"rebuffering expected":"buffer is empty"}, optimal quality level ${h}`)),h>-1)return h;const f=r.levels[i],g=r.loadLevelObj;return g&&(null==f?void 0:f.bitrate)<g.bitrate?i:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,s,n,i,a){var o;const l=s+n,u=this.lastLoadedFragLevel,c=-1===u?this.hls.firstLevel:u,{fragCurrent:d,partCurrent:h}=this,{levels:f,allAudioTracks:g,loadLevel:p,config:m}=this.hls;if(1===f.length)return 0;const y=f[c],v=!(null==(o=this.hls.latestLevelDetails)||!o.live),b=-1===p||-1===u;let E,S="SDR",T=(null==y?void 0:y.frameRate)||0;const{audioPreference:w,videoPreference:k}=m,_=this.audioTracksByGroup||(this.audioTracksByGroup=_t(g));let A=-1;if(b){if(-1!==this.firstSelection)return this.firstSelection;const s=this.codecTiers||(this.codecTiers=function(e,t,r,s){return e.slice(r,s+1).reduce((e,r,s)=>{if(!r.codecSet)return e;const n=r.audioGroups;let i=e[r.codecSet];i||(e[r.codecSet]=i={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:s,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!n,fragmentError:0}),i.minBitrate=Math.min(i.minBitrate,r.bitrate);const a=Math.min(r.height,r.width);return i.minHeight=Math.min(i.minHeight,a),i.minFramerate=Math.min(i.minFramerate,r.frameRate),i.minIndex=Math.min(i.minIndex,s),i.maxScore=Math.max(i.maxScore,r.score),i.fragmentError+=r.fragmentError,i.videoRanges[r.videoRange]=(i.videoRanges[r.videoRange]||0)+1,n&&n.forEach(e=>{if(!e)return;const r=t.groups[e];r&&(i.hasDefaultAudio=i.hasDefaultAudio||t.hasDefaultAudio?r.hasDefault:r.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(r.channels).forEach(e=>{i.channels[e]=(i.channels[e]||0)+r.channels[e]}))}),e},{})}(f,_,t,r)),n=function(e,t,r,s,n){const i=Object.keys(e),a=null==s?void 0:s.channels,o=null==s?void 0:s.audioCodec,l=null==n?void 0:n.videoCodec,u=a&&2===parseInt(a);let c=!1,d=!1,h=1/0,f=1/0,g=1/0,p=1/0,m=0,y=[];const{preferHDR:v,allowedVideoRanges:b}=Tt(t,n);for(let t=i.length;t--;){const r=e[i[t]];c||(c=r.channels[2]>0),h=Math.min(h,r.minHeight),f=Math.min(f,r.minFramerate),g=Math.min(g,r.minBitrate),b.filter(e=>r.videoRanges[e]>0).length>0&&(d=!0)}h=R(h)?h:0,f=R(f)?f:0;const E=Math.max(1080,h),S=Math.max(30,f);g=R(g)?g:r,r=Math.max(g,r),d||(t=void 0);const T=i.length>1;return{codecSet:i.reduce((t,s)=>{const n=e[s];if(s===t)return t;if(y=d?b.filter(e=>n.videoRanges[e]>0):[],T){if(n.minBitrate>r)return kt(s,`min bitrate of ${n.minBitrate} > current estimate of ${r}`),t;if(!n.hasDefaultAudio)return kt(s,"no renditions with default or auto-select sound found"),t;if(o&&s.indexOf(o.substring(0,4))%5!=0)return kt(s,`audio codec preference "${o}" not found`),t;if(a&&!u){if(!n.channels[a])return kt(s,`no renditions with ${a} channel sound found (channels options: ${Object.keys(n.channels)})`),t}else if((!o||u)&&c&&0===n.channels[2])return kt(s,"no renditions with stereo sound found"),t;if(n.minHeight>E)return kt(s,`min resolution of ${n.minHeight} > maximum of ${E}`),t;if(n.minFramerate>S)return kt(s,`min framerate of ${n.minFramerate} > maximum of ${S}`),t;if(!y.some(e=>n.videoRanges[e]>0))return kt(s,`no variants with VIDEO-RANGE of ${wt(y)} found`),t;if(l&&s.indexOf(l.substring(0,4))%5!=0)return kt(s,`video codec preference "${l}" not found`),t;if(n.maxScore<m)return kt(s,`max score of ${n.maxScore} < selected max of ${m}`),t}return t&&(Xe(s)>=Xe(t)||n.fragmentError>e[t].fragmentError)?t:(p=n.minIndex,m=n.maxScore,s)},void 0),videoRanges:y,preferHDR:v,minFramerate:f,minBitrate:g,minIndex:p}}(s,S,e,w,k),{codecSet:i,videoRanges:a,minFramerate:o,minBitrate:l,minIndex:u,preferHDR:c}=n;A=u,E=i,S=c?a[a.length-1]:a[0],T=o,e=Math.max(e,l),this.log(`picked start tier ${wt(n)}`)}else E=null==y?void 0:y.codecSet,S=null==y?void 0:y.videoRange;const L=h?h.duration:d?d.duration:0,I=this.bwEstimator.getEstimateTTFB()/1e3,P=[];for(let o=r;o>=t;o--){var C;const t=f[o],d=o>c;if(!t)continue;if(m.useMediaCapabilities&&!t.supportedResult&&!t.supportedPromise){const r=navigator.mediaCapabilities;"function"==typeof(null==r?void 0:r.decodingInfo)&&ut(t,_,S,T,e,w)?(t.supportedPromise=ct(t,_,r,this.supportedCache),t.supportedPromise.then(e=>{if(!this.hls)return;t.supportedResult=e;const r=this.hls.levels,s=r.indexOf(t);e.error?this.warn(`MediaCapabilities decodingInfo error: "${e.error}" for level ${s} ${wt(e)}`):e.supported?e.decodingInfoResults.some(e=>!1===e.smooth||!1===e.powerEfficient)&&this.log(`MediaCapabilities decodingInfo for level ${s} not smooth or powerEfficient: ${wt(e)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${s} ${wt(e)}`),s>-1&&r.length>1&&(this.log(`Removing unsupported level ${s}`),this.hls.removeLevel(s),-1===this.hls.loadLevel&&(this.hls.nextLoadLevel=0)))}).catch(e=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${e}`)})):t.supportedResult=ot}if((E&&t.codecSet!==E||S&&t.videoRange!==S||d&&T>t.frameRate||!d&&T>0&&T<t.frameRate||null!=(C=t.supportedResult)&&null!=(C=C.decodingInfoResults)&&C.some(e=>!1===e.smooth))&&(!b||o!==A)){P.push(o);continue}const g=t.details,y=(h?null==g?void 0:g.partTarget:null==g?void 0:g.averagetargetduration)||L;let k;k=d?a*e:i*e;const D=L&&s>=2*L&&0===n?t.averageBitrate:t.maxBitrate,x=this.getTimeToLoadFrag(I,k,D*y,void 0===g);if(k>=D&&(o===u||0===t.loadError&&0===t.fragmentError)&&(x<=I||!R(x)||v&&!this.bitrateTestDelay||x<l)){const e=this.forcedAutoLevel;return o===p||-1!==e&&e===p||(P.length&&this.trace(`Skipped level(s) ${P.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${f[P[0]].codecs}" ${f[P[0]].videoRange}; not compatible with "${E}" ${S}`),this.info(`switch candidate:${c}->${o} adjustedbw(${Math.round(k)})-bitrate=${Math.round(k-D)} ttfb:${I.toFixed(1)} avgDuration:${y.toFixed(1)} maxFetchDuration:${l.toFixed(1)} fetchDuration:${x.toFixed(1)} firstSelection:${b} codecSet:${t.codecSet} videoRange:${t.videoRange} hls.loadLevel:${p}`)),b&&(this.firstSelection=o),o}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls;return Math.min(Math.max(e,r),t)}},bufferController:class extends q{constructor(e,t){var r;super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=e=>{var t;this.hls&&"open"===(null==(t=this.mediaSource)?void 0:t.readyState)&&this.hls.pauseBuffering()},this._onStartStreaming=e=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=e=>{const{media:t,mediaSource:r}=this;e&&this.log("Media source opened"),t&&r&&(r.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(x.MEDIA_ATTACHED,{media:t,mediaSource:r}),null!==this.mediaSource&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:e,_objectUrl:t}=this;e!==t&&this.error(`Media element src was set while attaching MediaSource (${t} > ${e})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=(r=ee(e.config.preferManagedMediaSource),"undefined"!=typeof self&&r===self.ManagedMediaSource),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.BUFFER_RESET,this.onBufferReset,this),e.on(x.BUFFER_APPENDING,this.onBufferAppending,this),e.on(x.BUFFER_CODECS,this.onBufferCodecs,this),e.on(x.BUFFER_EOS,this.onBufferEos,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(x.FRAG_PARSED,this.onFragParsed,this),e.on(x.FRAG_CHANGED,this.onFragChanged,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.BUFFER_RESET,this.onBufferReset,this),e.off(x.BUFFER_APPENDING,this.onBufferAppending,this),e.off(x.BUFFER_CODECS,this.onBufferCodecs,this),e.off(x.BUFFER_EOS,this.onBufferEos,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(x.FRAG_PARSED,this.onFragParsed,this),e.off(x.FRAG_CHANGED,this.onFragChanged,this),e.off(x.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const r={};if(this.operationQueue){const e=this.isUpdating();e||this.operationQueue.removeBlockers();const t=this.isQueued();(e||t)&&this.warn(`Transfering MediaSource with${t?" operations in queue":""}${e?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===t?H(r,s.tracks):this.sourceBuffers.forEach(e=>{const[t]=e;t&&(r[t]=H({},this.tracks[t]),this.removeBuffer(t)),e[0]=e[1]=null}),{media:e,mediaSource:t,tracks:r}}initTracks(){this.sourceBuffers=[[null,null],[null,null]],this.tracks={},this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var r;let s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(`${s} bufferCodec event(s) expected.`),null!=(r=this.transferData)&&r.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()}onMediaAttaching(e,t){const r=this.media=t.media;this.transferData=this.overrides=void 0;const s=ee(this.appendSource);if(s){const e=!!t.mediaSource;(e||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const n=this.mediaSource=t.mediaSource||new s;if(this.assignMediaSource(n),e)this._objectUrl=r.src,this.attachTransferred();else{const e=this._objectUrl=self.URL.createObjectURL(n);if(this.appendSource)try{r.removeAttribute("src");const t=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||t&&n instanceof t,ji(r),function(e,t){const r=self.document.createElement("source");r.type="video/mp4",r.src=t,e.appendChild(r)}(r,e),r.load()}catch(t){r.src=e}else r.src=e}r.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,r;this.log(`${(null==(t=this.transferData)?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${null==(r=e.constructor)?void 0:r.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const r=this.tracks,s=t.tracks,n=s?Object.keys(s):null,i=n?n.length:0,a=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(s&&n&&i){if(!this.tracksReady)return this.hls.config.startFragPrefetch=!0,void this.log("attachTransferred: waiting for SourceBuffer track info");if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})\nrequired tracks: ${wt(r,(e,t)=>"initSegment"===e?void 0:t)};\ntransfer tracks: ${wt(s,(e,t)=>"initSegment"===e?void 0:t)}}`),!te(s,r)){t.mediaSource=null,t.tracks=void 0;const n=e.currentTime,i=this.details,a=Math.max(n,(null==i?void 0:i.fragments[0].start)||0);return a-n>1?void this.log(`attachTransferred: waiting for playback to reach new tracks start time ${n} -> ${a}`):(this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(s)}"->"${Object.keys(r)}") start time: ${a} currentTime: ${n}`),this.onMediaDetaching(x.MEDIA_DETACHING,{}),this.onMediaAttaching(x.MEDIA_ATTACHING,t),void(e.currentTime=a))}this.transferData=void 0,n.forEach(e=>{const t=e,r=s[t];if(r){const e=r.buffer;if(e){const s=this.fragmentTracker,n=r.id;if(s.hasFragments(n)||s.hasParts(n)){const r=Tr.getBuffered(e);s.detectEvictedFragments(t,r,n,null,!0)}const i=Gi(t),a=[t,e];this.sourceBuffers[i]=a,e.updating&&this.operationQueue&&this.operationQueue.prependBlocker(t),this.trackSourceBuffer(t,r)}}}),a(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),a()}get mediaSourceOpenOrEnded(){var e;const t=null==(e=this.mediaSource)?void 0:e.readyState;return"open"===t||"ended"===t}onMediaDetaching(e,t){const r=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:s,mediaSource:n,_objectUrl:i}=this;if(n){if(this.log("media source "+(r?"transferring":"detaching")),r)this.sourceBuffers.forEach(([e])=>{e&&this.removeBuffer(e)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const e="open"===n.readyState;try{const t=n.sourceBuffers;for(let r=t.length;r--;)e&&t[r].abort(),n.removeSourceBuffer(t[r]);e&&n.endOfStream()}catch(e){this.warn(`onMediaDetaching: ${e.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}n.removeEventListener("sourceopen",this._onMediaSourceOpen),n.removeEventListener("sourceended",this._onMediaSourceEnded),n.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(n.removeEventListener("startstreaming",this._onStartStreaming),n.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}s&&(s.removeEventListener("emptied",this._onMediaEmptied),r||(i&&self.URL.revokeObjectURL(i),this.mediaSrc===i?(s.removeAttribute("src"),this.appendSource&&ji(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(x.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const r=null==(t=this.tracks[e])?void 0:t.buffer;if(this.removeBuffer(e),r)try{var s;null!=(s=this.mediaSource)&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(r)}catch(t){this.warn(`onBufferReset ${e}`,t)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Gi(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new Fi(this.tracks)}onBufferCodecs(e,t){var r;const s=this.tracks,n=Object.keys(t);this.log(`BUFFER_CODECS: "${n}" (current SB count ${this.sourceBufferCount})`);const i="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),a=!i&&this.sourceBufferCount&&this.media&&n.some(e=>!s[e]);i||a?this.warn(`Unsupported transition between "${Object.keys(s)}" and "${n}" SourceBuffers`):(n.forEach(e=>{var r,n;const i=t[e],{id:a,codec:o,levelCodec:l,container:u,metadata:c,supplemental:d}=i;let h=s[e];const f=null==(r=this.transferData)||null==(r=r.tracks)?void 0:r[e],g=null!=f&&f.buffer?f:h,p=(null==g?void 0:g.pendingCodec)||(null==g?void 0:g.codec),m=null==g?void 0:g.levelCodec;h||(h=s[e]={buffer:void 0,listeners:[],codec:o,supplemental:d,container:u,levelCodec:l,metadata:c,id:a});const y=tt(p,m),v=null==y?void 0:y.replace($i,"$1");let b=tt(o,l);const E=null==(n=b)?void 0:n.replace($i,"$1");b&&y&&v!==E&&("audio"===e.slice(0,5)&&(b=et(b,this.appendSource)),this.log(`switching codec ${p} to ${b}`),b!==(h.pendingCodec||h.codec)&&(h.pendingCodec=b),h.container=u,this.appendChangeType(e,u,b))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),this.sourceBufferCount||(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&"main"===(null==(r=t.audio)?void 0:r.id)&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks()))}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const r=this.tracks[t];return e[t]={id:r.id,container:r.container,codec:r.codec,levelCodec:r.levelCodec},e},{})}appendChangeType(e,t,r){const s=`${t};codecs=${r}`,n={label:`change-type=${s}`,execute:()=>{const n=this.tracks[e];if(n){const i=n.buffer;null!=i&&i.changeType&&(this.log(`changing ${e} sourceBuffer type to ${s}`),i.changeType(s),n.codec=r,n.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{this.warn(`Failed to change ${e} SourceBuffer type`,t)}};this.append(n,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const r=e.start,s=r+.05*e.duration;if(!0===(null==(t=this.fragmentTracker.getAppendedFrag(r,$))?void 0:t.gap))return;const n={label:"block-audio",execute:()=>{var e;const t=this.tracks.video;(this.lastVideoAppendEnd>s||null!=t&&t.buffer&&Tr.isBuffered(t.buffer,s)||!0===(null==(e=this.fragmentTracker.getAppendedFrag(s,$))?void 0:e.gap))&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:e=>{this.warn("Error executing block-audio operation",e)}};this.blockedAudioAppend={op:n,frag:e},this.append(n,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:r}=this,{data:s,type:n,parent:i,frag:a,part:o,chunkMeta:l,offset:u}=t,c=l.buffering[n],{sn:d,cc:h}=a,f=self.performance.now();c.start=f;const g=a.stats.buffering,p=o?o.stats.buffering:null;0===g.start&&(g.start=f),p&&0===p.start&&(p.start=f);const m=r.audio;let y=!1;"audio"===n&&"audio/mpeg"===(null==m?void 0:m.container)&&(y=!this.lastMpegAudioChunk||1===l.id||this.lastMpegAudioChunk.sn!==l.sn,this.lastMpegAudioChunk=l);const v=r.video,b=null==v?void 0:v.buffer;if(b&&"initSegment"!==d){const e=o||a,t=this.blockedAudioAppend;if("audio"!==n||"main"===i||this.blockedAudioAppend||v.ending||v.ended){if("video"===n){const r=e.end;if(t){const e=t.frag.start;(r>e||r<this.lastVideoAppendEnd||Tr.isBuffered(b,e))&&this.unblockAudio()}this.lastVideoAppendEnd=r}}else{const t=e.start+.05*e.duration,r=b.buffered,s=this.currentOp("video");r.length||s?!s&&!Tr.isBuffered(b,t)&&this.lastVideoAppendEnd<t&&this.blockAudio(e):this.blockAudio(e)}}const E=(o||a).start,S={label:`append-${n}`,execute:()=>{var e;c.executeStart=self.performance.now();const t=null==(e=this.tracks[n])?void 0:e.buffer;t&&(y?this.updateTimestampOffset(t,E,.1,n,d,h):void 0!==u&&R(u)&&this.updateTimestampOffset(t,u,1e-6,n,d,h)),this.appendExecutor(s,n)},onStart:()=>{},onComplete:()=>{const e=self.performance.now();c.executeEnd=c.end=e,0===g.first&&(g.first=e),p&&0===p.first&&(p.first=e);const t={};this.sourceBuffers.forEach(([e,r])=>{e&&(t[e]=Tr.getBuffered(r))}),this.appendErrors[n]=0,"audio"===n||"video"===n?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(x.BUFFER_APPENDED,{type:n,frag:a,part:o,chunkMeta:l,parent:a.type,timeRanges:t})},onError:e=>{var t;const r={type:C.MEDIA_ERROR,parent:a.type,details:D.BUFFER_APPEND_ERROR,sourceBufferName:n,frag:a,part:o,chunkMeta:l,error:e,err:e,fatal:!1},s=null==(t=this.media)?void 0:t.error;if(e.code===DOMException.QUOTA_EXCEEDED_ERR||"QuotaExceededError"==e.name||"quota"in e)r.details=D.BUFFER_FULL_ERROR;else if(e.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!s)r.errorAction=Zt(!0);else if(e.name===Ui&&0===this.sourceBufferCount)r.errorAction=Zt(!0);else{const e=++this.appendErrors[n];this.warn(`Failed ${e}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${n}" sourceBuffer (${s||"no media error"})`),(e>=this.hls.config.appendErrorMaxRetry||s)&&(r.fatal=!0)}this.hls.trigger(x.ERROR,r)}};this.log(`queuing "${n}" append sn: ${d}${o?" p: "+o.index:""} of ${a.type===$?"level":"track"} ${a.level} cc: ${h}`),this.append(S,n,this.isPending(this.tracks[n]))}getFlushOp(e,t,r){return this.log(`queuing "${e}" remove ${t}-${r}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,r)},onStart:()=>{},onComplete:()=>{this.hls.trigger(x.BUFFER_FLUSHED,{type:e})},onError:s=>{this.warn(`Failed to remove ${t}-${r} from "${e}" SourceBuffer`,s)}}}onBufferFlushing(e,t){const{type:r,startOffset:s,endOffset:n}=t;r?this.append(this.getFlushOp(r,s,n),r):this.sourceBuffers.forEach(([e])=>{e&&this.append(this.getFlushOp(e,s,n),e)})}onFragParsed(e,t){const{frag:r,part:s}=t,n=[],i=s?s.elementaryStreams:r.elementaryStreams;i[he]?n.push("audiovideo"):(i[ce]&&n.push("audio"),i[de]&&n.push("video"));0===n.length&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(()=>{const e=self.performance.now();r.stats.buffering.end=e,s&&(s.stats.buffering.end=e);const t=s?s.stats:r.stats;this.hls.trigger(x.FRAG_BUFFERED,{frag:r,part:s,stats:t,id:r.type})},n).catch(e=>{this.warn(`Fragment buffered callback ${e}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var r;this.sourceBuffers.forEach(([e])=>{if(e){const r=this.tracks[e];t.type&&t.type!==e||(r.ending=!0,r.ended||(r.ended=!0,this.log(`${e} buffer reached EOS`)))}});const s=!1!==(null==(r=this.overrides)?void 0:r.endOfStream);this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{var t;return e&&!(null!=(t=this.tracks[e])&&t.ended)})?s?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:e}=this;e&&"open"===e.readyState?(this.log("Calling mediaSource.endOfStream()"),e.endOfStream(),this.hls.trigger(x.BUFFERED_TO_END,void 0)):e&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${e.readyState}`)})):(this.tracksEnded(),this.hls.trigger(x.BUFFERED_TO_END,void 0)):"video"===t.type&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(null!==e){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===D.BUFFER_APPEND_ERROR&&t.frag){var r;const e=null==(r=t.errorAction)?void 0:r.nextAutoLevel;R(e)&&e!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||null===t)return;if(!this.sourceBufferCount)return;const s=e.config,n=r.currentTime,i=t.levelTargetDuration,a=t.live&&null!==s.liveBackBufferLength?s.liveBackBufferLength:s.backBufferLength;if(R(a)&&a>=0){const e=Math.max(a,i),t=Math.floor(n/i)*i-e;this.flushBackBuffer(n,i,t)}const o=s.frontBufferFlushThreshold;if(R(o)&&o>0){const e=Math.max(s.maxBufferLength,o),t=Math.max(e,i),r=Math.floor(n/i)*i+t;this.flushFrontBuffer(n,i,r)}}flushBackBuffer(e,t,r){this.sourceBuffers.forEach(([e,t])=>{if(t){const n=Tr.getBuffered(t);if(n.length>0&&r>n.start(0)){var s;this.hls.trigger(x.BACK_BUFFER_REACHED,{bufferEnd:r});const t=this.tracks[e];if(null!=(s=this.details)&&s.live)this.hls.trigger(x.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(null!=t&&t.ended)return void this.log(`Cannot flush ${e} back buffer while SourceBuffer is in ended state`);this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:e})}}})}flushFrontBuffer(e,t,r){this.sourceBuffers.forEach(([t,s])=>{if(s){const n=Tr.getBuffered(s),i=n.length;if(i<2)return;const a=n.start(i-1),o=n.end(i-1);if(r>a||e>=a&&e<=o)return;this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:a,endOffset:1/0,type:t})}})}getDurationAndRange(){var e;const{details:t,mediaSource:r}=this;if(!t||!this.media||"open"!==(null==r?void 0:r.readyState))return null;const s=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&r.setLiveSeekableRange){const e=Math.max(0,t.fragmentStart);return{duration:1/0,start:e,end:Math.max(e,s)}}return{duration:1/0}}const n=null==(e=this.overrides)?void 0:e.duration;if(n)return R(n)?{duration:n}:null;const i=this.media.duration;return s>(R(r.duration)?r.duration:0)&&s>i||!R(i)?{duration:s}:null}updateMediaSource({duration:e,start:t,end:r}){const s=this.mediaSource;this.media&&s&&"open"===s.readyState&&(s.duration!==e&&(R(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),s.duration=e),void 0!==t&&void 0!==r&&(this.log(`MediaSource duration is set to ${s.duration}. Setting seekable range to ${t}-${r}.`),s.setLiveSeekableRange(t,r)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:r}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${wt(r)}`),this.tracksReady){var s;const e=null==(s=this.transferData)?void 0:s.tracks;e&&Object.keys(e).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,r])=>{if(t){const s=this.tracks[t];e[t]={buffer:r,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(x.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([e])=>{this.executeNext(e)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(x.ERROR,{type:C.MEDIA_ERROR,details:D.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:r}=this;if(!r)throw new Error("createSourceBuffers called when mediaSource was null");for(const n in e){const i=n,a=e[i];if(this.isPending(a)){const e=this.getTrackCodec(a,i),n=`${a.container};codecs=${e}`;a.codec=e,this.log(`creating sourceBuffer(${n})${this.currentOp(i)?" Queued":""} ${wt(a)}`);try{const e=r.addSourceBuffer(n),s=Gi(i),o=[i,e];t[s]=o,a.buffer=e}catch(e){var s;return this.error(`error while trying to add sourceBuffer: ${e.message}`),this.shiftAndExecuteNext(i),null==(s=this.operationQueue)||s.removeBlockers(),delete this.tracks[i],void this.hls.trigger(x.ERROR,{type:C.MEDIA_ERROR,details:D.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,sourceBufferName:i,mimeType:n,parent:a.id})}this.trackSourceBuffer(i,a)}}this.bufferCreated()}getTrackCodec(e,t){const r=e.supplemental;let s=e.codec;r&&("video"===t||"audiovideo"===t)&&qe(r,"video")&&(s=function(e,t){const r=[];if(e){const t=e.split(",");for(let e=0;e<t.length;e++)ze(t[e],"video")||r.push(t[e])}return t&&r.push(t),r.join(",")}(s,r));const n=tt(s,e.levelCodec);return n?"audio"===t.slice(0,5)?et(n,this.appendSource):n:""}trackSourceBuffer(e,t){const r=t.buffer;if(!r)return;const s=this.getTrackCodec(t,e);this.tracks[e]={buffer:r,codec:s,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(e,t)=>{const r=t.removedRanges;null!=r&&r.length&&this.hls.trigger(x.BUFFER_FLUSHED,{type:e})})}get mediaSrc(){var e,t;const r=(null==(e=this.media)||null==(t=e.querySelector)?void 0:t.call(e,"source"))||this.media;return null==r?void 0:r.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if("closed"===(null==(t=this.mediaSource)?void 0:t.readyState))return void this.resetBuffer(e);const r=this.currentOp(e);r&&(r.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var r;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${null==(r=this.mediaSource)?void 0:r.readyState}`);this.error(`${s}`,t),this.hls.trigger(x.ERROR,{type:C.MEDIA_ERROR,details:D.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const n=this.currentOp(e);n&&n.onError(s)}updateTimestampOffset(e,t,r,s,n,i){const a=t-e.timestampOffset;Math.abs(a)>=r&&(this.log(`Updating ${s} SourceBuffer timestampOffset to ${t} (sn: ${n} cc: ${i})`),e.timestampOffset=t)}removeExecutor(e,t,r){const{media:s,mediaSource:n}=this,i=this.tracks[e],a=null==i?void 0:i.buffer;if(!s||!n||!a)return this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),void this.shiftAndExecuteNext(e);const o=R(s.duration)?s.duration:1/0,l=R(n.duration)?n.duration:1/0,u=Math.max(0,t),c=Math.min(r,o,l);c>u&&(!i.ending||i.ended)?(i.ended=!1,this.log(`Removing [${u},${c}] from the ${e} SourceBuffer`),a.remove(u,c)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.tracks[t],s=null==r?void 0:r.buffer;if(!s)throw new Bi(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);r.ending=!1,r.ended=!1,s.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(e=>{this.warn(`SourceBuffer blocked callback ${e}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(e){this.warn(`Callback run without blocking ${this.operationQueue} ${e}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:r}=this,s=t.map(e=>this.appendBlocker(e));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(s).then(t=>{r===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(e=>{var t;const r=null==(t=this.tracks[e])?void 0:t.buffer;r&&!r.updating&&this.shiftAndExecuteNext(e)})}append(e,t,r){this.operationQueue&&this.operationQueue.append(e,t,r)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,r){const s=this.tracks[e];if(!s)return;const n=s.buffer;if(!n)return;const i=r.bind(this,e);s.listeners.push({event:t,listener:i}),n.addEventListener(t,i)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const r=t.buffer;r&&(t.listeners.forEach(e=>{r.removeEventListener(e.event,e.listener)}),t.listeners.length=0)}},capLevelController:Ki,errorController:class extends q{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(x.ERROR,this.onError,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(x.ERROR,this.onError,this),e.off(x.ERROR,this.onErrorOut,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(null==e?void 0:e.type)===$?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,r=t.currentLevel;return null!=(e=t.loadLevelObj)&&e.details||-1===r?t.loadLevel:r}variantHasKey(e,t){if(e){var r;if(null!=(r=e.details)&&r.hasKey(t))return!0;const s=e.audioGroups;if(s){return this.hls.allAudioTracks.filter(e=>s.indexOf(e.groupId)>=0).some(e=>{var r;return null==(r=e.details)?void 0:r.hasKey(t)})}}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var r;if(t.fatal)return;const s=this.hls,n=t.context;switch(t.details){case D.FRAG_LOAD_ERROR:case D.FRAG_LOAD_TIMEOUT:case D.KEY_LOAD_ERROR:case D.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case D.FRAG_PARSING_ERROR:if(null!=(r=t.frag)&&r.gap)return void(t.errorAction=Zt());case D.FRAG_GAP:case D.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=zt);case D.LEVEL_EMPTY_ERROR:case D.LEVEL_PARSING_ERROR:{var i;const e=t.parent===$?t.level:s.loadLevel;t.details===D.LEVEL_EMPTY_ERROR&&null!=(i=t.context)&&null!=(i=i.levelDetails)&&i.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case D.LEVEL_LOAD_ERROR:case D.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==n?void 0:n.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.level)));case D.AUDIO_TRACK_LOAD_ERROR:case D.AUDIO_TRACK_LOAD_TIMEOUT:case D.SUBTITLE_LOAD_ERROR:case D.SUBTITLE_TRACK_LOAD_TIMEOUT:if(n){const e=s.loadLevelObj;if(e&&(n.type===M&&e.hasAudioGroup(n.groupId)||n.type===F&&e.hasSubtitleGroup(n.groupId)))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=zt,void(t.errorAction.flags=Qt)}return;case D.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:return void(t.errorAction={action:zt,flags:Xt});case D.KEY_SYSTEM_SESSION_UPDATE_FAILED:case D.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case D.KEY_SYSTEM_NO_SESSION:return void(t.errorAction={action:zt,flags:Jt});case D.BUFFER_ADD_CODEC_ERROR:case D.REMUX_ALLOC_ERROR:case D.BUFFER_APPEND_ERROR:var a;if(!t.errorAction)t.errorAction=this.getLevelSwitchAction(t,null!=(a=t.level)?a:s.loadLevel);return;case D.INTERNAL_EXCEPTION:case D.BUFFER_APPENDING_ERROR:case D.BUFFER_FULL_ERROR:case D.LEVEL_SWITCH_ERROR:case D.BUFFER_STALLED_ERROR:case D.BUFFER_SEEK_OVER_HOLE:case D.BUFFER_NUDGE_ON_STALL:return void(t.errorAction=Zt())}t.type===C.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Zt())}getPlaylistRetryOrSwitchAction(e,t){const r=Bt(this.hls.config.playlistLoadPolicy,e),s=this.playlistError++;if(Kt(r,s,Ft(e),e.response))return{action:Wt,flags:Yt,retryConfig:r,retryCount:s};const n=this.getLevelSwitchAction(e,t);return r&&(n.retryConfig=r,n.retryCount=s),n}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),s=t.levels[r],{fragLoadPolicy:n,keyLoadPolicy:i}=t.config,a=Bt($t(e)?i:n,e),o=t.levels.reduce((e,t)=>e+t.fragmentError,0);if(s&&(e.details!==D.FRAG_GAP&&s.fragmentError++,!Ut(e))){if(Kt(a,o,Ft(e),e.response))return{action:Wt,flags:Yt,retryConfig:a,retryCount:o}}const l=this.getLevelSwitchAction(e,r);return a&&(l.retryConfig=a,l.retryCount=o),l}getLevelSwitchAction(e,t){const r=this.hls;null==t&&(t=r.loadLevel);const s=this.hls.levels[t];if(s){var n,i;const t=e.details;s.loadError++,t===D.BUFFER_APPEND_ERROR&&s.fragmentError++;let l=-1;const{levels:u,loadLevel:c,minAutoLevel:d,maxAutoLevel:h}=r;r.autoLevelEnabled||r.config.preserveManualLevelOnError||(r.loadLevel=-1);const f=null==(n=e.frag)?void 0:n.type,g=(f===U&&t===D.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(t===D.BUFFER_ADD_CODEC_ERROR||t===D.BUFFER_APPEND_ERROR))&&u.some(({audioCodec:e})=>s.audioCodec!==e),p="video"===e.sourceBufferName&&(t===D.BUFFER_ADD_CODEC_ERROR||t===D.BUFFER_APPEND_ERROR)&&u.some(({codecSet:e,audioCodec:t})=>s.codecSet!==e&&s.audioCodec===t),{type:m,groupId:y}=null!=(i=e.context)?i:{};for(let r=u.length;r--;){const n=(r+c)%u.length;if(n!==c&&n>=d&&n<=h&&0===u[n].loadError){var a,o;const r=u[n];if(t===D.FRAG_GAP&&f===$&&e.frag){const t=u[n].details;if(t){const r=xt(e.frag,t.fragments,e.frag.start);if(null!=r&&r.gap)continue}}else{if(m===M&&r.hasAudioGroup(y)||m===F&&r.hasSubtitleGroup(y))continue;if(f===U&&null!=(a=s.audioGroups)&&a.some(e=>r.hasAudioGroup(e))||f===B&&null!=(o=s.subtitleGroups)&&o.some(e=>r.hasSubtitleGroup(e))||g&&s.audioCodec===r.audioCodec||p&&s.codecSet===r.codecSet||!g&&s.codecSet!==r.codecSet)continue}l=n;break}}if(l>-1&&r.loadLevel!==l)return e.levelRetry=!0,this.playlistError=0,{action:zt,flags:Yt,nextAutoLevel:l}}return{action:zt,flags:Qt}}onErrorOut(e,t){var r;switch(null==(r=t.errorAction)?void 0:r.action){case Vt:break;case zt:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===D.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError()):t.fatal=!0}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:s}=r,n=r.nextAutoLevel;switch(s){case Yt:this.switchLevel(e,n);break;case Xt:{const s=this.getVariantLevelIndex(e.frag),n=t.levels[s],i=null==n?void 0:n.attrs["HDCP-LEVEL"];if(r.hdcpLevel=i,"NONE"===i)this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(i){t.maxHdcpLevel=ft[ft.indexOf(i)-1],r.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Jt:{const t=e.decryptdata;if(t){const s=this.hls.levels,n=s.length;for(let r=n;r--;){var i,a;if(this.variantHasKey(s[r],t))this.log(`Banned key found in level ${r} (${s[r].bitrate}bps) or audio group "${null==(i=s[r].audioGroups)?void 0:i.join(",")}" (${null==(a=e.frag)?void 0:a.type} fragment) ${se(t.keyId||[])}`),s[r].fragmentError++,s[r].loadError++,this.log(`Removing level ${r} with key error (${e.error})`),this.hls.removeLevel(r)}const o=e.frag;if(this.hls.levels.length<n)r.resolved=!0;else if(o&&o.type!==$){const e=o.decryptdata;e&&!t.matches(e)&&(r.resolved=!0)}}break}}r.resolved||this.switchLevel(e,n)}switchLevel(e,t){if(void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===D.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&"audiovideo"!==e.sourceBufferName)){const t=it(e.mimeType),r=this.hls.levels;for(let s=r.length;s--;)r[s][`${e.sourceBufferName}Codec`]===t&&(this.log(`Removing level ${s} for ${e.details} ("${t}" not supported)`),this.hls.removeLevel(s))}}},fpsController:class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(x.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(x.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,r){const s=performance.now();if(t){if(this.lastTime){const e=s-this.lastTime,n=r-this.lastDroppedFrames,i=t-this.lastDecodedFrames,a=1e3*n/e,o=this.hls;if(o.trigger(x.FPS_DROP,{currentDropped:n,currentDecoded:i,totalDroppedFrames:r}),a>0&&n>o.config.fpsDroppedMonitoringThreshold*i){let e=o.currentLevel;o.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=e)&&(e-=1,o.trigger(x.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:o.currentLevel}),o.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Jr,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:ol,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends en{constructor(e,t,r){super(e,t,r,"subtitle-stream-controller",B),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(x.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(x.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=Ks,this.setInterval(500),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:s}=t;if(this.fragContextChanged(r)||(ge(r)&&(this.fragPrevious=r),this.state=Ks),!s)return;const n=this.tracksBuffered[this.currentTrackId];if(!n)return;let i;const a=r.start;for(let e=0;e<n.length;e++)if(a>=n[e].start&&a<=n[e].end){i=n[e];break}const o=r.start+r.duration;i?i.end=o:(i={start:a,end:o},n.push(i)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:r,endOffset:s}=t;if(0===r&&s!==Number.POSITIVE_INFINITY){const e=s-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach(t=>{for(let r=0;r<t.length;)if(t[r].end<=e)t.shift();else{if(!(t[r].start<e))break;t[r].start=e,r++}}),this.fragmentTracker.removeFragmentsInRange(r,e,B)}}onError(e,t){const r=t.frag;(null==r?void 0:r.type)===B&&(t.details===D.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Gs&&(this.state=Ks))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){this.levels&&Oi(this.levels,t)?this.levels=t.map(e=>new Et(e)):(this.tracksBuffered=[],this.levels=t.map(e=>{const t=new Et(e);return this.tracksBuffered[t.id]=[],t}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,B),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,null==(r=this.levels)||!r.length||-1===this.currentTrackId)return void this.clearInterval();const s=this.levels[this.currentTrackId];null!=s&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==Gs&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:s,levels:n}=this,{details:i,id:a}=t;if(!n)return void this.warn(`Subtitle tracks were reset while loading level ${a}`);const o=n[a];if(a>=n.length||!o)return;this.log(`Subtitle track ${a} loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(i.live||null!=(r=o.details)&&r.live){if(i.deltaUpdateFailed)return;const e=this.mainDetails;if(!e)return void(this.startFragRequested=!1);const t=e.fragments[0];var u;if(o.details)l=this.alignPlaylists(i,o.details,null==(u=this.levelLastLoaded)?void 0:u.details),0===l&&t&&(l=t.start,As(i,l));else i.hasProgramDateTime&&e.hasProgramDateTime?($s(i,e),l=i.fragmentStart):t&&(l=t.start,As(i,l));e&&!this.startFragRequested&&this.setStartPosition(e,l)}if(o.details=i,this.levelLastLoaded=o,a===s&&(this.hls.trigger(x.SUBTITLE_TRACK_UPDATED,{details:i,id:a,groupId:t.groupId}),this.tick(),i.live&&!this.fragCurrent&&this.media&&this.state===Ks)){xt(null,i.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,s=t.decryptdata,n=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&null!=s&&s.key&&s.iv&&Fr(s.method)){const e=performance.now();this.decrypter.decrypt(new Uint8Array(r),s.key.buffer,s.iv.buffer,$r(s.method)).catch(e=>{throw n.trigger(x.ERROR,{type:C.MEDIA_ERROR,details:D.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e}).then(r=>{const s=performance.now();n.trigger(x.FRAG_DECRYPTED,{frag:t,payload:r,stats:{tstart:e,tdecrypt:s}})}).catch(e=>{this.warn(`${e.name}: ${e.message}`),this.state=Ks})}}doTick(){if(this.media){if(this.state===Ks){const{currentTrackId:e,levels:t}=this,r=null==t?void 0:t[e];if(!r||!t.length||!r.details)return;if(this.waitForLive(r))return;const{config:s}=this,n=this.getLoadPosition(),i=Tr.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],n,s.maxBufferHole),{end:a,len:o}=i,l=r.details;if(o>this.hls.maxBufferLength+l.levelTargetDuration)return;const u=l.fragments,c=u.length,d=l.edge;let h=null;const f=this.fragPrevious;if(a<d){const e=s.maxFragLookUpTolerance,t=a>d-e?0:e;h=xt(f,u,Math.max(u[0].start,a),t),!h&&f&&f.start<u[0].start&&(h=u[0])}else h=u[c-1];if(h=this.filterReplacedPrimary(h,r.details),!h)return;const g=u[h.sn-l.startSN-1];if(g&&g.cc===h.cc&&this.fragmentTracker.getState(g)===er&&(h=g),this.fragmentTracker.getState(h)===er){const e=this.mapToInitFragWhenRequired(h);e&&this.loadFragment(e,r,a)}}}else this.state=Ks}loadFragment(e,t,r){ge(e)?super.loadFragment(e,t,r):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new co(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends xi{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const t=Wa(this.media.textTracks);for(let r=0;r<t.length;r++)if("hidden"===t[r].mode)e=t[r];else if("showing"===t[r].mode){e=t[r];break}const r=this.findTrackForTextTrack(e);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVEL_LOADING,this.onLevelLoading,this),e.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(x.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const r=this.media;if(!r)return;const s=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||r.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,s)return;Wa(r.textTracks).forEach(e=>{za(e)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:s,details:n}=t,i=this.tracksInGroup[r];if(!i||i.groupId!==s)return void this.warn(`Subtitle track with id:${r} and group:${s} not found in active group ${null==i?void 0:i.groupId}`);const a=i.details;i.details=t.details,this.log(`Subtitle track ${r} "${i.name}" lang:${i.lang} group:${s} loaded [${n.startSN}-${n.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,s=this.groupIds;let n=this.currentTrack;if(!r||(null==s?void 0:s.length)!==(null==r?void 0:r.length)||null!=r&&r.some(e=>-1===(null==s?void 0:s.indexOf(e)))){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter(e=>!r||-1!==r.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!n&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.subtitlePreference;if(!n&&t){this.selectDefaultTrack=!1;const r=Lt(t,e);if(r>-1)n=e[r];else{const e=Lt(t,this.tracks);n=this.tracks[e]}}let s=this.findTrackId(n);-1===s&&n&&(s=this.findTrackId(null));const i={subtitleTracks:e};this.log(`Updating subtitle tracks, ${e.length} track(s) found in "${null==r?void 0:r.join(",")}" group-id`),this.hls.trigger(x.SUBTITLE_TRACKS_UPDATED,i),-1!==s&&-1===this.trackId&&this.setSubtitleTrack(s)}}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const n=t[s];if((!r||n.default)&&(r||e)&&(!e||Rt(n,e)))return s}if(e){for(let r=0;r<t.length;r++){const s=t[r];if(Ni(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const s=t[r];if(Ni(e.attrs,s.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){if(Mi(t[r],e))return r}}return-1}onError(e,t){!t.fatal&&t.context&&(t.context.type!==F||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(-1===e.id)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&Rt(e,r))return r;const s=Lt(e,this.tracksInGroup);if(s>-1){const e=this.tracksInGroup[s];return this.setSubtitleTrack(s),e}if(r)return null;{const r=Lt(e,t);if(r>-1)return t[r]}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,s=e.groupId,n=this.getUrlWithDirectives(e.url,t),i=e.details,a=null==i?void 0:i.age;this.log(`Loading subtitle ${r} "${e.name}" lang:${e.lang} group:${s}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""}${a&&i.live?" age "+a.toFixed(1)+(i.type&&" "+i.type||""):""} ${n}`),this.hls.trigger(x.SUBTITLE_TRACK_LOADING,{url:n,id:r,groupId:s,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Wa(e.textTracks),r=this.currentTrack;let s;if(r&&(s=t.filter(e=>Mi(r,e))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(e=>{"disabled"!==e.mode&&e!==s&&(e.mode="disabled")}),s){const e=this.subtitleDisplay?"showing":"hidden";s.mode!==e&&(s.mode=e)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(e<-1||e>=t.length||!R(e))return void this.warn(`Invalid subtitle track id: ${e}`);this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s)return void this.hls.trigger(x.SUBTITLE_TRACK_SWITCH,{id:e});const n=!!s.details&&!s.details.live;if(e===this.trackId&&s===r&&n)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:i,groupId:a="",name:o,type:l,url:u}=s;this.hls.trigger(x.SUBTITLE_TRACK_SWITCH,{id:i,groupId:a,name:o,type:l,url:u});const c=this.switchParams(s.url,null==r?void 0:r.details,s.details);this.loadPlaylist(c)}},timelineController:class{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(x.FRAG_LOADING,this.onFragLoading,this),e.on(x.FRAG_LOADED,this.onFragLoaded,this),e.on(x.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(x.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(x.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(x.FRAG_LOADING,this.onFragLoading,this),e.off(x.FRAG_LOADED,this.onFragLoaded,this),e.off(x.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(x.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(x.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new rl(this,"textTrack1"),t=new rl(this,"textTrack2"),r=new rl(this,"textTrack3"),s=new rl(this,"textTrack4");this.cea608Parser1=new Ro(1,e,t),this.cea608Parser2=new Ro(3,r,s)}addCues(e,t,r,s,n){let i=!1;for(let e=n.length;e--;){const s=n[e],a=il(s[0],s[1],t,r);if(a>=0&&(s[0]=Math.min(s[0],t),s[1]=Math.max(s[1],r),i=!0,a/(r-t)>.5))return}if(i||n.push([t,r]),this.config.renderTextTracksNatively){const n=this.captionsTracks[e];this.Cues.newCue(n,t,r,s)}else{const n=this.Cues.newCue(null,t,r,s);this.hls.trigger(x.CUES_PARSED,{type:"captions",cues:n,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:n,trackId:i}){const{unparsedVttFrags:a}=this;r===$&&(this.initPTS[t.cc]={baseTime:s,timescale:n,trackId:i}),a.length&&(this.unparsedVttFrags=[],a.forEach(e=>{this.initPTS[e.frag.cc]?this.onFragLoaded(x.FRAG_LOADED,e):this.hls.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let s=0;s<r.textTracks.length;s++){const n=r.textTracks[s];if(nl(n,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return n}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:s}=this,{label:n,languageCode:i}=t[e],a=this.getExistingTrack(n,i);if(a)r[e]=a,za(r[e]),Ha(r[e],s);else{const t=this.createTextTrack("captions",n,i);t&&(t[e]=!0,r[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(x.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,r){const s=this.media;if(s)return s.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const r=!!t.transferMedia;if(this.media=null,r)return;const{captionsTracks:s}=this;Object.keys(s).forEach(e=>{za(s[e]),delete s[e]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let e=0;e<t.length;e++)za(t[e])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],s=r.some(e=>e.textCodec===Vo);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(Oi(this.tracks,r))return void(this.tracks=r);if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const e=this.media,t=e?Wa(e.textTracks):null;if(this.tracks.forEach((e,r)=>{let s;if(t){let r=null;for(let s=0;s<t.length;s++)if(t[s]&&nl(t[s],e)){r=t[s],t[s]=null;break}r&&(s=r)}if(s)za(s);else{const t=sl(e);s=this.createTextTrack(t,e.name,e.lang),s&&(s.mode="disabled")}s&&this.textTracks.push(s)}),null!=t&&t.length){const e=t.filter(e=>null!==e).map(e=>e.label);e.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${e.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const e=this.tracks.map(e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}));this.hls.trigger(x.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(e=>{const t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;const r=`textTrack${t[1]}`,s=this.captionsProperties[r];s&&(s.label=e.name,e.lang&&(s.languageCode=e.lang),s.media=e)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===$){var r,s;const{cea608Parser1:e,cea608Parser2:n,lastSn:i}=this,{cc:a,sn:o}=t.frag,l=null!=(r=null==(s=t.part)?void 0:s.index)?r:-1;e&&n&&(o!==i+1||o===i&&l!==this.lastPartIndex+1||a!==this.lastCc)&&(e.reset(),n.reset()),this.lastCc=a,this.lastSn=o,this.lastPartIndex=l}}onFragLoaded(e,t){const{frag:r,payload:s}=t;if(r.type===B)if(s.byteLength){const e=r.decryptdata,n="stats"in t;if(null==e||!e.encrypted||n){const e=this.tracks[r.level],n=this.vttCCs;n[r.cc]||(n[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),e&&e.textCodec===Vo?this._parseIMSC1(r,s):this._parseVTTs(t)}}else this.hls.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;Yo(t,this.initPTS[e.cc],t=>{this._appendCues(t,e.level),r.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},t=>{r.logger.log(`Failed to parse IMSC1: ${t}`),r.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})})}_parseVTTs(e){var t;const{frag:r,payload:s}=e,{initPTS:n,unparsedVttFrags:i}=this,a=n.length-1;if(!n[r.cc]&&-1===a)return void i.push(e);const o=this.hls;Ho(null!=(t=r.initSegment)&&t.data?Me(r.initSegment.data,new Uint8Array(s)).buffer:s,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,e=>{this._appendCues(e,r.level),o.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},t=>{const n="Missing initPTS for VTT MPEGTS"===t.message;n?i.push(e):this._fallbackToIMSC1(r,s),o.logger.log(`Failed to parse VTT cue: ${t}`),n&&a>r.cc||o.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:t})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||Yo(t,this.initPTS[e.cc],()=>{r.textCodec=Vo,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||"disabled"===r.mode)return;e.forEach(e=>Va(r,e))}else{const s=this.tracks[t];if(!s)return;const n=s.default?"default":"subtitles"+t;r.trigger(x.CUES_PARSED,{type:"subtitles",cues:e,track:n})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===B&&this.onFragLoaded(x.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:r,samples:s}=t;if(r.type!==$||"NONE"!==this.closedCaptionsForLevel(r))for(let e=0;e<s.length;e++){const t=s[e].bytes;if(t){this.cea608Parser1||this.initCea608Parsers();const r=this.extractCea608Data(t);this.cea608Parser1.addData(s[e].pts,r[0]),this.cea608Parser2.addData(s[e].pts,r[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:s,type:n}){const{media:i}=this;if(i&&!(i.currentTime<r)){if(!n||"video"===n){const{captionsTracks:e}=this;Object.keys(e).forEach(s=>qa(e[s],t,r))}if(this.config.renderTextTracksNatively&&0===t&&void 0!==s){const{textTracks:e}=this;Object.keys(e).forEach(r=>qa(e[r],t,s))}}}extractCea608Data(e){const t=[[],[]],r=31&e[0];let s=2;for(let n=0;n<r;n++){const r=e[s++],n=127&e[s++],i=127&e[s++];if(0===n&&0===i)continue;if(!!(4&r)){const e=3&r;0!==e&&1!==e||(t[e].push(n),t[e].push(i))}}return t}},audioStreamController:class extends en{constructor(e,t,r){super(e,t,r,"audio-stream-controller",U),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(x.BUFFER_RESET,this.onBufferReset,this),e.on(x.BUFFER_CREATED,this.onBufferCreated,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(x.FRAG_LOADING,this.onFragLoading,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(x.BUFFER_RESET,this.onBufferReset,this),e.off(x.BUFFER_CREATED,this.onBufferCreated,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(x.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(x.FRAG_LOADING,this.onFragLoading,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:r,initPTS:s,timescale:n,trackId:i}){if(r===$){const e=t.cc,r=this.fragCurrent;if(this.initPTS[e]={baseTime:s,timescale:n,trackId:i},this.log(`InitPTS for cc: ${e} found from main: ${s/n} (${s}/${n}) trackId: ${i}`),this.mainAnchor=t,this.state===Js){const r=this.waitingData;(!r&&!this.loadingParts||r&&r.frag.cc!==e)&&this.syncWithAnchor(t,null==r?void 0:r.frag)}else!this.hls.hasEnoughToStart&&r&&r.cc!==e?(r.abortRequests(),this.syncWithAnchor(t,r)):this.state===Ks&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var r;const s=(null==(r=this.mainFragLoading)?void 0:r.frag)||null;if(t&&(null==s?void 0:s.cc)===t.cc)return;const n=(s||e).cc,i=Mt(this.getLevelDetails(),n,this.getLoadPosition());i&&(this.log(`Syncing with main frag at ${i.start} cc ${i.cc}`),this.startFragRequested=!1,this.nextLoadPosition=i.start,this.resetLoadingState(),this.state===Ks&&this.doTickIdle())}startLoad(e,t){if(!this.levels)return this.startPosition=e,void(this.state=Gs);const r=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),r>0&&-1===e?(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r,this.state=Ks):this.state=qs,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case Ks:this.doTickIdle();break;case qs:{const{levels:e,trackId:t}=this,r=null==e?void 0:e[t],s=null==r?void 0:r.details;if(s&&!this.waitForLive(r)){if(this.waitForCdnTuneIn(s))break;this.state=Js}break}case zs:this.checkRetryDate();break;case Js:{const e=this.waitingData;if(e){const{frag:t,part:r,cache:s,complete:n}=e,i=this.mainAnchor;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.state=Vs;const e={frag:t,part:r,payload:s.flush().buffer,networkDetails:null};this._handleFragmentLoadProgress(e),n&&super._handleFragmentLoadComplete(e)}else i&&i.cc!==e.frag.cc&&this.syncWithAnchor(i,e.frag)}else this.state=Ks}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:r,media:s,trackId:n}=this,i=t.config;if(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!i.startFragPrefetch)||null==r||!r[n])return;const a=r[n],o=a.details;if(!o||this.waitForLive(a)||this.waitForCdnTuneIn(o))return this.state=qs,void(this.startFragRequested=!1);const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,ce,U));const u=this.getFwdBufferInfo(l,U);if(null===u)return;if(!this.switchingTrack&&this._streamEnded(u,o))return t.trigger(x.BUFFER_EOS,{type:"audio"}),void(this.state=Qs);const c=u.len,d=t.maxBufferLength,h=o.fragments,f=h[0].start,g=this.getLoadPosition(),p=this.flushing?g:u.end;if(this.switchingTrack&&s){const e=g;o.PTSKnown&&e<f&&(u.end>f||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=f+.05)}if(c>=d&&!this.switchingTrack&&p<h[h.length-1].start)return;let m=this.getNextFragment(p,o);if(m&&this.isLoopLoading(m,p)&&(m=this.getNextFragmentLoopLoading(m,o,u,$,d)),!m)return void(this.bufferFlushed=!0);let y=(null==(e=this.mainFragLoading)?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&y&&ge(m)&&!m.endList&&(!o.live||!this.loadingParts&&p<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(y)===sr&&(this.mainFragLoading=y=null),y&&ge(y))){if(m.start>y.end){const e=this.fragmentTracker.getFragAtPos(p,$);e&&e.end>y.end&&(y=e,this.mainFragLoading={frag:e,targetBufferTime:null})}if(m.start>y.end)return}this.loadFragment(m,a,p)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(e=>new Et(e))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),r?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==Gs&&(this.setInterval(100),this.state=Ks,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const r=this.cachedTrackLoadedData;r&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(x.AUDIO_TRACK_LOADED,r))}onAudioTrackLoaded(e,t){var r;const{levels:s}=this,{details:n,id:i,groupId:a,track:o}=t;if(!s)return void this.warn(`Audio tracks reset while loading track ${i} "${o.name}" of "${a}"`);const l=this.mainDetails;if(!l||n.endCC>l.endCC||l.expired)return this.cachedTrackLoadedData=t,void(this.state!==Gs&&(this.state=qs));this.cachedTrackLoadedData=null,this.log(`Audio track ${i} "${o.name}" of "${a}" loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""},duration:${n.totalduration}`);const u=s[i];let c=0;if(n.live||null!=(r=u.details)&&r.live){if(this.checkLiveUpdate(n),n.deltaUpdateFailed)return;var d;if(u.details)c=this.alignPlaylists(n,u.details,null==(d=this.levelLastLoaded)?void 0:d.details);n.alignedSliding||(Fs(n,l),n.alignedSliding||$s(n,l),c=n.fragmentStart)}u.details=n,this.levelLastLoaded=u,this.startFragRequested||this.setStartPosition(l,c),this.hls.trigger(x.AUDIO_TRACK_UPDATED,{details:n,id:i,groupId:t.groupId}),this.state!==qs||this.waitForCdnTuneIn(n)||(this.state=Ks),this.tick()}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:s,payload:n}=e,{config:i,trackId:a,levels:o}=this;if(!o)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);const l=o[a];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const u=l.details;if(!u)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(r.start);const c=i.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let d=this.transmuxer;d||(d=this.transmuxer=new Di(this.hls,U,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[r.cc],f=null==(t=r.initSegment)?void 0:t.data;if(void 0!==h){const e=!1,t=s?s.index:-1,i=-1!==t,a=new Er(r.level,r.sn,r.stats.chunkCount,n.byteLength,t,i);d.push(n,f,c,"",r,s,u.totalduration,e,a,h)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${u.startSN} ,${u.endSN}],track ${a}`);const{cache:e}=this.waitingData=this.waitingData||{frag:r,part:s,cache:new rn,complete:!1};e.push(new Uint8Array(n)),this.state!==Gs&&(this.state=Js)}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===$&&ge(t.frag)&&(this.mainFragLoading=t,this.state===Ks&&this.tick())}onFragBuffered(e,t){const{frag:r,part:s}=t;if(r.type===U)if(this.fragContextChanged(r))this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if(ge(r)){this.fragPrevious=r;const e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(x.AUDIO_TRACK_SWITCHED,z({},e)))}this.fragBufferedComplete(r,s),this.media&&this.tick()}else this.audioOnly||r.type!==$||r.elementaryStreams.video||r.elementaryStreams.audiovideo||(this.audioOnly=!0,this.mainFragLoading=null)}onError(e,t){var r;if(t.fatal)this.state=Xs;else switch(t.details){case D.FRAG_GAP:case D.FRAG_PARSING_ERROR:case D.FRAG_DECRYPT_ERROR:case D.FRAG_LOAD_ERROR:case D.FRAG_LOAD_TIMEOUT:case D.KEY_LOAD_ERROR:case D.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(U,t);break;case D.AUDIO_TRACK_LOAD_ERROR:case D.AUDIO_TRACK_LOAD_TIMEOUT:case D.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==qs||(null==(r=t.context)?void 0:r.type)!==M||(this.state=Ks);break;case D.BUFFER_ADD_CODEC_ERROR:case D.BUFFER_APPEND_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case D.BUFFER_FULL_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case D.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushing(e,{type:t}){t!==de&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==de){this.flushing=!1,this.bufferFlushed=!0,this.state===Qs&&(this.state=Ks);const e=this.mediaBuffer||this.media;e&&(this.afterBufferFlushed(e,t,U),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:s}=this,{remuxResult:n,chunkMeta:i}=e,a=this.getCurrentContext(i);if(!a)return void this.resetWhenMissingContext(i);const{frag:o,part:l,level:u}=a,{details:c}=u,{audio:d,text:h,id3:f,initSegment:g}=n;if(!this.fragContextChanged(o)&&c){if(this.state=Ws,this.switchingTrack&&d&&this.completeAudioSwitch(this.switchingTrack),null!=g&&g.tracks){const e=o.initSegment||o;if(this.unhandledEncryptionError(g,o))return;this._bufferInitSegment(u,g.tracks,e,i),s.trigger(x.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:r,tracks:g.tracks})}if(d){const{startPTS:e,endPTS:t,startDTS:r,endDTS:s}=d;l&&(l.elementaryStreams[ce]={startPTS:e,endPTS:t,startDTS:r,endDTS:s}),o.setElementaryStreamInfo(ce,e,t,r,s),this.bufferFragmentData(d,o,l,i)}if(null!=f&&null!=(t=f.samples)&&t.length){const e=H({id:r,frag:o,details:c},f);s.trigger(x.FRAG_PARSING_METADATA,e)}if(h){const e=H({id:r,frag:o,details:c},h);s.trigger(x.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(o)}_bufferInitSegment(e,t,r,s){if(this.state!==Ws)return;if(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio)return;const n=t.audio;n.id=U;const i=e.audioCodec;this.log(`Init audio buffer, container:${n.container}, codecs[level/parsed]=[${i}/${n.codec}]`),i&&1===i.split(",").length&&(n.levelCodec=i),this.hls.trigger(x.BUFFER_CODECS,t);const a=n.initSegment;if(null!=a&&a.byteLength){const e={type:"audio",frag:r,part:null,chunkMeta:s,parent:r.type,data:a};this.hls.trigger(x.BUFFER_APPENDING,e)}this.tickImmediate()}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);var n;if(this.switchingTrack||s===er||s===rr)if(ge(e))if(null!=(n=t.details)&&n.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=Js;const r=this.mainDetails;r&&r.fragmentStart!==t.details.fragmentStart&&$s(t.details,r)}else super.loadFragment(e,t,r);else this._loadInitSegment(e,t);else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:r,assocLang:s,characteristics:n,audioCodec:i,channels:a}=this.bufferedTrack;Rt({name:t,lang:r,assocLang:s,characteristics:n,audioCodec:i,channels:a},e,It)||(Ct(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(x.AUDIO_TRACK_SWITCHED,z({},e))}},audioTrackController:class extends xi{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVEL_LOADING,this.onLevelLoading,this),e.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(x.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:s,details:n}=t,i=this.tracksInGroup[r];if(!i||i.groupId!==s)return void this.warn(`Audio track with id:${r} and group:${s} not found in active group ${null==i?void 0:i.groupId}`);const a=i.details;i.details=t.details,this.log(`Audio track ${r} "${i.name}" lang:${i.lang} group:${s} loaded [${n.startSN}-${n.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,s=this.groupIds;let n=this.currentTrack;if(!r||(null==s?void 0:s.length)!==(null==r?void 0:r.length)||null!=r&&r.some(e=>-1===(null==s?void 0:s.indexOf(e)))){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter(e=>!r||-1!==r.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!n&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.audioPreference;if(!n&&t){const r=Lt(t,e,It);if(r>-1)n=e[r];else{const e=Lt(t,this.tracks);n=this.tracks[e]}}let s=this.findTrackId(n);-1===s&&n&&(s=this.findTrackId(null));const a={audioTracks:e};this.log(`Updating audio tracks, ${e.length} track(s) found in group(s): ${null==r?void 0:r.join(",")}`),this.hls.trigger(x.AUDIO_TRACKS_UPDATED,a);const o=this.trackId;if(-1!==s&&-1===o)this.setAudioTrack(s);else if(e.length&&-1===o){var i;const t=new Error(`No audio track selected for current audio group-ID(s): ${null==(i=this.groupIds)?void 0:i.join(",")} track count: ${e.length}`);this.warn(t.message),this.hls.trigger(x.ERROR,{type:C.MEDIA_ERROR,details:D.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}}onError(e,t){!t.fatal&&t.context&&(t.context.type!==M||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const s=this.currentTrack;if(s&&Rt(e,s,It))return s;const n=Lt(e,this.tracksInGroup,It);if(n>-1){const e=this.tracksInGroup[n];return this.setAudioTrack(n),e}if(s){let s=t.loadLevel;-1===s&&(s=t.firstAutoLevel);const n=function(e,t,r,s,n){const i=t[s],a=t.reduce((e,t,r)=>{const s=t.uri;return(e[s]||(e[s]=[])).push(r),e},{}),o=a[i.uri];o.length>1&&(s=Math.max.apply(Math,o));const l=i.videoRange,u=i.frameRate,c=i.codecSet.substring(0,4),d=Pt(t,s,t=>{if(t.videoRange!==l||t.frameRate!==u||t.codecSet.substring(0,4)!==c)return!1;const s=t.audioGroups,i=r.filter(e=>!s||-1!==s.indexOf(e.groupId));return Lt(e,i,n)>-1});return d>-1?d:Pt(t,s,t=>{const s=t.audioGroups,i=r.filter(e=>!s||-1!==s.indexOf(e.groupId));return Lt(e,i,n)>-1})}(e,t.levels,r,s,It);if(-1===n)return null;t.nextLoadLevel=n}if(e.channels||e.audioCodec){const t=Lt(e,r);if(t>-1)return r[t]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn(`Invalid audio track id: ${e}`);this.selectDefaultTrack=!1;const r=this.currentTrack,s=t[e],n=s.details&&!s.details.live;if(e===this.trackId&&s===r&&n)return;if(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(x.AUDIO_TRACK_SWITCHING,z({},s)),n)return;const i=this.switchParams(s.url,null==r?void 0:r.details,s.details);this.loadPlaylist(i)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const s=t[r];if((!this.selectDefaultTrack||s.default)&&(!e||Rt(e,s,It)))return r}if(e){const{name:r,lang:s,assocLang:n,characteristics:i,audioCodec:a,channels:o}=e;for(let e=0;e<t.length;e++){if(Rt({name:r,lang:s,assocLang:n,characteristics:i,audioCodec:a,channels:o},t[e],It))return e}for(let r=0;r<t.length;r++){const s=t[r];if(Ni(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const s=t[r];if(Ni(e.attrs,s.attrs,["LANGUAGE"]))return r}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Ct(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,s=e.groupId,n=this.getUrlWithDirectives(e.url,t),i=e.details,a=null==i?void 0:i.age;this.log(`Loading audio-track ${r} "${e.name}" lang:${e.lang} group:${s}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""}${a&&i.live?" age "+a.toFixed(1)+(i.type&&" "+i.type||""):""} ${n}`),this.hls.trigger(x.AUDIO_TRACK_LOADING,{url:n,id:r,groupId:s,deliveryDirectives:t||null,track:e})}},emeController:Ua,cmcdController:class{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:Hi.MANIFEST,su:!this.initialized})}catch(e){this.hls.logger.warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=e=>{try{const{frag:t,part:r}=e,s=this.hls.levels[t.level],n=this.getObjectType(t),i={d:1e3*(r||t).duration,ot:n};n!==Hi.VIDEO&&n!==Hi.AUDIO&&n!=Hi.MUXED||(i.br=s.bitrate/1e3,i.tb=this.getTopBandwidth(n)/1e3,i.bl=this.getBufferLength(n));const a=r?this.getNextPart(r):this.getNextFrag(t);null!=a&&a.url&&a.url!==t.url&&(i.nor=a.url),this.apply(e,i)}catch(e){this.hls.logger.warn("Could not generate segment CMCD data.",e)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;null!=r&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||e.sessionId,this.cid=r.contentId,this.useHeaders=!0===r.useHeaders,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHED,this.onMediaDetached,this),e.on(x.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHED,this.onMediaDetached,this),e.off(x.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,s;this.audioBuffer=null==(r=t.tracks.audio)?void 0:r.buffer,this.videoBuffer=null==(s=t.tracks.video)?void 0:s.buffer}createData(){var e;return{v:1,sf:Vi.HLS,sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){H(t,this.createData());const r=t.ot===Hi.INIT||t.ot===Hi.VIDEO||t.ot===Hi.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((e,r)=>(s.includes(r)&&(e[r]=t[r]),e),{}));const n={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),xa(e.headers,t,n)):e.url=Ma(e.url,t,n)}getNextFrag(e){var t;const r=null==(t=this.hls.levels[e.level])?void 0:t.details;if(r){const t=e.sn-r.startSN;return r.fragments[t+1]}}getNextPart(e){var t;const{index:r,fragment:s}=e,n=null==(t=this.hls.levels[s.level])||null==(t=t.details)?void 0:t.partList;if(n){const{sn:e}=s;for(let t=n.length-1;t>=0;t--){const s=n[t];if(s.index===r&&s.fragment.sn===e)return n[t+1]}}}getObjectType(e){const{type:t}=e;return"subtitle"===t?Hi.TIMED_TEXT:"initSegment"===e.sn?Hi.INIT:"audio"===t?Hi.AUDIO:"main"===t?this.hls.audioTracks.length?Hi.VIDEO:Hi.MUXED:void 0}getTopBandwidth(e){let t,r=0;const s=this.hls;if(e===Hi.AUDIO)t=s.audioTracks;else{const e=s.maxAutoLevel,r=e>-1?e+1:s.levels.length;t=s.levels.slice(0,r)}return t.forEach(e=>{e.bitrate>r&&(r=e.bitrate)}),r>0?r:NaN}getBufferLength(e){const t=this.media,r=e===Hi.AUDIO?this.audioBuffer:this.videoBuffer;if(!r||!t)return NaN;return 1e3*Tr.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new r(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,r,s){t(e),this.loader.load(e,r,s)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new r(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,r,s){t(e),this.loader.load(e,r,s)}}}},contentSteeringController:class extends q{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0)return void this.scheduleRefresh(this.uri,e)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(t=>t!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;null!==r&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if((null==r?void 0:r.action)===zt&&r.flags===Qt){const e=this.levels;let s=this._pathwayPriority,n=this.pathwayId;if(t.context){const{groupId:r,pathwayId:s,type:i}=t.context;r&&e?n=this.getPathwayForGroupId(r,i,n):s&&(n=s)}n in this.penalizedPathways||(this.penalizedPathways[n]=performance.now()),!s&&e&&(s=this.pathways()),s&&s.length>1&&(this.updatePathwayPriority(s),r.resolved=this.pathwayId!==n),t.details!==D.BUFFER_APPEND_ERROR||t.fatal?r.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${n} levels: ${e?e.length:e} priorities: ${wt(s)} penalized: ${wt(this.penalizedPathways)}`):r.resolved=!0}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){let t;this._pathwayPriority=e;const r=this.penalizedPathways,s=performance.now();Object.keys(r).forEach(e=>{s-r[e]>3e5&&delete r[e]});for(let s=0;s<e.length;s++){const n=e[s];if(n in r)continue;if(n===this.pathwayId)return;const i=this.hls.nextLoadLevel,a=this.hls.levels[i];if(t=this.getLevelsForPathway(n),t.length>0){this.log(`Setting Pathway to "${n}"`),this.pathwayId=n,Cs(t),this.hls.trigger(x.LEVELS_UPDATED,{levels:t});const e=this.hls.levels[i];a&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==a.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==a.bitrate&&this.log(`Unstable Pathways change from bitrate ${a.bitrate} to ${e.bitrate}`),this.hls.nextLoadLevel=i);break}}}getPathwayForGroupId(e,t,r){const s=this.getLevelsForPathway(r).concat(this.levels||[]);for(let r=0;r<s.length;r++)if(t===M&&s[r].hasAudioGroup(e)||t===F&&s[r].hasSubtitleGroup(e))return s[r].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},s={};e.forEach(e=>{const{ID:n,"BASE-ID":i,"URI-REPLACEMENT":a}=e;if(t.some(e=>e.pathwayId===n))return;const o=this.getLevelsForPathway(i).map(e=>{const t=new Pr(e.attrs);t["PATHWAY-ID"]=n;const i=t.AUDIO&&`${t.AUDIO}_clone_${n}`,o=t.SUBTITLES&&`${t.SUBTITLES}_clone_${n}`;i&&(r[t.AUDIO]=i,t.AUDIO=i),o&&(s[t.SUBTITLES]=o,t.SUBTITLES=o);const l=$a(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",a),u=new Et({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:l,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(let t=1;t<e.audioGroups.length;t++)u.addGroupId("audio",`${e.audioGroups[t]}_clone_${n}`);if(e.subtitleGroups)for(let t=1;t<e.subtitleGroups.length;t++)u.addGroupId("text",`${e.subtitleGroups[t]}_clone_${n}`);return u});t.push(...o),Fa(this.audioTracks,r,a,n),Fa(this.subtitleTracks,s,a,n)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;let s;this.loader&&this.loader.destroy(),this.loader=new r(t);try{s=new self.URL(e)}catch(t){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${e}`)}if("data:"!==s.protocol){const e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+e)}const n={responseType:"json",url:s.href},i=t.steeringManifestLoadPolicy.default,a=i.errorRetry||i.timeoutRetry||{},o={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(e,t,r,n)=>{this.log(`Loaded steering manifest: "${s}"`);const i=e.data;if(1!==(null==i?void 0:i.VERSION))return void this.log(`Steering VERSION ${i.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=i.TTL;const{"RELOAD-URI":a,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=i;if(a)try{this.uri=new self.URL(a,s).href}catch(e){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${a}`)}this.scheduleRefresh(this.uri||r.url),o&&this.clonePathways(o);const u={steeringManifest:i,url:s.toString()};this.hls.trigger(x.STEERING_MANIFEST_LOADED,u),l&&this.updatePathwayPriority(l)},onError:(e,t,r,s)=>{if(this.log(`Error loading steering manifest: ${e.code} ${e.text} (${t.url})`),this.stopLoad(),410===e.code)return this.enabled=!1,void this.log(`Steering manifest ${t.url} no longer available`);let n=1e3*this.timeToLoad;if(429===e.code){const e=this.loader;if("function"==typeof(null==e?void 0:e.getResponseHeader)){const t=e.getResponseHeader("Retry-After");t&&(n=1e3*parseFloat(t))}return void this.log(`Steering manifest ${t.url} rate limited`)}this.scheduleRefresh(this.uri||t.url,n)},onTimeout:(e,t,r)=>{this.log(`Timeout loading steering manifest (${t.url})`),this.scheduleRefresh(this.uri||t.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(n,o,l)}scheduleRefresh(e,t=1e3*this.timeToLoad){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var t;const r=null==(t=this.hls)?void 0:t.media;!r||r.ended?this.scheduleRefresh(e,1e3*this.timeToLoad):this.loadSteeringManifest(e)},t)}},interstitialsController:class extends q{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled||!this.schedule)return;const t=e-this.timelinePos;if(Math.abs(t)<1/7056e5)return;const r=t<=-.01;this.timelinePos=e,this.bufferedPos=e;const s=this.playingItem;if(!s)return void this.checkBuffer();if(r){this.schedule.resetErrorsInRange(e,e-t)&&this.updateSchedule(!0)}if(this.checkBuffer(),r&&e<s.start||e>=s.end){var n;const t=this.findItemIndex(s);let i=this.schedule.findItemIndexAtTime(e);if(-1===i&&(i=t+(r?-1:1),this.log(`seeked ${r?"back ":""}to position not covered by schedule ${e} (resolving from ${t} to ${i})`)),!this.isInterstitial(s)&&null!=(n=this.media)&&n.paused&&(this.shouldPlay=!1),!r&&i>t){const e=this.schedule.findJumpRestrictedIndex(t+1,i);if(e>t)return void this.setSchedulePosition(e)}return void this.setSchedulePosition(i)}const i=this.playingAsset;if(!i){if(this.playingLastItem&&this.isInterstitial(s)){const t=s.event.assetList[0];t&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(e,t))}return}const a=i.timelineStart,o=i.duration||0;var l;(r&&e<a||e>=a+o)&&(null!=(l=s.event)&&l.appendInPlace&&(this.clearAssetPlayers(s.event,s),this.flushFrontBuffer(e)),this.setScheduleToAssetAtTime(e,i))},this.onTimeupdate=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled)return;if(!(e>this.timelinePos))return;this.timelinePos=e,e>this.bufferedPos&&this.checkBuffer();const t=this.playingItem;if(!t||this.playingLastItem)return;if(e>=t.end){this.timelinePos=t.end;const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}const r=this.playingAsset;if(!r)return;e>=r.timelineStart+(r.duration||0)&&this.setScheduleToAssetAtTime(e,r)},this.onScheduleUpdate=(e,t)=>{const r=this.schedule;if(!r)return;const s=this.playingItem,n=r.events||[],i=r.items||[],a=r.durations,o=e.map(e=>e.identifier),l=!(!n.length&&!o.length);(l||t)&&this.log(`INTERSTITIALS_UPDATED (${n.length}): ${n}\nSchedule: ${i.map(e=>ao(e))} pos: ${this.timelinePos}`),o.length&&this.log(`Removed events ${o}`);let u=null,c=null;s&&(u=this.updateItem(s,this.timelinePos),this.itemsMatch(s,u)?this.playingItem=u:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const d=this.bufferingItem;if(d&&(c=this.updateItem(d,this.bufferedPos),this.itemsMatch(d,c)?this.bufferingItem=c:d.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(d.event,null))),e.forEach(e=>{e.assetList.forEach(e=>{this.clearAssetPlayer(e.identifier,null)})}),this.playerQueue.forEach(e=>{if(e.interstitial.appendInPlace){const t=e.assetItem.timelineStart,r=e.timelineOffset-t;if(r)try{e.timelineOffset=t}catch(s){Math.abs(r)>Qa&&this.warn(`${s} ("${e.assetId}" ${e.timelineOffset}->${t})`)}}}),l||t){if(this.hls.trigger(x.INTERSTITIALS_UPDATED,{events:n.slice(0),schedule:i.slice(0),durations:a,removedIds:o}),this.isInterstitial(s)&&o.includes(s.event.identifier))return this.warn(`Interstitial "${s.event.identifier}" removed while playing`),void this.primaryFallback(s.event);s&&this.trimInPlace(u,s),d&&c!==u&&this.trimInPlace(c,d),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new oo(e),this.schedule=new io(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(x.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(x.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(x.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(x.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(x.BUFFER_APPENDED,this.onBufferAppended,this),e.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(x.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(x.MEDIA_ENDED,this.onMediaEnded,this),e.on(x.ERROR,this.onError,this),e.on(x.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(x.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(x.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(x.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(x.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(x.BUFFER_CODECS,this.onBufferCodecs,this),e.off(x.BUFFER_APPENDED,this.onBufferAppended,this),e.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(x.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(x.MEDIA_ENDED,this.onMediaEnded,this),e.off(x.ERROR,this.onError,this),e.off(x.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;null==(e=this.getBufferingPlayer())||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.getBufferingPlayer())||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Bs(e,"play",this.onPlay),Bs(e,"pause",this.onPause),Bs(e,"seeking",this.onSeeking),Bs(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const r=this.media=t.media;Us(r,"seeking",this.onSeeking),Us(r,"timeupdate",this.onTimeupdate),Us(r,"play",this.onPlay),Us(r,"pause",this.onPause)}onMediaAttached(e,t){const r=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,null===r)this.checkStart();else if(!s){this.clearScheduleState();const e=this.findItemIndex(r);this.setSchedulePosition(e)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const r=!!t.transferMedia,s=this.media;if(this.media=null,!r&&(s&&this.removeMediaListeners(s),this.detachedData)){const e=this.getBufferingPlayer();e&&(this.log(`Removing schedule state for detachedData and ${e}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,e.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,r=t=>t?e.getAssetPlayer(t.identifier):t,s=(t,s,i,a,o)=>{if(t){let l=t[s].start;const u=t.event;if(u){if("playout"===s||u.timelineOccupancy!==Xa.Point){const e=r(i);(null==e?void 0:e.interstitial)===u&&(l+=e.assetItem.startOffset+e[o])}}else{l+=("bufferedPos"===a?n():e[a])-t.start}return l}return 0},n=()=>{const t=e.bufferedPos;return t===Number.MAX_VALUE?i("primary"):Math.max(t,0)},i=t=>{var r,s;return null!=(r=e.primaryDetails)&&r.live?e.primaryDetails.edge:(null==(s=e.schedule)?void 0:s.durations[t])||0},a=(t,n)=>{var i,a;const o=e.effectivePlayingItem;if(null!=o&&null!=(i=o.event)&&i.restrictions.skip||!e.schedule)return;e.log(`seek to ${t} "${n}"`);const l=e.effectivePlayingItem,u=e.schedule.findItemIndexAtTime(t,n),c=null==(a=e.schedule.items)?void 0:a[u],d=e.getBufferingPlayer(),h=null==d?void 0:d.interstitial,f=null==h?void 0:h.appendInPlace,g=l&&e.itemsMatch(l,c);if(l&&(f||g)){const i=r(e.playingAsset),a=(null==i?void 0:i.media)||e.primaryMedia;if(a){const r="primary"===n?a.currentTime:s(l,n,e.playingAsset,"timelinePos","currentTime"),o=t-r,u=(f?r:a.currentTime)+o;if(u>=0&&(!i||f||u<=i.duration))return void(a.currentTime=u)}}if(c){let r=t;if("primary"!==n){const e=t-c[n].start;r=c.start+e}const s=!e.isInterstitial(c);if(e.isInterstitial(l)&&!l.event.appendInPlace||!s&&!c.event.appendInPlace){if(l){const i=e.findItemIndex(l);if(u>i){const t=e.schedule.findJumpRestrictedIndex(i+1,u);if(t>i)return void e.setSchedulePosition(t)}let a=0;if(s)e.timelinePos=r,e.checkBuffer();else{const e=c.event.assetList,r=t-(c[n]||c).start;for(let t=e.length;t--;){const s=e[t];if(s.duration&&r>=s.startOffset&&r<s.startOffset+s.duration){a=t;break}}}e.setSchedulePosition(u,a)}}else{const t=e.media||(f?null==d?void 0:d.media:null);t&&(t.currentTime=r)}}},o=()=>{const r=e.effectivePlayingItem;if(e.isInterstitial(r))return r;const s=t();return e.isInterstitial(s)?s:null},l={get bufferedEnd(){const r=t(),n=e.bufferingItem;var i;return n&&n===r&&(s(n,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-n.playout.start||(null==(i=e.bufferingAsset)?void 0:i.startOffset))||0},get currentTime(){const t=o(),r=e.effectivePlayingItem;return r&&r===t?s(r,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-r.playout.start:0},set currentTime(t){const r=o(),s=e.effectivePlayingItem;s&&s===r&&a(t+s.playout.start,"playout")},get duration(){const e=o();return e?e.playout.end-e.playout.start:0},get assetPlayers(){var t;const r=null==(t=o())?void 0:t.event.assetList;return r?r.map(t=>e.getAssetPlayer(t.identifier)):[]},get playingIndex(){var t;const r=null==(t=o())?void 0:t.event;return r&&e.effectivePlayingAsset?r.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return o()}};return this.manager={get events(){var t;return(null==(t=e.schedule)||null==(t=t.events)?void 0:t.slice(0))||[]},get schedule(){var t;return(null==(t=e.schedule)||null==(t=t.items)?void 0:t.slice(0))||[]},get interstitialPlayer(){return o()?l:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const r=t();return e.findItemIndex(r)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const t=e.effectivePlayingItem;return e.findItemIndex(t)},primary:{get bufferedEnd(){return n()},get currentTime(){const t=e.timelinePos;return t>0?t:0},set currentTime(e){a(e,"primary")},get duration(){return i("primary")},get seekableStart(){var t;return(null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(e){a(e,"integrated")},get duration(){return i("integrated")},get seekableStart(){var t;return((t,r)=>{var s;if(0!==t&&"primary"!==r&&null!=(s=e.schedule)&&s.length){var n;const s=e.schedule.findItemIndexAtTime(t),i=null==(n=e.schedule.items)?void 0:n[s];if(i)return t+(i[r].start-i.start)}return t})((null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0,"integrated")}},skip:()=>{const t=e.effectivePlayingItem,r=null==t?void 0:t.event;if(r&&!r.restrictions.skip){const s=e.findItemIndex(t);if(r.appendInPlace){const e=t.playout.start+t.event.duration;a(e+.001,"playout")}else e.advanceAfterAssetEnded(r,s,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,r=null==(e=this.schedule)?void 0:e.items;return!!(this.playbackStarted&&t&&r)&&this.findItemIndex(t)===r.length-1}get playbackStarted(){return null!==this.effectivePlayingItem}get currentTime(){var e,t;if(null===this.mediaSelection)return;const r=this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&!r.event.appendInPlace)return;let s=this.media;!s&&null!=(e=this.bufferingItem)&&null!=(e=e.event)&&e.appendInPlace&&(s=this.primaryMedia);const n=null==(t=s)?void 0:t.currentTime;return void 0!==n&&R(n)?n:void 0}get primaryMedia(){var e;return this.media||(null==(e=this.detachedData)?void 0:e.media)||null}isInterstitial(e){return!(null==e||!e.event)}retreiveMediaSource(e,t){const r=this.getAssetPlayer(e);r&&this.transferMediaFromPlayer(r,t)}transferMediaFromPlayer(e,t){const r=e.interstitial.appendInPlace,s=e.media;if(r&&s===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&s)return void(this.detachedData={media:s});const r=e.transferMedia();this.log(`transfer MediaSource from ${e} ${wt(r)}`),this.detachedData=r}else t&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))}transferMediaTo(e,t){var r,s;if(e.media===t)return;let n=null;const i=this.hls,a=e!==i,o=a&&e.interstitial.appendInPlace,l=null==(r=this.detachedData)?void 0:r.mediaSource;let u;if(i.media)o&&(n=i.transferMedia(),this.detachedData=n),u="Primary";else if(l){const e=this.getBufferingPlayer();e?(n=e.transferMedia(),u=`${e}`):u="detached MediaSource"}else u="detached media";if(!n)if(l)n=this.detachedData,this.log(`using detachedData: MediaSource ${wt(n)}`);else if(!this.detachedData||i.media===t){const e=this.playerQueue;e.length>1&&e.forEach(e=>{if(a&&e.interstitial.appendInPlace!==o){const t=e.interstitial;this.clearInterstitial(e.interstitial,null),t.appendInPlace=!1,t.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${t}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}const c=n&&"mediaSource"in n&&"closed"!==(null==(s=n.mediaSource)?void 0:s.readyState),d=c&&n?n:t;this.log(`${c?"transfering MediaSource":"attaching media"} to ${a?e:"Primary"} from ${u} (media.currentTime: ${t.currentTime})`);const h=this.schedule;if(d===n&&h){const t=a&&e.assetId===h.assetIdAtEnd;d.overrides={duration:h.duration,endOfStream:!a||t,cueRemoval:!a}}e.attachMedia(d)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=null==e?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;-1===this.bufferedPos&&(this.bufferedPos=0);const r=this.timelinePos,s=this.effectivePlayingItem;if(-1===r){const r=this.hls.startPosition;if(this.log(uo("checkStart",r)),this.timelinePos=r,t.length&&t[0].cue.pre){const r=e.findEventIndex(t[0].identifier);this.setSchedulePosition(r)}else if(r>=0||!this.primaryLive){const t=this.timelinePos=r>0?r:0,s=e.findItemIndexAtTime(t);this.setSchedulePosition(s)}}else if(s&&!this.playingItem){const t=e.findItemIndex(s);this.setSchedulePosition(t)}}advanceAssetBuffering(e,t){const r=e.event,s=r.findAssetIndex(t),n=ro(r,s);if(r.isAssetPastPlayoutLimit(n)){if(this.schedule){var i;const t=null==(i=this.schedule.items)?void 0:i[this.findItemIndex(e)+1];t&&this.bufferedToItem(t)}}else this.bufferedToEvent(e,n)}advanceAfterAssetEnded(e,t,r){const s=ro(e,r);if(e.isAssetPastPlayoutLimit(s)){if(this.schedule){const r=this.schedule.items;if(r){const s=t+1;if(s>=r.length)return void this.setSchedulePosition(-1);const n=e.resumeTime;this.timelinePos<n&&(this.log(uo("advanceAfterAssetEnded",n)),this.timelinePos=n,e.appendInPlace&&this.advanceInPlace(n),this.checkBuffer(this.bufferedPos<n)),this.setSchedulePosition(s)}}}else{if(e.appendInPlace){const t=e.assetList[s];t&&this.advanceInPlace(t.timelineStart)}this.setSchedulePosition(t,s)}}setScheduleToAssetAtTime(e,t){const r=this.schedule;if(!r)return;const s=t.parentIdentifier,n=r.getEvent(s);if(n){const t=r.findEventIndex(s),i=r.findAssetIndex(n,e);this.advanceAfterAssetEnded(n,t,i-1)}}setSchedulePosition(e,t){var r;const s=null==(r=this.schedule)?void 0:r.items;if(!s||this.playbackDisabled)return;const n=e>=0?s[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${n?ao(n):n}) pos: ${this.timelinePos}`);const i=this.waitingItem||this.playingItem,a=this.playingLastItem;if(this.isInterstitial(i)){const r=i.event,u=this.playingAsset,c=null==u?void 0:u.identifier,d=c?this.getAssetPlayer(c):null;if(d&&c&&(!this.eventItemsMatch(i,n)||void 0!==t&&c!==r.assetList[t].identifier)){var o;const t=r.findAssetIndex(u);if(this.log(`INTERSTITIAL_ASSET_ENDED ${t+1}/${r.assetList.length} ${so(u)}`),this.endedAsset=u,this.playingAsset=null,this.hls.trigger(x.INTERSTITIAL_ASSET_ENDED,{asset:u,assetListIndex:t,event:r,schedule:s.slice(0),scheduleIndex:e,player:d}),i!==this.playingItem)return void(this.itemsMatch(i,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(r,this.findItemIndex(this.playingItem),t));this.retreiveMediaSource(c,n),!d.media||null!=(o=this.detachedData)&&o.mediaSource||d.detachMedia()}if(!this.eventItemsMatch(i,n)&&(this.endedItem=i,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${r} ${ao(i)}`),r.hasPlayed=!0,this.hls.trigger(x.INTERSTITIAL_ENDED,{event:r,schedule:s.slice(0),scheduleIndex:e}),r.cue.once)){var l;this.updateSchedule();const e=null==(l=this.schedule)?void 0:l.items;if(n&&e){const r=this.findItemIndex(n);this.advanceSchedule(r,e,t,i,a)}return}}this.advanceSchedule(e,s,t,i,a)}advanceSchedule(e,t,r,s,n){const i=this.schedule;if(!i)return;const a=t[e]||null,o=this.primaryMedia,l=this.playerQueue;if(l.length&&l.forEach(t=>{const r=t.interstitial,s=i.findEventIndex(r.identifier);(s<e||s>e+1)&&this.clearInterstitial(r,a)}),this.isInterstitial(a)){this.timelinePos=Math.min(Math.max(this.timelinePos,a.start),a.end);const n=a.event;if(void 0===r){const t=ro(n,(r=i.findAssetIndex(n,this.timelinePos))-1);if(n.isAssetPastPlayoutLimit(t)||n.appendInPlace&&this.timelinePos===a.end)return void this.advanceAfterAssetEnded(n,e,r);r=t}const l=this.waitingItem;this.assetsBuffered(a,o)||this.setBufferingItem(a);let u=this.preloadAssets(n,r);if(this.eventItemsMatch(a,l||s)||(this.waitingItem=a,this.log(`INTERSTITIAL_STARTED ${ao(a)} ${n.appendInPlace?"append in place":""}`),this.hls.trigger(x.INTERSTITIAL_STARTED,{event:n,schedule:t.slice(0),scheduleIndex:e})),!n.assetListLoaded)return void this.log(`Waiting for ASSET-LIST to complete loading ${n}`);if(n.assetListLoader&&(n.assetListLoader.destroy(),n.assetListLoader=void 0),!o)return void this.log(`Waiting for attachMedia to start Interstitial ${n}`);this.waitingItem=this.endedItem=null,this.playingItem=a;const c=n.assetList[r];if(!c)return void this.advanceAfterAssetEnded(n,e,r||0);if(u||(u=this.getAssetPlayer(c.identifier)),null===u||u.destroyed){const e=n.assetList.length;this.warn(`asset ${r+1}/${e} player destroyed ${n}`),u=this.createAssetPlayer(n,c,r),u.loadSource()}if(!this.eventItemsMatch(a,this.bufferingItem)&&n.appendInPlace&&this.isAssetBuffered(c))return;this.startAssetPlayer(u,r,t,e,o),this.shouldPlay&&lo(u.media)}else a?(this.resumePrimary(a,e,s),this.shouldPlay&&lo(this.hls.media)):n&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(i.durations.primary,null))}get playbackDisabled(){return!1===this.hls.config.enableInterstitialPlayback}get primaryDetails(){var e;return null==(e=this.mediaSelection)?void 0:e.main.details}get primaryLive(){var e;return!(null==(e=this.primaryDetails)||!e.live)}resumePrimary(e,t,r){var s,n;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${ao(e)}`),null==(s=this.detachedData)||!s.mediaSource){let r=this.timelinePos;(r<e.start||r>=e.end)&&(r=this.getPrimaryResumption(e,t),this.log(uo("resumePrimary",r)),this.timelinePos=r),this.attachPrimary(r,e)}if(!r)return;const i=null==(n=this.schedule)?void 0:n.items;i&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${ao(e)}`),this.hls.trigger(x.INTERSTITIALS_PRIMARY_RESUMED,{schedule:i.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const r=e.start;if(this.primaryLive){const e=this.primaryDetails;if(0===t)return this.hls.startPosition;if(e&&(r<e.fragmentStart||r>e.edge))return this.hls.liveSyncPosition||-1}return r}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);if(null!=t&&t.hls)return t.hls.bufferedToEnd;return Tr.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,r){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const s=this.primaryMedia;if(!s)return;const n=this.hls;n.media?this.checkBuffer():(this.transferMediaTo(n,s),r&&this.startLoadingPrimaryAt(e,r)),r||(this.log(uo("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,r))}startLoadingPrimaryAt(e,t){var r;const s=this.hls;!s.loadingEnabled||!s.media||Math.abs(((null==(r=s.mainForwardBufferInfo)?void 0:r.start)||s.media.currentTime)-e)>.5?s.startLoad(e,t):s.bufferingEnabled||s.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),null==(e=this.schedule)||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(x.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(x.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(-1===t.level||!this.schedule)return;const r=this.hls.levels[t.level];if(!r.details)return;const s=z(z({},this.mediaSelection||this.altSelection),{},{main:r});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const r=this.hls.audioTracks[t.id],s=this.mediaSelection;if(!s)return void(this.altSelection=z(z({},this.altSelection),{},{audio:r}));const n=z(z({},s),{},{audio:r});this.mediaSelection=n}onSubtitleTrackUpdated(e,t){const r=this.hls.subtitleTracks[t.id],s=this.mediaSelection;if(!s)return void(this.altSelection=z(z({},this.altSelection),{},{subtitles:r}));const n=z(z({},s),{},{subtitles:r});this.mediaSelection=n}onAudioTrackSwitching(e,t){const r=At(t);this.playerQueue.forEach(({hls:e})=>e&&(e.setAudioOption(t)||e.setAudioOption(r)))}onSubtitleTrackSwitch(e,t){const r=At(t);this.playerQueue.forEach(({hls:e})=>e&&(e.setSubtitleOption(t)||-1!==t.id&&e.setSubtitleOption(r)))}onBufferCodecs(e,t){const r=t.tracks;r&&(this.requiredTracks=r)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const r=this.playingItem;if(r&&!this.itemsMatch(r,this.bufferingItem)&&!this.isInterstitial(r)){const e=this.timelinePos;this.bufferedPos=e,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let e=0;e<t.length;e++){const s=t[e];if(s.cue.post){var r;const e=this.schedule.findEventIndex(s.identifier),t=null==(r=this.schedule.items)?void 0:r[e];this.isInterstitial(t)&&this.eventItemsMatch(t,this.bufferingItem)&&this.bufferedToItem(t,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}else this.shouldPlay=!1}updateItem(e,t){var r;const s=null==(r=this.schedule)?void 0:r.items;if(e&&s){return s[this.findItemIndex(e,t)]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((t,r)=>{e.event.isAssetPastPlayoutLimit(r)&&this.clearAssetPlayer(t.identifier,null)});const r=e.end+.25,s=Tr.bufferInfo(this.primaryMedia,r,0);if(s.end>r||(s.nextStart||0)>r){this.log(`trim buffered interstitial ${ao(e)} (was ${ao(t)})`);const s=!0;this.attachPrimary(r,null,s),this.flushFrontBuffer(r)}}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var r;return!!t&&(e===t||e.event.identifier===(null==(r=t.event)?void 0:r.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const r=this.mediaSelection;r&&(null==(t=this.schedule)||t.updateSchedule(r,[],e))}checkBuffer(e){var t;const r=null==(t=this.schedule)?void 0:t.items;if(!r)return;const s=Tr.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,r,e)}updateBufferedPos(e,t,r){const s=this.schedule,n=this.bufferingItem;if(this.bufferedPos>e||!s)return;if(1===t.length&&this.itemsMatch(t[0],n))return void(this.bufferedPos=e);const i=this.playingItem,a=this.findItemIndex(i);let o=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var l;const r=this.findItemIndex(n),s=Math.min(r+1,t.length-1),i=t[s];if((-1===o&&n&&e>=n.end||null!=(l=i.event)&&l.appendInPlace&&e+.01>=i.start)&&(o=s),this.isInterstitial(n)){const e=n.event;if(s-a>1&&!1===e.appendInPlace)return;if(0===e.assetList.length&&e.assetListLoader)return}if(this.bufferedPos=e,o>r&&o>a)this.bufferedToItem(i);else{const t=this.primaryDetails;this.primaryLive&&t&&e>t.edge-t.targetduration&&i.start<t.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(i)&&this.preloadAssets(i.event,0)}}else r&&i&&!this.itemsMatch(i,n)&&(o===a?this.bufferedToItem(i):o===a+1&&this.bufferedToItem(t[o]))}assetsBuffered(e,t){return 0!==e.event.assetList.length&&!e.event.assetList.some(e=>{const r=this.getAssetPlayer(e.identifier);return!(null!=r&&r.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,r=this.schedule;if(!this.itemsMatch(e,t)&&r){const{items:s,events:n}=r;if(!s||!n)return t;const i=this.isInterstitial(e),a=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const o=a?a.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${ao(e)}`+(t?` (${o.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(i){const t=r.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((e,r)=>{const s=this.getAssetPlayer(e.identifier);s&&(r===t&&s.loadSource(),s.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(e=>e.pauseBuffering());this.hls.trigger(x.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:n.slice(0),schedule:s.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const r=this.setBufferingItem(e);if(!this.playbackDisabled)if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(null!==r){this.bufferingAsset=null;const t=this.detachedData;if(t)if(t.mediaSource){const t=!0;this.attachPrimary(e.start,e,t)}else this.preloadPrimary(e);else this.preloadPrimary(e)}}preloadPrimary(e){const t=this.findItemIndex(e),r=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(r)}bufferedToEvent(e,t){const r=e.event,s=0===r.assetList.length&&!r.assetListLoader,n=r.cue.once;if(s||!n){const e=this.preloadAssets(r,t);if(null!=e&&e.interstitial.appendInPlace){const t=this.primaryMedia;t&&this.bufferAssetPlayer(e,t)}}}preloadAssets(e,t){const r=e.assetUrl,s=e.assetList.length,n=0===s&&!e.assetListLoader,i=e.cue.once;if(n){const n=e.timelineStart;if(e.appendInPlace){var a;const t=this.playingItem;this.isInterstitial(t)||(null==t||null==(a=t.nextEvent)?void 0:a.identifier)!==e.identifier||this.flushFrontBuffer(n+.25)}let i,o=0;if(!this.playingItem&&this.primaryLive&&(o=this.hls.startPosition,-1===o&&(o=this.hls.liveSyncPosition||0)),o&&!e.cue.pre&&!e.cue.post){const e=o-n;e>0&&(i=Math.round(1e3*e)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${r?1:s} ${e}${i?` live-start: ${o} start-offset: ${i}`:""}`),r)return this.createAsset(e,0,0,n,e.duration,r);const l=this.assetListLoader.loadAssetList(e,i);l&&(e.assetListLoader=l)}else if(!i&&s){for(let r=t;r<s;r++){const t=e.assetList[r],s=this.getAssetPlayerQueueIndex(t.identifier);-1!==s&&!this.playerQueue[s].destroyed||t.error||this.createAssetPlayer(e,t,r)}const r=e.assetList[t];if(r){const e=this.getAssetPlayer(r.identifier);return e&&e.loadSource(),e}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`);Object.keys(t).forEach(t=>{this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:t})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let r=0;r<t.length;r++)if(e===t[r].assetId)return r;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t)for(let r=0;r<e.length;r++)if(e[r].media===t)return e[r];return null}createAsset(e,t,r,s,n,i){const a={parentIdentifier:e.identifier,identifier:Ja(e,i,t),duration:n,startOffset:r,timelineStart:s,uri:i};return this.createAssetPlayer(e,a,t)}createAssetPlayer(e,t,r){const s=this.hls,n=s.userConfig;let i=n.videoPreference;const a=s.loadLevelObj||s.levels[s.currentLevel];(i||a)&&(i=H({},i),a.videoCodec&&(i.videoCodec=a.videoCodec),a.videoRange&&(i.allowedVideoRanges=[a.videoRange]));const o=s.audioTracks[s.audioTrack],l=s.subtitleTracks[s.subtitleTrack];let u=0;if(this.primaryLive||e.appendInPlace){const e=this.timelinePos-t.timelineStart;if(e>1){const r=t.duration;r&&e<r&&(u=e)}}const c=t.identifier,d=z(z({},n),{},{maxMaxBufferLength:Math.min(180,s.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:s.sessionId,assetPlayerId:c,abrEwmaDefaultEstimate:s.bandwidthEstimate,interstitialsController:void 0,startPosition:u,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:i,audioPreference:o||n.audioPreference,subtitlePreference:l||n.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(d.timelineOffset=t.timelineStart));const h=d.cmcd;null!=h&&h.sessionId&&h.contentId&&(d.cmcd=H({},h,{contentId:Ya(t.uri)})),this.getAssetPlayer(c)&&this.warn(`Duplicate date range identifier ${e} and asset ${c}`);const f=new no(this.HlsPlayerClass,d,e,t);this.playerQueue.push(f),e.assetList[r]=t;let g=!0;const p=s=>{if(s.live){var n;const t=new Error(`Interstitials MUST be VOD assets ${e}`),s={fatal:!0,type:C.OTHER_ERROR,details:D.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},i=(null==(n=this.schedule)?void 0:n.findEventIndex(e.identifier))||-1;return void this.handleAssetItemError(s,e,i,r,t.message)}const i=s.edge-s.fragmentStart,a=t.duration;(g||null===a||i>a)&&(g=!1,this.log(`Interstitial asset "${c}" duration change ${a} > ${i}`),t.duration=i,this.updateSchedule())};f.on(x.LEVEL_UPDATED,(e,{details:t})=>p(t)),f.on(x.LEVEL_PTS_UPDATED,(e,{details:t})=>p(t)),f.on(x.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const m=(e,t)=>{const r=this.getAssetPlayer(c);if(r&&t.tracks){r.off(x.BUFFER_CODECS,m),r.tracks=t.tracks;const e=this.primaryMedia;this.bufferingAsset===r.assetItem&&e&&!r.media&&this.bufferAssetPlayer(r,e)}};f.on(x.BUFFER_CODECS,m);f.on(x.BUFFERED_TO_END,()=>{var r;const s=this.getAssetPlayer(c);if(this.log(`buffered to end of asset ${s}`),!s||!this.schedule)return;const n=this.schedule.findEventIndex(e.identifier),i=null==(r=this.schedule.items)?void 0:r[n];this.isInterstitial(i)&&this.advanceAssetBuffering(i,t)});const y=t=>()=>{if(!this.getAssetPlayer(c)||!this.schedule)return;this.shouldPlay=!0;const r=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,r,t)};return f.once(x.MEDIA_ENDED,y(r)),f.once(x.PLAYOUT_LIMIT_REACHED,y(1/0)),f.on(x.ERROR,(t,s)=>{if(!this.schedule)return;const n=this.getAssetPlayer(c);if(s.details===D.BUFFER_STALLED_ERROR)return null!=n&&n.appendInPlace?void this.handleInPlaceStall(e):(this.onTimeupdate(),void this.checkBuffer(!0));this.handleAssetItemError(s,e,this.schedule.findEventIndex(e.identifier),r,`Asset player error ${s.error} ${e}`)}),f.on(x.DESTROYING,()=>{if(!this.getAssetPlayer(c)||!this.schedule)return;const t=new Error(`Asset player destroyed unexpectedly ${c}`),s={fatal:!0,type:C.OTHER_ERROR,details:D.INTERSTITIAL_ASSET_ITEM_ERROR,error:t};this.handleAssetItemError(s,e,this.schedule.findEventIndex(e.identifier),r,t.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${so(t)}`),this.hls.trigger(x.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:r,event:e,player:f}),f}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(e=>{this.clearAssetPlayer(e.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(-1!==t){this.log(`reset asset player "${e}" after error`);const r=this.playerQueue[t];this.transferMediaFromPlayer(r,null),r.resetDetails()}}clearAssetPlayer(e,t){const r=this.getAssetPlayerQueueIndex(e);if(-1!==r){const e=this.playerQueue[r];this.log(`clear ${e} toSegment: ${t?ao(t):t}`),this.transferMediaFromPlayer(e,t),this.playerQueue.splice(r,1),e.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,r,s,n){const{interstitial:i,assetItem:a,assetId:o}=e,l=i.assetList.length,u=this.playingAsset;this.endedAsset=null,this.playingAsset=a,u&&u.identifier===o||(u&&(this.clearAssetPlayer(u.identifier,r[s]),delete u.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${l} ${so(a)}`),this.hls.trigger(x.INTERSTITIAL_ASSET_STARTED,{asset:a,assetListIndex:t,event:i,schedule:r.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,n)}bufferAssetPlayer(e,t){var r,s;if(!this.schedule)return;const{interstitial:n,assetItem:i}=e,a=this.schedule.findEventIndex(n.identifier),o=null==(r=this.schedule.items)?void 0:r[a];if(!o)return;e.loadSource(),this.setBufferingItem(o),this.bufferingAsset=i;const l=this.getBufferingPlayer();if(l===e)return;const u=n.appendInPlace;if(u&&!1===(null==l?void 0:l.interstitial.appendInPlace))return;const c=(null==l?void 0:l.tracks)||(null==(s=this.detachedData)?void 0:s.tracks)||this.requiredTracks;if(u&&i!==this.playingAsset){if(!e.tracks)return void this.log(`Waiting for track info before buffering ${e}`);if(c&&!te(c,e.tracks)){const t=new Error(`Asset ${so(i)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(c)}')`),r={fatal:!0,type:C.OTHER_ERROR,details:D.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},s=n.findAssetIndex(i);return void this.handleAssetItemError(r,n,a,s,t.message)}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,r=this.primaryMedia;if(!t||!r)return;const s=r.currentTime,n=t.findAssetIndex(e,s),i=e.assetList[n];if(i){const a=this.getAssetPlayer(i.identifier);if(a){const o=a.currentTime||s-i.timelineStart,l=a.duration-o;if(this.warn(`Stalled at ${o} of ${o+l} in ${a} ${e} (media.currentTime: ${s})`),o&&(l/r.playbackRate<.5||a.bufferedInPlaceToEnd(r))&&a.hls){const r=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,r,n)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,r,s,n){if(e.details===D.BUFFER_STALLED_ERROR)return;const i=t.assetList[s]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${i?so(i):i} ${e.error}`),!this.schedule)return;const a=(null==i?void 0:i.identifier)||"",o=this.getAssetPlayerQueueIndex(a),l=this.playerQueue[o]||null,u=this.schedule.items,c=H({},e,{fatal:!1,errorAction:Zt(!0),asset:i,assetListIndex:s,event:t,schedule:u,scheduleIndex:r,player:l});if(this.hls.trigger(x.INTERSTITIAL_ASSET_ERROR,c),!e.fatal)return;const d=this.playingAsset,h=this.bufferingAsset,f=new Error(n);if(i&&(this.clearAssetPlayer(a,null),i.error=f),t.assetList.some(e=>!e.error))for(let e=s;e<t.assetList.length;e++)this.resetAssetPlayer(t.assetList[e].identifier);else t.error=f;this.updateSchedule(!0),t.error?this.primaryFallback(t):d&&d.identifier===a?this.advanceAfterAssetEnded(t,r,s):h&&h.identifier===a&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,h)}primaryFallback(e){const t=e.timelineStart,r=this.effectivePlayingItem;let s=this.timelinePos;if(r){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${s} playing: ${ao(r)} error: ${e.error}`),-1===s&&(s=this.hls.startPosition);const n=this.updateItem(r,s);this.itemsMatch(r,n)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(-1===s)return void this.checkStart();if(!this.schedule)return;const n=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(n)}onAssetListLoaded(e,t){var r,s;const n=t.event,i=n.identifier,a=t.assetListResponse.ASSETS;if(null==(r=this.schedule)||!r.hasEvent(i))return;const o=n.timelineStart,l=n.duration;let u=0;a.forEach((e,t)=>{const r=parseFloat(e.DURATION);this.createAsset(n,t,u,o+u,r,e.URI),u+=r}),n.duration=u,this.log(`Loaded asset-list with duration: ${u} (was: ${l}) ${n}`);const c=this.waitingItem,d=(null==c?void 0:c.event.identifier)===i;this.updateSchedule();const h=null==(s=this.bufferingItem)?void 0:s.event;if(d){var f;const e=this.schedule.findEventIndex(i),t=null==(f=this.schedule.items)?void 0:f[e];if(t){if(!this.playingItem&&this.timelinePos>t.end){if(this.schedule.findItemIndexAtTime(this.timelinePos)!==e)return n.error=new Error(`Interstitial ${a.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${n}`),this.log(n.error.message),this.updateSchedule(!0),void this.primaryFallback(n)}this.setBufferingItem(t)}this.setSchedulePosition(e)}else if((null==h?void 0:h.identifier)===i){const e=n.assetList[0];if(e){const t=this.getAssetPlayer(e.identifier);if(h.appendInPlace){const e=this.primaryMedia;t&&e&&this.bufferAssetPlayer(t,e)}else t&&t.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case D.ASSET_LIST_PARSING_ERROR:case D.ASSET_LIST_LOAD_ERROR:case D.ASSET_LIST_LOAD_TIMEOUT:{const e=t.interstitial;e&&(this.updateSchedule(!0),this.primaryFallback(e));break}case D.BUFFER_STALLED_ERROR:{const e=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(e)&&e.event.appendInPlace)return void this.handleInPlaceStall(e.event);this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}});function pl(e){return e&&"object"==typeof e?Array.isArray(e)?e.map(pl):Object.keys(e).reduce((t,r)=>(t[r]=pl(e[r]),t),{}):e}function ml(e,t){const r=e.loader;if(r!==ul&&r!==fl)t.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{(function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1})()&&(e.loader=ul,e.progressive=!0,e.enableSoftwareAES=!0,t.log("[config]: Progressive streaming enabled, using FetchLoader"))}}class yl extends br{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var e;null!=(e=this.media)&&e.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{var e;this.hls&&(this.ended=(null==(e=this.media)?void 0:e.currentTime)||1,this.hls.trigger(x.MEDIA_ENDED,{stalled:!1}))},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(100),this.mediaSource=t.mediaSource;const r=this.media=t.media;Us(r,"playing",this.onMediaPlaying),Us(r,"waiting",this.onMediaWaiting),Us(r,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:r}=this;r&&(Bs(r,"playing",this.onMediaPlaying),Bs(r,"waiting",this.onMediaWaiting),Bs(r,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(null==(e=this.media)||!e.readyState||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var r,s;const n=null==(r=this.hls)?void 0:r.config;if(!n)return;const i=this.media;if(!i)return;const{seeking:a}=i,o=this.seeking&&!a,l=!this.seeking&&a,u=i.paused&&!a||i.ended||0===i.playbackRate;if(this.seeking=a,e!==t)return t&&(this.ended=0),this.moved=!0,a||(this.nudgeRetry=0,n.nudgeOnVideoHole&&!u&&e>t&&this.nudgeOnVideoHole(e,t)),void(0===this.waiting&&this.stallResolved(e));if(l||o)return void(o&&this.stallResolved(e));if(u)return this.nudgeRetry=0,this.stallResolved(e),void(!this.ended&&i.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(x.MEDIA_ENDED,{stalled:!1})));if(!Tr.getBuffered(i).length)return void(this.nudgeRetry=0);const c=Tr.bufferInfo(i,e,0),d=c.nextStart||0,h=this.fragmentTracker;if(a&&h&&this.hls){const t=vl(this.hls.inFlightFragments,e),r=c.len>2,s=!d||t||d-e>2&&!h.getPartialFragment(e);if(r||s)return;this.moved=!1}const f=null==(s=this.hls)?void 0:s.latestLevelDetails;if(!this.moved&&null!==this.stalled&&h){if(!(c.len>0)&&!d)return;const t=Math.max(d,c.start||0)-e,r=!(null==f||!f.live)?2*f.targetduration:2,s=El(e,h);if(t>0&&(t<=r||s))return void(i.paused||this._trySkipBufferHole(s))}const g=n.detectStallWithCurrentTimeMs,p=self.performance.now(),m=this.waiting;let y=this.stalled;if(null===y){if(!(m>0&&p-m<g))return void(this.stalled=p);y=this.stalled=m}const v=p-y;if(!a&&(v>=g||m)&&this.hls){var b;if("ended"===(null==(b=this.mediaSource)?void 0:b.readyState)&&(null==f||!f.live)&&Math.abs(e-((null==f?void 0:f.edge)||0))<1){if(this.ended)return;return this.ended=e||1,void this.hls.trigger(x.MEDIA_ENDED,{stalled:!0})}if(this._reportStall(c),!this.media||!this.hls)return}const E=Tr.bufferInfo(i,e,n.maxBufferHole);this._tryFixBufferStall(E,v,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const r=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(r)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(x.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var r;const s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&null!=(r=this.buffered.audio)&&r.length&&s&&s.length>1&&e>s.end(0)){const r=Tr.bufferedInfo(Tr.timeRangesToArray(this.buffered.audio),e,0);if(r.len>1&&t>=r.start){const r=Tr.timeRangesToArray(s),n=Tr.bufferedInfo(r,t,0).bufferedIndex;if(n>-1&&n<r.length-1){const t=Tr.bufferedInfo(r,e,0).bufferedIndex,s=r[n].end,i=r[n+1].start;if((-1===t||t>n)&&i-s<1&&e-s<2){const r=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${s} -> ${i} buffered index: ${t}`);this.warn(r.message),this.media.currentTime+=1e-6;let n=El(e,this.fragmentTracker);n&&"fragment"in n?n=n.fragment:n||(n=void 0);const a=Tr.bufferInfo(this.media,e,0);this.hls.trigger(x.ERROR,{type:C.MEDIA_ERROR,details:D.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:r,reason:r.message,frag:n,buffer:a.len,bufferInfo:a})}}}}}_tryFixBufferStall(e,t,r){var s,n;const{fragmentTracker:i,media:a}=this,o=null==(s=this.hls)?void 0:s.config;if(!a||!i||!o)return;const l=null==(n=this.hls)?void 0:n.latestLevelDetails,u=El(r,i);if(u||null!=l&&l.live&&r<l.fragmentStart){if(this._trySkipBufferHole(u)||!this.media)return}const c=e.buffered,d=this.adjacentTraversal(e,r);(c&&c.length>1&&e.len>o.maxBufferHole||e.nextStart&&(e.nextStart-r<o.maxBufferHole||d))&&(t>1e3*o.highBufferWatchdogPeriod||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const r=this.fragmentTracker,s=e.nextStart;if(r&&s){const e=r.getFragAtPos(t,$),n=r.getFragAtPos(s,$);if(e&&n)return n.sn-e.sn<2}return!1}_reportStall(e){const{hls:t,media:r,stallReported:s,stalled:n}=this;if(!s&&null!==n&&r&&t){this.stallReported=!0;const s=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${wt(e)})`);this.warn(s.message),t.trigger(x.ERROR,{type:C.MEDIA_ERROR,details:D.BUFFER_STALLED_ERROR,fatal:!1,error:s,buffer:e.len,bufferInfo:e,stalled:{start:n}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:r,media:s}=this,n=null==(t=this.hls)?void 0:t.config;if(!s||!r||!n)return 0;const i=s.currentTime,a=Tr.bufferInfo(s,i,0),o=i<a.start?a.start:a.nextStart;if(o&&this.hls){const t=a.len<=n.maxBufferHole,u=a.len>0&&a.len<1&&s.readyState<3,c=o-i;if(c>0&&(t||u)){if(c>n.maxBufferHole){let t=!1;if(0===i){const e=r.getAppendedFrag(0,$);e&&o<e.end&&(t=!0)}if(!t&&e){var l;if(null==(l=this.hls.loadLevelObj)||!l.details)return 0;if(vl(this.hls.inFlightFragments,o))return 0;let t=!1,s=e.end;for(;s<o;){const e=El(s,r);if(!e){t=!0;break}s+=e.duration}if(t)return 0}}const t=Math.max(o+.05,i+.1);if(this.warn(`skipping hole, adjusting currentTime from ${i} to ${t}`),this.moved=!0,s.currentTime=t,null==e||!e.gap){const r=new Error(`fragment loaded with buffer holes, seeking from ${i} to ${t}`),s={type:C.MEDIA_ERROR,details:D.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:r,reason:r.message,buffer:a.len,bufferInfo:a};e&&("fragment"in e?s.part=e:s.frag=e),this.hls.trigger(x.ERROR,s)}return t}}return 0}_tryNudgeBuffer(e){const{hls:t,media:r,nudgeRetry:s}=this,n=null==t?void 0:t.config;if(!r||!n)return 0;const i=r.currentTime;if(this.nudgeRetry++,s<n.nudgeMaxRetry){const a=i+(s+1)*n.nudgeOffset,o=new Error(`Nudging 'currentTime' from ${i} to ${a}`);this.warn(o.message),r.currentTime=a,t.trigger(x.ERROR,{type:C.MEDIA_ERROR,details:D.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1,buffer:e.len,bufferInfo:e})}else{const r=new Error(`Playhead still not moving while enough data buffered @${i} after ${n.nudgeMaxRetry} nudges`);this.error(r.message),t.trigger(x.ERROR,{type:C.MEDIA_ERROR,details:D.BUFFER_STALLED_ERROR,error:r,fatal:!0,buffer:e.len,bufferInfo:e})}}}function vl(e,t){const r=bl(e.main);if(r&&r.start<=t)return r;const s=bl(e.audio);return s&&s.start<=t?s:null}function bl(e){if(!e)return null;switch(e.state){case Ks:case Gs:case Qs:case Xs:return null}return e.frag}function El(e,t){return t.getAppendedFrag(e,$)||t.getPartialFragment(e)}function Sl(){if("undefined"!=typeof self)return self.VTTCue||self.TextTrackCue}function Tl(e,t,r,s,n){let i=new e(t,r,"");try{i.value=s,n&&(i.type=n)}catch(a){i=new e(t,r,wt(n?z({type:n},s):s))}return i}const wl=(()=>{const e=Sl();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class kl{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(x.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(x.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(x.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var r;this.media=t.media,!1===(null==(r=t.overrides)?void 0:r.cueRemoval)&&(this.removeCues=!1)}onMediaAttached(){var e;const t=null==(e=this.hls)?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null;!!t.transferMedia||(this.id3Track&&(this.removeCues&&za(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if("metadata"===r.kind&&"id3"===r.label)return Ha(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:r,enableID3MetadataCues:s}=this.hls.config;if(!r&&!s)return;const{samples:n}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const i=Sl();if(i)for(let e=0;e<n.length;e++){const t=n[e].type;if(t===Cn.emsg&&!r||!s)continue;const a=Ln(n[e].data),o=n[e].pts;let l=o+n[e].duration;l>wl&&(l=wl);l-o<=0&&(l=o+.25);for(let e=0;e<a.length;e++){const r=a[e];if(!Rn(r)){this.updateId3CueEnds(o,t);const e=Tl(i,o,l,r,t);e&&this.id3Track.addCue(e)}}}}updateId3CueEnds(e,t){var r;const s=null==(r=this.id3Track)?void 0:r.cues;if(s)for(let r=s.length;r--;){const n=s[r];n.type===t&&n.startTime<e&&n.endTime===wl&&(n.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:s}){const{id3Track:n,hls:i}=this;if(!i)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:o}}=i;if(n&&(a||o)){let e;e="audio"===s?e=>e.type===Cn.audioId3&&o:"video"===s?e=>e.type===Cn.emsg&&a:e=>e.type===Cn.audioId3&&o||e.type===Cn.emsg&&a,qa(n,t,r,e)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:r,timelineOffset:s,enableDateRangeMetadataCues:n,interstitialsController:i}=this.hls.config;if(!n)return;const a=Sl();if(r&&s&&!i){const{fragmentStart:t,fragmentEnd:s}=e;let n=this.assetCue;n?(n.startTime=t,n.endTime=s):a&&(n=this.assetCue=Tl(a,t,s,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),n&&(n.id=r,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(n),n.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:o}=this,{dateRanges:l}=e,u=Object.keys(l);let c=this.dateRangeCuesAppended;var d;if(o&&t)if(null!=(d=o.cues)&&d.length){const e=Object.keys(c).filter(e=>!u.includes(e));for(let t=e.length;t--;){var h;const r=e[t],s=null==(h=c[r])?void 0:h.cues;delete c[r],s&&Object.keys(s).forEach(e=>{const t=s[e];if(t){t.removeEventListener("enter",this.onEventCueEnter);try{o.removeCue(t)}catch(e){}}})}}else c=this.dateRangeCuesAppended={};const f=e.fragments[e.fragments.length-1];if(0!==u.length&&R(null==f?void 0:f.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let e=0;e<u.length;e++){const t=u[e],r=l[t],s=r.startTime,n=c[t],o=(null==n?void 0:n.cues)||{};let d=(null==n?void 0:n.durationKnown)||!1,h=wl;const{duration:f,endDate:g}=r;if(g&&null!==f)h=s+f,d=!0;else if(r.endOnNext&&!d){const e=u.reduce((e,t)=>{if(t!==r.id){const s=l[t];if(s.class===r.class&&s.startDate>r.startDate&&(!e||r.startDate<e.startDate))return s}return e},null);e&&(h=e.startTime,d=!0)}const p=Object.keys(r.attr);for(let e=0;e<p.length;e++){const l=p[e];if(!Cr(l))continue;const u=o[l];if(u)!d||null!=n&&n.durationKnown?Math.abs(u.startTime-s)>.01&&(u.startTime=s,u.endTime=h):u.endTime=h;else if(a){let e=r.attr[l];Dr(l)&&(e=ne(e));const n=Tl(a,s,h,{key:l,data:e},Cn.dateRange);n&&(n.id=t,this.id3Track.addCue(n),o[l]=n,i&&("X-ASSET-LIST"!==l&&"X-ASSET-URL"!==l||n.addEventListener("enter",this.onEventCueEnter)))}}c[t]={cues:o,dateRange:r,durationKnown:d}}}}}class _l{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:e}=this,t=this.levelDetails;if(!e||!t)return;this.currentTime=e.currentTime;const r=this.computeLatency();if(null===r)return;this._latency=r;const{lowLatencyMode:s,maxLiveSyncPlaybackRate:n}=this.config;if(!s||1===n||!t.live)return;const i=this.targetLatency;if(null===i)return;const a=r-i;if(a<Math.min(this.maxLatency,i+t.targetduration)&&a>.05&&this.forwardBufferLength>1){const t=Math.min(2,Math.max(1,n)),r=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20,s=Math.min(t,Math.max(1,r));this.changeMediaPlaybackRate(e,s)}else 1!==e.playbackRate&&0!==e.playbackRate&&this.changeMediaPlaybackRate(e,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return(null==(e=this.hls)?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(void 0!==e.liveMaxLatencyDuration)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(null===e||null===this.hls)return null;const{holdBack:t,partHoldBack:r,targetduration:s}=e,{liveSyncDuration:n,liveSyncDurationCount:i,lowLatencyMode:a}=this.config,o=this.hls.userConfig;let l=a&&r||t;(this._targetLatencyUpdated||o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==n?n:i*s);const u=s;return l+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,u)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(null===e||null===t)return null;const r=this.levelDetails;if(null===r)return null;const s=r.edge,n=e-t-this.edgeStalled,i=s-r.totalduration,a=s-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(i,n),a)}get drift(){const e=this.levelDetails;return null===e?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(null===e)return 0;const t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(x.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(x.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var r;t.details===D.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&null!=(r=this.levelDetails)&&r.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var r,s;e.playbackRate!==t&&(null==(r=this.hls)||r.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${null==(s=this.targetLatency)?void 0:s.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}class Al extends xi{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this),e.on(x.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this),e.off(x.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,s=[],n={},i={};let a=!1,o=!1,l=!1;t.levels.forEach(e=>{const t=e.attrs;let{audioCodec:u,videoCodec:c}=e;u&&(e.audioCodec=u=et(u,r)||void 0),c&&(c=e.videoCodec=function(e){const t=e.split(",");for(let e=0;e<t.length;e++){const r=t[e].split(".");r.length>2&&"avc1"===r[0]&&(t[e]=`avc1.${parseInt(r[1]).toString(16)}${("000"+parseInt(r[2]).toString(16)).slice(-4)}`)}return t.join(",")}(c));const{width:d,height:h,unknownCodecs:f}=e,g=(null==f?void 0:f.length)||0;if(a||(a=!(!d||!h)),o||(o=!!c),l||(l=!!u),g||u&&!this.isAudioSupported(u)||c&&!this.isVideoSupported(c))return void this.log(`Some or all CODECS not supported "${t.CODECS}"`);const{CODECS:p,"FRAME-RATE":m,"HDCP-LEVEL":y,"PATHWAY-ID":v,RESOLUTION:b,"VIDEO-RANGE":E}=t,S=`${`${v||"."}-`}${e.bitrate}-${b}-${m}-${p}-${E}-${y}`;if(n[S])if(n[S].uri===e.url||e.attrs["PATHWAY-ID"])n[S].addGroupId("audio",t.AUDIO),n[S].addGroupId("text",t.SUBTITLES);else{const t=i[S]+=1;e.attrs["PATHWAY-ID"]=new Array(t+1).join(".");const r=this.createLevel(e);n[S]=r,s.push(r)}else{const t=this.createLevel(e);n[S]=t,i[S]=1,s.push(t)}}),this.filterAndSortMediaOptions(s,t,a,o,l)}createLevel(e){const t=new Et(e),r=e.supplemental;if(null!=r&&r.videoCodec&&!this.isVideoSupported(r.videoCodec)){const e=new Error(`SUPPLEMENTAL-CODECS not supported "${r.videoCodec}"`);this.log(e.message),t.supportedResult=lt(e,[])}return t}isAudioSupported(e){return qe(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return qe(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,r,s,n){var i;let a=[],o=[],l=e;const u=(null==(i=t.stats)?void 0:i.parsing)||{};if((r||s)&&n&&(l=l.filter(({videoCodec:e,videoRange:t,width:r,height:s})=>{return(!!e||!(!r||!s))&&(!!(n=t)&&gt.indexOf(n)>-1);var n})),0===l.length)return Promise.resolve().then(()=>{if(this.hls){let e="no level with compatible codecs found in manifest",r=e;t.levels.length&&(r=`one or more CODECS in variant not supported: ${wt(t.levels.map(e=>e.attrs.CODECS).filter((e,t,r)=>r.indexOf(e)===t))}`,this.warn(r),e+=` (${r})`);const s=new Error(e);this.hls.trigger(x.ERROR,{type:C.MEDIA_ERROR,details:D.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:s,reason:r})}}),void(u.end=performance.now());t.audioTracks&&(a=t.audioTracks.filter(e=>!e.audioCodec||this.isAudioSupported(e.audioCodec)),Ll(a)),t.subtitles&&(o=t.subtitles,Ll(o));const c=l.slice(0);l.sort((e,t)=>{if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return gt.indexOf(e.videoRange)-gt.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){const r=Qe(e.videoCodec),s=Qe(t.videoCodec);if(r!==s)return s-r}if(e.uri===t.uri&&e.codecSet!==t.codecSet){const r=Xe(e.codecSet),s=Xe(t.codecSet);if(r!==s)return s-r}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0});let d=c[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==c.length))for(let e=0;e<c.length;e++)if(c[e].pathwayId===l[0].pathwayId){d=c[e];break}this._levels=l;for(let e=0;e<l.length;e++)if(l[e]===d){var h;this._firstLevel=e;const t=d.bitrate,r=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${t}`),void 0===(null==(h=this.hls.userConfig)?void 0:h.abrEwmaDefaultEstimate)){const e=Math.min(t,this.hls.config.abrEwmaDefaultEstimateMax);e>r&&r===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=e)}break}const f=n&&!s,g=this.hls.config,p=!(!g.audioStreamController||!g.audioTrackController),m={levels:l,audioTracks:a,subtitleTracks:o,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:n,video:s,altAudio:p&&!f&&a.some(e=>!!e.url)};u.end=performance.now(),this.hls.trigger(x.MANIFEST_PARSED,m)}get levels(){return 0===this._levels.length?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const r=new Error("invalid level idx"),s=e<0;if(this.hls.trigger(x.ERROR,{type:C.OTHER_ERROR,details:D.LEVEL_SWITCH_ERROR,level:e,fatal:s,error:r,reason:r.message}),s)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,s=this.currentLevel,n=s?s.attrs["PATHWAY-ID"]:void 0,i=t[e],a=i.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=i,r===e&&s&&n===a)return;this.log(`Switching to level ${e} (${i.height?i.height+"p ":""}${i.videoRange?i.videoRange+" ":""}${i.codecSet?i.codecSet+" ":""}@${i.bitrate})${a?" with Pathway "+a:""} from level ${r}${n?" with Pathway "+n:""}`);const o={level:e,attrs:i.attrs,details:i.details,bitrate:i.bitrate,averageBitrate:i.averageBitrate,maxBitrate:i.maxBitrate,realBitrate:i.realBitrate,width:i.width,height:i.height,codecSet:i.codecSet,audioCodec:i.audioCodec,videoCodec:i.videoCodec,audioGroups:i.audioGroups,subtitleGroups:i.subtitleGroups,loaded:i.loaded,loadError:i.loadError,fragmentError:i.fragmentError,name:i.name,id:i.id,uri:i.uri,url:i.url,urlId:0,audioGroupIds:i.audioGroupIds,textGroupIds:i.textGroupIds};this.hls.trigger(x.LEVEL_SWITCHING,o);const l=i.details;if(!l||l.live){const e=this.switchParams(i.uri,null==s?void 0:s.details,l);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),r=e.filter(e=>-1!==t.indexOf(e));if(e.length<1)return void this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);this.steering.pathwayPriority=r}}onError(e,t){!t.fatal&&t.context&&t.context.type===N&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(void 0!==t&&t.type===$){const e=t.elementaryStreams;if(!Object.keys(e).some(t=>!!e[t]))return;const r=this._levels[t.level];null!=r&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var r;const{level:s,details:n}=t,i=t.levelInfo;var a;if(!i)return this.warn(`Invalid level index ${s}`),void(null!=(a=t.deliveryDirectives)&&a.skip&&(n.deltaUpdateFailed=!0));if(i===this.currentLevel||t.withoutMultiVariant){0===i.fragmentError&&(i.loadError=0);let e=i.details;e===t.details&&e.advanced&&(e=void 0),this.playlistLoaded(s,t,e)}else null!=(r=t.deliveryDirectives)&&r.skip&&(n.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=this.getUrlWithDirectives(e.uri,t),s=this.currentLevelIndex,n=e.attrs["PATHWAY-ID"],i=e.details,a=null==i?void 0:i.age;this.log(`Loading level index ${s}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""}${n?" Pathway "+n:""}${a&&i.live?" age "+a.toFixed(1)+(i.type&&" "+i.type||""):""} ${r}`),this.hls.trigger(x.LEVEL_LOADING,{url:r,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(1===this._levels.length)return;const r=this._levels.filter((t,r)=>r!==e||(this.steering&&this.steering.removeLevel(t),t===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,t.details&&t.details.fragments.forEach(e=>e.level=-1)),!1));Cs(r),this._levels=r,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const s=r.length-1;this._firstLevel=Math.min(this._firstLevel,s),this._startLevel&&(this._startLevel=Math.min(this._startLevel,s)),this.hls.trigger(x.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(x.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function Ll(e){const t={};e.forEach(e=>{const r=e.groupId||"";e.id=t[r]=t[r]||0,t[r]++})}function Rl(){return self.SourceBuffer||self.WebKitSourceBuffer}function Il(){if(!ee())return!1;const e=Rl();return!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove}class Pl extends en{constructor(e,t,r){super(e,t,r,"stream-controller",$),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const e=this.media,t=e?e.currentTime:null;if(null===t||!R(t))return;if(this.log(`Media seeked to ${t.toFixed(3)}`),!this.getBufferedFrag(t))return;const r=this.getFwdBufferInfoAtPos(e,t,$,0);null!==r&&0!==r.len?this.tick():this.warn(`Main forward buffer length at ${t} on "seeked" event ${r?r.len:"empty"})`)},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(x.MANIFEST_PARSED,this.onManifestParsed,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.LEVEL_LOADED,this.onLevelLoaded,this),e.on(x.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(x.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(x.BUFFER_CREATED,this.onBufferCreated,this),e.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(x.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(x.MANIFEST_PARSED,this.onManifestParsed,this),e.off(x.LEVEL_LOADED,this.onLevelLoaded,this),e.off(x.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(x.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(x.BUFFER_CREATED,this.onBufferCreated,this),e.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(x.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:r,hls:s}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=s.startLevel;-1===e&&(s.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=s.firstAutoLevel),s.nextLoadLevel=e,this.level=s.loadLevel,this._hasEnoughToStart=!!t}r>0&&-1===e&&!t&&(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r),this.state=Ks,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=Gs}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case Zs:{const{levels:e,level:t}=this,r=null==e?void 0:e[t],s=null==r?void 0:r.details;if(s&&(!s.live||this.levelLastLoaded===r&&!this.waitForLive(r))){if(this.waitForCdnTuneIn(s))break;this.state=Ks;break}if(this.hls.nextLoadLevel!==this.level){this.state=Ks;break}break}case zs:this.checkRetryDate()}this.state===Ks&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),null!=(e=this.media)&&e.readyState&&!1===this.media.seeking&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:s}=this;if(null===t||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;const n=this.buffering?e.nextLoadLevel:e.loadLevel;if(null==r||!r[n])return;const i=r[n],a=this.getMainFwdBufferInfo();if(null===a)return;const o=this.getLevelDetails();if(o&&this._streamEnded(a,o)){const e={};return 2===this.altAudio&&(e.type="video"),this.hls.trigger(x.BUFFER_EOS,e),void(this.state=Qs)}if(!this.buffering)return;e.loadLevel!==n&&-1===e.manualLevel&&this.log(`Adapting to level ${n} from level ${this.level}`),this.level=e.nextLoadLevel=n;const l=i.details;if(!l||this.state===Zs||this.waitForLive(i))return this.level=n,this.state=Zs,void(this.startFragRequested=!1);const u=a.len,c=this.getMaxBufferLength(i.maxBitrate);if(u>=c)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const d=this.backtrackFragment?this.backtrackFragment.start:a.end;let h=this.getNextFragment(d,l);if(this.couldBacktrack&&!this.fragPrevious&&h&&ge(h)&&this.fragmentTracker.getState(h)!==sr){var f;const e=(null!=(f=this.backtrackFragment)?f:h).sn-l.startSN,t=l.fragments[e-1];t&&h.cc===t.cc&&(h=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(h&&this.isLoopLoading(h,d)){if(!h.gap){const e=this.audioOnly&&!this.altAudio?ce:de,t=(e===de?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,$)}h=this.getNextFragmentLoopLoading(h,l,a,$,c)}h&&(!h.initSegment||h.initSegment.data||this.bitrateTest||(h=h.initSegment),this.loadFragment(h,i,d))}loadFragment(e,t,r){const s=this.fragmentTracker.getState(e);s===er||s===rr?ge(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,r):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,$)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let r;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const n=this.getLevelDetails();if(null!=n&&n.live){const e=this.getMainFwdBufferInfo();if(!e||e.len<2*n.targetduration)return}if(!t.paused&&e){const t=e[this.hls.nextLoadLevel],s=this.fragLastKbps;r=s&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*s)+1:0}else r=0;const i=this.getBufferedFrag(t.currentTime+r);if(i){const e=this.followingBufferedFrag(i);if(e){this.abortCurrentFrag();const t=e.maxStartPTS?e.maxStartPTS:e.start,r=e.duration,s=Math.max(i.end,t+Math.min(Math.max(r-this.config.maxFragLookUpTolerance,r*(this.couldBacktrack?.5:.125)),r*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(s,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Hs:case Vs:case zs:case Ws:case Ys:this.state=Ks}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,2===this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;Us(r,"playing",this.onMediaPlaying),Us(r,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:r}=this;r&&(Bs(r,"playing",this.onMediaPlaying),Bs(r,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t);!!t.transferMedia||(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(x.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let r=!1,s=!1;for(let e=0;e<t.levels.length;e++){const n=t.levels[e].audioCodec;n&&(r=r||-1!==n.indexOf("mp4a.40.2"),s=s||-1!==n.indexOf("mp4a.40.5"))}this.audioCodecSwitch=r&&s&&!function(){var e;const t=Rl();return"function"==typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==Ks)return;const s=t.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=Zs)}onLevelLoaded(e,t){var r;const{levels:s,startFragRequested:n}=this,i=t.level,a=t.details,o=a.totalduration;if(!s)return void this.warn(`Levels were reset while loading level ${i}`);this.log(`Level ${i} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${o}`);const l=t.levelInfo,u=this.fragCurrent;!u||this.state!==Vs&&this.state!==zs||u.level!==t.level&&u.loader&&this.abortCurrentFrag();let c=0;if(a.live||null!=(r=l.details)&&r.live){var d;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;c=this.alignPlaylists(a,l.details,null==(d=this.levelLastLoaded)?void 0:d.details)}if(l.details=a,this.levelLastLoaded=l,n||this.setStartPosition(a,c),this.hls.trigger(x.LEVEL_UPDATED,{details:a,level:i}),this.state===Zs){if(this.waitForCdnTuneIn(a))return;this.state=Ks}n&&a.live&&this.synchronizeToLiveEdge(a),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const s=this.hls.liveSyncPosition,n=this.getLoadPosition(),i=e.fragmentStart,a=e.edge,o=n>=i-t.maxFragLookUpTolerance&&n<=a;if(null!==s&&r.duration>s&&(n<s||!o)){const i=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!o&&r.readyState<4||n<a-i)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),r.readyState))if(this.warn(`Playback: ${n.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${s.toFixed(3)}`),"buffered"===this.config.liveSyncMode){var l;const e=Tr.bufferInfo(r,s,0);if(null==(l=e.buffered)||!l.length)return void(r.currentTime=s);if(e.start<=n)return void(r.currentTime=s);const{nextStart:t}=Tr.bufferedInfo(e.buffered,n,0);t&&(r.currentTime=t)}else r.currentTime=s}}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:s,payload:n}=e,{levels:i}=this;if(!i)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);const a=i[r.level];if(!a)return void this.warn(`Level ${r.level} not found on progress`);const o=a.details;if(!o)return this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),void this.fragmentTracker.removeFragment(r);const l=a.videoCodec,u=o.PTSKnown||!o.live,c=null==(t=r.initSegment)?void 0:t.data,d=this._getAudioCodec(a),h=this.transmuxer=this.transmuxer||new Di(this.hls,$,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=s?s.index:-1,g=-1!==f,p=new Er(r.level,r.sn,r.stats.chunkCount,n.byteLength,f,g),m=this.initPTS[r.cc];h.push(n,c,d,l,r,s,o.totalduration,u,p,m)}onAudioTrackSwitching(e,t){const r=this.hls,s=0!==this.altAudio;if(Ct(t.url,r))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(s)return this.altAudio=0,this.fragmentTracker.removeAllFragments(),r.once(x.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(x.AUDIO_TRACK_SWITCHED,t)}),void r.trigger(x.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});r.trigger(x.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=Ct(t.url,this.hls);if(r){const e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=r?2:0,this.tick()}onBufferCreated(e,t){const r=t.tracks;let s,n,i=!1;for(const e in r){const t=r[e];if("main"===t.id){if(n=e,s=t,"video"===e){const t=r[e];t&&(this.videoBuffer=t.buffer)}}else i=!0}i&&s?(this.log(`Alternate track found, use ${n}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:s}=t,n=r.type===$;if(n){if(this.fragContextChanged(r))return this.warn(`Fragment ${r.sn}${s?" p: "+s.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),void(this.state===Ys&&(this.state=Ks));const e=s?s.stats:r.stats;this.fragLastKbps=Math.round(8*e.total/(e.buffering.end-e.loading.first)),ge(r)&&(this.fragPrevious=r),this.fragBufferedComplete(r,s)}const i=this.media;i&&(!this._hasEnoughToStart&&Tr.getBuffered(i).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),n&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var r;if(t.fatal)this.state=Xs;else switch(t.details){case D.FRAG_GAP:case D.FRAG_PARSING_ERROR:case D.FRAG_DECRYPT_ERROR:case D.FRAG_LOAD_ERROR:case D.FRAG_LOAD_TIMEOUT:case D.KEY_LOAD_ERROR:case D.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError($,t);break;case D.LEVEL_LOAD_ERROR:case D.LEVEL_LOAD_TIMEOUT:case D.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Zs||(null==(r=t.context)?void 0:r.type)!==N||(this.state=Ks);break;case D.BUFFER_ADD_CODEC_ERROR:case D.BUFFER_APPEND_ERROR:if("main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case D.BUFFER_FULL_ERROR:if("main"!==t.parent)return;if(this.reduceLengthAndFlushBuffer(t)){!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}break;case D.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onFragLoadEmergencyAborted(){this.state=Ks,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==ce||!this.altAudio){const e=(t===de?this.videoBuffer:this.mediaBuffer)||this.media;e&&(this.afterBufferFlushed(e,t,$),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,-1===this.level&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking)return void this.log(`could not seek to ${r}, already seeking at ${t}`);const s=this.timelineOffset;s&&r&&(r+=s);const n=this.getLevelDetails(),i=Tr.getBuffered(e),a=i.length?i.start(0):0,o=a-r,l=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||o>0&&(o<l||this.loadingParts&&o<2*((null==n?void 0:n.partTarget)||0)))&&(this.log(`adjusting start position by ${o} to match buffer start`),r+=o,this.startPosition=r),t<r&&(this.log(`seek to target start position ${r} from current time ${t} buffer start ${a}`),e.currentTime=r)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(e=>{const{hls:r}=this,s=null==e?void 0:e.frag;if(!s||this.fragContextChanged(s))return;t.fragmentError=0,this.state=Ks,this.startFragRequested=!1,this.bitrateTest=!1;const n=s.stats;n.parsing.start=n.parsing.end=n.buffering.start=n.buffering.end=self.performance.now(),r.trigger(x.FRAG_LOADED,e),s.bitrateTest=!1}).catch(t=>{this.state!==Gs&&this.state!==Xs&&(this.warn(t),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:r}=this,{remuxResult:s,chunkMeta:n}=e,i=this.getCurrentContext(n);if(!i)return void this.resetWhenMissingContext(n);const{frag:a,part:o,level:l}=i,{video:u,text:c,id3:d,initSegment:h}=s,{details:f}=l,g=this.altAudio?void 0:s.audio;if(this.fragContextChanged(a))this.fragmentTracker.removeFragment(a);else{if(this.state=Ws,h){const e=h.tracks;if(e){const s=a.initSegment||a;if(this.unhandledEncryptionError(h,a))return;this._bufferInitSegment(l,e,s,n),r.trigger(x.FRAG_PARSING_INIT_SEGMENT,{frag:s,id:t,tracks:e})}const s=h.initPTS,i=h.timescale,o=this.initPTS[a.cc];if(R(s)&&(!o||o.baseTime!==s||o.timescale!==i)){const e=h.trackId;this.initPTS[a.cc]={baseTime:s,timescale:i,trackId:e},r.trigger(x.INIT_PTS_FOUND,{frag:a,id:t,initPTS:s,timescale:i,trackId:e})}}if(u&&f){g&&"audiovideo"===u.type&&this.logMuxedErr(a);const e=f.fragments[a.sn-1-f.startSN],t=a.sn===f.startSN,r=!e||a.cc>e.cc;if(!1!==s.independent){const{startPTS:e,endPTS:s,startDTS:i,endDTS:l}=u;if(o)o.elementaryStreams[u.type]={startPTS:e,endPTS:s,startDTS:i,endDTS:l};else if(u.firstKeyFrame&&u.independent&&1===n.id&&!r&&(this.couldBacktrack=!0),u.dropped&&u.independent){const n=this.getMainFwdBufferInfo(),i=(n?n.end:this.getLoadPosition())+this.config.maxBufferHole,o=u.firstKeyFramePTS?u.firstKeyFramePTS:e;if(!t&&i<o-this.config.maxBufferHole&&!r)return void this.backtrack(a);r&&(a.gap=!0),a.setElementaryStreamInfo(u.type,a.start,s,a.start,l,!0)}else t&&e-(f.appliedTimelineOffset||0)>2&&(a.gap=!0);a.setElementaryStreamInfo(u.type,e,s,i,l),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(u,a,o,n,t||r)}else{if(!t&&!r)return void this.backtrack(a);a.gap=!0}}if(g){const{startPTS:e,endPTS:t,startDTS:r,endDTS:s}=g;o&&(o.elementaryStreams[ce]={startPTS:e,endPTS:t,startDTS:r,endDTS:s}),a.setElementaryStreamInfo(ce,e,t,r,s),this.bufferFragmentData(g,a,o,n)}if(f&&null!=d&&d.samples.length){const e={id:t,frag:a,details:f,samples:d.samples};r.trigger(x.FRAG_PARSING_METADATA,e)}if(f&&c){const e={id:t,frag:a,details:f,samples:c.samples};r.trigger(x.FRAG_PARSING_USERDATA,e)}}}logMuxedErr(e){this.warn(`${ge(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,r,s){if(this.state!==Ws)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(r));const{audio:n,video:i,audiovideo:a}=t;if(n){const r=e.audioCodec;let s=tt(n.codec,r);"mp4a"===s&&(s="mp4a.40.5");const i=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){s&&(s=-1!==s.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const e=n.metadata;e&&"channelCount"in e&&1!==(e.channelCount||1)&&-1===i.indexOf("firefox")&&(s="mp4a.40.5")}s&&-1!==s.indexOf("mp4a.40.5")&&-1!==i.indexOf("android")&&"audio/mpeg"!==n.container&&(s="mp4a.40.2",this.log(`Android: force audio codec to ${s}`)),r&&r!==s&&this.log(`Swapping manifest audio codec "${r}" for "${s}"`),n.levelCodec=s,n.id=$,this.log(`Init audio buffer, container:${n.container}, codecs[selected/level/parsed]=[${s||""}/${r||""}/${n.codec}]`),delete t.audiovideo}if(i){i.levelCodec=e.videoCodec,i.id=$;const r=i.codec;if(4===(null==r?void 0:r.length))switch(r){case"hvc1":case"hev1":i.codec="hvc1.1.6.L120.90";break;case"av01":i.codec="av01.0.04M.08";break;case"avc1":i.codec="avc1.42e01e"}this.log(`Init video buffer, container:${i.container}, codecs[level/parsed]=[${e.videoCodec||""}/${r}]${i.codec!==r?" parsed-corrected="+i.codec:""}${i.supplemental?" supplemental="+i.supplemental:""}`),delete t.audiovideo}a&&(this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),delete t.video,delete t.audio);const o=Object.keys(t);if(o.length){if(this.hls.trigger(x.BUFFER_CODECS,t),!this.hls)return;o.forEach(e=>{const n=t[e].initSegment;null!=n&&n.byteLength&&this.hls.trigger(x.BUFFER_APPENDING,{type:e,data:n,frag:r,part:null,chunkMeta:s,parent:r.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&2===this.altAudio?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,$)}get maxBufferLength(){const{levels:e,level:t}=this,r=null==e?void 0:e[t];return r?this.getMaxBufferLength(r.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Ks}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const r=e.currentTime;if(Tr.isBuffered(e,r)?t=this.getAppendedFrag(r):Tr.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,r=t.level;e&&t.sn===e.sn&&e.level===r||(this.fragPlaying=t,this.hls.trigger(x.FRAG_CHANGED,{frag:t}),e&&e.level===r||this.hls.trigger(x.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;return R(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;if(R(t)){const e=this.getLevelDetails(),r=this.currentFrag||(e?xt(null,e.fragments,t):null);if(r){const e=r.programDateTime;if(null!==e){const s=e+1e3*(t-r.start);return new Date(s)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Cl extends q{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyIdToKeyInfo){const s=this.keyIdToKeyInfo[r].loader;if(s){var t;if(e&&e!==(null==(t=s.context)?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=D.KEY_LOAD_ERROR,r,s,n){return new vr({type:C.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:n,error:r,networkDetails:s})}loadClear(e,t,r){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let s=0,n=t.length;s<n;s++){const i=t[s];if(e.cc<=i.cc&&(!ge(e)||!ge(i)||e.sn<i.sn)||!r&&s==n-1)return this.emeController.selectKeySystemFormat(i).then(e=>{if(!this.emeController)return;i.setKeyFormat(e);const t=Yr(e);return t?this.emeController.getKeySystemAccess([t]):void 0})}if(this.config.requireKeySystemAccessOnStart){const e=Xr(this.config);if(e.length)return this.emeController.getKeySystemAccess(e)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,s;t&&e.setKeyFormat(t);const n=e.decryptdata;if(!n){const r=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,D.KEY_LOAD_ERROR,r))}const i=n.uri;if(!i)return Promise.reject(this.createKeyLoadError(e,D.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${i}"`)));const a=Dl(n);let o=this.keyIdToKeyInfo[a];if(null!=(r=o)&&r.decryptdata.key)return n.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});if(this.emeController&&null!=(s=o)&&s.keyLoadPromise){switch(this.emeController.getKeyStatus(o.decryptdata)){case"usable":case"usable-in-future":return o.keyLoadPromise.then(t=>{const{keyInfo:r}=t;return n.key=r.decryptdata.key,{frag:e,keyInfo:r}})}}switch(this.log(`${this.keyIdToKeyInfo[a]?"Rel":"L"}oading${n.keyId?" keyId: "+se(n.keyId):""} URI: ${n.uri} from ${e.type} ${e.level}`),o=this.keyIdToKeyInfo[a]={decryptdata:n,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},n.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===n.keyFormat?this.loadKeyHTTP(o,e):this.loadKeyEME(o,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,D.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${n.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var s;if(!e.decryptdata.keyId&&null!=(s=t.initSegment)&&s.data){const r=function(e){const t=[];return Oe(e,e=>t.push(e.subarray(8,24))),t}(t.initSegment.data);if(r.length){let t=r[0];t.some(e=>0!==e)?(this.log(`Using keyId found in init segment ${se(t)}`),rs.setKeyIdForUri(e.decryptdata.uri,t)):(t=rs.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${se(t)}`)),e.decryptdata.keyId=t}}if(!e.decryptdata.keyId&&!ge(t))return Promise.resolve(r);const n=this.emeController.loadKey(r);return(e.keyLoadPromise=n.then(t=>(e.mediaKeySessionContext=t,r))).catch(r=>{throw e.keyLoadPromise=null,"data"in r&&(r.data.frag=t),r})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,s=new(0,r.loader)(r);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((n,i)=>{const a={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},o=r.keyLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(e,t,r,s)=>{const{frag:a,keyInfo:o}=r,l=Dl(o.decryptdata);if(!a.decryptdata||o!==this.keyIdToKeyInfo[l])return i(this.createKeyLoadError(a,D.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),s));o.decryptdata.key=a.decryptdata.key=new Uint8Array(e.data),a.keyLoader=null,o.loader=null,n({frag:a,keyInfo:o})},onError:(e,r,s,n)=>{this.resetLoader(r),i(this.createKeyLoadError(t,D.KEY_LOAD_ERROR,new Error(`HTTP Error ${e.code} loading key ${e.text}`),s,z({url:a.url,data:void 0},e)))},onTimeout:(e,r,s)=>{this.resetLoader(r),i(this.createKeyLoadError(t,D.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),s))},onAbort:(e,r,s)=>{this.resetLoader(r),i(this.createKeyLoadError(t,D.INTERNAL_ABORTED,new Error("key loading aborted"),s))}};s.load(a,l,u)})}resetLoader(e){const{frag:t,keyInfo:r,url:s}=e,n=r.loader;t.keyLoader===n&&(t.keyLoader=null,r.loader=null);const i=Dl(r.decryptdata)||s;delete this.keyIdToKeyInfo[i],n&&n.destroy()}}function Dl(e){if(e.keyFormat!==zr){const t=e.keyId;if(t)return se(t)}return e.uri}function xl(e){const{type:t}=e;switch(t){case M:return U;case F:return B;default:return $}}function Ol(e,t){let r=e.url;return void 0!==r&&0!==r.indexOf("data:")||(r=t.url),r}class Nl{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(x.MANIFEST_LOADING,this.onManifestLoading,this),e.on(x.LEVEL_LOADING,this.onLevelLoading,this),e.on(x.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(x.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(x.MANIFEST_LOADING,this.onManifestLoading,this),e.off(x.LEVEL_LOADING,this.onLevelLoading,this),e.off(x.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(x.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,s=t.loader,n=new(r||s)(t);return this.loaders[e.type]=n,n}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:O,url:r,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:r,level:s,pathwayId:n,url:i,deliveryDirectives:a,levelInfo:o}=t;this.load({id:r,level:s,pathwayId:n,responseType:"text",type:N,url:i,deliveryDirectives:a,levelOrTrack:o})}onAudioTrackLoading(e,t){const{id:r,groupId:s,url:n,deliveryDirectives:i,track:a}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:M,url:n,deliveryDirectives:i,levelOrTrack:a})}onSubtitleTrackLoading(e,t){const{id:r,groupId:s,url:n,deliveryDirectives:i,track:a}=t;this.load({id:r,groupId:s,level:null,responseType:"text",type:F,url:n,deliveryDirectives:i,levelOrTrack:a})}onLevelsUpdated(e,t){const r=this.loaders[N];if(r){const e=r.context;e&&!t.levels.some(t=>t===e.levelOrTrack)&&(r.abort(),delete this.loaders[N])}}load(e){var t;const r=this.hls.config;let s,n=this.getInternalLoader(e);if(n){const t=this.hls.logger,r=n.context;if(r&&r.levelOrTrack===e.levelOrTrack&&(r.url===e.url||r.deliveryDirectives&&!e.deliveryDirectives))return void(r.url===e.url?t.log(`[playlist-loader]: ignore ${e.url} ongoing request`):t.log(`[playlist-loader]: ignore ${e.url} in favor of ${r.url}`));t.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),n.abort()}if(s=e.type===O?r.manifestLoadPolicy.default:H({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),n=this.createInternalLoader(e),R(null==(t=e.deliveryDirectives)?void 0:t.part)){let t;if(e.type===N&&null!==e.level?t=this.hls.levels[e.level].details:e.type===M&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===F&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){const e=t.partTarget,r=t.targetduration;if(e&&r){const t=1e3*Math.max(3*e,.8*r);s=H({},s,{maxTimeToFirstByteMs:Math.min(t,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,s.maxTimeToFirstByteMs)})}}}const i=s.errorRetry||s.timeoutRetry||{},a={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:i.maxNumRetry||0,retryDelay:i.retryDelayMs||0,maxRetryDelay:i.maxRetryDelayMs||0},o={onSuccess:(e,t,r,s)=>{const n=this.getInternalLoader(r);this.resetInternalLoader(r.type);const i=e.data;t.parsing.start=performance.now(),us.isMediaPlaylist(i)||r.type!==O?this.handleTrackOrLevelPlaylist(e,t,r,s||null,n):this.handleMasterPlaylist(e,t,r,s)},onError:(e,t,r,s)=>{this.handleNetworkError(t,r,!1,e,s)},onTimeout:(e,t,r)=>{this.handleNetworkError(t,r,!0,void 0,e)}};n.load(e,a,o)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:r}=this.hls;(e||r)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,r,s){const n=this.hls,i=e.data,a=Ol(e,r),o=us.parseMasterPlaylist(i,a);if(o.playlistParsingError)return t.parsing.end=performance.now(),void this.handleManifestParsingError(e,r,o.playlistParsingError,s,t);const{contentSteering:l,levels:u,sessionData:c,sessionKeys:d,startTimeOffset:h,variableList:f}=o;this.variableList=f,u.forEach(e=>{const{unknownCodecs:t}=e;if(t){const{preferManagedMediaSource:r}=this.hls.config;let{audioCodec:s,videoCodec:n}=e;for(let i=t.length;i--;){const a=t[i];qe(a,"audio",r)?(e.audioCodec=s=s?`${s},${a}`:a,Ve.audio[s.substring(0,4)]=2,t.splice(i,1)):qe(a,"video",r)&&(e.videoCodec=n=n?`${n},${a}`:a,Ve.video[n.substring(0,4)]=2,t.splice(i,1))}}});const{AUDIO:g=[],SUBTITLES:p,"CLOSED-CAPTIONS":m}=us.parseMasterPlaylistMedia(i,a,o);if(g.length){g.some(e=>!e.url)||!u[0].audioCodec||u[0].attrs.AUDIO||(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Pr({}),bitrate:0,url:""}))}n.trigger(x.MANIFEST_LOADED,{levels:u,audioTracks:g,subtitles:p,captions:m,contentSteering:l,url:a,stats:t,networkDetails:s,sessionData:c,sessionKeys:d,startTimeOffset:h,variableList:f})}handleTrackOrLevelPlaylist(e,t,r,s,n){const i=this.hls,{id:a,level:o,type:l}=r,u=Ol(e,r),c=R(o)?o:R(a)?a:0,d=xl(r),h=us.parseLevelPlaylist(e.data,u,c,d,0,this.variableList);if(l===O){const e={attrs:new Pr({}),bitrate:0,details:h,name:"",url:u};h.requestScheduled=t.loading.start+Ls(h,0),i.trigger(x.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:u,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=h,this.handlePlaylistLoaded(h,e,t,r,s,n)}handleManifestParsingError(e,t,r,s,n){this.hls.trigger(x.ERROR,{type:C.NETWORK_ERROR,details:D.MANIFEST_PARSING_ERROR,fatal:t.type===O,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:s,stats:n})}handleNetworkError(e,t,r=!1,s,n){let i=`A network ${r?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===N?i+=`: ${e.level} id: ${e.id}`:e.type!==M&&e.type!==F||(i+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(i);this.hls.logger.warn(`[playlist-loader]: ${i}`);let o=D.UNKNOWN,l=!1;const u=this.getInternalLoader(e);switch(e.type){case O:o=r?D.MANIFEST_LOAD_TIMEOUT:D.MANIFEST_LOAD_ERROR,l=!0;break;case N:o=r?D.LEVEL_LOAD_TIMEOUT:D.LEVEL_LOAD_ERROR,l=!1;break;case M:o=r?D.AUDIO_TRACK_LOAD_TIMEOUT:D.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case F:o=r?D.SUBTITLE_TRACK_LOAD_TIMEOUT:D.SUBTITLE_LOAD_ERROR,l=!1}u&&this.resetInternalLoader(e.type);const c={type:C.NETWORK_ERROR,details:o,fatal:l,url:e.url,loader:u,context:e,error:a,networkDetails:t,stats:n};if(s){const r=(null==t?void 0:t.url)||e.url;c.response=z({url:r,data:void 0},s)}this.hls.trigger(x.ERROR,c)}handlePlaylistLoaded(e,t,r,s,n,i){const a=this.hls,{type:o,level:l,levelOrTrack:u,id:c,groupId:d,deliveryDirectives:h}=s,f=Ol(t,s),g=xl(s);let p="number"==typeof s.level&&g===$?l:void 0;const m=e.playlistParsingError;if(m){if(this.hls.logger.warn(`${m} ${e.url}`),!a.config.ignorePlaylistParsingErrors)return void a.trigger(x.ERROR,{type:C.NETWORK_ERROR,details:D.LEVEL_PARSING_ERROR,fatal:!1,url:f,error:m,reason:m.message,response:t,context:s,level:p,parent:g,networkDetails:n,stats:r});e.playlistParsingError=null}if(!e.fragments.length){const i=e.playlistParsingError=new Error("No Segments found in Playlist");return void a.trigger(x.ERROR,{type:C.NETWORK_ERROR,details:D.LEVEL_EMPTY_ERROR,fatal:!1,url:f,error:i,reason:i.message,response:t,context:s,level:p,parent:g,networkDetails:n,stats:r})}switch(e.live&&i&&(i.getCacheAge&&(e.ageHeader=i.getCacheAge()||0),i.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),o){case O:case N:if(p)if(u){if(u!==a.levels[p]){const e=a.levels.indexOf(u);e>-1&&(p=e)}}else p=0;a.trigger(x.LEVEL_LOADED,{details:e,levelInfo:u||a.levels[0],level:p||0,id:c||0,stats:r,networkDetails:n,deliveryDirectives:h,withoutMultiVariant:o===O});break;case M:a.trigger(x.AUDIO_TRACK_LOADED,{details:e,track:u,id:c||0,groupId:d||"",stats:r,networkDetails:n,deliveryDirectives:h});break;case F:a.trigger(x.SUBTITLE_TRACK_LOADED,{details:e,track:u,id:c||0,groupId:d||"",stats:r,networkDetails:n,deliveryDirectives:h})}}}class Ml{static get version(){return ln}static isMSESupported(){return Il()}static isSupported(){return function(){if(!Il())return!1;const e=ee();return"function"==typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(t=>e.isTypeSupported(Ye(t,"video")))||["mp4a.40.2","fLaC"].some(t=>e.isTypeSupported(Ye(t,"audio"))))}()}static getMediaSource(){return ee()}static get Events(){return x}static get MetadataSchema(){return Cn}static get ErrorTypes(){return C}static get ErrorDetails(){return D}static get DefaultConfig(){return Ml.defaultConfig?Ml.defaultConfig:gl}static set DefaultConfig(e){Ml.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new on,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=function(e,t,r){const s=Q();if("object"==typeof console&&!0===e||"object"==typeof e){const n=["debug","log","info","warn","error"];n.forEach(t=>{s[t]=X(t,e,r)});try{s.log(`Debug logs enabled for "${t}" in hls.js version 1.6.15`)}catch(e){return Q()}n.forEach(t=>{J[t]=X(t,e)})}else H(J,s);return s}(e.debug||!1,"Hls instance",e.assetPlayerId),r=this.config=function(e,t,r){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const s=pl(e),n=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(e=>{const i=`${"level"===e?"playlist":e}LoadPolicy`,a=void 0===t[i],o=[];n.forEach(r=>{const n=`${e}Loading${r}`,l=t[n];if(void 0!==l&&a){o.push(n);const e=s[i].default;switch(t[i]={default:e},r){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}}),o.length&&r.warn(`hls.js config: "${o.join('", "')}" setting(s) are deprecated, use "${i}": ${wt(t[i])}`)}),z(z({},s),t)}(Ml.DefaultConfig,e,t);this.userConfig=e,r.progressive&&ml(r,t);const{abrController:s,bufferController:n,capLevelController:i,errorController:a,fpsController:o}=r,l=new a(this),u=this.abrController=new s(this),c=new nr(this),d=r.interstitialsController,h=d?this.interstitialsController=new d(this,Ml):null,f=this.bufferController=new n(this,c),g=this.capLevelController=new i(this),p=new o(this),m=new Nl(this),y=r.contentSteeringController,v=y?new y(this):null,b=this.levelController=new Al(this,v),E=new kl(this),S=new Cl(this.config,this.logger),T=this.streamController=new Pl(this,c,S),w=this.gapController=new yl(this,c);g.setStreamController(T),p.setStreamController(T);const k=[m,b,T];h&&k.splice(1,0,h),v&&k.splice(1,0,v),this.networkControllers=k;const _=[u,f,w,g,p,E,c];this.audioTrackController=this.createController(r.audioTrackController,k);const A=r.audioStreamController;A&&k.push(this.audioStreamController=new A(this,c,S)),this.subtitleTrackController=this.createController(r.subtitleTrackController,k);const L=r.subtitleStreamController;L&&k.push(this.subtititleStreamController=new L(this,c,S)),this.createController(r.timelineController,_),S.emeController=this.emeController=this.createController(r.emeController,_),this.cmcdController=this.createController(r.cmcdController,_),this.latencyController=this.createController(_l,_),this.coreComponents=_,k.push(l);const R=l.onErrorOut;"function"==typeof R&&this.on(x.ERROR,R,l),this.on(x.MANIFEST_LOADED,m.onManifestLoaded,m)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,s){this._emitter.off(e,t,r,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),!this.triggeringException){this.triggeringException=!0;const r=e===x.ERROR;this.trigger(x.ERROR,{type:C.OTHER_ERROR,details:D.INTERNAL_EXCEPTION,fatal:r,event:e,error:t}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(x.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const t=new Error(`attachMedia failed: invalid argument (${e})`);return void this.trigger(x.ERROR,{type:C.OTHER_ERROR,details:D.ATTACH_MEDIA_ERROR,fatal:!0,error:t})}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,r=t?e.media:e,s=t?e:{media:r};this._media=r,this.trigger(x.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(x.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(x.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,r=this._url,s=this._url=le.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),t&&r&&(r!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(x.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(e,t),this.started&&this.networkControllers);r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!this.started&&this.networkControllers);e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[$]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[U]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[B]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=null==e?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=function(){try{return crypto.randomUUID()}catch(e){try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(e){let t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?r:3&r|8).toString(16)})}}}()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return-1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){(function(e){return ft.indexOf(e)>-1})(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let s=0;s<r;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let s;if(s=-1===t&&null!=e&&e.length?e.length-1:t,r)for(let t=s;t--;){const s=e[t].attrs["HDCP-LEVEL"];if(s&&s<=r)return t}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return(null==(t=this.audioTrackController)?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return(null==(t=this.subtitleTrackController)?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!(null==(e=this.bufferController)||!e.bufferedToEnd)}get interstitialsManager(){var e;return(null==(e=this.interstitialsController)?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){return ct(e,_t(t),navigator.mediaCapabilities)}}Ml.defaultConfig=void 0;var Fl=v();const $l="https://api.satvplus.com.ar",Ul="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVrc2dhcWdha3p3dnFjdGVra2dqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5NTAwMzIsImV4cCI6MjA4NjUyNjAzMn0.dnJMB_Orqu_ldP7ODcs-VpZduaGPUEbe2u-yYJXk9Fc",Bl=5e3,jl=45;function Gl(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r}function Kl(e,t,r,s){return new(r||(r=Promise))(function(n,i){function a(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,o)}l((s=s.apply(e,t||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;class Hl extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Vl extends Hl{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class zl extends Hl{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class ql extends Hl{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Wl;!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(Wl||(Wl={}));class Yl{constructor(e,{headers:t={},customFetch:r,region:s=Wl.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=(e=>e?(...t)=>e(...t):(...e)=>fetch(...e))(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return Kl(this,arguments,void 0,function*(e,t={}){var r;let s,n;try{const{headers:i,method:a,body:o,signal:l,timeout:u}=t;let c={},{region:d}=t;d||(d=this.region);const h=new URL(`${this.url}/${e}`);let f;d&&"any"!==d&&(c["x-region"]=d,h.searchParams.set("forceFunctionRegion",d)),o&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)?"undefined"!=typeof Blob&&o instanceof Blob||o instanceof ArrayBuffer?(c["Content-Type"]="application/octet-stream",f=o):"string"==typeof o?(c["Content-Type"]="text/plain",f=o):"undefined"!=typeof FormData&&o instanceof FormData?f=o:(c["Content-Type"]="application/json",f=JSON.stringify(o)):f=!o||"string"==typeof o||"undefined"!=typeof Blob&&o instanceof Blob||o instanceof ArrayBuffer||"undefined"!=typeof FormData&&o instanceof FormData?o:JSON.stringify(o);let g=l;u&&(n=new AbortController,s=setTimeout(()=>n.abort(),u),l?(g=n.signal,l.addEventListener("abort",()=>n.abort())):g=n.signal);const p=yield this.fetch(h.toString(),{method:a||"POST",headers:Object.assign(Object.assign(Object.assign({},c),this.headers),i),body:f,signal:g}).catch(e=>{throw new Vl(e)}),m=p.headers.get("x-relay-error");if(m&&"true"===m)throw new zl(p);if(!p.ok)throw new ql(p);let y,v=(null!==(r=p.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return y="application/json"===v?yield p.json():"application/octet-stream"===v||"application/pdf"===v?yield p.blob():"text/event-stream"===v?p:"multipart/form-data"===v?yield p.formData():yield p.text(),{data:y,error:null,response:p}}catch(e){return{data:null,error:e,response:e instanceof ql||e instanceof zl?e.context:void 0}}finally{s&&clearTimeout(s)}})}}var Ql=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}},Xl=class{constructor(e){var t,r,s;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(t=e.shouldThrowOnError)&&void 0!==t&&t,this.signal=e.signal,this.isMaybeSingle=null!==(r=e.isMaybeSingle)&&void 0!==r&&r,this.urlLengthLimit=null!==(s=e.urlLengthLimit)&&void 0!==s?s:8e3,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){var r=this;void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{let t=null,s=null,n=null,i=e.status,a=e.statusText;if(e.ok){var o,l;if("HEAD"!==r.method){var u;const t=await e.text();""===t||(s="text/csv"===r.headers.get("Accept")||r.headers.get("Accept")&&(null===(u=r.headers.get("Accept"))||void 0===u?void 0:u.includes("application/vnd.pgrst.plan+text"))?t:JSON.parse(t))}const c=null===(o=r.headers.get("Prefer"))||void 0===o?void 0:o.match(/count=(exact|planned|estimated)/),d=null===(l=e.headers.get("content-range"))||void 0===l?void 0:l.split("/");c&&d&&d.length>1&&(n=parseInt(d[1])),r.isMaybeSingle&&"GET"===r.method&&Array.isArray(s)&&(s.length>1?(t={code:"PGRST116",details:`Results contain ${s.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},s=null,n=null,i=406,a="Not Acceptable"):s=1===s.length?s[0]:null)}else{var c;const n=await e.text();try{t=JSON.parse(n),Array.isArray(t)&&404===e.status&&(s=[],t=null,i=200,a="OK")}catch(r){404===e.status&&""===n?(i=204,a="No Content"):t={message:n}}if(t&&r.isMaybeSingle&&(null==t||null===(c=t.details)||void 0===c?void 0:c.includes("0 rows"))&&(t=null,i=200,a="OK"),t&&r.shouldThrowOnError)throw new Ql(t)}return{error:t,data:s,count:n,status:i,statusText:a}});return this.shouldThrowOnError||(s=s.catch(e=>{var t;let r="",s="",n="";const i=null==e?void 0:e.cause;if(i){var a,o,l,u;const t=null!==(a=null==i?void 0:i.message)&&void 0!==a?a:"",s=null!==(o=null==i?void 0:i.code)&&void 0!==o?o:"";r=`${null!==(l=null==e?void 0:e.name)&&void 0!==l?l:"FetchError"}: ${null==e?void 0:e.message}`,r+=`\n\nCaused by: ${null!==(u=null==i?void 0:i.name)&&void 0!==u?u:"Error"}: ${t}`,s&&(r+=` (${s})`),(null==i?void 0:i.stack)&&(r+=`\n${i.stack}`)}else{var c;r=null!==(c=null==e?void 0:e.stack)&&void 0!==c?c:""}const d=this.url.toString().length;return"AbortError"===(null==e?void 0:e.name)||"ABORT_ERR"===(null==e?void 0:e.code)?(n="",s="Request was aborted (timeout or manual cancellation)",d>this.urlLengthLimit&&(s+=`. Note: Your request URL is ${d} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):"HeadersOverflowError"!==(null==i?void 0:i.name)&&"UND_ERR_HEADERS_OVERFLOW"!==(null==i?void 0:i.code)||(n="",s="HTTP headers exceeded server limits (typically 16KB)",d>this.urlLengthLimit&&(s+=`. Your request URL is ${d} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:r,hint:s,code:n},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}},Jl=class extends Xl{select(e){let t=!1;const r=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:n=s}={}){const i=n?`${n}.order`:"order",a=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${void 0===r?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const s=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){const n=void 0===s?"offset":`${s}.offset`,i=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(i,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:n=!1,format:i="text"}={}){var a;const o=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=null!==(a=this.headers.get("Accept"))&&void 0!==a?a:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${o};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};const Zl=new RegExp("[,()]");var eu=class extends Jl{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(e=>"string"==typeof e&&Zl.test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}notIn(e,t){const r=Array.from(new Set(t)).map(e=>"string"==typeof e&&Zl.test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`not.in.(${r})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let n="";"plain"===s?n="pl":"phrase"===s?n="ph":"websearch"===s&&(n="w");const i=void 0===r?"":`(${r})`;return this.url.searchParams.append(e,`${n}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}},tu=class{constructor(e,{headers:t={},schema:r,fetch:s,urlLengthLimit:n=8e3}){this.url=e,this.headers=new Headers(t),this.schema=r,this.fetch=s,this.urlLengthLimit=n}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(e,t){const{head:r=!1,count:s}=null!=t?t:{},n=r?"HEAD":"GET";let i=!1;const a=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!i?"":('"'===e&&(i=!i),e)).join(""),{url:o,headers:l}=this.cloneRequestState();return o.searchParams.set("select",a),s&&l.append("Prefer",`count=${s}`),new eu({method:n,url:o,headers:l,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(e,{count:t,defaultToNull:r=!0}={}){var s;const{url:n,headers:i}=this.cloneRequestState();if(t&&i.append("Prefer",`count=${t}`),r||i.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);n.searchParams.set("columns",e.join(","))}}return new eu({method:"POST",url:n,headers:i,schema:this.schema,body:e,fetch:null!==(s=this.fetch)&&void 0!==s?s:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:n=!0}={}){var i;const{url:a,headers:o}=this.cloneRequestState();if(o.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),void 0!==t&&a.searchParams.set("on_conflict",t),s&&o.append("Prefer",`count=${s}`),n||o.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);a.searchParams.set("columns",e.join(","))}}return new eu({method:"POST",url:a,headers:o,schema:this.schema,body:e,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch,urlLengthLimit:this.urlLengthLimit})}update(e,{count:t}={}){var r;const{url:s,headers:n}=this.cloneRequestState();return t&&n.append("Prefer",`count=${t}`),new eu({method:"PATCH",url:s,headers:n,schema:this.schema,body:e,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:e}={}){var t;const{url:r,headers:s}=this.cloneRequestState();return e&&s.append("Prefer",`count=${e}`),new eu({method:"DELETE",url:r,headers:s,schema:this.schema,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch,urlLengthLimit:this.urlLengthLimit})}};function ru(e){return(ru="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function su(e){var t=function(e,t){if("object"!=ru(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t);if("object"!=ru(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ru(t)?t:t+""}function nu(e,t,r){return(t=su(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function iu(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function au(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?iu(Object(r),!0).forEach(function(t){nu(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iu(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var ou=class e{constructor(e,{headers:t={},schema:r,fetch:s,timeout:n,urlLengthLimit:i=8e3}={}){this.url=e,this.headers=new Headers(t),this.schemaName=r,this.urlLengthLimit=i;const a=null!=s?s:globalThis.fetch;this.fetch=void 0!==n&&n>0?(e,t)=>{const r=new AbortController,s=setTimeout(()=>r.abort(),n),i=null==t?void 0:t.signal;if(i){if(i.aborted)return clearTimeout(s),a(e,t);const n=()=>{clearTimeout(s),r.abort()};return i.addEventListener("abort",n,{once:!0}),a(e,au(au({},t),{},{signal:r.signal})).finally(()=>{clearTimeout(s),i.removeEventListener("abort",n)})}return a(e,au(au({},t),{},{signal:r.signal})).finally(()=>clearTimeout(s))}:a}from(e){if(!e||"string"!=typeof e||""===e.trim())throw new Error("Invalid relation name: relation must be a non-empty string.");return new tu(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(e,t={},{head:r=!1,get:s=!1,count:n}={}){var i;let a;const o=new URL(`${this.url}/rpc/${e}`);let l;const u=e=>null!==e&&"object"==typeof e&&(!Array.isArray(e)||e.some(u)),c=r&&Object.values(t).some(u);c?(a="POST",l=t):r||s?(a=r?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{o.searchParams.append(e,t)})):(a="POST",l=t);const d=new Headers(this.headers);return c?d.set("Prefer",n?`count=${n},return=minimal`:"return=minimal"):n&&d.set("Prefer",`count=${n}`),new eu({method:a,url:o,headers:d,schema:this.schemaName,body:l,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch,urlLengthLimit:this.urlLengthLimit})}};class lu{constructor(){}static detectEnvironment(){var e;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof global&&void 0!==global.WebSocket)return{type:"native",constructor:global.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const t=globalThis.process;if(t){const e=t.versions;if(e&&e.node){const t=e.node,r=parseInt(t.replace(/^v/,"").split(".")[0]);return r>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`\n\nSuggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}}const uu="2.0.0",cu=uu,du=1e4;var hu,fu,gu,pu,mu,yu;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(hu||(hu={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(fu||(fu={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(gu||(gu={})),function(e){e.websocket="websocket"}(pu||(pu={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(mu||(mu={}));class vu{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=null!=e?e:[]}encode(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&"string"==typeof e.payload.event)return t(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(r))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer(null===(t=e.payload)||void 0===t?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,r;const s=null!==(r=null===(t=e.payload)||void 0===t?void 0:t.payload)&&void 0!==r?r:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,s)}_encodeJsonUserBroadcastPush(e){var t,r;const s=null!==(r=null===(t=e.payload)||void 0===t?void 0:t.payload)&&void 0!==r?r:{},n=(new TextEncoder).encode(JSON.stringify(s)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,n)}_encodeUserBroadcastPush(e,t,r){var s,n;const i=e.topic,a=null!==(s=e.ref)&&void 0!==s?s:"",o=null!==(n=e.join_ref)&&void 0!==n?n:"",l=e.payload.event,u=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},c=0===Object.keys(u).length?"":JSON.stringify(u);if(o.length>255)throw new Error(`joinRef length ${o.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(i.length>255)throw new Error(`topic length ${i.length} exceeds maximum of 255`);if(l.length>255)throw new Error(`userEvent length ${l.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`metadata length ${c.length} exceeds maximum of 255`);const d=this.USER_BROADCAST_PUSH_META_LENGTH+o.length+a.length+i.length+l.length+c.length,h=new ArrayBuffer(this.HEADER_LENGTH+d);let f=new DataView(h),g=0;f.setUint8(g++,this.KINDS.userBroadcastPush),f.setUint8(g++,o.length),f.setUint8(g++,a.length),f.setUint8(g++,i.length),f.setUint8(g++,l.length),f.setUint8(g++,c.length),f.setUint8(g++,t),Array.from(o,e=>f.setUint8(g++,e.charCodeAt(0))),Array.from(a,e=>f.setUint8(g++,e.charCodeAt(0))),Array.from(i,e=>f.setUint8(g++,e.charCodeAt(0))),Array.from(l,e=>f.setUint8(g++,e.charCodeAt(0))),Array.from(c,e=>f.setUint8(g++,e.charCodeAt(0)));var p=new Uint8Array(h.byteLength+r.byteLength);return p.set(new Uint8Array(h),0),p.set(new Uint8Array(r),h.byteLength),p.buffer}decode(e,t){if(this._isArrayBuffer(e)){return t(this._binaryDecode(e))}if("string"==typeof e){const r=JSON.parse(e),[s,n,i,a,o]=r;return t({join_ref:s,ref:n,topic:i,event:a,payload:o})}return t({})}_binaryDecode(e){const t=new DataView(e),r=t.getUint8(0),s=new TextDecoder;if(r===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,t,s)}_decodeUserBroadcast(e,t,r){const s=t.getUint8(1),n=t.getUint8(2),i=t.getUint8(3),a=t.getUint8(4);let o=this.HEADER_LENGTH+4;const l=r.decode(e.slice(o,o+s));o+=s;const u=r.decode(e.slice(o,o+n));o+=n;const c=r.decode(e.slice(o,o+i));o+=i;const d=e.slice(o,e.byteLength),h=a===this.JSON_ENCODING?JSON.parse(r.decode(d)):d,f={type:this.BROADCAST_EVENT,event:u,payload:h};return i>0&&(f.meta=JSON.parse(c)),{join_ref:null,ref:null,topic:l,event:this.BROADCAST_EVENT,payload:f}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||"ArrayBuffer"===(null===(t=null==e?void 0:e.constructor)||void 0===t?void 0:t.name)}_pick(e,t){return e&&"object"==typeof e?Object.fromEntries(Object.entries(e).filter(([e])=>t.includes(e))):{}}}class bu{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(yu||(yu={}));const Eu=(e,t,r={})=>{var s;const n=null!==(s=r.skipTypes)&&void 0!==s?s:[];return t?Object.keys(t).reduce((r,s)=>(r[s]=Su(s,e,t,n),r),{}):{}},Su=(e,t,r,s)=>{const n=t.find(t=>t.name===e),i=null==n?void 0:n.type,a=r[e];return i&&!s.includes(i)?Tu(i,a):wu(a)},Tu=(e,t)=>{if("_"===e.charAt(0)){const r=e.slice(1,e.length);return Lu(t,r)}switch(e){case yu.bool:return ku(t);case yu.float4:case yu.float8:case yu.int2:case yu.int4:case yu.int8:case yu.numeric:case yu.oid:return _u(t);case yu.json:case yu.jsonb:return Au(t);case yu.timestamp:return Ru(t);case yu.abstime:case yu.date:case yu.daterange:case yu.int4range:case yu.int8range:case yu.money:case yu.reltime:case yu.text:case yu.time:case yu.timestamptz:case yu.timetz:case yu.tsrange:case yu.tstzrange:default:return wu(t)}},wu=e=>e,ku=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},_u=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},Au=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e}return e},Lu=(e,t)=>{if("string"!=typeof e)return e;const r=e.length-1,s=e[r];if("{"===e[0]&&"}"===s){let s;const n=e.slice(1,r);try{s=JSON.parse("["+n+"]")}catch(e){s=n?n.split(","):[]}return s.map(e=>Tu(t,e))}return e},Ru=e=>"string"==typeof e?e.replace(" ","T"):e,Iu=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),""===t.pathname||"/"===t.pathname?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class Pu{constructor(e,t,r={},s=1e4){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Cu,Du,xu,Ou;!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(Cu||(Cu={}));class Nu{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Nu.syncState(this.state,e,t,r),this.pendingDiffs.forEach(e=>{this.state=Nu.syncDiff(this.state,e,t,r)}),this.pendingDiffs=[],s()}),this.channel._on(r.diff,{},e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=Nu.syncDiff(this.state,e,t,r),s())}),this.onJoin((e,t,r)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:r})}),this.onLeave((e,t,r)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:r})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const n=this.cloneDeep(e),i=this.transformState(t),a={},o={};return this.map(n,(e,t)=>{i[e]||(o[e]=t)}),this.map(i,(e,t)=>{const r=n[e];if(r){const s=t.map(e=>e.presence_ref),n=r.map(e=>e.presence_ref),i=t.filter(e=>n.indexOf(e.presence_ref)<0),l=r.filter(e=>s.indexOf(e.presence_ref)<0);i.length>0&&(a[e]=i),l.length>0&&(o[e]=l)}else a[e]=t}),this.syncDiff(n,{joins:a,leaves:o},r,s)}static syncDiff(e,t,r,s){const{joins:n,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(n,(t,s)=>{var n;const i=null!==(n=e[t])&&void 0!==n?n:[];if(e[t]=this.cloneDeep(s),i.length>0){const r=e[t].map(e=>e.presence_ref),s=i.filter(e=>r.indexOf(e.presence_ref)<0);e[t].unshift(...s)}r(t,i,s)}),this.map(i,(t,r)=>{let n=e[t];if(!n)return;const i=r.map(e=>e.presence_ref);n=n.filter(e=>i.indexOf(e.presence_ref)<0),e[t]=n,s(t,n,r),0===n.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return t[r]="metas"in s?s.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(Du||(Du={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(xu||(xu={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(Ou||(Ou={}));class Mu{constructor(e,t={config:{}},r){var s,n;if(this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=fu.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Pu(this,gu.join,this.params,this.timeout),this.rejoinTimer=new bu(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=fu.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=fu.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=fu.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=fu.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=fu.errored,this.rejoinTimer.scheduleTimeout())}),this._on(gu.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new Nu(this),this.broadcastEndpointURL=Iu(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null===(n=null===(s=this.params.config)||void 0===s?void 0:s.broadcast)||void 0===n?void 0:n.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var r,s,n;if(this.socket.isConnected()||this.socket.connect(),this.state==fu.closed){const{config:{broadcast:i,presence:a,private:o}}=this.params,l=null!==(s=null===(r=this.bindings.postgres_changes)||void 0===r?void 0:r.map(e=>e.filter))&&void 0!==s?s:[],u=!!this.bindings[xu.PRESENCE]&&this.bindings[xu.PRESENCE].length>0||!0===(null===(n=this.params.config.presence)||void 0===n?void 0:n.enabled),c={},d={broadcast:i,presence:Object.assign(Object.assign({},a),{enabled:u}),postgres_changes:l,private:o};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(Ou.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(Ou.CLOSED)),this.updateJoinPayload(Object.assign({config:d},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:t})=>{var r;if(this.socket._isManualToken()||this.socket.setAuth(),void 0!==t){const s=this.bindings.postgres_changes,n=null!==(r=null==s?void 0:s.length)&&void 0!==r?r:0,i=[];for(let r=0;r<n;r++){const n=s[r],{filter:{event:a,schema:o,table:l,filter:u}}=n,c=t&&t[r];if(!(c&&c.event===a&&Mu.isFilterValueEqual(c.schema,o)&&Mu.isFilterValueEqual(c.table,l)&&Mu.isFilterValueEqual(c.filter,u)))return this.unsubscribe(),this.state=fu.errored,void(null==e||e(Ou.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));i.push(Object.assign(Object.assign({},n),{id:c.id}))}return this.bindings.postgres_changes=i,void(e&&e(Ou.SUBSCRIBED))}null==e||e(Ou.SUBSCRIBED)}).receive("error",t=>{this.state=fu.errored,null==e||e(Ou.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(Ou.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===fu.joined&&e===xu.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,t,r)}async httpSend(e,t,r={}){var s;if(null==t)return Promise.reject("Payload is required for httpSend()");const n={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(n.Authorization=`Bearer ${this.socket.accessTokenValue}`);const i={method:"POST",headers:n,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,i,null!==(s=r.timeout)&&void 0!==s?s:this.timeout);if(202===a.status)return{success:!0};let o=a.statusText;try{const e=await a.json();o=e.error||e.message||o}catch(e){}return Promise.reject(new Error(o))}async send(e,t={}){var r,s;if(this._canPush()||"broadcast"!==e.type)return new Promise(r=>{var s,n,i;const a=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(i=null===(n=null===(s=this.params)||void 0===s?void 0:s.config)||void 0===n?void 0:n.broadcast)||void 0===i?void 0:i.ack)||r("ok"),a.receive("ok",()=>r("ok")),a.receive("error",()=>r("error")),a.receive("timeout",()=>r("timed out"))});{console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:n,payload:i}=e,a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:i,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,o,null!==(r=t.timeout)&&void 0!==r?r:this.timeout);return await(null===(s=e.body)||void 0===s?void 0:s.cancel()),e.ok?"ok":"error"}catch(e){return"AbortError"===e.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=fu.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(gu.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new Pu(this,gu.leave,{},e),r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{null==r||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=fu.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const s=new AbortController,n=setTimeout(()=>s.abort(),r),i=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(n),i}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Pu(this,e,t,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,n;const i=e.toLocaleLowerCase(),{close:a,error:o,leave:l,join:u}=gu;if(r&&[a,o,l,u].indexOf(i)>=0&&r!==this._joinRef())return;let c=this._onMessage(i,t,r);if(t&&!c)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?null===(s=this.bindings.postgres_changes)||void 0===s||s.filter(e=>{var t,r,s;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(s=null===(r=e.filter)||void 0===r?void 0:r.event)||void 0===s?void 0:s.toLocaleLowerCase())===i}).map(e=>e.callback(c,r)):null===(n=this.bindings[i])||void 0===n||n.filter(e=>{var r,s,n,a,o,l;if(["broadcast","presence","postgres_changes"].includes(i)){if("id"in e){const i=e.id,a=null===(r=e.filter)||void 0===r?void 0:r.event;return i&&(null===(s=t.ids)||void 0===s?void 0:s.includes(i))&&("*"===a||(null==a?void 0:a.toLocaleLowerCase())===(null===(n=t.data)||void 0===n?void 0:n.type.toLocaleLowerCase()))}{const r=null===(o=null===(a=null==e?void 0:e.filter)||void 0===a?void 0:a.event)||void 0===o?void 0:o.toLocaleLowerCase();return"*"===r||r===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===i}).map(e=>{if("object"==typeof c&&"ids"in c){const e=c.data,{schema:t,table:r,commit_timestamp:s,type:n,errors:i}=e,a={schema:t,table:r,commit_timestamp:s,eventType:n,new:{},old:{},errors:i};c=Object.assign(Object.assign({},a),this._getPayloadRecords(e))}e.callback(c,r)})}_isClosed(){return this.state===fu.closed}_isJoined(){return this.state===fu.joined}_isJoining(){return this.state===fu.joining}_isLeaving(){return this.state===fu.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),n={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(n):this.bindings[s]=[n],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(e=>{var s;return!((null===(s=e.type)||void 0===s?void 0:s.toLocaleLowerCase())===r&&Mu.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}static isFilterValueEqual(e,t){return(null!=e?e:void 0)===(null!=t?t:void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(gu.close,{},e)}_onError(e){this._on(gu.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=fu.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=Eu(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=Eu(e.columns,e.old_record)),t}}const Fu=()=>{},$u=25e3,Uu=10,Bu=100,ju=[1e3,2e3,5e3,1e4];class Gu{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=du,this.transport=null,this.heartbeatIntervalMs=$u,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Fu,this.ref=0,this.reconnectTimer=null,this.vsn=cu,this.logger=Fu,this.conn=null,this.sendBuffer=[],this.serializer=new vu,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),!(null===(r=null==t?void 0:t.params)||void 0===r?void 0:r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${pu.websocket}`,this.httpEndpoint=Iu(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=lu.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error(`${t}\n\nTo use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })`);throw new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},"function"==typeof this.conn.close&&(e?this.conn.close(e,null!=t?t:""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case hu.connecting:return mu.Connecting;case hu.open:return mu.Open;case hu.closing:return mu.Closing;default:return mu.Closed}}isConnected(){return this.connectionState()===mu.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e,t={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(e=>e.topic===r);if(s)return s;{const r=new Mu(`realtime:${e}`,t,this);return this.channels.push(r),r}}push(e){const{topic:t,event:r,payload:s,ref:n}=e,i=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${r} (${n})`,s),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(e){this.log("error","error in heartbeat callback",e)}return this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},Bu)}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(e){this.log("error","error in heartbeat callback",e)}this._setAuthSafely("heartbeat")}else try{this.heartbeatCallback("disconnected")}catch(e){this.log("error","error in heartbeat callback",e)}}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event&&e.ref&&e.ref===this.pendingHeartbeatRef){const t=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error",t)}catch(e){this.log("error","error in heartbeat callback",e)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:t,event:r,payload:s,ref:n}=e,i=n?`(${n})`:"",a=s.status||"";this.log("receive",`${a} ${t} ${r} ${i}`.trim(),s),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(r,s,n)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===hu.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===hu.open||this.conn.readyState===hu.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`);(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(e=>{this.log("error","error waiting for auth on connect",e),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this._terminateWorker()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e);try{this.heartbeatCallback("error")}catch(e){this.log("error","error in heartbeat callback",e)}}_triggerChanError(){this.channels.forEach(e=>e._trigger(gu.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const r=e.match(/\?/)?"&":"?";return`${e}${r}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e,t=!1){this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t,r=!1;if(e)t=e,r=!0;else if(this.accessToken)try{t=await this.accessToken()}catch(e){this.log("error","Error fetching access token from callback",e),t=this.accessTokenValue}else t=this.accessTokenValue;r?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{const r={access_token:t,version:"realtime-js/2.97.0"};t&&e.updateJoinPayload(r),e.joinedOnce&&e._isJoined()&&e._push(gu.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(t=>{this.log("error",`Error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(t){this.log("error",`error in ${e} callback`,t)}})}catch(t){this.log("error",`error triggering ${e} callbacks`,t)}}_setupReconnectionTimer(){this.reconnectTimer=new bu(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Uu)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,s,n,i,a,o,l,u,c,d,h;switch(this.transport=null!==(t=null==e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(r=null==e?void 0:e.timeout)&&void 0!==r?r:du,this.heartbeatIntervalMs=null!==(s=null==e?void 0:e.heartbeatIntervalMs)&&void 0!==s?s:$u,this.worker=null!==(n=null==e?void 0:e.worker)&&void 0!==n&&n,this.accessToken=null!==(i=null==e?void 0:e.accessToken)&&void 0!==i?i:null,this.heartbeatCallback=null!==(a=null==e?void 0:e.heartbeatCallback)&&void 0!==a?a:Fu,this.vsn=null!==(o=null==e?void 0:e.vsn)&&void 0!==o?o:cu,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(l=null==e?void 0:e.reconnectAfterMs)&&void 0!==l?l:e=>ju[e-1]||1e4,this.vsn){case"1.0.0":this.encode=null!==(u=null==e?void 0:e.encode)&&void 0!==u?u:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(c=null==e?void 0:e.decode)&&void 0!==c?c:(e,t)=>t(JSON.parse(e));break;case uu:this.encode=null!==(d=null==e?void 0:e.encode)&&void 0!==d?d:this.serializer.encode.bind(this.serializer),this.decode=null!==(h=null==e?void 0:e.decode)&&void 0!==h?h:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null==e?void 0:e.workerUrl}}}var Ku=class extends Error{constructor(e,t){super(e),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown="CommitStateUnknownException"===t.icebergType||[500,502,504].includes(t.status)&&!0===t.icebergType?.includes("CommitState")}isNotFound(){return 404===this.status}isConflict(){return 409===this.status}isAuthenticationTimeout(){return 419===this.status}};function Hu(e){const t=e.fetchImpl??globalThis.fetch;return{async request({method:r,path:s,query:n,body:i,headers:a}){const o=function(e,t,r){const s=new URL(t,e);if(r)for(const[e,t]of Object.entries(r))void 0!==t&&s.searchParams.set(e,t);return s.toString()}(e.baseUrl,s,n),l=await async function(e){return e&&"none"!==e.type?"bearer"===e.type?{Authorization:`Bearer ${e.token}`}:"header"===e.type?{[e.name]:e.value}:"custom"===e.type?await e.getHeaders():{}:{}}(e.auth),u=await t(o,{method:r,headers:{...i?{"Content-Type":"application/json"}:{},...l,...a},body:i?JSON.stringify(i):void 0}),c=await u.text(),d=(u.headers.get("content-type")||"").includes("application/json"),h=d&&c?JSON.parse(c):c;if(!u.ok){const e=d?h:void 0,t=e?.error;throw new Ku(t?.message??`Request failed with status ${u.status}`,{status:u.status,icebergType:t?.type,icebergCode:t?.code,details:e})}return{status:u.status,headers:u.headers,data:h}}}}function Vu(e){return e.join("")}var zu=class{constructor(e,t=""){this.client=e,this.prefix=t}async listNamespaces(e){const t=e?{parent:Vu(e.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(e=>({namespace:e}))}async createNamespace(e,t){const r={namespace:e.namespace,properties:t?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:r})).data}async dropNamespace(e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Vu(e.namespace)}`})}async loadNamespaceMetadata(e){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Vu(e.namespace)}`})).data.properties}}async namespaceExists(e){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Vu(e.namespace)}`}),!0}catch(e){if(e instanceof Ku&&404===e.status)return!1;throw e}}async createNamespaceIfNotExists(e,t){try{return await this.createNamespace(e,t)}catch(e){if(e instanceof Ku&&409===e.status)return;throw e}}};function qu(e){return e.join("")}var Wu=class{constructor(e,t="",r){this.client=e,this.prefix=t,this.accessDelegation=r}async listTables(e){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${qu(e.namespace)}/tables`})).data.identifiers}async createTable(e,t){const r={};this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation);return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${qu(e.namespace)}/tables`,body:t,headers:r})).data.metadata}async updateTable(e,t){const r=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${qu(e.namespace)}/tables/${e.name}`,body:t});return{"metadata-location":r.data["metadata-location"],metadata:r.data.metadata}}async dropTable(e,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${qu(e.namespace)}/tables/${e.name}`,query:{purgeRequested:String(t?.purge??!1)}})}async loadTable(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${qu(e.namespace)}/tables/${e.name}`,headers:t})).data.metadata}async tableExists(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${qu(e.namespace)}/tables/${e.name}`,headers:t}),!0}catch(e){if(e instanceof Ku&&404===e.status)return!1;throw e}}async createTableIfNotExists(e,t){try{return await this.createTable(e,t)}catch(r){if(r instanceof Ku&&409===r.status)return await this.loadTable({namespace:e.namespace,name:t.name});throw r}}},Yu=class{constructor(e){let t="v1";e.catalogName&&(t+=`/${e.catalogName}`);const r=e.baseUrl.endsWith("/")?e.baseUrl:`${e.baseUrl}/`;this.client=Hu({baseUrl:r,auth:e.auth,fetchImpl:e.fetch}),this.accessDelegation=e.accessDelegation?.join(","),this.namespaceOps=new zu(this.client,t),this.tableOps=new Wu(this.client,t,this.accessDelegation)}async listNamespaces(e){return this.namespaceOps.listNamespaces(e)}async createNamespace(e,t){return this.namespaceOps.createNamespace(e,t)}async dropNamespace(e){await this.namespaceOps.dropNamespace(e)}async loadNamespaceMetadata(e){return this.namespaceOps.loadNamespaceMetadata(e)}async listTables(e){return this.tableOps.listTables(e)}async createTable(e,t){return this.tableOps.createTable(e,t)}async updateTable(e,t){return this.tableOps.updateTable(e,t)}async dropTable(e,t){await this.tableOps.dropTable(e,t)}async loadTable(e){return this.tableOps.loadTable(e)}async namespaceExists(e){return this.namespaceOps.namespaceExists(e)}async tableExists(e){return this.tableOps.tableExists(e)}async createNamespaceIfNotExists(e,t){return this.namespaceOps.createNamespaceIfNotExists(e,t)}async createTableIfNotExists(e,t){return this.tableOps.createTableIfNotExists(e,t)}},Qu=class extends Error{constructor(e,t="storage",r,s){super(e),this.__isStorageError=!0,this.namespace=t,this.name="vectors"===t?"StorageVectorsError":"StorageError",this.status=r,this.statusCode=s}};function Xu(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}var Ju=class extends Qu{constructor(e,t,r,s="storage"){super(e,s,t,r),this.name="vectors"===s?"StorageVectorsApiError":"StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Zu=class extends Qu{constructor(e,t,r="storage"){super(e,r),this.name="vectors"===r?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=t}};const ec=e=>{if(Array.isArray(e))return e.map(e=>ec(e));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([e,r])=>{const s=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[s]=ec(r)}),t};function tc(e){return(tc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rc(e){var t=function(e,t){if("object"!=tc(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t);if("object"!=tc(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==tc(t)?t:t+""}function sc(e,t,r){return(t=rc(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nc(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function ic(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?nc(Object(r),!0).forEach(function(t){sc(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nc(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}const ac=e=>{var t;return e.msg||e.message||e.error_description||("string"==typeof e.error?e.error:null===(t=e.error)||void 0===t?void 0:t.message)||JSON.stringify(e)},oc=(e,t,r,s)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&"HEAD"!==e&&s?((e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)})(s)?(n.headers=ic({"Content-Type":"application/json"},null==t?void 0:t.headers),n.body=JSON.stringify(s)):n.body=s,(null==t?void 0:t.duplex)&&(n.duplex=t.duplex),ic(ic({},n),r)):ic(ic({},n),r)};async function lc(e,t,r,s,n,i,a){return new Promise((o,l)=>{e(r,oc(t,s,n,i)).then(e=>{if(!e.ok)throw e;if(null==s?void 0:s.noResolveJson)return e;if("vectors"===a){const t=e.headers.get("content-type");if("0"===e.headers.get("content-length")||204===e.status)return{};if(!t||!t.includes("application/json"))return{}}return e.json()}).then(e=>o(e)).catch(e=>(async(e,t,r,s)=>{if(e&&"object"==typeof e&&"status"in e&&"ok"in e&&"number"==typeof e.status&&!(null==r?void 0:r.noResolveJson)){const r=e,n=r.status||500;if("function"==typeof r.json)r.json().then(e=>{const r=(null==e?void 0:e.statusCode)||(null==e?void 0:e.code)||n+"";t(new Ju(ac(e),n,r,s))}).catch(()=>{if("vectors"===s){const e=n+"";t(new Ju(r.statusText||`HTTP ${n} error`,n,e,s))}else{const e=n+"";t(new Ju(r.statusText||`HTTP ${n} error`,n,e,s))}});else{const e=n+"";t(new Ju(r.statusText||`HTTP ${n} error`,n,e,s))}}else t(new Zu(ac(e),e,s))})(e,l,s,a))})}function uc(e="storage"){return{get:async(t,r,s,n)=>lc(t,"GET",r,s,n,void 0,e),post:async(t,r,s,n,i)=>lc(t,"POST",r,n,i,s,e),put:async(t,r,s,n,i)=>lc(t,"PUT",r,n,i,s,e),head:async(t,r,s,n)=>lc(t,"HEAD",r,ic(ic({},s),{},{noResolveJson:!0}),n,void 0,e),remove:async(t,r,s,n,i)=>lc(t,"DELETE",r,n,i,s,e)}}const cc=uc("storage"),{get:dc,post:hc,put:fc,head:gc,remove:pc}=cc,mc=uc("vectors");var yc=class{constructor(e,t={},r,s="storage"){var n;this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.fetch=(n=r)?(...e)=>n(...e):(...e)=>fetch(...e),this.namespace=s}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=ic(ic({},this.headers),{},{[e]:t}),this}async handleOperation(e){try{return{data:await e(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Xu(e))return{data:null,error:e};throw e}}},vc=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}async execute(){try{return{data:(await this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Xu(e))return{data:null,error:e};throw e}}};let bc;bc=Symbol.toStringTag;var Ec=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[bc]="BlobDownloadBuilder",this.promise=null}asStream(){return new vc(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){try{return{data:await(await this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Xu(e))return{data:null,error:e};throw e}}};const Sc={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Tc={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var wc=class extends yc{constructor(e,t={},r,s){super(e,t,s,"storage"),this.bucketId=r}async uploadOrUpdate(e,t,r,s){var n=this;return n.handleOperation(async()=>{let i;const a=ic(ic({},Tc),s);let o=ic(ic({},n.headers),"POST"===e&&{"x-upsert":String(a.upsert)});const l=a.metadata;"undefined"!=typeof Blob&&r instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),l&&i.append("metadata",n.encodeMetadata(l)),i.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(i=r,i.has("cacheControl")||i.append("cacheControl",a.cacheControl),l&&!i.has("metadata")&&i.append("metadata",n.encodeMetadata(l))):(i=r,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,l&&(o["x-metadata"]=n.toBase64(n.encodeMetadata(l))),("undefined"!=typeof ReadableStream&&i instanceof ReadableStream||i&&"object"==typeof i&&"pipe"in i&&"function"==typeof i.pipe)&&!a.duplex&&(a.duplex="half")),(null==s?void 0:s.headers)&&(o=ic(ic({},o),s.headers));const u=n._removeEmptyFolders(t),c=n._getFinalPath(u),d=await("PUT"==e?fc:hc)(n.fetch,`${n.url}/object/${c}`,i,ic({headers:o},(null==a?void 0:a.duplex)?{duplex:a.duplex}:{}));return{path:u,id:d.Id,fullPath:d.Key}})}async upload(e,t,r){return this.uploadOrUpdate("POST",e,t,r)}async uploadToSignedUrl(e,t,r,s){var n=this;const i=n._removeEmptyFolders(e),a=n._getFinalPath(i),o=new URL(n.url+`/object/upload/sign/${a}`);return o.searchParams.set("token",t),n.handleOperation(async()=>{let e;const t=ic({upsert:Tc.upsert},s),a=ic(ic({},n.headers),{"x-upsert":String(t.upsert)});return"undefined"!=typeof Blob&&r instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(e=r,e.append("cacheControl",t.cacheControl)):(e=r,a["cache-control"]=`max-age=${t.cacheControl}`,a["content-type"]=t.contentType),{path:i,fullPath:(await fc(n.fetch,o.toString(),e,{headers:a})).Key}})}async createSignedUploadUrl(e,t){var r=this;return r.handleOperation(async()=>{let s=r._getFinalPath(e);const n=ic({},r.headers);(null==t?void 0:t.upsert)&&(n["x-upsert"]="true");const i=await hc(r.fetch,`${r.url}/object/upload/sign/${s}`,{},{headers:n}),a=new URL(r.url+i.url),o=a.searchParams.get("token");if(!o)throw new Qu("No token returned by API");return{signedUrl:a.toString(),path:e,token:o}})}async update(e,t,r){return this.uploadOrUpdate("PUT",e,t,r)}async move(e,t,r){var s=this;return s.handleOperation(async()=>await hc(s.fetch,`${s.url}/object/move`,{bucketId:s.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:s.headers}))}async copy(e,t,r){var s=this;return s.handleOperation(async()=>({path:(await hc(s.fetch,`${s.url}/object/copy`,{bucketId:s.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:s.headers})).Key}))}async createSignedUrl(e,t,r){var s=this;return s.handleOperation(async()=>{let n=s._getFinalPath(e),i=await hc(s.fetch,`${s.url}/object/sign/${n}`,ic({expiresIn:t},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:s.headers});const a=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{signedUrl:encodeURI(`${s.url}${i.signedURL}${a}`)}})}async createSignedUrls(e,t,r){var s=this;return s.handleOperation(async()=>{const n=await hc(s.fetch,`${s.url}/object/sign/${s.bucketId}`,{expiresIn:t,paths:e},{headers:s.headers}),i=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return n.map(e=>ic(ic({},e),{},{signedUrl:e.signedURL?encodeURI(`${s.url}${e.signedURL}${i}`):null}))})}download(e,t,r){const s=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",n=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),i=n?`?${n}`:"",a=this._getFinalPath(e);return new Ec(()=>dc(this.fetch,`${this.url}/${s}/${a}${i}`,{headers:this.headers,noResolveJson:!0},r),this.shouldThrowOnError)}async info(e){var t=this;const r=t._getFinalPath(e);return t.handleOperation(async()=>ec(await dc(t.fetch,`${t.url}/object/info/${r}`,{headers:t.headers})))}async exists(e){var t=this;const r=t._getFinalPath(e);try{return await gc(t.fetch,`${t.url}/object/${r}`,{headers:t.headers}),{data:!0,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Xu(e)&&e instanceof Zu){const t=e.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:e}}throw e}}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],n=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==n&&s.push(n);const i=void 0!==(null==t?void 0:t.transform)?"render/image":"object",a=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==a&&s.push(a);let o=s.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${r}${o}`)}}}async remove(e){var t=this;return t.handleOperation(async()=>await pc(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:e},{headers:t.headers}))}async list(e,t,r){var s=this;return s.handleOperation(async()=>{const n=ic(ic(ic({},Sc),t),{},{prefix:e||""});return await hc(s.fetch,`${s.url}/object/list/${s.bucketId}`,n,{headers:s.headers},r)})}async listV2(e,t){var r=this;return r.handleOperation(async()=>{const s=ic({},e);return await hc(r.fetch,`${r.url}/object/list-v2/${r.bucketId}`,s,{headers:r.headers},t)})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};const kc={"X-Client-Info":"storage-js/2.97.0"};var _c=class extends yc{constructor(e,t={},r,s){const n=new URL(e);(null==s?void 0:s.useNewHostname)&&/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase."));super(n.href.replace(/\/$/,""),ic(ic({},kc),t),r,"storage")}async listBuckets(e){var t=this;return t.handleOperation(async()=>{const r=t.listBucketOptionsToQueryString(e);return await dc(t.fetch,`${t.url}/bucket${r}`,{headers:t.headers})})}async getBucket(e){var t=this;return t.handleOperation(async()=>await dc(t.fetch,`${t.url}/bucket/${e}`,{headers:t.headers}))}async createBucket(e,t={public:!1}){var r=this;return r.handleOperation(async()=>await hc(r.fetch,`${r.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:r.headers}))}async updateBucket(e,t){var r=this;return r.handleOperation(async()=>await fc(r.fetch,`${r.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:r.headers}))}async emptyBucket(e){var t=this;return t.handleOperation(async()=>await hc(t.fetch,`${t.url}/bucket/${e}/empty`,{},{headers:t.headers}))}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await pc(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}))}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},Ac=class extends yc{constructor(e,t={},r){super(e.replace(/\/$/,""),ic(ic({},kc),t),r,"storage")}async createBucket(e){var t=this;return t.handleOperation(async()=>await hc(t.fetch,`${t.url}/bucket`,{name:e},{headers:t.headers}))}async listBuckets(e){var t=this;return t.handleOperation(async()=>{const r=new URLSearchParams;void 0!==(null==e?void 0:e.limit)&&r.set("limit",e.limit.toString()),void 0!==(null==e?void 0:e.offset)&&r.set("offset",e.offset.toString()),(null==e?void 0:e.sortColumn)&&r.set("sortColumn",e.sortColumn),(null==e?void 0:e.sortOrder)&&r.set("sortOrder",e.sortOrder),(null==e?void 0:e.search)&&r.set("search",e.search);const s=r.toString(),n=s?`${t.url}/bucket?${s}`:`${t.url}/bucket`;return await dc(t.fetch,n,{headers:t.headers})})}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await pc(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}))}from(e){var t=this;if(!(e=>!(!e||"string"!=typeof e)&&!(0===e.length||e.length>100)&&e.trim()===e&&!e.includes("/")&&!e.includes("\\")&&/^[\w!.\*'() &$@=;:+,?-]+$/.test(e))(e))throw new Qu("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const r=new Yu({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),s=this.shouldThrowOnError;return new Proxy(r,{get(e,t){const r=e[t];return"function"!=typeof r?r:async(...t)=>{try{return{data:await r.apply(e,t),error:null}}catch(e){if(s)throw e;return{data:null,error:e}}}}})}},Lc=class extends yc{constructor(e,t={},r){super(e.replace(/\/$/,""),ic(ic({},kc),{},{"Content-Type":"application/json"},t),r,"vectors")}async createIndex(e){var t=this;return t.handleOperation(async()=>await mc.post(t.fetch,`${t.url}/CreateIndex`,e,{headers:t.headers})||{})}async getIndex(e,t){var r=this;return r.handleOperation(async()=>await mc.post(r.fetch,`${r.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:r.headers}))}async listIndexes(e){var t=this;return t.handleOperation(async()=>await mc.post(t.fetch,`${t.url}/ListIndexes`,e,{headers:t.headers}))}async deleteIndex(e,t){var r=this;return r.handleOperation(async()=>await mc.post(r.fetch,`${r.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:r.headers})||{})}},Rc=class extends yc{constructor(e,t={},r){super(e.replace(/\/$/,""),ic(ic({},kc),{},{"Content-Type":"application/json"},t),r,"vectors")}async putVectors(e){var t=this;if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return t.handleOperation(async()=>await mc.post(t.fetch,`${t.url}/PutVectors`,e,{headers:t.headers})||{})}async getVectors(e){var t=this;return t.handleOperation(async()=>await mc.post(t.fetch,`${t.url}/GetVectors`,e,{headers:t.headers}))}async listVectors(e){var t=this;if(void 0!==e.segmentCount){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(void 0!==e.segmentIndex&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error("segmentIndex must be between 0 and "+(e.segmentCount-1))}return t.handleOperation(async()=>await mc.post(t.fetch,`${t.url}/ListVectors`,e,{headers:t.headers}))}async queryVectors(e){var t=this;return t.handleOperation(async()=>await mc.post(t.fetch,`${t.url}/QueryVectors`,e,{headers:t.headers}))}async deleteVectors(e){var t=this;if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return t.handleOperation(async()=>await mc.post(t.fetch,`${t.url}/DeleteVectors`,e,{headers:t.headers})||{})}},Ic=class extends yc{constructor(e,t={},r){super(e.replace(/\/$/,""),ic(ic({},kc),{},{"Content-Type":"application/json"},t),r,"vectors")}async createBucket(e){var t=this;return t.handleOperation(async()=>await mc.post(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{})}async getBucket(e){var t=this;return t.handleOperation(async()=>await mc.post(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:e},{headers:t.headers}))}async listBuckets(e={}){var t=this;return t.handleOperation(async()=>await mc.post(t.fetch,`${t.url}/ListVectorBuckets`,e,{headers:t.headers}))}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await mc.post(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{})}},Pc=class extends Ic{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new Cc(this.url,this.headers,e,this.fetch)}async createBucket(e){return(()=>super.createBucket)().call(this,e)}async getBucket(e){return(()=>super.getBucket)().call(this,e)}async listBuckets(e={}){return(()=>super.listBuckets)().call(this,e)}async deleteBucket(e){return(()=>super.deleteBucket)().call(this,e)}},Cc=class extends Lc{constructor(e,t,r,s){super(e,t,s),this.vectorBucketName=r}async createIndex(e){return(()=>super.createIndex)().call(this,ic(ic({},e),{},{vectorBucketName:this.vectorBucketName}))}async listIndexes(e={}){return(()=>super.listIndexes)().call(this,ic(ic({},e),{},{vectorBucketName:this.vectorBucketName}))}async getIndex(e){return(()=>super.getIndex)().call(this,this.vectorBucketName,e)}async deleteIndex(e){return(()=>super.deleteIndex)().call(this,this.vectorBucketName,e)}index(e){return new Dc(this.url,this.headers,this.vectorBucketName,e,this.fetch)}},Dc=class extends Rc{constructor(e,t,r,s,n){super(e,t,n),this.vectorBucketName=r,this.indexName=s}async putVectors(e){var t=this;return(()=>super.putVectors)().call(t,ic(ic({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async getVectors(e){var t=this;return(()=>super.getVectors)().call(t,ic(ic({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async listVectors(e={}){var t=this;return(()=>super.listVectors)().call(t,ic(ic({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async queryVectors(e){var t=this;return(()=>super.queryVectors)().call(t,ic(ic({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async deleteVectors(e){var t=this;return(()=>super.deleteVectors)().call(t,ic(ic({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}},xc=class extends _c{constructor(e,t={},r,s){super(e,t,r,s)}from(e){return new wc(this.url,this.headers,e,this.fetch)}get vectors(){return new Pc(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Ac(this.url+"/iceberg",this.headers,this.fetch)}};const Oc="2.97.0",Nc=3e4,Mc=9e4,Fc={"X-Client-Info":`gotrue-js/${Oc}`},$c="X-Supabase-Api-Version",Uc={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},Bc=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class jc extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function Gc(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class Kc extends jc{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}class Hc extends jc{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Vc extends jc{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class zc extends Vc{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function qc(e){return Gc(e)&&"AuthSessionMissingError"===e.name}class Wc extends Vc{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Yc extends Vc{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Qc extends Vc{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Xc extends Vc{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Jc extends Vc{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Zc extends Vc{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function ed(e){return Gc(e)&&"AuthRetryableFetchError"===e.name}class td extends Vc{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class rd extends Vc{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const sd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),nd=" \t\n\r=".split(""),id=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<nd.length;t+=1)e[nd[t].charCodeAt(0)]=-2;for(let t=0;t<sd.length;t+=1)e[sd[t].charCodeAt(0)]=t;return e})();function ad(e,t,r){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;r(sd[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;r(sd[e]),t.queuedBits-=6}}function od(e,t,r){const s=id[e];if(!(s>-1)){if(-2===s)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|s,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function ld(e){const t=[],r=e=>{t.push(String.fromCodePoint(e))},s={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=e=>{!function(e,t,r){if(0===t.utf8seq){if(e<=127)return void r(e);for(let r=1;r<6;r+=1)if(!(e>>7-r&1)){t.utf8seq=r;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&r(t.codepoint)}}(e,s,r)};for(let t=0;t<e.length;t+=1)od(e.charCodeAt(t),n,i);return t.join("")}function ud(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function cd(e){const t=[],r={queue:0,queuedBits:0},s=e=>{t.push(e)};for(let t=0;t<e.length;t+=1)od(e.charCodeAt(t),r,s);return new Uint8Array(t)}function dd(e){const t=[];return function(e,t){for(let r=0;r<e.length;r+=1){let s=e.charCodeAt(r);if(s>55295&&s<=56319){const t=1024*(s-55296)&65535;s=65536+(e.charCodeAt(r+1)-56320&65535|t),r+=1}ud(s,t)}}(e,e=>t.push(e)),new Uint8Array(t)}function hd(e){const t=[],r={queue:0,queuedBits:0},s=e=>{t.push(e)};return e.forEach(e=>ad(e,r,s)),ad(null,r,s),t.join("")}const fd=()=>"undefined"!=typeof window&&"undefined"!=typeof document,gd={tested:!1,writable:!1},pd=()=>{if(!fd())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(gd.tested)return gd.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),gd.tested=!0,gd.writable=!0}catch(e){gd.tested=!0,gd.writable=!1}return gd.writable};const md=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),yd=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},vd=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch(e){return r}},bd=async(e,t)=>{await e.removeItem(t)};class Ed{constructor(){this.promise=new Ed.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function Sd(e){const t=e.split(".");if(3!==t.length)throw new rd("Invalid JWT structure");for(let e=0;e<t.length;e++)if(!Bc.test(t[e]))throw new rd("JWT not in base64url format");return{header:JSON.parse(ld(t[0])),payload:JSON.parse(ld(t[1])),signature:cd(t[2]),raw:{header:t[0],payload:t[1]}}}function Td(e){return("0"+e.toString(16)).substr(-2)}async function wd(e){if(!("undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function kd(e,t,r=!1){const s=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let r="";for(let s=0;s<56;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}return crypto.getRandomValues(e),Array.from(e,Td).join("")}();let n=s;r&&(n+="/PASSWORD_RECOVERY"),await yd(e,`${t}-code-verifier`,n);const i=await wd(s);return[i,s===i?"plain":"s256"]}Ed.promiseConstructor=Promise;const _d=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const Ad=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ld(e){if(!Ad.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Rd(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"==typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Id(e){return JSON.parse(JSON.stringify(e))}const Pd=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Cd=[502,503,504];async function Dd(e){var t,r;if(!("object"==typeof(r=e)&&null!==r&&"status"in r&&"ok"in r&&"json"in r&&"function"==typeof r.json))throw new Zc(Pd(e),0);if(Cd.includes(e.status))throw new Zc(Pd(e),e.status);let s,n;try{s=await e.json()}catch(e){throw new Hc(Pd(e),e)}const i=function(e){const t=e.headers.get($c);if(!t)return null;if(!t.match(_d))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(e){return null}}(e);if(i&&i.getTime()>=Uc.timestamp&&"object"==typeof s&&s&&"string"==typeof s.code?n=s.code:"object"==typeof s&&s&&"string"==typeof s.error_code&&(n=s.error_code),n){if("weak_password"===n)throw new td(Pd(s),e.status,(null===(t=s.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===n)throw new zc}else if("object"==typeof s&&s&&"object"==typeof s.weak_password&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new td(Pd(s),e.status,s.weak_password.reasons);throw new Kc(Pd(s),e.status||500,n)}async function xd(e,t,r,s){var n;const i=Object.assign({},null==s?void 0:s.headers);i[$c]||(i[$c]=Uc.name),(null==s?void 0:s.jwt)&&(i.Authorization=`Bearer ${s.jwt}`);const a=null!==(n=null==s?void 0:s.query)&&void 0!==n?n:{};(null==s?void 0:s.redirectTo)&&(a.redirect_to=s.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await async function(e,t,r,s,n,i){const a=((e,t,r,s)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),r))})(t,s,n,i);let o;try{o=await e(r,Object.assign({},a))}catch(e){throw console.error(e),new Zc(Pd(e),0)}o.ok||await Dd(o);if(null==s?void 0:s.noResolveJson)return o;try{return await o.json()}catch(e){await Dd(e)}}(e,t,r+o,{headers:i,noResolveJson:null==s?void 0:s.noResolveJson},{},null==s?void 0:s.body);return(null==s?void 0:s.xform)?null==s?void 0:s.xform(l):{data:Object.assign({},l),error:null}}function Od(e){var t;let r=null;var s;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=(s=e.expires_in,Math.round(Date.now()/1e3)+s)));return{data:{session:r,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Nd(e){const t=Od(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function Md(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Fd(e){return{data:e,error:null}}function $d(e){const{action_link:t,email_otp:r,hashed_token:s,redirect_to:n,verification_type:i}=e,a=Gl(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:r,hashed_token:s,redirect_to:n,verification_type:i},user:Object.assign({},a)},error:null}}function Ud(e){return e}const Bd=["global","local","others"];class jd{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=md(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=Bd[0]){if(Bd.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Bd.join(", ")}`);try{return await xd(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(e){if(Gc(e))return{data:null,error:e};throw e}}async inviteUserByEmail(e,t={}){try{return await xd(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Md})}catch(e){if(Gc(e))return{data:{user:null},error:e};throw e}}async generateLink(e){try{const{options:t}=e,r=Gl(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=null==r?void 0:r.newEmail,delete s.newEmail),await xd(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:$d,redirectTo:null==t?void 0:t.redirectTo})}catch(e){if(Gc(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(e){try{return await xd(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Md})}catch(e){if(Gc(e))return{data:{user:null},error:e};throw e}}async listUsers(e){var t,r,s,n,i,a,o;try{const l={nextPage:null,lastPage:0,total:0},u=await xd(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(n=null===(s=null==e?void 0:e.perPage)||void 0===s?void 0:s.toString())&&void 0!==n?n:""},xform:Ud});if(u.error)throw u.error;const c=await u.json(),d=null!==(i=u.headers.get("x-total-count"))&&void 0!==i?i:0,h=null!==(o=null===(a=u.headers.get("link"))||void 0===a?void 0:a.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);l[`${r}Page`]=t}),l.total=parseInt(d)),{data:Object.assign(Object.assign({},c),l),error:null}}catch(e){if(Gc(e))return{data:{users:[]},error:e};throw e}}async getUserById(e){Ld(e);try{return await xd(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Md})}catch(e){if(Gc(e))return{data:{user:null},error:e};throw e}}async updateUserById(e,t){Ld(e);try{return await xd(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Md})}catch(e){if(Gc(e))return{data:{user:null},error:e};throw e}}async deleteUser(e,t=!1){Ld(e);try{return await xd(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Md})}catch(e){if(Gc(e))return{data:{user:null},error:e};throw e}}async _listFactors(e){Ld(e.userId);try{const{data:t,error:r}=await xd(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:r}}catch(e){if(Gc(e))return{data:null,error:e};throw e}}async _deleteFactor(e){Ld(e.userId),Ld(e.id);try{return{data:await xd(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(e){if(Gc(e))return{data:null,error:e};throw e}}async _listOAuthClients(e){var t,r,s,n,i,a,o;try{const l={nextPage:null,lastPage:0,total:0},u=await xd(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(n=null===(s=null==e?void 0:e.perPage)||void 0===s?void 0:s.toString())&&void 0!==n?n:""},xform:Ud});if(u.error)throw u.error;const c=await u.json(),d=null!==(i=u.headers.get("x-total-count"))&&void 0!==i?i:0,h=null!==(o=null===(a=u.headers.get("link"))||void 0===a?void 0:a.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);l[`${r}Page`]=t}),l.total=parseInt(d)),{data:Object.assign(Object.assign({},c),l),error:null}}catch(e){if(Gc(e))return{data:{clients:[]},error:e};throw e}}async _createOAuthClient(e){try{return await xd(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(Gc(e))return{data:null,error:e};throw e}}async _getOAuthClient(e){try{return await xd(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(Gc(e))return{data:null,error:e};throw e}}async _updateOAuthClient(e,t){try{return await xd(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(Gc(e))return{data:null,error:e};throw e}}async _deleteOAuthClient(e){try{return await xd(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(e){if(Gc(e))return{data:null,error:e};throw e}}async _regenerateOAuthClientSecret(e){try{return await xd(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(Gc(e))return{data:null,error:e};throw e}}}function Gd(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const Kd=!!(globalThis&&pd()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class Hd extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Vd extends Hd{}async function zd(e,t,r){Kd&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const s=new globalThis.AbortController;t>0&&setTimeout(()=>{s.abort(),Kd&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve();try{return await globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async s=>{if(!s){if(0===t)throw Kd&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Vd(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Kd)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(e){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",e)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}Kd&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,s.name);try{return await r()}finally{Kd&&console.log("@supabase/gotrue-js: navigatorLock: released",e,s.name)}})}catch(r){if("AbortError"===(null==r?void 0:r.name))throw new Vd(`Acquiring an exclusive Navigator LockManager lock "${e}" timed out waiting ${t}ms`);throw r}}function qd(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function Wd(e){const t=(new TextEncoder).encode(e);return"0x"+Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}class Yd extends Error{constructor({message:e,code:t,cause:r,name:s}){var n;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=null!==(n=null!=s?s:r instanceof Error?r.name:void 0)&&void 0!==n?n:"Unknown Error",this.code=t}}class Qd extends Yd{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function Xd({error:e,options:t}){var r,s,n;const{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new Yd({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("ConstraintError"===e.name){if(!0===(null===(r=i.authenticatorSelection)||void 0===r?void 0:r.requireResidentKey))return new Yd({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if("conditional"===t.mediation&&"required"===(null===(s=i.authenticatorSelection)||void 0===s?void 0:s.userVerification))return new Yd({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if("required"===(null===(n=i.authenticatorSelection)||void 0===n?void 0:n.userVerification))return new Yd({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if("InvalidStateError"===e.name)return new Yd({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if("NotAllowedError"===e.name)return new Yd({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if("NotSupportedError"===e.name){return 0===i.pubKeyCredParams.filter(e=>"public-key"===e.type).length?new Yd({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new Yd({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e})}if("SecurityError"===e.name){const t=window.location.hostname;if(!nh(t))return new Yd({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(i.rp.id!==t)return new Yd({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("TypeError"===e.name){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new Yd({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if("UnknownError"===e.name)return new Yd({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Yd({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function Jd({error:e,options:t}){const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new Yd({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if("NotAllowedError"===e.name)return new Yd({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if("SecurityError"===e.name){const t=window.location.hostname;if(!nh(t))return new Yd({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(r.rpId!==t)return new Yd({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("UnknownError"===e.name)return new Yd({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Yd({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}const Zd=new class{createNewAbortSignal(){if(this.controller){const e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}};function eh(e){if(!e)throw new Error("Credential creation options are required");if("undefined"!=typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:r,excludeCredentials:s}=e,n=Gl(e,["challenge","user","excludeCredentials"]),i=cd(t).buffer,a=Object.assign(Object.assign({},r),{id:cd(r.id).buffer}),o=Object.assign(Object.assign({},n),{challenge:i,user:a});if(s&&s.length>0){o.excludeCredentials=new Array(s.length);for(let e=0;e<s.length;e++){const t=s[e];o.excludeCredentials[e]=Object.assign(Object.assign({},t),{id:cd(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return o}function th(e){if(!e)throw new Error("Credential request options are required");if("undefined"!=typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:r}=e,s=Gl(e,["challenge","allowCredentials"]),n=cd(t).buffer,i=Object.assign(Object.assign({},s),{challenge:n});if(r&&r.length>0){i.allowCredentials=new Array(r.length);for(let e=0;e<r.length;e++){const t=r[e];i.allowCredentials[e]=Object.assign(Object.assign({},t),{id:cd(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return i}function rh(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();const r=e;return{id:e.id,rawId:e.id,response:{attestationObject:hd(new Uint8Array(e.response.attestationObject)),clientDataJSON:hd(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:null!==(t=r.authenticatorAttachment)&&void 0!==t?t:void 0}}function sh(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();const r=e,s=e.getClientExtensionResults(),n=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:hd(new Uint8Array(n.authenticatorData)),clientDataJSON:hd(new Uint8Array(n.clientDataJSON)),signature:hd(new Uint8Array(n.signature)),userHandle:n.userHandle?hd(new Uint8Array(n.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:null!==(t=r.authenticatorAttachment)&&void 0!==t?t:void 0}}function nh(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function ih(){var e,t;return!!(fd()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&"function"==typeof(null===(e=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===e?void 0:e.create)&&"function"==typeof(null===(t=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===t?void 0:t.get))}const ah={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},oh={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function lh(...e){const t=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),r=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),s={};for(const n of e)if(n)for(const e in n){const i=n[e];if(void 0!==i)if(Array.isArray(i))s[e]=i;else if(r(i))s[e]=i;else if(t(i)){const r=s[e];t(r)?s[e]=lh(r,i):s[e]=lh(i)}else s[e]=i}return s}class uh{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:r,signal:s},n){var i;try{const{data:a,error:o}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!a)return{data:null,error:o};const l=null!=s?s:Zd.createNewAbortSignal();if("create"===a.webauthn.type){const{user:e}=a.webauthn.credential_options.publicKey;if(!e.name){const t=r;if(t)e.name=`${e.id}:${t}`;else{const t=(await this.client.getUser()).data.user,r=(null===(i=null==t?void 0:t.user_metadata)||void 0===i?void 0:i.name)||(null==t?void 0:t.email)||(null==t?void 0:t.id)||"User";e.name=`${e.id}:${r}`}}e.displayName||(e.displayName=e.name)}switch(a.webauthn.type){case"create":{const t=function(e,t){return lh(ah,e,t||{})}(a.webauthn.credential_options.publicKey,null==n?void 0:n.create),{data:r,error:s}=await async function(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Qd("Browser returned unexpected credential type",t)}:{data:null,error:new Qd("Empty credential response",t)}}catch(t){return{data:null,error:Xd({error:t,options:e})}}}({publicKey:t,signal:l});return r?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:r}},error:null}:{data:null,error:s}}case"request":{const t=function(e,t){return lh(oh,e,t||{})}(a.webauthn.credential_options.publicKey,null==n?void 0:n.request),{data:r,error:s}=await async function(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Qd("Browser returned unexpected credential type",t)}:{data:null,error:new Qd("Empty credential response",t)}}catch(t){return{data:null,error:Jd({error:t,options:e})}}}(Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:t,signal:l}));return r?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:r}},error:null}:{data:null,error:s}}}}catch(e){return Gc(e)?{data:null,error:e}:{data:null,error:new Hc("Unexpected error in challenge",e)}}}async _verify({challengeId:e,factorId:t,webauthn:r}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:t=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:r=("undefined"!=typeof window?[window.location.origin]:void 0),signal:s}={}},n){if(!t)return{data:null,error:new jc("rpId is required for WebAuthn authentication")};try{if(!ih())return{data:null,error:new Hc("Browser does not support WebAuthn",null)};const{data:i,error:a}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:r},signal:s},{request:n});if(!i)return{data:null,error:a};const{webauthn:o}=i;return this._verify({factorId:e,challengeId:i.challengeId,webauthn:{type:o.type,rpId:t,rpOrigins:r,credential_response:o.credential_response}})}catch(e){return Gc(e)?{data:null,error:e}:{data:null,error:new Hc("Unexpected error in authenticate",e)}}}async _register({friendlyName:e,webauthn:{rpId:t=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:r=("undefined"!=typeof window?[window.location.origin]:void 0),signal:s}={}},n){if(!t)return{data:null,error:new jc("rpId is required for WebAuthn registration")};try{if(!ih())return{data:null,error:new Hc("Browser does not support WebAuthn",null)};const{data:i,error:a}=await this._enroll({friendlyName:e});if(!i)return await this.client.mfa.listFactors().then(t=>{var r;return null===(r=t.data)||void 0===r?void 0:r.all.find(t=>"webauthn"===t.factor_type&&t.friendly_name===e&&"unverified"!==t.status)}).then(e=>e?this.client.mfa.unenroll({factorId:null==e?void 0:e.id}):void 0),{data:null,error:a};const{data:o,error:l}=await this._challenge({factorId:i.id,friendlyName:i.friendly_name,webauthn:{rpId:t,rpOrigins:r},signal:s},{create:n});return o?this._verify({factorId:i.id,challengeId:o.challengeId,webauthn:{rpId:t,rpOrigins:r,type:o.webauthn.type,credential_response:o.webauthn.credential_response}}):{data:null,error:l}}catch(e){return Gc(e)?{data:null,error:e}:{data:null,error:new Hc("Unexpected error in register",e)}}}}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const ch={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Fc,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4,skipAutoInitialize:!1};async function dh(e,t,r){return await r()}const hh={};class fh{get jwks(){var e,t;return null!==(t=null===(e=hh[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){hh[this.storageKey]=Object.assign(Object.assign({},hh[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=hh[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){hh[this.storageKey]=Object.assign(Object.assign({},hh[this.storageKey]),{cachedAt:e})}constructor(e){var t,r,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const n=Object.assign(Object.assign({},ch),e);if(this.storageKey=n.storageKey,this.instanceID=null!==(t=fh.nextInstanceID[this.storageKey])&&void 0!==t?t:0,fh.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!n.debug,"function"==typeof n.debug&&(this.logger=n.debug),this.instanceID>0&&fd()){const e=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(e),this.logDebugMessages&&console.trace(e)}if(this.persistSession=n.persistSession,this.autoRefreshToken=n.autoRefreshToken,this.admin=new jd({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=md(n.fetch),this.lock=n.lock||dh,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,this.throwOnError=n.throwOnError,this.lockAcquireTimeout=n.lockAcquireTimeout,n.lock?this.lock=n.lock:this.persistSession&&fd()&&(null===(r=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===r?void 0:r.locks)?this.lock=zd:this.lock=dh,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new uh(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:pd()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Gd(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=Gd(this.memoryStorage)),fd()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(e){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",e)}null===(s=this.broadcastChannel)||void 0===s||s.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e);try{await this._notifyAllSubscribers(e.data.event,e.data.session,!1)}catch(e){this._debug("#broadcastChannel","error",e)}})}n.skipAutoInitialize||this.initialize().catch(e=>{this._debug("#initialize()","error",e)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Oc}) ${(new Date).toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{let t={},r="none";if(fd()&&(t=function(e){const t={},r=new URL(e);if(r.hash&&"#"===r.hash[0])try{new URLSearchParams(r.hash.substring(1)).forEach((e,r)=>{t[r]=e})}catch(e){}return r.searchParams.forEach((e,r)=>{t[r]=e}),t}(window.location.href),this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce")),fd()&&this.detectSessionInUrl&&"none"!==r){const{data:s,error:n}=await this._getSessionFromURL(t,r);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),function(e){return Gc(e)&&"AuthImplicitGrantRedirectError"===e.name}(n)){const t=null===(e=n.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:n}}return{error:n}}const{session:i,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",i,"redirect type",a),await this._saveSession(i),setTimeout(async()=>{"recovery"===a?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return Gc(e)?this._returnResult({error:e}):this._returnResult({error:new Hc("Unexpected error during initialization",e)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{const n=await xd(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(r=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==r?r:{},gotrue_meta_security:{captcha_token:null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken}},xform:Od}),{data:i,error:a}=n;if(a||!i)return this._returnResult({data:{user:null,session:null},error:a});const o=i.session,l=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(e){if(Gc(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signUp(e){var t,r,s;try{let n;if("email"in e){const{email:r,password:s,options:i}=e;let a=null,o=null;"pkce"===this.flowType&&([a,o]=await kd(this.storage,this.storageKey)),n=await xd(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==i?void 0:i.emailRedirectTo,body:{email:r,password:s,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:a,code_challenge_method:o},xform:Od})}else{if(!("phone"in e))throw new Yc("You must provide either an email or phone number and a password");{const{phone:t,password:i,options:a}=e;n=await xd(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:i,data:null!==(r=null==a?void 0:a.data)&&void 0!==r?r:{},channel:null!==(s=null==a?void 0:a.channel)&&void 0!==s?s:"sms",gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:Od})}}const{data:i,error:a}=n;if(a||!i)return await bd(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});const o=i.session,l=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(e){if(await bd(this.storage,`${this.storageKey}-code-verifier`),Gc(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithPassword(e){try{let t;if("email"in e){const{email:r,password:s,options:n}=e;t=await xd(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:Nd})}else{if(!("phone"in e))throw new Yc("You must provide either an email or phone number and a password");{const{phone:r,password:s,options:n}=e;t=await xd(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:Nd})}}const{data:r,error:s}=t;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!r||!r.session||!r.user){const e=new Wc;return this._returnResult({data:{user:null,session:null},error:e})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(e){if(Gc(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOAuth(e){var t,r,s,n;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(s=e.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:null===(n=e.options)||void 0===n?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,r,s,n,i,a,o,l,u,c,d;let h,f;if("message"in e)h=e.message,f=e.signature;else{const{chain:c,wallet:d,statement:g,options:p}=e;let m;if(fd())if("object"==typeof d)m=d;else{const e=window;if(!("ethereum"in e)||"object"!=typeof e.ethereum||!("request"in e.ethereum)||"function"!=typeof e.ethereum.request)throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.");m=e.ethereum}else{if("object"!=typeof d||!(null==p?void 0:p.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");m=d}const y=new URL(null!==(t=null==p?void 0:p.url)&&void 0!==t?t:window.location.href),v=await m.request({method:"eth_requestAccounts"}).then(e=>e).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!v||0===v.length)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const b=qd(v[0]);let E=null===(r=null==p?void 0:p.signInWithEthereum)||void 0===r?void 0:r.chainId;if(!E){const e=await m.request({method:"eth_chainId"});E=parseInt(e,16)}h=function(e){var t;const{chainId:r,domain:s,expirationTime:n,issuedAt:i=new Date,nonce:a,notBefore:o,requestId:l,resources:u,scheme:c,uri:d,version:h}=e;if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!s)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${a}`);if(!d)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==h)throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(null===(t=e.statement)||void 0===t?void 0:t.includes("\n"))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`);const f=`${c?`${c}://${s}`:s} wants you to sign in with your Ethereum account:\n${qd(e.address)}\n\n${e.statement?`${e.statement}\n`:""}`;let g=`URI: ${d}\nVersion: ${h}\nChain ID: ${r}${a?`\nNonce: ${a}`:""}\nIssued At: ${i.toISOString()}`;if(n&&(g+=`\nExpiration Time: ${n.toISOString()}`),o&&(g+=`\nNot Before: ${o.toISOString()}`),l&&(g+=`\nRequest ID: ${l}`),u){let e="\nResources:";for(const t of u){if(!t||"string"!=typeof t)throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${t}`);e+=`\n- ${t}`}g+=e}return`${f}\n${g}`}({domain:y.host,address:b,statement:g,uri:y.href,version:"1",chainId:E,nonce:null===(s=null==p?void 0:p.signInWithEthereum)||void 0===s?void 0:s.nonce,issuedAt:null!==(i=null===(n=null==p?void 0:p.signInWithEthereum)||void 0===n?void 0:n.issuedAt)&&void 0!==i?i:new Date,expirationTime:null===(a=null==p?void 0:p.signInWithEthereum)||void 0===a?void 0:a.expirationTime,notBefore:null===(o=null==p?void 0:p.signInWithEthereum)||void 0===o?void 0:o.notBefore,requestId:null===(l=null==p?void 0:p.signInWithEthereum)||void 0===l?void 0:l.requestId,resources:null===(u=null==p?void 0:p.signInWithEthereum)||void 0===u?void 0:u.resources}),f=await m.request({method:"personal_sign",params:[Wd(h),b]})}try{const{data:t,error:r}=await xd(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:h,signature:f},(null===(c=e.options)||void 0===c?void 0:c.captchaToken)?{gotrue_meta_security:{captcha_token:null===(d=e.options)||void 0===d?void 0:d.captchaToken}}:null),xform:Od});if(r)throw r;if(!t||!t.session||!t.user){const e=new Wc;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:r})}catch(e){if(Gc(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithSolana(e){var t,r,s,n,i,a,o,l,u,c,d,h;let f,g;if("message"in e)f=e.message,g=e.signature;else{const{chain:d,wallet:h,statement:p,options:m}=e;let y;if(fd())if("object"==typeof h)y=h;else{const e=window;if(!("solana"in e)||"object"!=typeof e.solana||!("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");y=e.solana}else{if("object"!=typeof h||!(null==m?void 0:m.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");y=h}const v=new URL(null!==(t=null==m?void 0:m.url)&&void 0!==t?t:window.location.href);if("signIn"in y&&y.signIn){const e=await y.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==m?void 0:m.signInWithSolana),{version:"1",domain:v.host,uri:v.href}),p?{statement:p}:null));let t;if(Array.isArray(e)&&e[0]&&"object"==typeof e[0])t=e[0];else{if(!(e&&"object"==typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");f="string"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),g=t.signature}else{if(!("signMessage"in y&&"function"==typeof y.signMessage&&"publicKey"in y&&"object"==typeof y&&y.publicKey&&"toBase58"in y.publicKey&&"function"==typeof y.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=[`${v.host} wants you to sign in with your Solana account:`,y.publicKey.toBase58(),...p?["",p,""]:[""],"Version: 1",`URI: ${v.href}`,`Issued At: ${null!==(s=null===(r=null==m?void 0:m.signInWithSolana)||void 0===r?void 0:r.issuedAt)&&void 0!==s?s:(new Date).toISOString()}`,...(null===(n=null==m?void 0:m.signInWithSolana)||void 0===n?void 0:n.notBefore)?[`Not Before: ${m.signInWithSolana.notBefore}`]:[],...(null===(i=null==m?void 0:m.signInWithSolana)||void 0===i?void 0:i.expirationTime)?[`Expiration Time: ${m.signInWithSolana.expirationTime}`]:[],...(null===(a=null==m?void 0:m.signInWithSolana)||void 0===a?void 0:a.chainId)?[`Chain ID: ${m.signInWithSolana.chainId}`]:[],...(null===(o=null==m?void 0:m.signInWithSolana)||void 0===o?void 0:o.nonce)?[`Nonce: ${m.signInWithSolana.nonce}`]:[],...(null===(l=null==m?void 0:m.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${m.signInWithSolana.requestId}`]:[],...(null===(c=null===(u=null==m?void 0:m.signInWithSolana)||void 0===u?void 0:u.resources)||void 0===c?void 0:c.length)?["Resources",...m.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join("\n");const e=await y.signMessage((new TextEncoder).encode(f),"utf8");if(!(e&&e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");g=e}}try{const{data:t,error:r}=await xd(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:hd(g)},(null===(d=e.options)||void 0===d?void 0:d.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:Od});if(r)throw r;if(!t||!t.session||!t.user){const e=new Wc;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:r})}catch(e){if(Gc(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async _exchangeCodeForSession(e){const t=await vd(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(null!=t?t:"").split("/");try{if(!r&&"pkce"===this.flowType)throw new Jc;const{data:t,error:n}=await xd(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Od});if(await bd(this.storage,`${this.storageKey}-code-verifier`),n)throw n;if(!t||!t.session||!t.user){const e=new Wc;return this._returnResult({data:{user:null,session:null,redirectType:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign(Object.assign({},t),{redirectType:null!=s?s:null}),error:n})}catch(e){if(await bd(this.storage,`${this.storageKey}-code-verifier`),Gc(e))return this._returnResult({data:{user:null,session:null,redirectType:null},error:e});throw e}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:n,nonce:i}=e,a=await xd(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:n,nonce:i,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:Od}),{data:o,error:l}=a;if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!o||!o.session||!o.user){const e=new Wc;return this._returnResult({data:{user:null,session:null},error:e})}return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),this._returnResult({data:o,error:l})}catch(e){if(Gc(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOtp(e){var t,r,s,n,i;try{if("email"in e){const{email:s,options:n}=e;let i=null,a=null;"pkce"===this.flowType&&([i,a]=await kd(this.storage,this.storageKey));const{error:o}=await xd(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},create_user:null===(r=null==n?void 0:n.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:i,code_challenge_method:a},redirectTo:null==n?void 0:n.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}if("phone"in e){const{phone:t,options:r}=e,{data:a,error:o}=await xd(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(s=null==r?void 0:r.data)&&void 0!==s?s:{},create_user:null===(n=null==r?void 0:r.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},channel:null!==(i=null==r?void 0:r.channel)&&void 0!==i?i:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:null==a?void 0:a.message_id},error:o})}throw new Yc("You must provide either an email or phone number.")}catch(e){if(await bd(this.storage,`${this.storageKey}-code-verifier`),Gc(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async verifyOtp(e){var t,r;try{let s,n;"options"in e&&(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo,n=null===(r=e.options)||void 0===r?void 0:r.captchaToken);const{data:i,error:a}=await xd(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:s,xform:Od});if(a)throw a;if(!i){throw new Error("An error occurred on token verification.")}const o=i.session,l=i.user;return(null==o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(e){if(Gc(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithSSO(e){var t,r,s,n,i;try{let a=null,o=null;"pkce"===this.flowType&&([a,o]=await kd(this.storage,this.storageKey));const l=await xd(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==r?r:void 0}),(null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:o}),headers:this.headers,xform:Fd});return(null===(n=l.data)||void 0===n?void 0:n.url)&&fd()&&!(null===(i=e.options)||void 0===i?void 0:i.skipBrowserRedirect)&&window.location.assign(l.data.url),this._returnResult(l)}catch(e){if(await bd(this.storage,`${this.storageKey}-code-verifier`),Gc(e))return this._returnResult({data:null,error:e});throw e}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new zc;const{error:s}=await xd(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(e){if(Gc(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:n}=e,{error:i}=await xd(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},redirectTo:null==n?void 0:n.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:i})}if("phone"in e){const{phone:r,type:s,options:n}=e,{data:i,error:a}=await xd(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:a})}throw new Yc("You must provide either an email or phone number and a type")}catch(e){if(Gc(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async getSession(){await this.initializePromise;return await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch(e){}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(e){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await vd(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=!!e.expires_at&&1e3*e.expires_at-Date.now()<Mc;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const t=await vd(this.userStorage,this.storageKey+"-user");(null==t?void 0:t.user)?e.user=t.user:e.user=Rd()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const t={value:this.suppressGetSessionWarning};e.user=function(e,t){return new Proxy(e,{get:(e,r,s)=>{if("__isInsecureUserWarningProxy"===r)return!0;if("symbol"==typeof r){const t=r.toString();if("Symbol(Symbol.toPrimitive)"===t||"Symbol(Symbol.toStringTag)"===t||"Symbol(util.inspect.custom)"===t||"Symbol(nodejs.util.inspect.custom)"===t)return Reflect.get(e,r,s)}return t.value||"string"!=typeof r||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(e,r,s)}})}(e.user,t),t.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?this._returnResult({data:{session:null},error:n}):this._returnResult({data:{session:s},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const t=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{return e?await xd(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Md}):await this._useSession(async e=>{var t,r,s;const{data:n,error:i}=e;if(i)throw i;return(null===(t=n.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await xd(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(s=null===(r=n.session)||void 0===r?void 0:r.access_token)&&void 0!==s?s:void 0,xform:Md}):{data:{user:null},error:new zc}})}catch(e){if(Gc(e))return qc(e)&&(await this._removeSession(),await bd(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:e});throw e}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:n}=r;if(n)throw n;if(!s.session)throw new zc;const i=s.session;let a=null,o=null;"pkce"===this.flowType&&null!=e.email&&([a,o]=await kd(this.storage,this.storageKey));const{data:l,error:u}=await xd(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:o}),jwt:i.access_token,xform:Md});if(u)throw u;return i.user=l.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),this._returnResult({data:{user:i.user},error:null})})}catch(e){if(await bd(this.storage,`${this.storageKey}-code-verifier`),Gc(e))return this._returnResult({data:{user:null},error:e});throw e}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new zc;const t=Date.now()/1e3;let r=t,s=!0,n=null;const{payload:i}=Sd(e.access_token);if(i.exp&&(r=i.exp,s=r<=t),s){const{data:t,error:r}=await this._callRefreshToken(e.refresh_token);if(r)return this._returnResult({data:{user:null,session:null},error:r});if(!t)return{data:{user:null,session:null},error:null};n=t}else{const{data:s,error:i}=await this._getUser(e.access_token);if(i)return this._returnResult({data:{user:null,session:null},error:i});n={access_token:e.access_token,refresh_token:e.refresh_token,user:s.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return this._returnResult({data:{user:n.user,session:n},error:null})}catch(e){if(Gc(e))return this._returnResult({data:{session:null,user:null},error:e});throw e}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:s,error:n}=t;if(n)throw n;e=null!==(r=s.session)&&void 0!==r?r:void 0}if(!(null==e?void 0:e.refresh_token))throw new zc;const{data:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?this._returnResult({data:{user:null,session:null},error:n}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(e){if(Gc(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async _getSessionFromURL(e,t){try{if(!fd())throw new Qc("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Qc(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new Xc("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Qc("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Xc("No code detected.");const{data:t,error:r}=await this._exchangeCodeForSession(e.code);if(r)throw r;const s=new URL(window.location.href);return s.searchParams.delete("code"),window.history.replaceState(window.history.state,"",s.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:n,refresh_token:i,expires_in:a,expires_at:o,token_type:l}=e;if(!(n&&a&&i&&l))throw new Qc("No session defined in URL");const u=Math.round(Date.now()/1e3),c=parseInt(a);let d=u+c;o&&(d=parseInt(o));const h=d-u;1e3*h<=Nc&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${c}s`);const f=d-c;u-f>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",f,d,u):u-f<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",f,d,u);const{data:g,error:p}=await this._getUser(n);if(p)throw p;const m={provider_token:r,provider_refresh_token:s,access_token:n,expires_in:c,expires_at:d,refresh_token:i,token_type:l,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:m,redirectType:e.type},error:null})}catch(e){if(Gc(e))return this._returnResult({data:{session:null,redirectType:null},error:e});throw e}}_isImplicitGrantCallback(e){return"function"==typeof this.detectSessionInUrl?this.detectSessionInUrl(new URL(window.location.href),e):Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await vd(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n&&!qc(n))return this._returnResult({error:n});const i=null===(r=s.session)||void 0===r?void 0:r.access_token;if(i){const{error:t}=await this.admin.signOut(i,e);if(t&&(!function(e){return Gc(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status)&&!qc(t))return this._returnResult({error:t})}return"others"!==e&&(await this._removeSession(),await bd(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=Symbol("auth-callback"),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>{await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:s},error:n}=t;if(n)throw n;await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(t){await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",t),console.error(t)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;"pkce"===this.flowType&&([r,s]=await kd(this.storage,this.storageKey,!0));try{return await xd(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(e){if(await bd(this.storage,`${this.storageKey}-code-verifier`),Gc(e))return this._returnResult({data:null,error:e});throw e}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null})}catch(e){if(Gc(e))return this._returnResult({data:null,error:e});throw e}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:r,error:s}=await this._useSession(async t=>{var r,s,n,i,a;const{data:o,error:l}=t;if(l)throw l;const u=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(r=e.options)||void 0===r?void 0:r.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(n=e.options)||void 0===n?void 0:n.queryParams,skipBrowserRedirect:!0});return await xd(this.fetch,"GET",u,{headers:this.headers,jwt:null!==(a=null===(i=o.session)||void 0===i?void 0:i.access_token)&&void 0!==a?a:void 0})});if(s)throw s;return fd()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==r?void 0:r.url),this._returnResult({data:{provider:e.provider,url:null==r?void 0:r.url},error:null})}catch(t){if(Gc(t))return this._returnResult({data:{provider:e.provider,url:null},error:t});throw t}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var r;try{const{error:s,data:{session:n}}=t;if(s)throw s;const{options:i,provider:a,token:o,access_token:l,nonce:u}=e,c=await xd(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:null!==(r=null==n?void 0:n.access_token)&&void 0!==r?r:void 0,body:{provider:a,id_token:o,access_token:l,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:Od}),{data:d,error:h}=c;return h?this._returnResult({data:{user:null,session:null},error:h}):d&&d.session&&d.user?(d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("USER_UPDATED",d.session)),this._returnResult({data:d,error:h})):this._returnResult({data:{user:null,session:null},error:new Wc})}catch(e){if(await bd(this.storage,`${this.storageKey}-code-verifier`),Gc(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:n,error:i}=t;if(i)throw i;return await xd(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(s=null===(r=n.session)||void 0===r?void 0:r.access_token)&&void 0!==s?s:void 0})})}catch(e){if(Gc(e))return this._returnResult({data:null,error:e});throw e}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await(r=async r=>(r>0&&await async function(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await xd(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Od})),s=(e,t)=>{const r=200*Math.pow(2,e);return t&&ed(t)&&Date.now()+r-n<Nc},new Promise((e,t)=>{(async()=>{for(let n=0;n<1/0;n++)try{const t=await r(n);if(!s(n,null,t))return void e(t)}catch(e){if(!s(n,e))return void t(e)}})()}))}catch(e){if(this._debug(t,"error",e),Gc(e))return this._returnResult({data:{session:null,user:null},error:e});throw e}finally{this._debug(t,"end")}var r,s}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),fd()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const s=await vd(this.storage,this.storageKey);if(s&&this.userStorage){let t=await vd(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:s.user},await yd(this.userStorage,this.storageKey+"-user",t)),s.user=null!==(e=null==t?void 0:t.user)&&void 0!==e?e:Rd()}else if(s&&!s.user&&!s.user){const e=await vd(this.storage,this.storageKey+"-user");e&&(null==e?void 0:e.user)?(s.user=e.user,await bd(this.storage,this.storageKey+"-user"),await yd(this.storage,this.storageKey,s)):s.user=Rd()}if(this._debug(r,"session from storage",s),!this._isValidSession(s))return this._debug(r,"session is not valid"),void(null!==s&&await this._removeSession());const n=1e3*(null!==(t=s.expires_at)&&void 0!==t?t:1/0)-Date.now()<Mc;if(this._debug(r,`session has${n?"":" not"} expired with margin of 90000s`),n){if(this.autoRefreshToken&&s.refresh_token){const{error:e}=await this._callRefreshToken(s.refresh_token);e&&(console.error(e),ed(e)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(s.user&&!0===s.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=await this._getUser(s.access_token);!t&&(null==e?void 0:e.user)?(s.user=e.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(e){console.error("Error getting user data:",e),this._debug(r,"error getting user data, skipping SIGNED_IN notification",e)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(e){return this._debug(r,"error",e),void console.error(e)}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new zc;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Ed;const{data:t,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!t.session)throw new zc;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const s={data:t.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(e){if(this._debug(s,"error",e),Gc(e)){const r={data:null,error:e};return ed(e)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(r),r}throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(e),e}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const s=[],n=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(e,t)}catch(e){s.push(e)}});if(await Promise.all(n),s.length>0){for(let e=0;e<s.length;e+=1)console.error(s[e]);throw s[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await bd(this.storage,`${this.storageKey}-code-verifier`);const t=Object.assign({},e),r=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!r&&t.user&&await yd(this.userStorage,this.storageKey+"-user",{user:t.user});const e=Object.assign({},t);delete e.user;const s=Id(e);await yd(this.storage,this.storageKey,s)}else{const e=Id(t);await yd(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await bd(this.storage,this.storageKey),await bd(this.storage,this.storageKey+"-code-verifier"),await bd(this.storage,this.storageKey+"-user"),this.userStorage&&await bd(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&fd()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Nc);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e);const t=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=t,t&&"object"==typeof t&&"function"==typeof t.unref?t.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(t)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const t=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,t&&clearTimeout(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const s=Math.floor((1e3*r.expires_at-e)/Nc);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),s<=3&&await this._callRefreshToken(r.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(!(e.isAcquireTimeout||e instanceof Hd))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!fd()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(e){this._debug("#visibilityChangedCallback","error",e)}},null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if((null==r?void 0:r.redirectTo)&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),(null==r?void 0:r.scopes)&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),"pkce"===this.flowType){const[e,t]=await kd(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});s.push(r.toString())}if(null==r?void 0:r.queryParams){const e=new URLSearchParams(r.queryParams);s.push(e.toString())}return(null==r?void 0:r.skipBrowserRedirect)&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;return n?this._returnResult({data:null,error:n}):await xd(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token})})}catch(e){if(Gc(e))return this._returnResult({data:null,error:e});throw e}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:n,error:i}=t;if(i)return this._returnResult({data:null,error:i});const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:"totp"===e.factorType?{issuer:e.issuer}:{}),{data:o,error:l}=await xd(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token});return l?this._returnResult({data:null,error:l}):("totp"===e.factorType&&"totp"===o.type&&(null===(s=null==o?void 0:o.totp)||void 0===s?void 0:s.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),this._returnResult({data:o,error:null}))})}catch(e){if(Gc(e))return this._returnResult({data:null,error:e});throw e}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return this._returnResult({data:null,error:n});const i=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:"create"===e.webauthn.type?rh(e.webauthn.credential_response):sh(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:o}=await xd(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:i,headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token});return o?this._returnResult({data:null,error:o}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:o}))})}catch(e){if(Gc(e))return this._returnResult({data:null,error:e});throw e}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return this._returnResult({data:null,error:n});const i=await xd(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token});if(i.error)return i;const{data:a}=i;if("webauthn"!==a.type)return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:eh(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:th(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(e){if(Gc(e))return this._returnResult({data:null,error:e});throw e}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:r}=await this.getUser();if(r)return{data:null,error:r};const s={all:[],phone:[],totp:[],webauthn:[]};for(const r of null!==(e=null==t?void 0:t.factors)&&void 0!==e?e:[])s.all.push(r),"verified"===r.status&&s[r.factor_type].push(r);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(e){var t,r,s,n;if(e)try{const{payload:s}=Sd(e);let n=null;s.aal&&(n=s.aal);let i=n;const{data:{user:a},error:o}=await this.getUser(e);if(o)return this._returnResult({data:null,error:o});(null!==(r=null===(t=null==a?void 0:a.factors)||void 0===t?void 0:t.filter(e=>"verified"===e.status))&&void 0!==r?r:[]).length>0&&(i="aal2");return{data:{currentLevel:n,nextLevel:i,currentAuthenticationMethods:s.amr||[]},error:null}}catch(e){if(Gc(e))return this._returnResult({data:null,error:e});throw e}const{data:{session:i},error:a}=await this.getSession();if(a)return this._returnResult({data:null,error:a});if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=Sd(i.access_token);let l=null;o.aal&&(l=o.aal);let u=l;(null!==(n=null===(s=i.user.factors)||void 0===s?void 0:s.filter(e=>"verified"===e.status))&&void 0!==n?n:[]).length>0&&(u="aal2");return{data:{currentLevel:l,nextLevel:u,currentAuthenticationMethods:o.amr||[]},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:r},error:s}=t;return s?this._returnResult({data:null,error:s}):r?await xd(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new zc})})}catch(e){if(Gc(e))return this._returnResult({data:null,error:e});throw e}}async _approveAuthorization(e,t){try{return await this._useSession(async r=>{const{data:{session:s},error:n}=r;if(n)return this._returnResult({data:null,error:n});if(!s)return this._returnResult({data:null,error:new zc});const i=await xd(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:e=>({data:e,error:null})});return i.data&&i.data.redirect_url&&fd()&&!(null==t?void 0:t.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(e){if(Gc(e))return this._returnResult({data:null,error:e});throw e}}async _denyAuthorization(e,t){try{return await this._useSession(async r=>{const{data:{session:s},error:n}=r;if(n)return this._returnResult({data:null,error:n});if(!s)return this._returnResult({data:null,error:new zc});const i=await xd(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:e=>({data:e,error:null})});return i.data&&i.data.redirect_url&&fd()&&!(null==t?void 0:t.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(e){if(Gc(e))return this._returnResult({data:null,error:e});throw e}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;return r?this._returnResult({data:null,error:r}):t?await xd(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new zc})})}catch(e){if(Gc(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{const{data:{session:r},error:s}=t;return s?this._returnResult({data:null,error:s}):r?(await xd(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new zc})})}catch(e){if(Gc(e))return this._returnResult({data:null,error:e});throw e}}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(t=>t.kid===e);if(r)return r;const s=Date.now();if(r=this.jwks.keys.find(t=>t.kid===e),r&&this.jwks_cached_at+6e5>s)return r;const{data:n,error:i}=await xd(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return n.keys&&0!==n.keys.length?(this.jwks=n,this.jwks_cached_at=s,r=n.keys.find(t=>t.kid===e),r||null):null}async getClaims(e,t={}){try{let r=e;if(!r){const{data:e,error:t}=await this.getSession();if(t||!e.session)return this._returnResult({data:null,error:t});r=e.session.access_token}const{header:s,payload:n,signature:i,raw:{header:a,payload:o}}=Sd(r);(null==t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(n.exp);const l=s.alg&&!s.alg.startsWith("HS")&&s.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(s.kid,(null==t?void 0:t.keys)?{keys:t.keys}:null==t?void 0:t.jwks):null;if(!l){const{error:e}=await this.getUser(r);if(e)throw e;return{data:{claims:n,header:s,signature:i},error:null}}const u=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(s.alg),c=await crypto.subtle.importKey("jwk",l,u,!0,["verify"]);if(!await crypto.subtle.verify(u,c,i,dd(`${a}.${o}`)))throw new rd("Invalid JWT signature");return{data:{claims:n,header:s,signature:i},error:null}}catch(e){if(Gc(e))return this._returnResult({data:null,error:e});throw e}}}fh.nextInstanceID={};const gh=fh;let ph="";ph="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const mh={headers:{"X-Client-Info":`supabase-js-${ph}/2.97.0`}},yh={schema:"public"},vh={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},bh={};function Eh(e){return(Eh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Sh(e){var t=function(e,t){if("object"!=Eh(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t);if("object"!=Eh(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Eh(t)?t:t+""}function Th(e,t,r){return(t=Sh(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wh(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function kh(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?wh(Object(r),!0).forEach(function(t){Th(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wh(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}const _h=(e,t,r)=>{const s=(e=>e?(...t)=>e(...t):(...e)=>fetch(...e))(r),n=Headers;return async(r,i)=>{var a;const o=null!==(a=await t())&&void 0!==a?a:e;let l=new n(null==i?void 0:i.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),s(r,kh(kh({},i),{},{headers:l}))}};var Ah=class extends gh{constructor(e){super(e)}},Lh=class{constructor(e,t,r){var s,n;this.supabaseUrl=e,this.supabaseKey=t;const i=function(e){const t=null==e?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL((r=t).endsWith("/")?r:r+"/")}catch(e){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}var r}(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const a=`sb-${i.hostname.split(".")[0]}-auth-token`,o=function(e,t){var r,s;const{db:n,auth:i,realtime:a,global:o}=e,{db:l,auth:u,realtime:c,global:d}=t,h={db:kh(kh({},l),n),auth:kh(kh({},u),i),realtime:kh(kh({},c),a),storage:{},global:kh(kh(kh({},d),o),{},{headers:kh(kh({},null!==(r=null==d?void 0:d.headers)&&void 0!==r?r:{}),null!==(s=null==o?void 0:o.headers)&&void 0!==s?s:{})}),accessToken:async()=>""};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!=r?r:{},{db:yh,realtime:bh,auth:kh(kh({},vh),{},{storageKey:a}),global:mh});var l;(this.storageKey=null!==(s=o.auth.storageKey)&&void 0!==s?s:"",this.headers=null!==(n=o.global.headers)&&void 0!==n?n:{},o.accessToken)?(this.accessToken=o.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(l=o.auth)&&void 0!==l?l:{},this.headers,o.global.fetch);this.fetch=_h(t,this._getAccessToken.bind(this),o.global.fetch),this.realtime=this._initRealtimeClient(kh({headers:this.headers,accessToken:this._getAccessToken.bind(this)},o.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(e=>this.realtime.setAuth(e)).catch(e=>console.warn("Failed to set initial Realtime auth token:",e)),this.rest=new ou(new URL("rest/v1",i).href,{headers:this.headers,schema:o.db.schema,fetch:this.fetch,timeout:o.db.timeout,urlLengthLimit:o.db.urlLengthLimit}),this.storage=new xc(this.storageUrl.href,this.headers,this.fetch,null==r?void 0:r.storage),o.accessToken||this._listenForAuthEvents()}get functions(){return new Yl(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t,r=this;if(r.accessToken)return await r.accessToken();const{data:s}=await r.auth.getSession();return null!==(e=null===(t=s.session)||void 0===t?void 0:t.access_token)&&void 0!==e?e:r.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,userStorage:n,storageKey:i,flowType:a,lock:o,debug:l,throwOnError:u},c,d){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ah({url:this.authUrl.href,headers:kh(kh({},h),c),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,userStorage:n,flowType:a,lock:o,debug:l,throwOnError:u,fetch:d,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new Gu(this.realtimeUrl.href,kh(kh({},e),{},{params:kh(kh({},{apikey:this.supabaseKey}),null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,r){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===r?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):(this.changedAccessToken=r,this.realtime.setAuth(r))}};(function(){if("undefined"!=typeof window)return!1;const e=globalThis.process;if(!e)return!1;const t=e.version;if(null==t)return!1;const r=t.match(/^v(\d+)\./);return!!r&&parseInt(r[1],10)<=18})()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Rh=new Lh($l,Ul,{auth:{persistSession:!0,autoRefreshToken:!0}});async function Ih(){var e,t;const{data:r,error:s}=await Rh.auth.getUser();return s?(console.warn("[AkiraPlayer] getUser error:",s.message),null):null!==(t=null===(e=r.user)||void 0===e?void 0:e.id)&&void 0!==t?t:null}async function Ph(e){var t,r;const s=await Ih();if(!s)return;const n=Math.max(0,e.durationSeconds-jl),i=e.durationSeconds>0&&e.positionSeconds>=n,a={user_id:s,content_id:e.contentId,season_id:null!==(t=e.seasonId)&&void 0!==t?t:null,episode_id:null!==(r=e.episodeId)&&void 0!==r?r:null,position_seconds:Math.floor(e.positionSeconds),duration_seconds:Math.floor(e.durationSeconds||0),completed:i},{error:o}=await Rh.from("watch_progress").upsert(a,{onConflict:"user_id,content_id,season_id,episode_id"});o&&console.warn("[AkiraPlayer] saveProgress error:",o.message)}function Ch(e){const t=e.trim().split(":").map(Number);return 3===t.length?3600*t[0]+60*t[1]+t[2]:2===t.length?60*t[0]+t[1]:Number(e)||0}function Dh(e){const t=e.match(/xywh=(\d+),(\d+),(\d+),(\d+)/i);if(t)return{x:Number(t[1]),y:Number(t[2]),w:Number(t[3]),h:Number(t[4])}}function xh(e,t){try{return new URL(t,e).toString()}catch{return t}}function Oh(e){if(!Number.isFinite(e))return"00:00";const t=Math.max(0,Math.floor(e)),r=Math.floor(t/3600),s=Math.floor(t%3600/60),n=t%60;return r>0?`${String(r).padStart(2,"0")}:${String(s).padStart(2,"0")}:${String(n).padStart(2,"0")}`:`${String(s).padStart(2,"0")}:${String(n).padStart(2,"0")}`}function Nh({src:e,poster:t,autoplay:r=!1,title:s="AkiraPlayer",channelLabel:n="SATVPlus",assetBase:i="/assets",assetBaseUrl:a,contentId:l,seasonId:u,episodeId:c,thumbnailsVtt:d,subtitles:h=[],onBack:f,recommendations:g=[],episodes:p=[],onOpenRecommendations:m,onSelectRecommendation:y,onSelectEpisode:v,recommendationsLabel:b="Te podra gustar"}){var E;const S=(a||i||"/assets").replace(/\/$/,""),T=Fl.useMemo(()=>function(e){const t=`${(e||"/assets").replace(/\/$/,"")}/media/icons/svg`;return{play:`${t}/play.svg`,pause:`${t}/pause.svg`,backward:`${t}/backward.svg`,forward:`${t}/forward.svg`,fullscreen:`${t}/fullscreen.svg`,windowed:`${t}/windowed.svg`,episodes:`${t}/episodes.svg`,volume:{mute:`${t}/volume/mute.svg`,vol0:`${t}/volume/vol0.svg`,vol1:`${t}/volume/vol1.svg`,vol2:`${t}/volume/vol2.svg`}}}(S),[S]),w=Fl.useRef(null),k=Fl.useRef(null),_=Fl.useRef(null),A=Fl.useRef(null),L=Fl.useRef(null),R=Fl.useRef(!1),I=Fl.useRef(0),P=Fl.useRef(null),C=Fl.useRef(null),[D,x]=Fl.useState(!1),[O,N]=Fl.useState(!1),[M,F]=Fl.useState(!1),[$,U]=Fl.useState(1),[B,j]=Fl.useState(!1),[G,K]=Fl.useState(!1),[H,V]=Fl.useState(!1),[z,q]=Fl.useState(0),[W,Y]=Fl.useState(0),[Q,X]=Fl.useState(0),[J,Z]=Fl.useState(!0),[ee,te]=Fl.useState(!1),[re,se]=Fl.useState(null),[ne,ie]=Fl.useState([]),[ae,oe]=Fl.useState(null),[le,ue]=Fl.useState(0),[ce,de]=Fl.useState(!1),he=G||H||B,fe=()=>{Z(!0),P.current&&(window.clearTimeout(P.current),P.current=null),D&&(P.current=window.setTimeout(()=>{ee||G||B||H||Z(!1)},2200))},ge=e=>{se({text:e,visible:!0}),C.current&&(window.clearTimeout(C.current),C.current=null),C.current=window.setTimeout(()=>{se(e=>e?{...e,visible:!1}:e)},700)},pe=()=>{K(!1),V(!1),j(!1)};Fl.useEffect(()=>{const t=k.current;if(t&&e){if(R.current=!1,L.current&&(L.current.destroy(),L.current=null),t.canPlayType("application/vnd.apple.mpegurl"))t.src=e;else if(Ml.isSupported()){const r=new Ml({enableWorker:!0,lowLatencyMode:!0});r.on(Ml.Events.ERROR,(e,t)=>{console.warn("[AkiraPlayer][HLS] error:",t)}),r.loadSource(e),r.attachMedia(t),L.current=r}else console.warn("[AkiraPlayer] HLS no soportado en este navegador");return()=>{L.current&&(L.current.destroy(),L.current=null),t.removeAttribute("src")}}},[e]),Fl.useEffect(()=>{const e=k.current;if(!e)return;const t=()=>{x(!0),fe()},s=()=>{x(!1),Z(!0)},n=()=>{q(e.currentTime||0);try{if(e.buffered&&e.buffered.length>0){const t=e.buffered.end(e.buffered.length-1);X(t)}}catch{}},i=()=>Y(e.duration||0),a=()=>{F(e.muted),U(e.volume)},o=()=>{x(!1),Z(!0),ge("Finalizado")};return e.addEventListener("play",t),e.addEventListener("pause",s),e.addEventListener("timeupdate",n),e.addEventListener("progress",n),e.addEventListener("loadedmetadata",i),e.addEventListener("durationchange",i),e.addEventListener("volumechange",a),e.addEventListener("ended",o),e.volume=1,r&&e.play().catch(()=>{}),()=>{e.removeEventListener("play",t),e.removeEventListener("pause",s),e.removeEventListener("timeupdate",n),e.removeEventListener("progress",n),e.removeEventListener("loadedmetadata",i),e.removeEventListener("durationchange",i),e.removeEventListener("volumechange",a),e.removeEventListener("ended",o)}},[r]),Fl.useEffect(()=>{const e=()=>{N(Boolean(document.fullscreenElement)),fe()};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]),Fl.useEffect(()=>{const e=k.current;if(!e)return;if(!W||!Number.isFinite(W))return;if(R.current)return;let t=!1;return(async()=>{var r;const s=await async function(e){const t=await Ih();if(!t)return null;let r=Rh.from("watch_progress").select("*").eq("user_id",t).eq("content_id",e.contentId);null!=e.seasonId&&(r=r.eq("season_id",e.seasonId)),null!=e.episodeId&&(r=r.eq("episode_id",e.episodeId));const{data:s,error:n}=await r.order("updated_at",{ascending:!1}).limit(1).maybeSingle();return n?(console.warn("[AkiraPlayer] loadProgress error:",n.message),null):s}({contentId:l,seasonId:u,episodeId:c});if(t||!s)return void(R.current=!0);const n=Number(s.position_seconds||0),i=Number(s.duration_seconds||0);if(i>0&&i-n<=(null!==(r=jl)&&void 0!==r?r:45))R.current=!0;else{if(n>0&&n<Math.max(0,W-3))try{e.currentTime=n,q(n),ge(`Continuar en ${Oh(n)}`)}catch{}R.current=!0}})(),()=>{t=!0}},[W,l,u,c]),Fl.useEffect(()=>{const e=k.current;if(!e)return;const t=()=>{const t=Date.now();if(t-I.current<Bl)return;I.current=t;const r=e.duration||0;!Number.isFinite(r)||r<=0||Ph({contentId:l,seasonId:u,episodeId:c,positionSeconds:e.currentTime||0,durationSeconds:r})};return e.addEventListener("timeupdate",t),()=>e.removeEventListener("timeupdate",t)},[l,u,c]),Fl.useEffect(()=>{const e=k.current;if(!e)return;const t=()=>{const t=e.duration||0;!Number.isFinite(t)||t<=0||Ph({contentId:l,seasonId:u,episodeId:c,positionSeconds:e.currentTime||0,durationSeconds:t})},r=()=>{"hidden"===document.visibilityState&&t()};return e.addEventListener("pause",t),window.addEventListener("beforeunload",t),document.addEventListener("visibilitychange",r),()=>{e.removeEventListener("pause",t),window.removeEventListener("beforeunload",t),document.removeEventListener("visibilitychange",r)}},[l,u,c]),Fl.useEffect(()=>{let e=!1;if(d)return(async()=>{try{const t=await async function(e){const t=await fetch(e);if(!t.ok)throw new Error(`No se pudo cargar VTT thumbnails: ${t.status}`);const r=(await t.text()).replace(/\r/g,"").split("\n"),s=[];let n=0;for(;n<r.length;){const t=r[n].trim();if(!t||"WEBVTT"===t){n++;continue}let i=t;if(!t.includes("--\x3e")){if(n++,n>=r.length)break;i=r[n].trim()}if(!i.includes("--\x3e")){n++;continue}const[a,o]=i.split("--\x3e").map(e=>e.trim()),l=Ch(a.split(" ")[0]),u=Ch(o.split(" ")[0]);for(n++;n<r.length&&!r[n].trim();)n++;if(n>=r.length)break;const c=r[n].trim();let d,h=c;const f=c.indexOf("#");f>=0&&(h=c.slice(0,f),d=Dh(c.slice(f+1))),s.push({start:l,end:u,url:xh(e,h),xywh:d}),n++}return s}(d);e||ie(t)}catch(t){console.warn("[AkiraPlayer] thumbnails VTT error:",t),e||ie([])}})(),()=>{e=!0};ie([])},[d]),Fl.useEffect(()=>{const e=w.current;if(!e)return;const t=e=>{var t;const r=e.target,s=null===(t=null==r?void 0:r.tagName)||void 0===t?void 0:t.toLowerCase();if("input"===s||"textarea"===s||(null==r?void 0:r.isContentEditable))return;const n=e.key.toLowerCase();return" "===n||"k"===n?(e.preventDefault(),void Te()):"j"===n||"arrowleft"===n?(e.preventDefault(),void we(-10)):"l"===n||"arrowright"===n?(e.preventDefault(),void we(10)):"m"===n?(e.preventDefault(),void _e()):"f"===n?(e.preventDefault(),void Le()):void("escape"===n&&(pe(),Z(!0)))};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)},[]),Fl.useEffect(()=>{const e=k.current;if(!e)return;const t=()=>{var t,r;const s=e.muted?0:e.volume,n=`${Math.max(0,Math.min(100,100*s))}%`;null===(t=w.current)||void 0===t||t.style.setProperty("--akira-volume-percent",n),null===(r=A.current)||void 0===r||r.style.setProperty("--akira-volume-percent",n)};return t(),e.addEventListener("volumechange",t),()=>{e.removeEventListener("volumechange",t)}},[]),Fl.useEffect(()=>()=>{P.current&&window.clearTimeout(P.current),C.current&&window.clearTimeout(C.current)},[]);const me=Fl.useMemo(()=>M?T.volume.mute:0===$?T.volume.vol0:$<=.5?T.volume.vol1:T.volume.vol2,[T,M,$]),ye=Fl.useMemo(()=>W&&Number.isFinite(W)?Math.max(0,Math.min(100,z/W*100)):0,[z,W]),ve=Fl.useMemo(()=>W&&Number.isFinite(W)?Math.max(0,Math.min(100,Q/W*100)):0,[Q,W]),be=Fl.useMemo(()=>null!=ae&&ne.length?function(e,t){for(const r of e)if(t>=r.start&&t<r.end)return r;return e.length?e[e.length-1]:null}(ne,ae):null,[ae,ne]),Ee=p.length>0,Se=g.length>0,Te=()=>{const e=k.current;e&&(fe(),e.paused?(e.play().catch(()=>{}),ge("Play")):(e.pause(),ge("Pause")))},we=e=>{const t=k.current;if(!t)return;const r=Number.isFinite(t.duration)?t.duration:1/0;t.currentTime=Math.max(0,Math.min(r,(t.currentTime||0)+e)),ge(e>0?`+${e}s`:`${e}s`),fe()},ke=e=>{const t=k.current;t&&(t.currentTime=e,q(e),fe())},_e=()=>{const e=k.current;e&&(e.muted=!e.muted,ge(e.muted?"Mute":"Unmute"),fe())},Ae=e=>{const t=k.current;t&&(t.volume=e,e>0&&t.muted&&(t.muted=!1),ge(`Vol ${Math.round(100*e)}%`),fe())},Le=async()=>{const e=w.current;if(e)try{document.fullscreenElement?(await document.exitFullscreen(),ge("Salir pantalla completa")):(await e.requestFullscreen(),ge("Pantalla completa"))}catch{}},Re=e=>{we("left"===e?-10:10)};return o.jsxs("div",{className:"akira-wrap "+(J?"controls-visible":"controls-hidden"),ref:w,tabIndex:0,role:"application","aria-label":"AkiraPlayer",onMouseMove:()=>{te(!0),fe()},onMouseLeave:()=>{te(!1),D&&(P.current&&window.clearTimeout(P.current),P.current=window.setTimeout(()=>{he||Z(!1)},900))},onClick:fe,onContextMenu:e=>e.preventDefault(),children:[o.jsx("video",{ref:k,className:"akira-video",poster:t,playsInline:!0,controls:!1,preload:"metadata",children:h.map(e=>o.jsx("track",{kind:"subtitles",src:e.src,srcLang:e.srclang,label:e.label,default:e.default},`${e.srclang}-${e.label}`))}),o.jsxs("div",{className:"akira-gesture-layer","aria-hidden":"true",children:[o.jsx("button",{type:"button",className:"akira-gesture-zone left",onDoubleClick:()=>Re("left"),onClick:e=>e.stopPropagation(),tabIndex:-1}),o.jsx("button",{type:"button",className:"akira-gesture-zone center",onDoubleClick:e=>e.preventDefault(),onClick:e=>{e.stopPropagation(),Te()},tabIndex:-1}),o.jsx("button",{type:"button",className:"akira-gesture-zone right",onDoubleClick:()=>Re("right"),onClick:e=>e.stopPropagation(),tabIndex:-1})]}),o.jsx("div",{className:"akira-top-overlay",children:o.jsx("div",{className:"akira-top-left",children:o.jsx("button",{type:"button",className:"akira-ghost-btn akira-back-btn",onClick:e=>{e.stopPropagation(),f?f():window.history.back()},"aria-label":"Volver",title:"Volver",children:""})})}),o.jsx("div",{className:"akira-feedback "+((null==re?void 0:re.visible)?"show":""),"aria-hidden":"true",children:o.jsx("div",{className:"akira-feedback-pill",children:null!==(E=null==re?void 0:re.text)&&void 0!==E?E:""})}),(G||H)&&o.jsx("div",{className:"akira-overlay-shell","aria-hidden":"true",onClick:e=>{e.stopPropagation(),pe(),fe()}}),G&&o.jsxs("div",{className:"akira-modal",role:"dialog","aria-modal":"true","aria-label":"Episodios",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"akira-modal-header",children:[o.jsxs("div",{className:"akira-modal-title",children:["Episodios ",p.length?`(${p.length})`:""]}),o.jsx("button",{type:"button",className:"akira-modal-close",onClick:()=>{K(!1),fe()},"aria-label":"Cerrar",title:"Cerrar",children:""})]}),o.jsx("div",{className:"akira-modal-body",children:0===p.length?o.jsx("div",{className:"akira-empty-state",children:"No hay episodios cargados todava."}):o.jsx("div",{className:"akira-episode-list",children:p.map(e=>{const t=!!c&&e.id===c,r=null!=e.seasonNumber&&null!=e.episodeNumber?`T${String(e.seasonNumber).padStart(2,"0")}  E${String(e.episodeNumber).padStart(2,"0")}`:null!=e.episodeNumber?`E${String(e.episodeNumber).padStart(2,"0")}`:"Episodio";return o.jsxs("button",{type:"button",className:"akira-episode-card "+(t?"current":""),onClick:()=>(e=>{v&&v(e.id,e),K(!1),fe()})(e),title:e.title,children:[o.jsxs("div",{className:"akira-episode-thumb",children:[e.thumbnail?o.jsx("img",{src:e.thumbnail,alt:"",loading:"lazy"}):o.jsx("div",{className:"akira-thumb-empty"}),o.jsx("span",{className:"akira-episode-badge",children:r})]}),o.jsxs("div",{className:"akira-episode-info",children:[o.jsxs("div",{className:"akira-episode-title-row",children:[o.jsx("div",{className:"akira-episode-title",children:e.title}),t&&o.jsx("span",{className:"akira-episode-current-pill",children:"Reproduciendo"})]}),e.synopsis&&o.jsx("div",{className:"akira-episode-synopsis",children:e.synopsis}),null!=e.durationSeconds&&e.durationSeconds>0&&o.jsx("div",{className:"akira-episode-meta",children:Oh(e.durationSeconds)})]})]},e.id)})})})]}),H&&!m&&o.jsxs("div",{className:"akira-modal akira-modal-reco",role:"dialog","aria-modal":"true","aria-label":b,onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"akira-modal-header",children:[o.jsx("div",{className:"akira-modal-title",children:b}),o.jsx("button",{type:"button",className:"akira-modal-close",onClick:()=>{V(!1),fe()},"aria-label":"Cerrar",title:"Cerrar",children:""})]}),o.jsx("div",{className:"akira-modal-body",children:Se?o.jsx("div",{className:"akira-reco-grid",children:g.map(e=>o.jsxs("button",{type:"button",className:"akira-reco-card",onClick:()=>(e=>{y&&y(e),V(!1),fe()})(e),title:e.title,children:[o.jsxs("div",{className:"akira-reco-poster",children:[e.poster?o.jsx("img",{src:e.poster,alt:"",loading:"lazy"}):o.jsx("div",{className:"akira-thumb-empty"}),e.type&&o.jsx("span",{className:"akira-reco-type",children:"series"===e.type?"Serie":"movie"===e.type?"Pelcula":e.type})]}),o.jsx("div",{className:"akira-reco-title",children:e.title}),e.synopsis?o.jsx("div",{className:"akira-reco-synopsis",children:e.synopsis}):null]},e.id))}):o.jsx("div",{className:"akira-empty-state",children:"No hay recomendaciones disponibles todava."})})]}),o.jsxs("div",{className:"akira-controls",onMouseEnter:()=>Z(!0),onMouseLeave:()=>{D&&fe()},children:[o.jsxs("div",{className:"akira-progress-row",children:[o.jsx("span",{className:"akira-time",children:Oh(z)}),o.jsxs("div",{className:"akira-progress-wrap",ref:_,onMouseMove:e=>{const t=_.current;if(!t||!W)return;const r=t.getBoundingClientRect(),s=Math.max(0,Math.min(r.width,e.clientX-r.left)),n=(r.width?s/r.width:0)*W;ue(s),oe(n),de(!0)},onMouseLeave:()=>{de(!1),oe(null)},children:[o.jsxs("div",{className:"akira-progress-visual","aria-hidden":"true",children:[o.jsx("div",{className:"akira-progress-track"}),o.jsx("div",{className:"akira-progress-buffered",style:{width:`${ve}%`}}),o.jsx("div",{className:"akira-progress-played",style:{width:`${ye}%`}})]}),o.jsx("input",{className:"akira-progress",type:"range",min:0,max:W||0,step:.1,value:Math.min(z,W||0),onChange:e=>ke(Number(e.target.value)),onInput:e=>ke(Number(e.target.value)),"aria-label":"Progreso"}),ce&&null!=ae&&o.jsxs("div",{className:"akira-thumb-preview",style:{left:le},children:[o.jsx("div",{className:"akira-thumb-image",children:be?be.xywh?o.jsx("div",{className:"akira-thumb-sprite",style:{backgroundImage:`url(${be.url})`,backgroundPosition:`-${be.xywh.x}px -${be.xywh.y}px`,width:`${be.xywh.w}px`,height:`${be.xywh.h}px`}}):o.jsx("img",{src:be.url,alt:""}):o.jsx("div",{className:"akira-thumb-empty"})}),o.jsx("div",{className:"akira-thumb-time",children:Oh(ae)})]})]}),o.jsx("span",{className:"akira-time",children:Oh(W)})]}),o.jsxs("div",{className:"akira-toolbar",children:[o.jsxs("div",{className:"akira-left",children:[o.jsxs("button",{type:"button",className:"akira-text-btn",onClick:e=>{e.stopPropagation(),pe(),m?m():(V(!0),fe())},title:b,"aria-label":b,children:[b,Se?o.jsx("span",{className:"akira-text-btn-count",children:g.length}):null]}),o.jsxs("button",{type:"button",className:"akira-text-btn",onClick:e=>{e.stopPropagation(),pe(),K(!0),fe()},title:"Episodios","aria-label":"Episodios",disabled:!Ee,children:["Episodios",Ee?o.jsx("span",{className:"akira-text-btn-count",children:p.length}):null]})]}),o.jsxs("div",{className:"akira-center-cluster",children:[o.jsx(Mh,{onClick:()=>we(-10),icon:T.backward,label:"Retroceder 10s",size:"xl"}),o.jsx(Mh,{onClick:Te,icon:D?T.pause:T.play,label:D?"Pause":"Play",size:"xxl",emphasized:!0,className:"playPauseBtn",imgClassName:D?"":"playSVG"}),o.jsx(Mh,{onClick:()=>we(10),icon:T.forward,label:"Adelantar 10s",size:"xl"})]}),o.jsxs("div",{className:"akira-right",children:[o.jsxs("div",{className:"akira-volume",onMouseEnter:()=>{j(!0),fe()},onMouseLeave:()=>j(!1),children:[o.jsx(Mh,{onClick:_e,icon:me,label:M?"Unmute":"Mute",size:"lg"}),o.jsx("div",{className:"akira-volume-pop "+(B?"show":""),children:o.jsx("input",{ref:A,className:"akira-volume-slider",type:"range",min:0,max:1,step:.01,value:M?0:$,onInput:e=>Ae(Number(e.target.value)),onChange:e=>Ae(Number(e.target.value)),"aria-label":"Volumen"})})]}),o.jsx(Mh,{onClick:()=>{Le()},icon:O?T.windowed:T.fullscreen,label:O?"Salir de pantalla completa":"Pantalla completa",size:"lg"})]})]})]})]})}function Mh({onClick:e,icon:t,label:r,size:s="lg",emphasized:n=!1,disabled:i=!1,className:a="",imgClassName:l=""}){return o.jsx("button",{type:"button",className:`akira-icon-btn ${s} ${n?"emphasized":""} ${a}`.trim(),onClick:e,"aria-label":r,title:r,disabled:i,children:o.jsx("img",{src:t,alt:"",className:l})})}function Fh(e,t){const r="string"==typeof e?document.querySelector(e):e;if(!r)throw new Error("AkiraPlayer: target not found");const s=L.createRoot(r);return s.render(o.jsx(Nh,{...t})),{unmount:()=>s.unmount()}}var $h={mount:Fh};e.default=$h,e.mount=Fh,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=akira-player.umd.js.map
